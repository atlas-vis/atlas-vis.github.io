/* version: 1.3.4 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","d3","pixi.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).atlas={},t.d3,t.PIXI)}(this,(function(exports,d3,PIXI){"use strict";function _interopNamespace(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var d3__namespace=_interopNamespace(d3),PIXI__namespace=_interopNamespace(PIXI);class Rectangle$1{constructor(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}toJSON(){let t={};return t.left=this.left,t.top=this.top,t.width=this.width,t.height=this.height,t}union(t){let e=Math.min(this.left,t.left),i=Math.min(this.top,t.top),r=Math.max(this.right,t.right),s=Math.max(this.bottom,t.bottom);return new Rectangle$1(e,i,r-e,s-i)}clone(){return new Rectangle$1(this.left,this.top,this.width,this.height)}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get x(){return(this.left+this.right)/2}get y(){return(this.top+this.bottom)/2}get center(){return(this.left+this.right)/2}get middle(){return(this.top+this.bottom)/2}contains(t,e){return this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e}}const nodeId="id",atlas_rowId="atlas_rowId",ScaleType=["linear","power","log","sqrt","symlog","identity","time","ordinal","band","point","ordinalColor","sequentialColor"],CurveMode={Natural:"natural",Basis:"basis",BumpX:"bumpX",BumpY:"bumpY",Linear:"linear",Step:"step",CatmullRom:"CatmullRom",Cardinal:"cardinal"},LayoutType={Grid:"grid",Circular:"circular",Stack:"stack",Treemap:"treemap",Packing:"packing",Force:"force",TidyTree:"tidytree"},Orientation={Vertical:"vertical",Horizontal:"horizontal",Angular:"angular",Radial:"radial"},Alignment={Top:"top",Left:"left",Bottom:"bottom",Right:"right",Center:"center",Middle:"middle"},ConstraintType={Align:"alignment",Distribute:"distribution",Affix:"affixation"},ItemType={Area:"area",Rect:"rect",Ellipse:"ellipse",Circle:"circle",Pie:"pie",Ring:"ring",Arc:"arc",Line:"line",Path:"path",Image:"image",PointText:"pointText",Collection:"collection",Group:"group",Scene:"scene",Axis:"axis",Glyph:"glyph",Legend:"legend",Polygon:"polygon",Gridlines:"gridlines",LinearGradient:"LinearGradient",Link:"link",DataTable:"datatable"},DataType={Boolean:"boolean",Integer:"integer",Number:"number",Date:"date",String:"string"},Aggregator={Max:"max",Min:"min",Avg:"avg",Median:"median",Sum:"sum",Count:"count",Mean:"mean",Percentile25:"percentile 25",Percentile75:"percentile 75"},Style2SVG={fillColor:"fill",strokeColor:"stroke",strokeWidth:"stroke-width",fillOpacity:"fill-opacity",strokeOpacity:"stroke-opacity",strokeDash:"stroke-dasharray",opacity:"opacity",fontSize:"font-size",fontFamily:"font-family",fontWeight:"font-weight",visibility:"visibility"},Errors={FIELD_NONEXISTENT:"Data field does not exist in the data table",INCOMPLETE_REPEAT_INFO:"Incomplete information to do repeat. You must specify an item, a categorical data field and a data table",REPEAT_BY_NONCAT:"Repeat only works on a string or date field",PARTITION_BY_NONCAT:"Divide only works on a string or date field",DENSIFY_BY_NONCAT:"Densify only works on a string or date field",COMPNT_NON_REPEATABLE:"Item not repeatable",INCOMPLETE_PARTITION_INFO:"Incomplete information to divide. You must specify an item, a categorical data field and a data table",COMPNT_NON_PARTITIONABLE:"Item cannot be divided",INCOMPLETE_DENSIFY_INFO:"Incomplete information to densify. You must specify an item, a categorical data field and a data table",COMPNT_NON_DENSIFIABLE:"Item cannot be densified",BIND_WITHOUT_DATASCOPE:"Item must be repeated or divided by data first before applyng binding",UNKNOWN_ALIGNMENT:"Unkown alignment",UNKOWNN_SCALE_TYPE:"Unknown scale type",UNKNOWN_ANCHOR:"Unknown anchor",INCOMPLETE_BINDING_INFO:"Incomplete binding information. You must specify an item, a data field and a visual channel",MULTIPLE_VALUES_PER_FIELD:"Multiple distinct field values exist",DIFFERENT_SCALE_TYPE:"Cannot merge different types of scale",INCORRECT_AXIS_INFO:"Cannot find relevant information to create an axis for ",INCORRECT_LEGEND_INFO:"Cannot find relevant information to create a legend for ",INSUFFICIENT_DATA_SCOPES:"Insufficient data to divide or densify a mark",INCORRECT_CONSTRAINT_INFO:"Constrain information is incorreclty passed",FEATURE_NOT_IMPLEMENTED:"This feature has not been implemented yet"};class Layout{constructor(t){this.group=void 0}run(){}clone(){}}class GridLayout extends Layout{constructor(t){super(),this.type="grid",this._numCols=t.numCols,this._numRows=t.numRows,this.baseline=t.baseline,this._horzDir=t.hasOwnProperty("hDir")?t.hDir:GridLayout.direction.Left2Right,this._vert2Dir=t.hasOwnProperty("vDir")?t.vDir:GridLayout.direction.Top2Bottom,this._hGap=t.hasOwnProperty("hGap")?t.hGap:5,this._vGap=t.hasOwnProperty("vGap")?t.vGap:5,this._cellHorzAlignment=Alignment.Left,this._cellVertAlignment=Alignment.Bottom}toJSON(){let t={args:{}};return t.type=this.type,t.args.numCols=this._numCols,t.args.numRows=this._numRows,t.args.baseline=this.baseline,t.args.hGap=this._hGap,t.args.vGap=this._vGap,t.args.horzCellAlignment=this._cellHorzAlignment,t.args.vertCellAlignment=this._cellVertAlignment,t.left=this._left,t.top=this._top,t}clone(){return new GridLayout({numCols:this._numCols,numRows:this._numRows,hDir:this._horzDir,vDir:this._vert2Dir,hGap:this._hGap,vGap:this._vGap})}get cellBounds(){let t,e=this.group,i=this._hGap,r=this._vGap;this._numRows?t=Math.ceil(this.group.children.length/this._numRows):this._numCols&&(t=this._numCols,Math.ceil(this.group.children.length/this._numCols));let s=e.children.map((t=>t.bounds));if(void 0===this._left){let t=s.map((t=>t.left)),e=s.map((t=>t.top));this._left=Math.min(...t),this._top=Math.min(...e)}let n=s.map((t=>t.width)),a=s.map((t=>t.height)),o=Math.max(...n),h=Math.max(...a),l=e.getInternalEncodings("x"),u=e.getInternalEncodings("y"),c=e.getInternalEncodings("width"),d=e.getInternalEncodings("height"),p=0;return l.length>0?(o=l[l.length-1].scale.rangeExtent,p=l[l.length-1].scale.range[0]):c.length>0&&c[c.length-1]._rectNegativeValues&&(o=c[c.length-1].scale.rangeExtent,p=c[c.length-1].scale.range[0]),u.length>0?h=u[u.length-1].scale.rangeExtent:d.length>0&&d[d.length-1]._rectNegativeValues&&(h=d[d.length-1].scale.rangeExtent),e.children.map(((e,s)=>new Rectangle$1(this._left+(o+i)*(s%t)+p,this._top+(h+r)*Math.floor(s/t),o,h)))}run(){if(null==this.group)return;let t=this.cellBounds,e=this.group.getInternalEncodings("x"),i=this.group.getInternalEncodings("y"),r=this.group.getInternalEncodings("width"),s=this.group.getInternalEncodings("height");for(let r=0;r<this.group.children.length;r++){let s=this.group.children[r],n=t[r],a=n.x-s.bounds.x,o=n.y-s.bounds.y;s.translate(a,o);let h=0,l=0;if(0==e.length)switch(this._cellHorzAlignment){case Alignment.Left:h=n.left-s.bounds.left;break;case Alignment.Center:h=n.x-s.bounds.x;break;case Alignment.Right:h=n.right-s.bounds.right}if(0==i.length)switch(this._cellVertAlignment){case Alignment.Top:l=n.top-s.bounds.top;break;case Alignment.Middle:l=n.y-s.bounds.y;break;case Alignment.Bottom:l=n.bottom-s.bounds.bottom}s.translate(h,l)}if(e.length>0){e[e.length-1]._apply()}else if(r.length>0){let t=r[r.length-1];t._rectNegativeValues&&t._apply()}if(i.length>0)i[i.length-1]._apply();else if(s.length>0){let t=s[s.length-1];t._rectNegativeValues&&t._apply()}this.group._updateBounds()}set hGap(t){this._hGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get hGap(){return this._hGap}set vGap(t){this._vGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get vGap(){return this._vGap}set numCols(t){this._numCols=t,this._numRows=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group)}get numCols(){return this._numCols?this._numCols:this._numRows?Math.ceil(this.group.children.length/this._numRows):void 0}set numRows(t){this._numRows=t,this._numCols=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group)}get numRows(){return this._numRows?this._numRows:this._numCols?Math.ceil(this.group.children.length/this._numCols):void 0}set vertCellAlignment(t){if(t!=Alignment.Top&&t!=Alignment.Bottom&&t!=Alignment.Middle)throw Errors.UNKOWN_ALIGNMENT;this._cellVertAlignment=t,this.run()}get vertCellAlignment(){return this._cellVertAlignment}set horzCellAlignment(t){if(t!=Alignment.Left&&t!=Alignment.Center&&t!=Alignment.Right)throw Errors.UNKOWN_ALIGNMENT;this._cellHorzAlignment=t,this.run()}get horzCellAlignment(){return this._cellHorzAlignment}}GridLayout.direction={Left2Right:"l2r",Right2Left:"r2l",Top2Bottom:"t2b",Bottom2Top:"b2t"};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function createMatch(t){return function(e){return e.test(t)}}function isMobile$1(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var s=createMatch(i),n={apple:{phone:s(appleIphone)&&!s(windowsPhone),ipod:s(appleIpod),tablet:!s(appleIphone)&&(s(appleTablet)||isAppleTabletOnIos13(e))&&!s(windowsPhone),universal:s(appleUniversal),device:(s(appleIphone)||s(appleIpod)||s(appleTablet)||s(appleUniversal)||isAppleTabletOnIos13(e))&&!s(windowsPhone)},amazon:{phone:s(amazonPhone),tablet:!s(amazonPhone)&&s(amazonTablet),device:s(amazonPhone)||s(amazonTablet)},android:{phone:!s(windowsPhone)&&s(amazonPhone)||!s(windowsPhone)&&s(androidPhone),tablet:!s(windowsPhone)&&!s(amazonPhone)&&!s(androidPhone)&&(s(amazonTablet)||s(androidTablet)),device:!s(windowsPhone)&&(s(amazonPhone)||s(amazonTablet)||s(androidPhone)||s(androidTablet))||s(/\bokhttp\b/i)},windows:{phone:s(windowsPhone),tablet:s(windowsTablet),device:s(windowsPhone)||s(windowsTablet)},other:{blackberry:s(otherBlackBerry),blackberry10:s(otherBlackBerry10),opera:s(otherOpera),firefox:s(otherFirefox),chrome:s(otherChrome),device:s(otherBlackBerry)||s(otherBlackBerry10)||s(otherOpera)||s(otherFirefox)||s(otherChrome)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}
// The ESM/CJS versions of ismobilejs only
var isMobile=isMobile$1(self.navigator),ENV$1,RENDERER_TYPE$1,BUFFER_BITS$1,BLEND_MODES$1,DRAW_MODES$1,FORMATS$1,TARGETS$1,TYPES$1,SAMPLER_TYPES$1,SCALE_MODES$1,WRAP_MODES$1,MIPMAP_MODES$1,ALPHA_MODES$1,CLEAR_MODES$1,GC_MODES$1,PRECISION$1,MASK_TYPES$1,MSAA_QUALITY$1;function maxRecommendedTextures(t){var e=!0;if(isMobile.tablet||isMobile.phone){var i;if(isMobile.apple.device)if(i=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(i[1],10)<11&&(e=!1);if(isMobile.android.device)if(i=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(i[1],10)<7&&(e=!1)}return e?t:4}function canUploadSameBuffer(){return!isMobile.apple.device}!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ENV$1||(ENV$1={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(RENDERER_TYPE$1||(RENDERER_TYPE$1={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(BUFFER_BITS$1||(BUFFER_BITS$1={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(BLEND_MODES$1||(BLEND_MODES$1={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES$1||(DRAW_MODES$1={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS$1||(FORMATS$1={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS$1||(TARGETS$1={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES$1||(TYPES$1={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(SAMPLER_TYPES$1||(SAMPLER_TYPES$1={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(SCALE_MODES$1||(SCALE_MODES$1={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES$1||(WRAP_MODES$1={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES$1||(MIPMAP_MODES$1={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES$1||(ALPHA_MODES$1={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(CLEAR_MODES$1||(CLEAR_MODES$1={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(GC_MODES$1||(GC_MODES$1={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(PRECISION$1||(PRECISION$1={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(MASK_TYPES$1||(MASK_TYPES$1={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(MSAA_QUALITY$1||(MSAA_QUALITY$1={}));var settings={MIPMAP_TEXTURES:MIPMAP_MODES$1.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:GC_MODES$1.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:WRAP_MODES$1.CLAMP,SCALE_MODE:SCALE_MODES$1.LINEAR,PRECISION_VERTEX:PRECISION$1.HIGH,PRECISION_FRAGMENT:isMobile.apple.device?PRECISION$1.HIGH:PRECISION$1.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},ENV,RENDERER_TYPE,BUFFER_BITS,BLEND_MODES,DRAW_MODES,FORMATS,TARGETS,TYPES,SAMPLER_TYPES,SCALE_MODES,WRAP_MODES,MIPMAP_MODES,ALPHA_MODES,CLEAR_MODES,GC_MODES,PRECISION,MASK_TYPES,MSAA_QUALITY;!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ENV||(ENV={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(RENDERER_TYPE||(RENDERER_TYPE={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(BUFFER_BITS||(BUFFER_BITS={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(BLEND_MODES||(BLEND_MODES={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES||(DRAW_MODES={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS||(FORMATS={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS||(TARGETS={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES||(TYPES={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(SAMPLER_TYPES||(SAMPLER_TYPES={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(SCALE_MODES||(SCALE_MODES={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES||(WRAP_MODES={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES||(MIPMAP_MODES={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES||(ALPHA_MODES={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(CLEAR_MODES||(CLEAR_MODES={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(GC_MODES||(GC_MODES={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(PRECISION||(PRECISION={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(MASK_TYPES||(MASK_TYPES={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(MSAA_QUALITY||(MSAA_QUALITY={}));var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var eventemitter3=createCommonjsModule((function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,n||t,a),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,r,s=[];if(0===this._eventsCount)return s;for(r in t=this._events)e.call(t,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},o.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,a=new Array(n);s<n;s++)a[s]=r[s].fn;return a},o.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},o.prototype.emit=function(t,e,r,s,n,a){var o=i?i+t:t;if(!this._events[o])return!1;var h,l,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,s),!0;case 5:return u.fn.call(u.context,e,r,s,n),!0;case 6:return u.fn.call(u.context,e,r,s,n,a),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,r);break;case 4:u[l].fn.call(u[l].context,e,r,s);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},o.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,r,s){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==e||s&&!o.once||r&&o.context!==r||a(this,n);else{for(var h=0,l=[],u=o.length;h<u;h++)(o[h].fn!==e||s&&!o[h].once||r&&o[h].context!==r)&&l.push(o[h]);l.length?this._events[n]=1===l.length?l[0]:l:a(this,n)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})),punycode=createCommonjsModule((function(t,e){!function(i){var r=e&&!e.nodeType&&e,s=t&&!t.nodeType&&t,n="object"==typeof commonjsGlobal&&commonjsGlobal;n.global!==n&&n.window!==n&&n.self!==n||(i=n);var a,o,h=2147483647,l=36,u=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,_=String.fromCharCode;function g(t){throw RangeError(p[t])}function m(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function y(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+m((t=t.replace(d,".")).split("."),e).join(".")}function x(t){for(var e,i,r=[],s=0,n=t.length;s<n;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<n?56320==(64512&(i=t.charCodeAt(s++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),s--):r.push(e);return r}function v(t){return m(t,(function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)})).join("")}function T(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function b(t,e,i){var r=0;for(t=i?f(t/700):t>>1,t+=f(t/e);t>455;r+=l)t=f(t/35);return f(r+36*t/(t+38))}function E(t){var e,i,r,s,n,a,o,u,c,d,p,_=[],m=t.length,y=0,x=128,T=72;for((i=t.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&g("not-basic"),_.push(t.charCodeAt(r));for(s=i>0?i+1:0;s<m;){for(n=y,a=1,o=l;s>=m&&g("invalid-input"),((u=(p=t.charCodeAt(s++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:l)>=l||u>f((h-y)/a))&&g("overflow"),y+=u*a,!(u<(c=o<=T?1:o>=T+26?26:o-T));o+=l)a>f(h/(d=l-c))&&g("overflow"),a*=d;T=b(y-n,e=_.length+1,0==n),f(y/e)>h-x&&g("overflow"),x+=f(y/e),y%=e,_.splice(y++,0,x)}return v(_)}function S(t){var e,i,r,s,n,a,o,u,c,d,p,m,y,v,E,S=[];for(m=(t=x(t)).length,e=128,i=0,n=72,a=0;a<m;++a)(p=t[a])<128&&S.push(_(p));for(r=s=S.length,s&&S.push("-");r<m;){for(o=h,a=0;a<m;++a)(p=t[a])>=e&&p<o&&(o=p);for(o-e>f((h-i)/(y=r+1))&&g("overflow"),i+=(o-e)*y,e=o,a=0;a<m;++a)if((p=t[a])<e&&++i>h&&g("overflow"),p==e){for(u=i,c=l;!(u<(d=c<=n?1:c>=n+26?26:c-n));c+=l)E=u-d,v=l-d,S.push(_(T(d+E%v,0))),u=f(E/v);S.push(_(T(u,0))),n=b(i,y,r==s),i=0,++r}++i,++e}return S.join("")}if(a={
/**
			 * A string representing the current Punycode.js version number.
			 * @memberOf punycode
			 * @type String
			 */
version:"1.3.2",ucs2:{decode:x,encode:v},decode:E,encode:S,toASCII:function(t){return y(t,(function(t){return c.test(t)?"xn--"+S(t):t}))},toUnicode:function(t){return y(t,(function(t){return u.test(t)?E(t.slice(4).toLowerCase()):t}))}},r&&s)if(t.exports==r)s.exports=a;else for(o in a)a.hasOwnProperty(o)&&(r[o]=a[o]);else i.punycode=a}(commonjsGlobal)})),util={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var decode=function(t,e,i,r){e=e||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var n=/\+/g;t=t.split(e);var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var o=t.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l,u,c,d,p=t[h].replace(n,"%20"),f=p.indexOf(i);f>=0?(l=p.substr(0,f),u=p.substr(f+1)):(l=p,u=""),c=decodeURIComponent(l),d=decodeURIComponent(u),hasOwnProperty(s,c)?Array.isArray(s[c])?s[c].push(d):s[c]=[s[c],d]:s[c]=d}return s},stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},encode=function(t,e,i,r){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(r){var s=encodeURIComponent(stringifyPrimitive(r))+i;return Array.isArray(t[r])?t[r].map((function(t){return s+encodeURIComponent(stringifyPrimitive(t))})).join(e):s+encodeURIComponent(stringifyPrimitive(t[r]))})).join(e):r?encodeURIComponent(stringifyPrimitive(r))+i+encodeURIComponent(stringifyPrimitive(t)):""},querystring=createCommonjsModule((function(t,e){e.decode=e.parse=decode,e.encode=e.stringify=encode}));querystring.decode,querystring.parse,querystring.encode,querystring.stringify;var parse=urlParse,resolve=urlResolve,format=urlFormat;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(t,e,i){if(t&&util.isObject(t)&&t instanceof Url)return t;var r=new Url;return r.parse(t,e,i),r}function urlFormat(t){return util.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)}Url.prototype.parse=function(t,e,i){if(!util.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),s=-1!==r&&r<t.indexOf("#")?"?":"#",n=t.split(s);n[0]=n[0].replace(/\\/g,"/");var a=t=n.join(s);if(a=a.trim(),!i&&1===t.split("#").length){var o=simplePathPattern.exec(a);if(o)return this.path=a,this.href=a,this.pathname=o[1],o[2]?(this.search=o[2],this.query=e?querystring.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=protocolPattern.exec(a);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,a=a.substr(h.length)}if(i||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===a.substr(0,2);!u||h&&hostlessProtocol[h]||(a=a.substr(2),this.slashes=!0)}if(!hostlessProtocol[h]&&(u||h&&!slashedProtocol[h])){for(var c,d,p=-1,f=0;f<hostEndingChars.length;f++){-1!==(_=a.indexOf(hostEndingChars[f]))&&(-1===p||_<p)&&(p=_)}-1!==(d=-1===p?a.lastIndexOf("@"):a.lastIndexOf("@",p))&&(c=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(c)),p=-1;for(f=0;f<nonHostChars.length;f++){var _;-1!==(_=a.indexOf(nonHostChars[f]))&&(-1===p||_<p)&&(p=_)}-1===p&&(p=a.length),this.host=a.slice(0,p),a=a.slice(p),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),y=(f=0,m.length);f<y;f++){var x=m[f];if(x&&!x.match(hostnamePartPattern)){for(var v="",T=0,b=x.length;T<b;T++)x.charCodeAt(T)>127?v+="x":v+=x[T];if(!v.match(hostnamePartPattern)){var E=m.slice(0,f),S=m.slice(f+1),A=x.match(hostnamePartStart);A&&(E.push(A[1]),S.unshift(A[2])),S.length&&(a="/"+S.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=punycode.toASCII(this.hostname));var I=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+I,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!unsafeProtocol[l])for(f=0,y=autoEscape.length;f<y;f++){var w=autoEscape[f];if(-1!==a.indexOf(w)){var R=encodeURIComponent(w);R===w&&(R=escape(w)),a=a.split(w).join(R)}}var O=a.indexOf("#");-1!==O&&(this.hash=a.substr(O),a=a.slice(0,O));var P=a.indexOf("?");if(-1!==P?(this.search=a.substr(P),this.query=a.substr(P+1),e&&(this.query=querystring.parse(this.query)),a=a.slice(0,P)):e&&(this.search="",this.query={}),a&&(this.pathname=a),slashedProtocol[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){I=this.pathname||"";var M=this.search||"";this.path=I+M}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(n=querystring.stringify(this.query));var a=this.search||n&&"?"+n||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&!1!==s?(s="//"+(s||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+s+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+r},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(util.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var i=new Url,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];i[n]=this[n]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),o=0;o<a.length;o++){var h=a[o];"protocol"!==h&&(i[h]=t[h])}return slashedProtocol[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!slashedProtocol[t.protocol]){for(var l=Object.keys(t),u=0;u<l.length;u++){var c=l[u];i[c]=t[c]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])i.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),i.pathname=d.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var p=i.pathname||"",f=i.search||"";i.path=p+f}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var _=i.pathname&&"/"===i.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),m=g||_||i.host&&t.pathname,y=m,x=i.pathname&&i.pathname.split("/")||[],v=(d=t.pathname&&t.pathname.split("/")||[],i.protocol&&!slashedProtocol[i.protocol]);if(v&&(i.hostname="",i.port=null,i.host&&(""===x[0]?x[0]=i.host:x.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),m=m&&(""===d[0]||""===x[0])),g)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,x=d;else if(d.length)x||(x=[]),x.pop(),x=x.concat(d),i.search=t.search,i.query=t.query;else if(!util.isNullOrUndefined(t.search)){if(v)i.hostname=i.host=x.shift(),(A=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=A.shift(),i.host=i.hostname=A.shift());return i.search=t.search,i.query=t.query,util.isNull(i.pathname)&&util.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!x.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var T=x.slice(-1)[0],b=(i.host||t.host||x.length>1)&&("."===T||".."===T)||""===T,E=0,S=x.length;S>=0;S--)"."===(T=x[S])?x.splice(S,1):".."===T?(x.splice(S,1),E++):E&&(x.splice(S,1),E--);if(!m&&!y)for(;E--;E)x.unshift("..");!m||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),b&&"/"!==x.join("/").substr(-1)&&x.push("");var A,I=""===x[0]||x[0]&&"/"===x[0].charAt(0);v&&(i.hostname=i.host=I?"":x.length?x.shift():"",(A=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=A.shift(),i.host=i.hostname=A.shift()));return(m=m||i.host&&x.length)&&!I&&x.unshift(""),x.length?i.pathname=x.join("/"):(i.pathname=null,i.path=null),util.isNull(i.pathname)&&util.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},Url.prototype.parseHost=function(){var t=this.host,e=portPattern.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var url={parse:parse,format:format,resolve:resolve};settings.RETINA_PREFIX=/@([0-9\.]+)x/,
/**
	 * Should the `failIfMajorPerformanceCaveat` flag be enabled as a context option used in the `isWebGLSupported` function.
	 * If set to true, a WebGL renderer can fail to be created if the browser thinks there could be performance issues when
	 * using WebGL.
	 *
	 * In PixiJS v6 this has changed from true to false by default, to allow WebGL to work in as many scenarios as possible.
	 * However, some users may have a poor experience, for example, if a user has a gpu or driver version blacklisted by the
	 * browser.
	 *
	 * If your application requires high performance rendering, you may wish to set this to false.
	 * We recommend one of two options if you decide to set this flag to false:
	 *
	 * 1: Use the `pixi.js-legacy` package, which includes a Canvas renderer as a fallback in case high performance WebGL is
	 *    not supported.
	 *
	 * 2: Call `isWebGLSupported` (which if found in the PIXI.utils package) in your code before attempting to create a PixiJS
	 *    renderer, and show an error message to the user if the function returns false, explaining that their device & browser
	 *    combination does not support high performance WebGL.
	 *    This is a much better strategy than trying to create a PixiJS renderer and finding it then fails.
	 *
	 * @static
	 * @name FAIL_IF_MAJOR_PERFORMANCE_CAVEAT
	 * @memberof PIXI.settings
	 * @type {boolean}
	 * @default false
	 */
settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello=!1,VERSION="6.0.4",supported;
/**
	 * Logs out the version and renderer information for this running instance of PIXI.
	 * If you don't want to see this message you can run `PIXI.utils.skipHello()` before
	 * creating your renderer. Keep in mind that doing that will forever make you a jerk face.
	 *
	 * @static
	 * @function sayHello
	 * @memberof PIXI.utils
	 * @param {string} type - The string renderer type to log.
	 */
function sayHello(t){var e;if(!saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["\n %c %c %c PixiJS "+VERSION+" - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,i)}else self.console&&self.console.log("PixiJS "+VERSION+" - "+t+" - http://www.pixijs.com/");saidHello=!0}}function isWebGLSupported(){return void 0===supported&&(supported=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!i||!i.getContextAttributes().stencil);if(i){var s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,r}catch(t){return!1}}()),supported}function hex2rgb(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function hex2string(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function mapPremultipliedBlendModes(){for(var t=[],e=[],i=0;i<32;i++)t[i]=i,e[i]=i;t[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,t[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,t[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,e[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,e[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,e[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}var premultiplyBlendMode=mapPremultipliedBlendModes();function premultiplyTint(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var i=t>>16&255,r=t>>8&255,s=255&t;return(255*e<<24)+((i=i*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(s=s*e+.5|0)}function nextPow2(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function isPow2(t){return!(t&t-1||!t)}function log2(t){var e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,e|=i=((t>>>=i)>15?1:0)<<2,(e|=i=((t>>>=i)>3?1:0)<<1)|(t>>>=i)>>1}function removeItems(t,e,i){var r,s=t.length;if(!(e>=s||0===i)){var n=s-(i=e+i>s?s-e:i);for(r=e;r<n;++r)t[r]=t[r+i];t.length=n}}var nextUid=0;function uid(){return++nextUid}var warnings={};
/**
	 * Helper for warning developers about deprecated features & settings.
	 * A stack track for warnings is given; useful for tracking-down where
	 * deprecated methods/properties/classes are being used within the code.
	 *
	 * @memberof PIXI.utils
	 * @function deprecation
	 * @param {string} version - The version where the feature became deprecated
	 * @param {string} message - Message should include what is deprecated, where, and the new solution
	 * @param {number} [ignoreDepth=3] - The number of steps to ignore at the top of the error stack
	 *        this is mostly to ignore internal deprecation calls.
	 */function deprecation(t,e,i){if(void 0===i&&(i=3),!warnings[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),warnings[e]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null),tempAnchor;function determineCrossOrigin(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=t;var i=url.parse(tempAnchor.href),r=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&r&&i.protocol===e.protocol?"":"anonymous"}function getResolutionOfUrl(t,e){var i=settings.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}!function(){function t(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||settings.RESOLUTION,this.resize(t,e)}t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0})}();var Runner=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,i,r,s,n,a,o){if(arguments.length>8)throw new Error("max arguments reached");var h=this,l=h.name,u=h.items;this._aliasCount++;for(var c=0,d=u.length;c<d;c++)u[c][l](t,e,i,r,s,n,a,o);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}(),UPDATE_PRIORITY;Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}}),settings.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=0),void 0===r&&(r=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),Ticker=function(){function t(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,i){return void 0===i&&(i=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(t,e,i))},t.prototype.addOnce=function(t,e,i){return void 0===i&&(i=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(t,e,i,!0))},t.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var r=this._head,s=r.next;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),PI_2=2*Math.PI,SHAPES;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(SHAPES||(SHAPES={}));var Rectangle=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=SHAPES.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(s-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=s-r,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),Point$1=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),ObservablePoint=function(){function t(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this._x=i,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,i){return void 0===e&&(e=this.cb),void 0===i&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Matrix=function(){function t(t,e,i,r,s,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===n&&(n=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=n}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,i,r,s,n){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=n,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.prototype.apply=function(t,e){e=e||new Point$1;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Point$1;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return e.x=this.d*i*r+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,n=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this},t.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},t.prototype.setTransform=function(t,e,i,r,s,n,a,o,h){return this.a=Math.cos(a+h)*s,this.b=Math.sin(a+h)*s,this.c=-Math.sin(a-o)*n,this.d=Math.cos(a-o)*n,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,s=this.d,n=t.pivot,a=-Math.atan2(-r,s),o=Math.atan2(i,e),h=Math.abs(a+o);return h<1e-5||Math.abs(PI_2-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+s*s),t.position.x=this.tx+(n.x*e+n.y*r),t.position.y=this.ty+(n.x*i+n.y*s),t},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,s=this.tx,n=t*r-e*i;return this.a=r/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-r*s)/n,this.ty=-(t*this.ty-e*s)/n,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(var t=0;t<16;t++){var e=[];rotationCayley.push(e);for(var i=0;i<16;i++)for(var r=signum(ux[t]*ux[i]+vx[t]*uy[i]),s=signum(uy[t]*ux[i]+vy[t]*uy[i]),n=signum(ux[t]*vx[i]+vx[t]*vy[i]),a=signum(uy[t]*vx[i]+vy[t]*vy[i]),o=0;o<16;o++)if(ux[o]===r&&uy[o]===s&&vx[o]===n&&vy[o]===a){e.push(o);break}}for(t=0;t<16;t++){var h=new Matrix;h.set(ux[t],uy[t],vx[t],vy[t],0,0),rotationMatrices.push(h)}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return ux[t]},uY:function(t){return uy[t]},vX:function(t){return vx[t]},vY:function(t){return vy[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return rotationCayley[t][e]},sub:function(t,e){return rotationCayley[t][groupD8.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?groupD8.S:groupD8.N:2*Math.abs(e)<=Math.abs(t)?t>0?groupD8.E:groupD8.W:e>0?t>0?groupD8.SE:groupD8.SW:t>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var s=rotationMatrices[groupD8.inv(e)];s.tx=i,s.ty=r,t.append(s)}};
/**
	 * Transform that takes care about its versions
	 *
	 * @class
	 * @memberof PIXI
	 */!function(){function t(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t}(),
/**
	 * The maximum support for using WebGL. If a device does not
	 * support WebGL version, for instance WebGL 2, it will still
	 * attempt to fallback support to WebGL 1. If you want to
	 * explicitly remove feature support to target a more stable
	 * baseline, prefer a lower environment.
	 *
	 * Due to {@link https://bugs.chromium.org/p/chromium/issues/detail?id=934823|bug in chromium}
	 * we disable webgl2 by default for all non-apple mobile devices.
	 *
	 * @static
	 * @name PREFER_ENV
	 * @memberof PIXI.settings
	 * @type {number}
	 * @default PIXI.ENV.WEBGL2
	 */
settings.PREFER_ENV=isMobile.any?ENV.WEBGL:ENV.WEBGL2,settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(t,e){if(!t)return null;var i="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var s=INSTALLED.length-1;s>=0;--s){var n=INSTALLED[s];if(n.test&&n.test(t,i))return new n(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function __extends(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Resource=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,i){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),BufferResource=function(t){function e(e,i){var r=this,s=i||{},n=s.width,a=s.height;if(!n||!a)throw new Error("BufferResource width or height invalid");return(r=t.call(this,n,a)||this).data=e,r}return __extends(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES.UNPACK);var s=e.realWidth,n=e.realHeight;return i.width===s&&i.height===n?r.texSubImage2D(e.target,0,0,0,s,n,e.format,e.type,this.data):(i.width=s,i.height=n,r.texImage2D(e.target,0,i.internalFormat,s,n,0,e.format,i.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Resource),defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM},BaseTexture=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this)||this,s=(i=i||{}).alphaMode,n=i.mipmap,a=i.anisotropicLevel,o=i.scaleMode,h=i.width,l=i.height,u=i.wrapMode,c=i.format,d=i.type,p=i.target,f=i.resolution,_=i.resourceOptions;return!e||e instanceof Resource||((e=autoDetectResource(e,_)).internal=!0),r.width=h||0,r.height=l||0,r.resolution=f||settings.RESOLUTION,r.mipmap=void 0!==n?n:settings.MIPMAP_TEXTURES,r.anisotropicLevel=void 0!==a?a:settings.ANISOTROPIC_LEVEL,r.wrapMode=u||settings.WRAP_MODE,r.scaleMode=void 0!==o?o:settings.SCALE_MODE,r.format=c||FORMATS.RGBA,r.type=d||TYPES.UNSIGNED_BYTE,r.target=p||TARGETS.TEXTURE_2D,r.alphaMode=void 0!==s?s:ALPHA_MODES.UNPACK,r.uid=uid(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=h>0&&l>0,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}return __extends(e,t),Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT()),this},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,i,r){void 0===r&&(r=settings.STRICT_TEXTURE_CACHE);var s="string"==typeof t,n=null;if(s)n=t;else{if(!t._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+uid()}n=t._pixiId}var o=BaseTextureCache[n];if(s&&r&&!o)throw new Error('The cacheId "'+n+'" does not exist in BaseTextureCache.');return o||((o=new e(t,i)).cacheId=n,e.addToCache(o,n)),o},e.fromBuffer=function(t,i,r,s){t=t||new Float32Array(i*r*4);var n=new BufferResource(t,{width:i,height:r}),a=t instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new e(n,Object.assign(defaultBufferOptions,s||{width:i,height:r,type:a}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),BaseTextureCache[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),BaseTextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=BaseTextureCache[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete BaseTextureCache[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete BaseTextureCache[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(eventemitter3),AbstractMultiResource=function(t){function e(e,i){var r=this,s=i||{},n=s.width,a=s.height;(r=t.call(this,n,a)||this).items=[],r.itemDirtyIds=[];for(var o=0;o<e;o++){var h=new BaseTexture;r.items.push(h),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return __extends(e,t),e.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Resource?this.addResourceAt(t[i],i):this.addResourceAt(autoDetectResource(t[i],e),i))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],i=e.realWidth,r=e.realHeight;return t.resize(i,r),Promise.resolve(t)})),this._load},e}(Resource),ArrayResource=function(t){function e(e,i){var r,s,n=this,a=i||{},o=a.width,h=a.height;return Array.isArray(e)?(r=e,s=e.length):s=e,n=t.call(this,s,{width:o,height:h})||this,r&&n.initFromArray(r,i),n}return __extends(e,t),e.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=TARGETS.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,e,i){var r=this,s=r.length,n=r.itemDirtyIds,a=r.items,o=t.gl;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,s,0,e.format,e.type,null);for(var h=0;h<s;h++){var l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,e.type,l.resource.source))}return!0},e}(AbstractMultiResource),BaseImageResource=function(t){function e(e){var i=this,r=e,s=r.naturalWidth||r.videoWidth||r.width,n=r.naturalHeight||r.videoHeight||r.height;return(i=t.call(this,s,n)||this).source=e,i.noSubImage=!1,i}return __extends(e,t),e.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=determineCrossOrigin(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},e.prototype.upload=function(t,e,i,r){var s=t.gl,n=e.realWidth,a=e.realHeight;return r=r||this.source,s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||i.width!==n||i.height!==a?(i.width=n,i.height=a,s.texImage2D(e.target,0,e.format,e.format,e.type,r)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,e.type,r),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Resource),CanvasResource=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(BaseImageResource),CubeResource=function(t){function e(i,r){var s=this,n=r||{},a=n.width,o=n.height,h=n.autoLoad,l=n.linkBaseTexture;if(i&&i.length!==e.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");s=t.call(this,6,{width:a,height:o})||this;for(var u=0;u<e.SIDES;u++)s.items[u].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+u;return s.linkBaseTexture=!1!==l,i&&s.initFromArray(i,r),!1!==h&&s.load(),s}return __extends(e,t),e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=TARGETS.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,e,i){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},e.prototype.upload=function(t,i,r){for(var s=this.itemDirtyIds,n=0;n<e.SIDES;n++){var a=this.items[n];s[n]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(t,a,r),s[n]=a.dirtyId):s[n]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,i.realWidth,i.realHeight,0,i.format,r.type,null),s[n]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(AbstractMultiResource),ImageResource=function(t){function e(e,i){var r=this;if(i=i||{},!(e instanceof HTMLImageElement)){var s=new Image;BaseImageResource.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}return r=t.call(this,e)||this,
// FireFox 68, and possibly other versions, seems like setting the HTMLImageElement#width and #height
!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==i.createBitmap?i.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,r.alphaMode="number"==typeof i.alphaMode?i.alphaMode:null,r.bitmap=null,r._load=null,!1!==i.autoLoad&&r.load(),r}return __extends(e,t),e.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,i){var r=e.source;e.url=r.src;var s=function(){e.destroyed||(r.onload=null,r.onerror=null,e.resize(r.width,r.height),e._load=null,e.createBitmap?t(e.process()):t(e))};r.complete&&r.src?s():(r.onload=s,r.onerror=function(t){i(t),e.onError.emit(t)})}))),this._load},e.prototype.process=function(){var t=this,e=this.source;return null!==this._process?this._process:null===this.bitmap&&self.createImageBitmap?(this._process=self.createImageBitmap(e,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"}).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},e.prototype.upload=function(e,i,r){if("number"==typeof this.alphaMode&&(i.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,i,r,this.bitmap),!this.preserveBitmap){var s=!0,n=i._glTextures;for(var a in n){var o=n[a];if(o!==r&&o.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},e}(BaseImageResource),SVGResource=function(t){function e(e,i){var r=this;return i=i||{},(r=t.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=i.scale||1,r._overrideWidth=i.width,r._overrideHeight=i.height,r._resolve=null,r._crossorigin=i.crossorigin,r._load=null,!1!==i.autoLoad&&r.load(),r}return __extends(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;BaseImageResource.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(i){t._resolve&&(e.onerror=null,t.onError.emit(i))},e.onload=function(){if(t._resolve){var i=e.width,r=e.height;if(!i||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var s=i*t.scale,n=r*t.scale;(t._overrideWidth||t._overrideHeight)&&(s=t._overrideWidth||t._overrideHeight/r*i,n=t._overrideHeight||t._overrideWidth/i*r),s=Math.round(s),n=Math.round(n);var a=t.source;a.width=s,a.height=n,a._pixiId="canvas_"+uid(),a.getContext("2d").drawImage(e,0,0,i,r,0,0,s,n),t._resolve(),t._resolve=null}}},e.getSize=function(t){var i=e.SVG_SIZE.exec(t),r={};return i&&(r[i[1]]=Math.round(parseFloat(i[3])),r[i[5]]=Math.round(parseFloat(i[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&0===t.indexOf("<svg")},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(BaseImageResource),VideoResource=function(t){function e(i,r){var s=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof i&&(i=[i]);var a=i[0].src||i[0];BaseImageResource.crossOrigin(n,a,r.crossorigin);for(var o=0;o<i.length;++o){var h=document.createElement("source"),l=i[o],u=l.src,c=l.mime,d=(u=u||i[o]).split("?").shift().toLowerCase(),p=d.substr(d.lastIndexOf(".")+1);c=c||e.MIME_TYPES[p]||"video/"+p,h.src=u,h.type=c,n.appendChild(h)}i=n}return(s=t.call(this,i)||this).noSubImage=!0,s._autoUpdate=!0,s._isConnectedToTicker=!1,s._updateFPS=r.updateFPS||0,s._msToNextUpdate=0,s.autoPlay=!1!==r.autoPlay,s._load=null,s._resolve=null,s._onCanPlay=s._onCanPlay.bind(s),s._onError=s._onError.bind(s),!1!==r.autoLoad&&s.load(),s}return __extends(e,t),e.prototype.update=function(e){if(!this.destroyed){var i=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(i){t.valid?i(t):(t._resolve=i,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&Ticker.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,i){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(i)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(BaseImageResource),ImageBitmapResource=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},e}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var _resources={__proto__:null,Resource:Resource,BaseImageResource:BaseImageResource,INSTALLED:INSTALLED,autoDetectResource:autoDetectResource,AbstractMultiResource:AbstractMultiResource,ArrayResource:ArrayResource,BufferResource:BufferResource,CanvasResource:CanvasResource,CubeResource:CubeResource,ImageResource:ImageResource,SVGResource:SVGResource,VideoResource:VideoResource,ImageBitmapResource:ImageBitmapResource},System=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),DepthResource=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES.UNPACK);var s=e.realWidth,n=e.realHeight;return i.width===s&&i.height===n?r.texSubImage2D(e.target,0,0,0,s,n,e.format,e.type,this.data):(i.width=s,i.height=n,r.texImage2D(e.target,0,1===t.context.webGLVersion?r.DEPTH_COMPONENT:r.DEPTH_COMPONENT16,s,n,0,e.format,e.type,this.data)),!0},e}(BufferResource),Framebuffer=function(){function t(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(t){return this.depthTexture=t||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],s=r.resolution;r.setSize(t/s,e/s)}if(this.depthTexture){s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),BaseRenderTexture=function(t){function e(e){var i=this;if("number"==typeof e){var r=arguments[0],s=arguments[1],n=arguments[2],a=arguments[3];e={width:r,height:s,scaleMode:n,resolution:a}}i=t.call(this,null,e)||this;var o=e||{},h=o.width,l=o.height;return i.mipmap=MIPMAP_MODES.OFF,i.width=Math.ceil(h)||100,i.height=Math.ceil(l)||100,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Framebuffer(i.width*i.resolution,i.height*i.resolution).addColorTexture(0,i),i.maskStack=[],i.filterStack=[{}],i}return __extends(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(BaseTexture),TextureUvs=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,i){var r=e.width,s=e.height;if(i){var n=t.width/2/r,a=t.height/2/s,o=t.x/r+n,h=t.y/s+a;i=groupD8.add(i,groupD8.NW),this.x0=o+n*groupD8.uX(i),this.y0=h+a*groupD8.uY(i),i=groupD8.add(i,2),this.x1=o+n*groupD8.uX(i),this.y1=h+a*groupD8.uY(i),i=groupD8.add(i,2),this.x2=o+n*groupD8.uX(i),this.y2=h+a*groupD8.uY(i),i=groupD8.add(i,2),this.x3=o+n*groupD8.uX(i),this.y3=h+a*groupD8.uY(i)}else this.x0=t.x/r,this.y0=t.y/s,this.x1=(t.x+t.width)/r,this.y1=t.y/s,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/s,this.x3=t.x/r,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},t}(),DEFAULT_UVS=new TextureUvs,Texture=function(t){function e(i,r,s,n,a,o){var h=t.call(this)||this;if(h.noFrame=!1,r||(h.noFrame=!0,r=new Rectangle(0,0,1,1)),i instanceof e&&(i=i.baseTexture),h.baseTexture=i,h._frame=r,h.trim=n,h.valid=!1,h._uvs=DEFAULT_UVS,h.uvMatrix=null,h.orig=s||r,h._rotate=Number(a||0),!0===a)h._rotate=2;else if(h._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=o?new Point$1(o.x,o.y):new Point$1(0,0),h._updateID=0,h.textureCacheIds=[],i.valid?h.noFrame?i.valid&&h.onBaseTextureUpdated(i):h.frame=r:i.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&i.on("update",h.onBaseTextureUpdated,h),h}return __extends(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var i=this.baseTexture.resource;i&&i.url&&TextureCache[i.url]&&e.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),r=new e(this.baseTexture,!this.noFrame&&t,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r},e.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,i,r){void 0===i&&(i={}),void 0===r&&(r=settings.STRICT_TEXTURE_CACHE);var s="string"==typeof t,n=null;if(s)n=t;else{if(!t._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+uid()}n=t._pixiId}var o=TextureCache[n];if(s&&r&&!o)throw new Error('The cacheId "'+n+'" does not exist in TextureCache.');return o||(i.resolution||(i.resolution=getResolutionOfUrl(t)),(o=new e(new BaseTexture(t,i))).baseTexture.cacheId=n,BaseTexture.addToCache(o.baseTexture,n),e.addToCache(o,n)),o},e.fromURL=function(t,i){var r=Object.assign({autoLoad:!1},null==i?void 0:i.resourceOptions),s=e.from(t,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then((function(){return Promise.resolve(s)}))},e.fromBuffer=function(t,i,r,s){return new e(BaseTexture.fromBuffer(t,i,r,s))},e.fromLoader=function(t,i,r,s){var n=new BaseTexture(t,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(i)},s)),a=n.resource;a instanceof ImageResource&&(a.url=i);var o=new e(n);return r||(r=i),BaseTexture.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==i&&(BaseTexture.addToCache(o.baseTexture,i),e.addToCache(o,i)),o.baseTexture.valid?Promise.resolve(o):new Promise((function(t){o.baseTexture.once("loaded",(function(){return t(o)}))}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),TextureCache[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),TextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=TextureCache[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete TextureCache[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)TextureCache[t.textureCacheIds[r]]===t&&delete TextureCache[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,r=t.width,s=t.height,n=e+r>this.baseTexture.width,a=i+s>this.baseTexture.height;if(n||a){var o=n&&a?"and":"or",h="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,l="Y: "+i+" + "+s+" = "+(i+s)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+h+" "+o+" "+l)}this.valid=r&&s&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(eventemitter3);function createWhiteTexture(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Texture(new BaseTexture(new CanvasResource(t)))}function removeAllHandlers(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Texture.EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture.EMPTY),removeAllHandlers(Texture.EMPTY.baseTexture),Texture.WHITE=createWhiteTexture(),removeAllHandlers(Texture.WHITE),removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return __extends(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,i){void 0===i&&(i=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,i&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){for(var i=arguments,r=[],s=1;s<arguments.length;s++)r[s-1]=i[s];return"number"==typeof t&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:r[0],scaleMode:r[1],resolution:r[2]}),new e(new BaseRenderTexture(t))},e}(Texture),RenderTexturePool=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e){var i=new BaseRenderTexture(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new RenderTexture(i)},t.prototype.getOptimalTexture=function(e,i,r){void 0===r&&(r=1);var s=t.SCREEN_KEY;e*=r,i*=r,this.enableFullScreen&&e===this._pixelsWidth&&i===this._pixelsHeight||(s=(65535&(e=nextPow2(e)))<<16|65535&(i=nextPow2(i))),this.texturePool[s]||(this.texturePool[s]=[]);var n=this.texturePool[s].pop();return n||(n=this.createTexture(e,i)),n.filterPoolKey=s,n.setResolution(r),n},t.prototype.getFilterTexture=function(t,e){var i=this.getOptimalTexture(t.width,t.height,e||t.resolution);return i.filterFrame=t.filterFrame,i},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var i=t.SCREEN_KEY,r=this.texturePool[i];if(this.enableFullScreen=e.width>0&&e.height>0,r)for(var s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY="screen",t}(),Attribute=function(){function t(t,e,i,r,s,n,a){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=TYPES.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=s,this.start=n,this.instance=a}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,s,n){return new t(e,i,r,s,n)},t}(),UID=0,Buffer=function(){function t(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=UID++,this.disposeRunner=new Runner("disposeBuffer")}return t.prototype.update=function(t){this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}();function getBufferType(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var map={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays(t,e){for(var i=0,r=0,s={},n=0;n<t.length;n++)r+=e[n],i+=t[n].length;var a=new ArrayBuffer(4*i),o=null,h=0;for(n=0;n<t.length;n++){var l=e[n],u=t[n],c=getBufferType(u);s[c]||(s[c]=new map[c](a)),o=s[c];for(var d=0;d<u.length;d++){o[(d/l|0)*r+h+d%l]=u[d]}h+=l}return new Float32Array(a)}var byteSizeMap={5126:4,5123:2,5121:1},UID$1=0,map$1={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Geometry=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=UID$1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,i,r,s,n,a,o){if(void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Buffer||(e instanceof Array&&(e=new Float32Array(e)),e=new Buffer(e));var h=t.split("|");if(h.length>1){for(var l=0;l<h.length;l++)this.addAttribute(h[l],e,i,r,s);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Attribute(u,i,r,s,n,a,o),this.instanced=this.instanced||o,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof Buffer||(t instanceof Array&&(t=new Uint16Array(t)),t=new Buffer(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],r=new Buffer;for(t in this.attributes){var s=this.attributes[t],n=this.buffers[s.buffer];e.push(n.data),i.push(s.size*byteSizeMap[s.type]/4),s.buffer=0}for(r.data=interleaveTypedArrays(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new Buffer(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new Attribute(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},t.merge=function(e){for(var i,r=new t,s=[],n=[],a=[],o=0;o<e.length;o++){i=e[o];for(var h=0;h<i.buffers.length;h++)n[h]=n[h]||0,n[h]+=i.buffers[h].data.length,a[h]=0}for(o=0;o<i.buffers.length;o++)s[o]=new(map$1[getBufferType(i.buffers[o].data)])(n[o]),r.buffers[o]=new Buffer(s[o]);for(o=0;o<e.length;o++){i=e[o];for(h=0;h<i.buffers.length;h++)s[h].set(i.buffers[h].data,a[h]),a[h]+=i.buffers[h].data.length}if(r.attributes=i.attributes,i.indexBuffer){r.indexBuffer=r.buffers[i.buffers.indexOf(i.indexBuffer)],r.indexBuffer.index=!0;var l=0,u=0,c=0,d=0;for(o=0;o<i.buffers.length;o++)if(i.buffers[o]!==i.indexBuffer){d=o;break}for(var o in i.attributes){var p=i.attributes[o];(0|p.buffer)===d&&(u+=p.size*byteSizeMap[p.type]/4)}for(o=0;o<e.length;o++){var f=e[o].indexBuffer.data;for(h=0;h<f.length;h++)r.indexBuffer.data[h+c]+=l;l+=i.buffers[d].data.length/u,c+=f.length}}return r},t}(),Quad=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return __extends(e,t),e}(Geometry),QuadUv=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new Buffer(e.vertices),e.uvBuffer=new Buffer(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return __extends(e,t),e.prototype.map=function(t,e){var i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(Geometry),UID$2=0,UniformGroup=function(){function t(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},
/**
	         * dirty version
	         * @protected
	         * @member {number}
	         */
this.dirtyId=0,this.id=UID$2++,this.static=!!e}return t.prototype.update=function(){this.dirtyId++},t.prototype.add=function(e,i,r){this.uniforms[e]=new t(i,r)},t.from=function(e,i){return new t(e,i)},t}(),FilterState=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),tempPoints=[new Point$1,new Point$1,new Point$1,new Point$1],tempMatrix=new Matrix,FilterSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.defaultFilterStack=[{}],i.texturePool=new RenderTexturePool,i.texturePool.setScreenSize(e.view),i.statePool=[],i.quad=new Quad,i.quadUv=new QuadUv,i.tempRect=new Rectangle,i.activeState={},i.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),i.forceClear=!1,i.useMaxPadding=!1,i}return __extends(e,t),e.prototype.push=function(t,e){for(var i=this.renderer,r=this.defaultFilterStack,s=this.statePool.pop()||new FilterState,n=this.renderer.renderTexture,a=e[0].resolution,o=e[0].padding,h=e[0].autoFit,l=e[0].legacy,u=1;u<e.length;u++){var c=e[u];a=Math.min(a,c.resolution),o=this.useMaxPadding?Math.max(o,c.padding):o+c.padding,h=h&&c.autoFit,l=l||c.legacy}if(1===r.length&&(this.defaultFilterStack[0].renderTexture=n.current),r.push(s),s.resolution=a,s.legacy=l,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(o),h){var d=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(tempMatrix.copyFrom(i.projection.transform).invert(),d),s.sourceFrame.fit(d)}this.roundFrame(s.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,a),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;var p=this.tempRect;p.x=0,p.y=0,p.width=s.sourceFrame.width,p.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(n.sourceFrame),s.bindingDestinationFrame.copyFrom(n.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,n.bind(s.renderTexture,s.sourceFrame,p),i.framebuffer.clear(0,0,0,0)},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var s=r.inputSize,n=r.inputPixel,a=r.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],n[0]=s[0]*e.resolution,n[1]=s[1]*e.resolution,n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*s[2]-.5*n[2],a[3]=e.sourceFrame.height*s[3]-.5*n[3],e.legacy){var o=r.filterArea;o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=e.sourceFrame.x,o[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var h=t[t.length-1];if(e.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,h.renderTexture,CLEAR_MODES.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;var c=0;for(c=0;c<i.length-1;++c){i[c].apply(this,l,u,CLEAR_MODES.CLEAR,e);var d=l;l=u,u=d}i[c].apply(this,l,h.renderTexture,CLEAR_MODES.BLEND,e),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},e.prototype.bindAndClear=function(t,e){void 0===e&&(e=CLEAR_MODES.CLEAR);var i=this.renderer,r=i.renderTexture,s=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var n=this.tempRect;n.x=0,n.y=0,n.width=t.filterFrame.width,n.height=t.filterFrame.height,r.bind(t,t.filterFrame,n)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=1&s.stateId||this.forceClear;(e===CLEAR_MODES.CLEAR||e===CLEAR_MODES.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},e.prototype.applyFilter=function(t,e,i,r){var s=this.renderer;s.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(DRAW_MODES.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,r=i.sourceFrame,s=i.destinationFrame,n=e._texture.orig,a=t.set(s.width,0,0,s.height,r.x,r.y),o=e.worldTransform.copyTo(Matrix.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,i){return void 0===i&&(i=1),this.texturePool.getOptimalTexture(t,e,i)},e.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var i=t;t=e,e=i}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e.prototype.transformAABB=function(t,e){var i=tempPoints[0],r=tempPoints[1],s=tempPoints[2],n=tempPoints[3];i.set(e.left,e.top),r.set(e.left,e.bottom),s.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(s,s),t.apply(n,n);var a=Math.min(i.x,r.x,s.x,n.x),o=Math.min(i.y,r.y,s.y,n.y),h=Math.max(i.x,r.x,s.x,n.x),l=Math.max(i.y,r.y,s.y,n.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o},e.prototype.roundFrame=function(t,e,i,r,s){if(s){var n=s.a,a=s.b,o=s.c,h=s.d;if(!(0===a&&0===o||0===n&&0===h))return}(s=s?tempMatrix.copyFrom(s):tempMatrix.identity()).translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)},e}(System),ObjectRenderer=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),BatchSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.emptyRenderer=new ObjectRenderer(e),i.currentRenderer=i.emptyRenderer,i}return __extends(e,t),e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)},e.prototype.boundArray=function(t,e,i,r){for(var s=t.elements,n=t.ids,a=t.count,o=0,h=0;h<a;h++){var l=s[h],u=l._batchLocation;if(u>=0&&u<r&&e[u]===l)n[h]=u;else for(;o<r;){var c=e[o];if(!c||c._batchEnabled!==i||c._batchLocation!==o){n[h]=o,l._batchLocation=o,e[o]=l;break}o++}}},e}(System),CONTEXT_UID_COUNTER=0,ContextSystem=function(t){function e(e){var i=t.call(this,e)||this;
/**
	         * Either 1 or 2 to reflect the WebGL version being used
	         * @member {number}
	         * @readonly
	         */return i.webGLVersion=1,i.extensions={},i.supports={uint32Indices:!1},i.handleContextLost=i.handleContextLost.bind(i),i.handleContextRestored=i.handleContextRestored.bind(i),e.view.addEventListener("webglcontextlost",i.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",i.handleContextRestored,!1),i}return __extends(e,t),Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var i;if(settings.PREFER_ENV>=ENV.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e}(System),GLFramebuffer=function(t){this.framebuffer=t,this.stencil=null,
/**
	         * latest known version of framebuffer
	         * @member {number}
	         * @protected
	         */
this.dirtyId=0,
/**
	         * latest known version of framebuffer format
	         * @member {number}
	         * @protected
	         */
this.dirtyFormat=0,
/**
	         * latest known version of framebuffer size
	         * @member {number}
	         * @protected
	         */
this.dirtySize=0,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},tempRectangle=new Rectangle,FramebufferSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.managedFramebuffers=[],i.unknownFramebuffer=new Framebuffer(10,10),i.msaaSamples=null,i}return __extends(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},e.prototype.bind=function(t,e){var i=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var n=t.colorTextures[s];this.renderer.texture.unbind(n.parentTextureArray||n)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,i,r){var s=this.viewport;s.width===i&&s.height===r&&s.x===t&&s.y===e||(s.x=t,s.y=e,s.width=i,s.height=r,this.gl.viewport(t,e,i,r))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(t,e,i,r,s){void 0===s&&(s=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH);var n=this.gl;n.clearColor(t,e,i,r),n.clear(s)},e.prototype.initFramebuffer=function(t){var e=this.gl,i=new GLFramebuffer(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},e.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,s=0;s<r.length;s++)this.renderer.texture.bind(r[s],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1)),i.multisample>1&&(i.msaaBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,i.msaaBuffer));for(var s=[],n=0;n<r;n++)if(!(0===n&&i.multisample>1)){var a=t.colorTextures[n],o=a.parentTextureArray||a;this.renderer.texture.bind(o,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,a.target,o._glTextures[this.CONTEXT_UID].texture,0),s.push(e.COLOR_ATTACHMENT0+n)}if((s.length>1&&e.drawBuffers(s),t.depthTexture)&&this.writeDepthTexture){var h=t.depthTexture;this.renderer.texture.bind(h,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,0)}i.stencil||!t.stencil&&!t.depth||(i.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i.stencil))},e.prototype.detectSamples=function(t){var e=this.msaaSamples,i=MSAA_QUALITY.NONE;if(t<=1||null===e)return i;for(var r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return 1===i&&(i=MSAA_QUALITY.NONE),i},e.prototype.blit=function(t,e,i){var r=this,s=r.current,n=r.renderer,a=r.gl,o=r.CONTEXT_UID;if(2===n.context.webGLVersion&&s){var h=s.glFramebuffers[o];if(h){if(!t){if(h.multisample<=1)return;h.blitFramebuffer||(h.blitFramebuffer=new Framebuffer(s.width,s.height),h.blitFramebuffer.addColorTexture(0,s.colorTextures[0])),(t=h.blitFramebuffer).width=s.width,t.height=s.height}e||((e=tempRectangle).width=s.width,e.height=s.height),i||(i=e);var l=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.stencil&&r.deleteRenderbuffer(i.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var i=t.width,r=t.height,s=this.gl,n=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,n),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,r),e.stencil=n,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle},e}(System),GLBuffer=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},byteSizeMap$1={5126:4,5123:2,5121:1},GeometrySystem=function(t){function e(e){var i=t.call(this,e)||this;return i._activeGeometry=null,i._activeVao=null,i.hasVao=!0,i.hasInstance=!0,i.canUseUInt32ElementIndex=!1,i.managedGeometries={},i.managedBuffers={},i}return __extends(e,t),e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,i,s,n){return r.drawElementsInstancedANGLE(t,e,i,s,n)},t.drawArraysInstanced=function(t,e,i,s){return r.drawArraysInstancedANGLE(t,e,i,s)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},s=!0);var n=r[e.program.id]||this.initGeometryVao(t,e.program,s);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,i=0;i<t.buffers.length;i++){var r=t.buffers[i],s=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==s.updateID){s.updateID=r._updateID;var n=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(n,s.buffer),this._boundBuffer=s,s.byteLength>=r.data.byteLength)e.bufferSubData(n,0,r.data);else{var a=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=r.data.byteLength,e.bufferData(n,r.data,a)}}}},e.prototype.checkCompatibility=function(t,e){var i=t.attributes,r=e.attributeData;for(var s in r)if(!i[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},e.prototype.getSignature=function(t,e){var i=t.attributes,r=e.attributeData,s=["g",t.id];for(var n in i)r[n]&&s.push(n);return s.join("-")},e.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0),this.checkCompatibility(t,e);var r=this.gl,s=this.CONTEXT_UID,n=this.getSignature(t,e),a=t.glVertexArrayObjects[this.CONTEXT_UID],o=a[n];if(o)return a[e.id]=o,o;var h=t.buffers,l=t.attributes,u={},c={};for(var d in h)u[d]=0,c[d]=0;for(var d in l)!l[d].size&&e.attributeData[d]?l[d].size=e.attributeData[d].size:l[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),u[l[d].buffer]+=l[d].size*byteSizeMap$1[l[d].type];for(var d in l){var p=l[d],f=p.size;void 0===p.stride&&(u[p.buffer]===f*byteSizeMap$1[p.type]?p.stride=0:p.stride=u[p.buffer]),void 0===p.start&&(p.start=c[p.buffer],c[p.buffer]+=f*byteSizeMap$1[p.type])}o=r.createVertexArray(),r.bindVertexArray(o);for(var _=0;_<h.length;_++){var g=h[_];g._glBuffers[s]||(g._glBuffers[s]=new GLBuffer(r.createBuffer()),this.managedBuffers[g.id]=g,g.disposeRunner.add(this)),i&&g._glBuffers[s].refCount++}return this.activateVao(t,e),this._activeVao=o,a[e.id]=o,a[n]=o,o},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,s=t.buffers;if(t.disposeRunner.remove(this),i){for(var n=0;n<s.length;n++){var a=s[n]._glBuffers[this.CONTEXT_UID];a.refCount--,0!==a.refCount||e||this.disposeBuffer(s[n],e)}if(!e)for(var o in i)if("g"===o[0]){var h=i[o];this._activeVao===h&&this.unbind(),r.deleteVertexArray(h)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t);e=Object.keys(this.managedBuffers);for(i=0;i<e.length;i++)this.disposeBuffer(this.managedBuffers[e[i]],t)},e.prototype.activateVao=function(t,e){var i=this.gl,r=this.CONTEXT_UID,s=t.buffers,n=t.attributes;t.indexBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var a=null;for(var o in n){var h=n[o],l=s[h.buffer]._glBuffers[r];if(e.attributeData[o]){a!==l&&(i.bindBuffer(i.ARRAY_BUFFER,l.buffer),a=l);var u=e.attributeData[o].location;if(i.enableVertexAttribArray(u),i.vertexAttribPointer(u,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(u,1)}}}},e.prototype.draw=function(t,e,i,r){var s=this.gl,n=this._activeGeometry;if(n.indexBuffer){var a=n.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?n.instanced?s.drawElementsInstanced(t,e||n.indexBuffer.data.length,o,(i||0)*a,r||1):s.drawElements(t,e||n.indexBuffer.data.length,o,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?s.drawArraysInstanced(t,i,e||n.getSize(),r||1):s.drawArrays(t,i,e||n.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(System),MaskData=function(){function t(t){void 0===t&&(t=null),this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},t.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function compileShader(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function compileProgram(t,e,i,r){var s=compileShader(t,t.VERTEX_SHADER,e),n=compileShader(t,t.FRAGMENT_SHADER,i),a=t.createProgram();if(t.attachShader(a,s),t.attachShader(a,n),r)for(var o in r)t.bindAttribLocation(a,r[o],o);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(t.getShaderParameter(s,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(s))),t.getShaderParameter(n,t.COMPILE_STATUS)||(console.warn(i),console.error(t.getShaderInfoLog(n))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(s),t.deleteShader(n),a}function booleanArray(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function defaultValue(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext={},context=unknownContext,maxFragmentPrecision;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var t=document.createElement("canvas"),e=void 0;settings.PREFER_ENV>=ENV.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),context=e}return context}function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;var t=getTestContext();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);maxFragmentPrecision=e.precision?PRECISION.HIGH:PRECISION.MEDIUM}}return maxFragmentPrecision}function setPrecision(t,e,i){if("precision"!==t.substring(0,9)){var r=e;return e===PRECISION.HIGH&&i!==PRECISION.HIGH&&(r=PRECISION.MEDIUM),"precision "+r+" float;\n"+t}return i!==PRECISION.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(t){return GLSL_TO_SIZE[t]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(t,e){if(!GL_TABLE){var i=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var r=0;r<i.length;++r){var s=i[r];GL_TABLE[t[s]]=GL_TO_GLSL_TYPES[s]}}return GL_TABLE[e]}var uniformParsers=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(t,e){var i=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var r in t.uniforms){var s=e[r];if(s){for(var n=t.uniforms[r],a=!1,o=0;o<uniformParsers.length;o++)if(uniformParsers[o].test(s,n)){i.push(uniformParsers[o].code(r,n)),a=!0;break}if(!a){var h=(1===s.size?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[s.type].replace("location",'ud["'+r+'"].location');i.push('\n            cv = ud["'+r+'"].value;\n            v = uv["'+r+'"];\n            '+h+";")}}else t.uniforms[r].group&&i.push('\n                    renderer.shader.syncUniformGroup(uv["'+r+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",i.join("\n"))}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n"),unsafeEval;function generateIfTestSrc(t){for(var e="",i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}function checkMaxIfStatementsInShader(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}function unsafeEvalSupported(){if("boolean"==typeof unsafeEval)return unsafeEval;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=!0===t({a:"b"},"a","b")}catch(t){unsafeEval=!1}return unsafeEval}var defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}",defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n",UID$3=0,nameCache={},Program=function(){function t(e,i,r){void 0===r&&(r="pixi-shader"),this.id=UID$3++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),nameCache[r]?(nameCache[r]++,r+="-"+nameCache[r]):nameCache[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return t.prototype.extractData=function(t,e){var i=getTestContext();if(i){var r=compileProgram(i,t,e);this.attributeData=this.getAttributeData(r,i),this.uniformData=this.getUniformData(r,i),i.deleteProgram(r)}else this.uniformData={},this.attributeData={}},t.prototype.getAttributeData=function(t,e){for(var i={},r=[],s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<s;n++){var a=e.getActiveAttrib(t,n),o=mapType(e,a.type),h={type:o,name:a.name,size:mapSize(o),location:0};i[a.name]=h,r.push(h)}r.sort((function(t,e){return t.name>e.name?1:-1}));for(n=0;n<r.length;n++)r[n].location=n;return i},t.prototype.getUniformData=function(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<r;s++){var n=e.getActiveUniform(t,s),a=n.name.replace(/\[.*?\]$/,""),o=n.name.match(/\[.*?\]$/),h=mapType(e,n.type);i[a]={type:h,size:n.size,isArray:o,value:defaultValue(h,n.size)}}return i},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return defaultVertex},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return defaultFragment},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var s=e+i,n=ProgramCache[s];return n||(ProgramCache[s]=n=new t(e,i,r)),n},t}(),Shader=function(){function t(t,e){for(var i in this.program=t,this.uniformGroup=e?e instanceof UniformGroup?e:new UniformGroup(e):new UniformGroup({}),t.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){return new t(Program.from(e,i),r)},t}(),BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,State=function(){function t(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND)},set:function(t){!!(this.data&1<<BLEND)!==t&&(this.data^=1<<BLEND)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET)},set:function(t){!!(this.data&1<<OFFSET)!==t&&(this.data^=1<<OFFSET)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING)},set:function(t){!!(this.data&1<<CULLING)!==t&&(this.data^=1<<CULLING)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST)},set:function(t){!!(this.data&1<<DEPTH_TEST)!==t&&(this.data^=1<<DEPTH_TEST)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK)},set:function(t){!!(this.data&1<<DEPTH_MASK)!==t&&(this.data^=1<<DEPTH_MASK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING)},set:function(t){!!(this.data&1<<WINDING)!==t&&(this.data^=1<<WINDING)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==BLEND_MODES.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),defaultVertex$1="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",defaultFragment$1="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n",Filter=function(t){function e(i,r,s){var n=this,a=Program.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return(n=t.call(this,a,s)||this).padding=0,n.resolution=settings.FILTER_RESOLUTION,n.enabled=!0,n.autoFit=!0,n.legacy=!!n.program.attributeData.aTextureCoord,n.state=new State,n}return __extends(e,t),e.prototype.apply=function(t,e,i,r,s){t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return defaultVertex$1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return defaultFragment$1},enumerable:!1,configurable:!0}),e}(Shader),vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",fragment="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",tempMat=new Matrix,TextureMatrix=function(){function t(t,e){this._texture=t,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,r=0;r<t.length;r+=2){var s=t[r],n=t[r+1];e[r]=s*i.a+n*i.c+i.tx,e[r+1]=s*i.b+n*i.d+i.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var r=e.orig,s=e.trim;s&&(tempMat.set(r.width/s.width,0,0,r.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(tempMat));var n=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/n.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/n.width,a[1]=(e._frame.y+o+h)/n.height,a[2]=(e._frame.x+e._frame.width-o+h)/n.width,a[3]=(e._frame.y+e._frame.height-o+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&0===e.rotate,!0},t}(),SpriteMaskFilter=function(t){function e(e){var i=this,r=new Matrix;return i=t.call(this,vertex,fragment)||this,e.renderable=!1,i.maskSprite=e,i.maskMatrix=r,i}return __extends(e,t),e.prototype.apply=function(t,e,i,r){var s=this.maskSprite,n=s._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new TextureMatrix(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))},e}(Filter),MaskSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.enableScissor=!0,i.alphaMaskPool=[],i.maskDataPool=[],i.maskStack=[],i.alphaMaskIndex=0,i}return __extends(e,t),e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var r=this.maskDataPool.pop()||new MaskData;r.pooled=!0,r.maskObject=e,i=r}switch(i.autoDetect&&this.detect(i),i.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),i._target=t,i.type){case MASK_TYPES.SCISSOR:this.maskStack.push(i),this.renderer.scissor.push(i);break;case MASK_TYPES.STENCIL:this.maskStack.push(i),this.renderer.stencil.push(i);break;case MASK_TYPES.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i),this.maskStack.push(i)}},e.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},e.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=MASK_TYPES.SPRITE;else if(t.type=MASK_TYPES.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var i=e.worldTransform,r=Math.atan2(i.b,i.a),s=Math.atan2(i.d,i.c);r=Math.round(r*(180/Math.PI)*100),s=((s=Math.round(s*(180/Math.PI)*100)-r)%18e3+18e3)%18e3,0===(r=(r%9e3+9e3)%9e3)&&9e3===s&&(t.type=MASK_TYPES.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e=t.maskObject,i=t._target,r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e;var s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,r),i.filterArea=s,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e}(System),AbstractMaskSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.maskStack=[],i.glConst=0,i}return __extends(e,t),e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==i&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.maskStack=null},e}(System),ScissorSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.SCISSOR_TEST,i}return __extends(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var i=t._scissorRect,r=e.getBounds(!0),s=this.renderer.gl;e.renderable=!1,i?r.fit(i):s.enable(s.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,i=this.renderer.projection,r=i.transform,s=i.sourceFrame,n=i.destinationFrame,a=e?e.resolution:this.renderer.resolution,o=n.width/s.width,h=n.height/s.height,l=((t.x-s.x)*o+n.x)*a,u=((t.y-s.y)*h+n.y)*a,c=t.width*o*a,d=t.height*h*a;r&&(l+=r.tx*a,u+=r.ty*a),e||(u=this.renderer.height-d-u),this.renderer.gl.scissor(l,u,c,d)},e}(AbstractMaskSystem),StencilSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.STENCIL_TEST,i}return __extends(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,r,this._getBitwiseMask()),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),this.renderer.framebuffer.blit(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(AbstractMaskSystem),ProjectionSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.destinationFrame=null,i.sourceFrame=null,i.defaultFrame=null,i.projectionMatrix=new Matrix,i.transform=null,i}return __extends(e,t),e.prototype.update=function(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,i,r){var s=this.projectionMatrix,n=r?-1:1;s.identity(),s.a=1/e.width*2,s.d=n*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-n-e.y*s.d},e.prototype.setTransform=function(t){},e}(System),tempRect=new Rectangle,tempRect2=new Rectangle,RenderTextureSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.clearColor=e._backgroundColorRgba,i.defaultMaskStack=[],i.current=null,i.sourceFrame=new Rectangle,i.destinationFrame=new Rectangle,i.viewportFrame=new Rectangle,i}return __extends(e,t),e.prototype.bind=function(t,e,i){void 0===t&&(t=null);var r,s,n,a=this.renderer;this.current=t,t?(n=(r=t.baseTexture).resolution,e||(tempRect.width=t.frame.width,tempRect.height=t.frame.height,e=tempRect),i||(tempRect2.x=t.frame.x,tempRect2.y=t.frame.y,tempRect2.width=e.width,tempRect2.height=e.height,i=tempRect2),s=r.framebuffer):(n=a.resolution,e||(tempRect.width=a.screen.width,tempRect.height=a.screen.height,e=tempRect),i||((i=tempRect).width=e.width,i.height=e.height));var o=this.viewportFrame;o.x=i.x*n,o.y=i.y*n,o.width=i.width*n,o.height=i.height*n,t||(o.y=a.view.height-(o.y+o.height)),this.renderer.framebuffer.bind(s,o),this.renderer.projection.update(i,e,n,!s),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},e.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var i=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer.screen,s=i.width!==r.width||i.height!==r.height;if(s){var n=this.viewportFrame,a=n.x,o=n.y,h=n.width,l=n.height;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,h,l)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(System),GLProgram=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},t}(),UID$4=0,defaultSyncData={textureCount:0},ShaderSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.destroyed=!1,i.systemCheck(),i.gl=null,i.shader=null,i.program=null,i.cache={},i.id=UID$4++,i}return __extends(e,t),e.prototype.systemCheck=function(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(defaultSyncData.textureCount=0,this.syncUniformGroup(t.uniformGroup,defaultSyncData)),r},e.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var i=this.getglProgram();t.static&&t.dirtyId===i.uniformGroups[t.id]||(i.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},e.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=generateUniformsSync(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var i=t.uniforms,r=[];for(var s in i)r.push(s),e[s]&&r.push(e[s].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},
/**
	     * Generates a glProgram version of the Shader provided.
	     *
	     * @private
	     * @param {PIXI.Shader} shader - the shader that the glProgram will be based on.
	     * @return {PIXI.GLProgram} A shiny new glProgram!
	     */
e.prototype.generateShader=function(t){var e=this.gl,i=t.program,r={};for(var s in i.attributeData)r[s]=i.attributeData[s].location;var n=compileProgram(e,i.vertexSrc,i.fragmentSrc,r),a={};for(var s in i.uniformData){var o=i.uniformData[s];a[s]={location:e.getUniformLocation(n,s),value:defaultValue(o.type,o.size)}}var h=new GLProgram(n,a);return i.glPrograms[this.renderer.CONTEXT_UID]=h,h},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(System);function mapWebGLBlendModesToPixi(t,e){return void 0===e&&(e=[]),e[BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD]=[t.ONE,t.ONE],e[BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.NONE]=[0,0],e[BLEND_MODES.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[BLEND_MODES.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[BLEND_MODES.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[BLEND_MODES.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[BLEND_MODES.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[BLEND_MODES.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[BLEND_MODES.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5,StateSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.gl=null,i.stateId=0,i.polygonOffset=0,i.blendMode=BLEND_MODES.NONE,i._blendEq=!1,i.map=[],i.map[BLEND$1]=i.setBlend,i.map[OFFSET$1]=i.setOffset,i.map[CULLING$1]=i.setCullFace,i.map[DEPTH_TEST$1]=i.setDepthTest,i.map[WINDING$1]=i.setFrontFace,i.map[DEPTH_MASK$1]=i.setDepthMask,i.checks=[],i.defaultState=new State,i.defaultState.blend=!0,i}return __extends(e,t),e.prototype.contextChange=function(t){this.gl=t,this.blendModes=mapWebGLBlendModesToPixi(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setDepthMask=function(t){this.gl.depthMask(t)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},e}(System),TextureGCSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.count=0,i.checkCount=0,i.maxIdle=settings.GC_MAX_IDLE,i.checkCountMax=settings.GC_MAX_CHECK_COUNT,i.mode=settings.GC_MODE,i}return __extends(e,t),e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,r=0;r<e.length;r++){var s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){var n=0;for(r=0;r<e.length;r++)null!==e[r]&&(e[n++]=e[r]);e.length=n}},e.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},e}(System),GLTexture=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121,this.samplerType=0},TextureSystem=function(t){function e(e){var i=t.call(this,e)||this;return i.boundTextures=[],i.currentLocation=-1,i.managedTextures=[],i._unknownBoundTextures=!1,i.unknownTexture=new BaseTexture,i.hasIntegerTextures=!1,i}return __extends(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new GLTexture(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new GLTexture(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if(t){if((t=t.castToBaseTexture()).parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)},e.prototype.ensureSamplerType=function(t){var e=this,i=e.boundTextures,r=e.hasIntegerTextures,s=e.CONTEXT_UID;if(r)for(var n=t-1;n>=0;--n){var a=i[n];if(a)a._glTextures[s].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(a)}},e.prototype.initTexture=function(t){var e=new GLTexture(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var i=this.renderer.gl;t.type===i.FLOAT&&t.format===i.RGBA&&(e.internalFormat=i.RGBA32F),t.type===TYPES.HALF_FLOAT&&(e.type=i.HALF_FLOAT),e.type===i.HALF_FLOAT&&t.format===i.RGBA&&(e.internalFormat=i.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var r=t.realWidth,s=t.realHeight,n=i.gl;(e.width!==r||e.height!==s||e.dirtyId<0)&&(e.width=r,e.height=s,n.texImage2D(t.target,0,e.internalFormat,r,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&removeItems(this.managedTextures,r,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==MIPMAP_MODES.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=WRAP_MODES.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==MIPMAP_MODES.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===SCALE_MODES.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===SCALE_MODES.LINEAR){var s=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST)},e}(System),_systems={__proto__:null,FilterSystem:FilterSystem,BatchSystem:BatchSystem,ContextSystem:ContextSystem,FramebufferSystem:FramebufferSystem,GeometrySystem:GeometrySystem,MaskSystem:MaskSystem,ScissorSystem:ScissorSystem,StencilSystem:StencilSystem,ProjectionSystem:ProjectionSystem,RenderTextureSystem:RenderTextureSystem,ShaderSystem:ShaderSystem,StateSystem:StateSystem,TextureGCSystem:TextureGCSystem,TextureSystem:TextureSystem},tempMatrix$1=new Matrix,AbstractRenderer=function(t){function e(e,i){void 0===e&&(e=RENDERER_TYPE.UNKNOWN);var r=t.call(this)||this;return i=Object.assign({},settings.RENDER_OPTIONS,i),r.options=i,r.type=e,r.screen=new Rectangle(0,0,i.width,i.height),r.view=i.view||document.createElement("canvas"),r.resolution=i.resolution||settings.RESOLUTION,r.useContextAlpha=i.useContextAlpha,r.autoDensity=!!i.autoDensity,r.preserveDrawingBuffer=i.preserveDrawingBuffer,r.clearBeforeRender=i.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,1],r._backgroundColorString="#000000",r.backgroundColor=i.backgroundColor||r._backgroundColor,r.backgroundAlpha=i.backgroundAlpha,void 0!==i.transparent&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),r.useContextAlpha=i.transparent,r.backgroundAlpha=i.transparent?0:1),r._lastObjectRendered=null,r.plugins={},r}return __extends(e,t),e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px"),this.emit("resize",t,e)},e.prototype.generateTexture=function(t,e,i,r){0===(r=r||t.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);var s=RenderTexture.create({width:0|r.width,height:0|r.height,scaleMode:e,resolution:i});return tempMatrix$1.tx=-r.x,tempMatrix$1.ty=-r.y,this.render(t,{renderTexture:s,clear:!1,transform:tempMatrix$1,skipUpdateTransform:!!t.parent}),s},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var i=this;i.plugins=null,i.type=RENDERER_TYPE.UNKNOWN,i.view=null,i.screen=null,i._tempDisplayObjectParent=null,i.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=hex2string(t),hex2rgb(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(eventemitter3);!function(t){function e(i){var r=t.call(this,RENDERER_TYPE.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},r.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),r.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),r.initPlugins(e.__plugins),i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:i.antialias,premultipliedAlpha:r.useContextAlpha&&"notMultiplied"!==r.useContextAlpha,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,sayHello(2===r.context.webGLVersion?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}__extends(e,t),e.create=function(t){if(isWebGLSupported())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=i,this.runners)this.runners[r].add(i);return this},e.prototype.render=function(t,e){var i,r,s,n;if(e&&(e instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),i=e,r=arguments[2],s=arguments[3],n=arguments[4]):(i=e.renderTexture,r=e.clear,s=e.transform,n=e.skipUpdateTransform)),this.renderingToScreen=!i,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=s,!this.context.isLost){if(i||(this._lastObjectRendered=t),!n){var a=t.enableTempParent();t.updateTransform(),t.disableTempParent(a)}this.renderTexture.bind(i),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),i&&i.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.runners.resize.emit(e,i)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(e){for(var i in this.runners.destroy.emit(),this.runners)this.runners[i].destroy();t.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,i){e.__plugins=e.__plugins||{},e.__plugins[t]=i}}(AbstractRenderer);var BatchDrawCall=function(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},BatchTextureArray=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),ViewableBuffer=function(){function t(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),AbstractBatchRenderer=function(t){function e(e){var i=t.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=State.for2d(),i.size=4*settings.SPRITE_BATCH_SIZE,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return __extends(e,t),e.prototype.contextChange=function(){var t=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,i=e._textureArrayPool,r=this.size/4,s=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new BatchDrawCall);for(;i.length<s;)i.push(new BatchTextureArray);for(var n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,i=this.MAX_TEXTURES,r=e._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count,o=++BaseTexture._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(n,i);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==o&&(l.count>=i&&(s.boundArray(l,n,o,i),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++o),d._batchEnabled=o,d.touched=a,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,n,o,i),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(c=0;c<n.length;c++)n[c]=null;BaseTexture._globalBatch=o},e.prototype.buildDrawCalls=function(t,i,r){var s=this,n=s._bufferedElements,a=s._attributeBuffer,o=s._indexBuffer,h=s.vertexSize,l=e._drawCallPool,u=this._dcIndex,c=this._aIndex,d=this._iIndex,p=l[u];p.start=this._iIndex,p.texArray=t;for(var f=i;f<r;++f){var _=n[f],g=_._texture.baseTexture,m=premultiplyBlendMode[g.alphaMode?1:0][_.blendMode];n[f]=null,i<f&&p.blend!==m&&(p.size=d-p.start,i=f,(p=l[++u]).texArray=t,p.start=d),this.packInterleavedGeometry(_,a,o,c,d),c+=_.vertexData.length/2*h,d+=_.indices.length,p.blend=m}i<r&&(p.size=d-p.start,++u),this._dcIndex=u,this._aIndex=c,this._iIndex=d},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,i=t._attributeBuffer,r=t._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,i=this.renderer,r=i.gl,s=i.state,n=e._drawCallPool,a=null,o=0;o<t;o++){var h=n[o],l=h.texArray,u=h.type,c=h.size,d=h.start,p=h.blend;a!==l&&(a=l,this.bindAndClearTexArray(l)),this.state.blendMode=p,s.set(this.state),r.drawElements(u,c,r.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=nextPow2(Math.ceil(t/8)),i=log2(e),r=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new ViewableBuffer(r*this.vertexSize*4)),s},e.prototype.getIndexBuffer=function(t){var e=nextPow2(Math.ceil(t/12)),i=log2(e),r=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s},e.prototype.packInterleavedGeometry=function(t,e,i,r,s){for(var n=e.uint32View,a=e.float32View,o=r/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?premultiplyTint(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<u.length;f+=2)a[r++]=u[f],a[r++]=u[f+1],a[r++]=h[f],a[r++]=h[f+1],n[r++]=p,a[r++]=c;for(f=0;f<l.length;f++)i[s++]=o+l[f]},e._drawCallPool=[],e._textureArrayPool=[],e}(ObjectRenderer),BatchShaderGenerator=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=UniformGroup.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Program(this.vertexSrc,r)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[t]};return new Shader(this.programCache[t],s)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),BatchGeometry=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i._buffer=new Buffer(null,e,!1),i._indexBuffer=new Buffer(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",i._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,TYPES.FLOAT).addIndex(i._indexBuffer),i}return __extends(e,t),e}(Geometry),defaultVertex$3="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",defaultFragment$2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",BatchPluginFactory=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:defaultVertex$3,fragment:defaultFragment$2,geometryClass:BatchGeometry,vertexSize:6},t),i=e.vertex,r=e.fragment,s=e.vertexSize,n=e.geometryClass;return function(t){function e(e){var a=t.call(this,e)||this;return a.shaderGenerator=new BatchShaderGenerator(i,r),a.geometryClass=n,a.vertexSize=s,a}return __extends(e,t),e}(AbstractBatchRenderer)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),t}();BatchPluginFactory.create();var resources={},_loop_1=function(t){Object.defineProperty(resources,t,{get:function(){return deprecation("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),_resources[t]}})};for(var name in _resources)_loop_1(name);var systems={},_loop_2=function(t){Object.defineProperty(systems,t,{get:function(){return deprecation("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),_systems[t]}})};for(var name in _systems)_loop_2(name);class LinearGradient{constructor(t){this._stops=[],this.type=ItemType.LinearGradient,this.id=this.type+ItemCounter[this.type]++,this.x1=t.hasOwnProperty("x1")?t.x1:0,this.x2=t.hasOwnProperty("x2")?t.x2:100,this.y1=t.hasOwnProperty("y1")?t.y1:0,this.y2=t.hasOwnProperty("y2")?t.y2:0}toJSON(){}addStop(t,e,i){this._stops.push({offset:t,color:e,opacity:i})}get stops(){return this._stops}}class Mark{constructor(t){if(this._dataScope=void 0,this.attrs={},this.styles={},void 0!==t)for(let e in Style2SVG)e in t&&(this.styles[e]=t[e])}contains(t,e){if(!this._bounds)return!1;if(!this._bounds.contains(t,e))return!1;switch(this.type){case ItemType.Rect:return!0;case ItemType.Circle:return Math.sqrt(Math.pow(t-this.x,2)+Math.pow(e-this.y,2))<=this.radius+this.strokeWidth;default:{let i=CanvasProvider.getContext(),r=new Path2D(this.getSVGPathData());return i.isPointInPath(r,t,e)}}}toJSON(){let t={};t.type=this.type,t.id=this.id,this.classId&&(t.classId=this.classId),this._dataScope&&(t.dataScope=this._dataScope.toJSON()),t.args={};for(let e in this.attrs)t.args[e]=this.attrs[e];for(let e in this.styles)e.indexOf("color")>0&&this.styles[e]instanceof LinearGradient?t.args[e]=this.styles[e].toJSON():t.args[e]=this.styles[e];return t}getScene(){let t=this;for(;t;){if(t.type==ItemType.Scene)return t;t=t.parent}}set dataScope(t){this._dataScope=t}get dataScope(){return this._dataScope}duplicate(){let t=this.getScene().mark(this.type);return this.copyPropertiesTo(t),t.classId=this.classId,this._dataScope&&(t._dataScope=this._dataScope.clone()),t}translate(t,e){}set visibility(t){this.styles.visibility=t}get visibility(){return this.styles.visibility?this.styles.visibility:"visible"}get opacity(){return"opacity"in this.styles?this.styles.opacity:1}set opacity(t){this.styles.opacity=t}}const EPSILON=1e-12,TRIGONOMETRIC_EPSILON=1e-8;function isZero(t){return t>=-EPSILON&&t<=EPSILON}class Point{constructor(t,e){this.x=t,this.y=e}transform(t){return t?t._transformPoint(this):this}negate(){return new Point(-this.x,-this.y)}subtract(t){return new Point(this.x-t.x,this.y-t.y)}isZero(){return isZero(this.x)&&isZero(this.y)}isCollinear(t){let e=this.x,i=this.y,r=t.x,s=t.y;return Math.abs(e*s-i*r)<=Math.sqrt((e*e+i*i)*(r*r+s*s))*TRIGONOMETRIC_EPSILON}}class Vertex{constructor(t,e,i){this.type="vertex",this._id=i,this.x=t.x,this.y=t.y,this.dataScope=void 0,this.parent=e,this.shape=void 0,this.width=0,this.height=0,this.radius=0,this.fillColor="#555",this.opacity=1,this.strokeWidth=0,this.strokeColor="#aaa"}get id(){return this.parent.id+"v"+this._id}toJSON(){let t={};return t.type=this.type,t.id=this._id,t.x=this.x,t.y=this.y,this._dataScope&&(t.dataScope=this._dataScope.toJSON()),t.shape=this.shape,t.width=this.width,t.height=this.height,t.radius=this.radius,t.fillColor=this.fillColor,t.opacity=this.opacity,t.strokeWidth=this.strokeWidth,t.strokeColor=this.strokeColor,t}static fromJSON(t,e){let i=new Vertex(t,e,t.id);return t.dataScope&&(i.dataScope=t.dataScope),i.shape=t.shape,i.width=t.width,i.height=t.height,i.radius=t.radius,i.fillColor=t.fillColor,i.opacity=t.opacity,i.strokeWidth=t.strokeWidth,i.strokeColor=t.strokeColor,i}translate(t,e){this.x+=t,this.y+=e}_clone(t){let e=new Vertex(new Point(this.x,this.y),t,this._id);return this.dataScope&&(e.dataScope=this.dataScope.clone()),e.shape=this.shape,e.width=this.width,e.height=this.height,e.radius=this.radius,e.fillColor=this.fillColor,e.opacity=this.opacity,e.strokeWidth=this.strokeWidth,e.strokeColor=this.strokeColor,e}}Vertex.styles=["vxShape","vxWidth","vxHeight","vxRadius","vxFillColor","vxStrokeColor","vxStrokeWidth","vxOpacity"];class Segment{constructor(t,e,i,r){this.type="segment",this._id=r,this.vertex1=t,this.vertex2=e,this.dataScope=void 0,this.parent=i}get id(){return this.parent.id+"s"+this._id}translate(t,e){this.vertex1.translate(t,e),this.vertex2.translate(t,e)}get x(){return(this.vertex1.x+this.vertex2.x)/2}get y(){return(this.vertex1.y+this.vertex2.y)/2}}class Path extends Mark{constructor(t){if(super(t),this.type=ItemType.Path,"strokeColor"in this.styles||(this.styles.strokeColor="#ccc"),"strokeWidth"in this.styles||(this.styles.strokeWidth=1),"strokeDash"in this.styles||(this.styles.strokeDash="none"),this.vertices=[],this.vertexCounter=0,this.segmentCounter=0,this.segments=[],this.anchor=void 0,this.closed=!1,this.curveMode="linear",this._vxShape=void 0,this._vxWidth=0,this._vxHeight=0,this._vxRadius=0,this._vxFillColor="#555555",this._vxStrokeColor="#aaaaaa",this._vxStrokeWidth=0,this._vxOpacity=1,void 0!==t){for(let e of Vertex.styles)e in t&&(this["_"+e]=t[e]);"vertices"in t&&this._setVertices(t.vertices)}}toJSON(){let t=super.toJSON();t.type=this.type,t.id=this.id,t.vertices=[];for(let e of this.vertices)t.vertices.push(e.toJSON());t.vertexCounter=this.vertexCounter,t.segmentCounter=this.segmentCounter,t.curveMode=this.curveMode,this._bounds&&(t.bounds=this._bounds.toJSON());for(let e of Vertex.styles)t.args[e]=this[e];return t}_setVertices(t){let e,i;this.vertices=[],this.segments=[];for(let r=0;r<t.length;r++){i=new Point(t[r][0],t[r][1]),e=new Vertex(i,this,this.vertexCounter++);for(let t of Vertex.styles)if(this[t]){let i=t.replace("vx","");e[i[0].toLowerCase()+i.slice(1)]=this[t]}this.vertices.push(e),r>0&&this.segments.push(new Segment(this.vertices[r-1],this.vertices[r],this,this.segmentCounter++))}}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles);for(let e of Vertex.styles)this["_"+e]&&(t["_"+e]=this["_"+e]);this._dataScope&&(t._dataScope=this._dataScope.clone()),t.closed=this.closed,t.curveMode=this.curveMode,t.vertices=[],t.segments=[];for(let e of this.vertices)t.vertices.push(e._clone(t));t.segmentCounter=0;for(let e=1;e<t.vertices.length;e++)t.segments.push(new Segment(t.vertices[e-1],t.vertices[e],t,t.segmentCounter++));t.closed&&t.segments.push(new Segment(t.vertices[t.vertices.length-1],t.vertices[0],t,t.segmentCounter++))}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get x(){return this.bounds.x}get y(){return this.bounds.y}get strokeColor(){return this.styles.strokeColor}set strokeColor(t){this.styles.strokeColor=t}get strokeWidth(){return this.styles.strokeWidth}set strokeWidth(t){this.styles.strokeWidth=t}get fillColor(){return this.styles.fillColor}set fillColor(t){this.styles.fillColor=t}get strokeDash(){return this.styles.strokeDash}set strokeDash(t){this.styles.strokeDash=t}translate(t,e){for(let i of this.vertices)i.translate(t,e);this._updateBounds()}resize(t,e){let i=this.bounds;for(let r of this.vertices)r.x=i.x+t/i.width*(r.x-i.x),r.y=i.y+e/i.height*(r.y-i.y);this._updateBounds()}_updateBounds(){let t=this.vertices.map((t=>t.x)),e=this.vertices.map((t=>t.y)),i=Math.min(...t),r=Math.min(...e),s=Math.max(...t),n=Math.max(...e);this._bounds=new Rectangle$1(i,r,s-i,n-r)}addVertex(t,e,i){let r=new Vertex(new Point(t,e),this,this.vertexCounter++);this.vertices.splice(i,0,r)}sortVertices(t,e){this.vertices.sort(((e,i)=>e[t]-i[t])),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){let e=this.segments[t];e.vertex1=this.vertices[t],e.vertex2=this.vertices[(t+1)%this.vertices.length]}}sortVerticesByData(t,e,i){let r;r=i?(e,r)=>i.indexOf(e.dataScope.getFieldValue(t))-i.indexOf(r.dataScope.getFieldValue(t)):(e,i)=>e.dataScope.getFieldValue(t)<i.dataScope.getFieldValue(t)?-1:1,this.vertices.sort(r),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){let e=this.segments[t];e.vertex1=this.vertices[t],e.vertex2=this.vertices[(t+1)%this.vertices.length]}}getSVGPathData(){let t=d3__namespace.path(),e=this._getD3CurveFunction(this.curveMode)(t);e.lineStart();for(let t of this.vertices)e.point(t.x,t.y);return this.closed&&e.point(this.vertices[0].x,this.vertices[0].y),e.lineEnd(),t._}get firstVertex(){return this.vertices[0]}_getD3CurveFunction(t){switch(t){case CurveMode.Natural:return d3__namespace.curveNatural;case CurveMode.Basis:return d3__namespace.curveBasis;case CurveMode.BumpX:return d3__namespace.curveBumpX;case CurveMode.BumpY:return d3__namespace.curveBumpY;case CurveMode.Linear:return d3__namespace.curveLinear;case CurveMode.Step:return d3__namespace.curveStep;case CurveMode.CatmullRom:return d3__namespace.curveCatmullRom;case CurveMode.Cardinal:return d3__namespace.curveCardinal;default:return d3__namespace.curveLinear}}get vxShape(){return this._vxShape}set vxShape(t){this._vxShape=t;for(let e of this.vertices)e.shape=t}get vxWidth(){return this._vxWidth}set vxWidth(t){this._vxWidth=t;for(let e of this.vertices)e.width=t}get vxHeight(){return this._vxHeight}set vxHeight(t){this._vxHeight=t;for(let e of this.vertices)e.height=t}get vxRadius(){return this._vxRadius}set vxRadius(t){this._vxRadius=t;for(let e of this.vertices)e.radius=t}get vxFillColor(){return this._vxFillColor}set vxFillColor(t){this._vxFillColor=t;for(let e of this.vertices)e.fillColor=t}get vxStrokeColor(){return this._vxStrokeColor}set vxStrokeColor(t){this._vxStrokeColor=t;for(let e of this.vertices)e.strokeColor=t}get vxStrokeWidth(){return this._vxStrokeWidth}set vxStrokeWidth(t){this._vxStrokeWidth=t;for(let e of this.vertices)e.strokeWidth=t}get vxOpacity(){return this._vxOpacity}set vxOpacity(t){this._vxOpacity=t;for(let e of this.vertices)e.opacity=t}}function findItems(t,e){let i=[];return _findItemsRecursive(t,e,i),i}function getPeers(t,e){return"vertex"==t.type?_getPeerVertices(t,e):"segment"==t.type?_getPeerSegments(t,e):findItems(e,(e=>e.classId==t.classId))}function getPeersGroupedByParent(t,e){let i={},r=getPeers(t,e);for(let t of r){let e=t.parent.id;e in i||(i[e]=[]),i[e].push(t)}return Object.keys(i).map((t=>i[t]))}function _getPeerSegments(t,e){if(t.dataScope){let i=t.parent;if(!i)throw new Error("segment has no parent mark");let r=findItems(e,(t=>t.classId==i.classId)),s=[];for(let t of r)s=s.concat(t.segments);return s}{let i=t.parent;if(!i)throw new Error("segment has no parent mark");let r=i.segments.indexOf(t),s=findItems(e,(t=>t.classId==i.classId)),n=[];for(let t of s)n.push(t.segments[r]);return n}}function _getPeerVertices(t,e){if(!t.classId){if(t.dataScope){let i=t.parent;if(!i)throw new Error("vertex has no parent mark");let r=findItems(e,(t=>t.classId==i.classId)),s=[];for(let t of r)s=s.concat(t.vertices);return s}{let i=t.parent;if(!i)throw new Error("vertex has no parent mark");let r=i.vertices.indexOf(t),s=findItems(e,(t=>t.classId==i.classId)),n=[];for(let t of s)n.push(t.vertices[r]);return n}}}function _findItemsRecursive(t,e,i){if(t&&"axis"!=t.type&&"legend"!=t.type&&"gridlines"!=t.type)if(_matchCriteria(t,e)&&i.push(t),t.vertices)for(let r of t.vertices.concat(t.segments))_matchCriteria(r,e)&&i.push(r);else if(t.children&&t.children.length>0)for(let r of t.children)_findItemsRecursive(r,e,i)}function _matchCriteria(t,e){return e(t)}function getClosestLayout(t){let e=t.parent;for(;e&&e.type!=ItemType.Scene;){if(e.layout)return e.layout;e=e.parent}}function getAllLayouts(t){let e=getParents(t),i=[];for(;e&&e[0].type!=ItemType.Scene;){for(let t of e)t.layout&&i.push(t.layout);e=getParents(e)}return i}function getCellBoundsInLayout(t){let e=t,i=t.parent;for(;i&&i.type!=ItemType.Scene;){if(i.layout){let t=i.children.findIndex((t=>t==e));return i.layout.cellBounds[t]}e=e.parent,i=e.parent}}function getCellBoundsInGridLayout(t){let e=t,i=t.parent;for(;i&&i.type!=ItemType.Scene;){if(i.layout&&i.layout.type==LayoutType.Grid){let t=i.children.findIndex((t=>t==e));return i.layout.cellBounds[t]}e=e.parent,i=e.parent}}function getEncodingKey(t){return t.classId?t.classId:"vertex"==t.type&&t.dataScope?t.parent.classId+"_v":"vertex"==t.type?t.parent.classId+"_v_"+t.parent.vertices.indexOf(t):"segment"==t.type&&t.dataScope?t.parent.classId+"_s":"segment"==t.type?t.parent.classId+"_s_"+t.parent.segments.indexOf(t):null}function getParents(t){let e=[];for(let i of t)i.parent&&e.indexOf(i.parent)<0&&e.push(i.parent);return e}function getLeafItems(t){let e=[];if(t.children&&t.children.length>0)for(let i of t.children)e=e.concat(getLeafItems(i));else e.push(t);return e}function isMark(t){return t instanceof Mark}const ItemCounter={area:0,rect:0,circle:0,pie:0,line:0,path:0,ring:0,arc:0,image:0,pointText:0,collection:0,group:0,scene:0,axis:0,glyph:0,legend:0,polygon:0,gridlines:0,LinearGradient:0,link:0,scale:0,datatable:0};function canAlign(t,e,i){if(e==Alignment.Top||e==Alignment.Bottom||e==Alignment.Middle){for(let e of t)if(!canMoveVertically(e,i))return!1;return!0}if(e==Alignment.Left||e==Alignment.Right||e==Alignment.Center){for(let e of t)if(!canMoveHorizontally(e,i))return!1;return!0}}function canMoveHorizontally(t,e){if(e.getEncodingByItem(t,"x"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==LayoutType.Grid&&e.numCols>1)return!1}return!t.parent||t.parent.type==ItemType.Scene||canMoveHorizontally(t.parent,e)}function canMoveVertically(t,e){if(e.getEncodingByItem(t,"y"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==LayoutType.Grid&&e.numRows>1)return!1}return!t.parent||t.parent.type==ItemType.Scene||canMoveVertically(t.parent,e)}var CanvasProvider={canvas:void 0,getCanvas:function(){return window?(void 0===this.canvas&&(this.canvas=document.createElement("canvas")),this.canvas):null},getContext:function(){var t=this.getCanvas();return t?t.getContext("2d"):null}},SVGProvider={svg:void 0,getSVG:function(){return window?(void 0===this.svg&&(this.svg=document.createElement("svg")),this.svg):null}};function getTextWidth(t,e){let i=CanvasProvider.getContext();return i.font=e,i.measureText(t).width}function getTopLevelGroup(t){let e=t.parent;return e.type==ItemType.Scene?t:getTopLevelGroup(e)}function polar2Cartesian(t,e,i,r){return[i*Math.cos(degree2radian(r))+t,e-i*Math.sin(degree2radian(r))]}function cartesian2Polar(t,e,i,r){let s=radian2degree(Math.atan2(r-e,t-i));s=Math.round(10*s+Number.EPSILON)/10,s<0&&(s+=360);let n=Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2));return n=Math.round(10*n+Number.EPSILON)/10,[s,n]}function degree2radian(t){return t*Math.PI/180}function radian2degree(t){return 180*t/Math.PI}function CheckAreaOrien(t){let e=t.vertices.length;for(let i=0;i<t.vertices.length/2;i++){let r=i,s=e-i-1,n=t.vertices[r],a=t.vertices[s];if(n.x!=a.x||n.y!=a.y)return n.x==a.x?"horizontal":"vertical"}}class Group{constructor(){this.children=[],this._dataScope=void 0,this._layout=void 0,this.type=ItemType.Group,this.id=this.type+ItemCounter[this.type]++}contains(t,e){return this._bounds||this._updateBounds(),this._bounds.contains(t,e)}toJSON(){let t={};if(t.type=this.type,t.id=this.id,this._dataScope&&(t.dataScope=this._dataScope.toJSON()),this.classId&&(t.classId=this.classId),this._layout&&(t.layout=this._layout.toJSON()),this._bounds&&(t.bounds=this._bounds.toJSON()),this.children.length>0&&this.type!=ItemType.Axis){t.children=[];for(let e of this.children)t.children.push(e.toJSON())}return this.childrenOrder&&(t.childrenOrder=this.childrenOrder),t}addChild(t){t.parent&&t.parent.removeChild(t),this.children.push(t),t.parent=this}addChildAt(t,e){t.parent&&t.parent.removeChild(t),this.children.splice(e,0,t),t.parent=this}removeChild(t){let e=this.children.indexOf(t);e>=0&&this.children.splice(e,1),t.parent=null}removeAll(){for(let t of this.children)t.parent=null;this.children=[]}getScene(){let t=this;for(;t;){if(t.type==ItemType.Scene)return t;t=t.parent}}get dataScope(){return this._dataScope}set dataScope(t){this._dataScope=t;for(let e of this.children)e.dataScope?e.dataScope=e.dataScope.merge(t):e.dataScope=t}translate(t,e){for(let i of this.children)i.translate(t,e);this._updateBounds(),this._layout&&(null!=this._layout._left&&(this._layout._left+=t),null!=this._layout._top&&(this._layout._top+=e),this._layout.run()),this._updateBounds()}getInternalEncodings(t){if(0==this.children.length)return[];let e=this.children[0],i=this.getScene(),r=Object.keys(i.encodings),s=[];for(;e&&(e.classId&&s.indexOf(e.classId)<0&&s.push(e.classId),e.children);)e=e.children[0];let n=[];for(let e of r){let r=e.split("_");for(let a of s)r[0]==a&&i.encodings[e][t]&&n.push(i.encodings[e][t])}return n}get firstChild(){return this.children[0]}set layout(t){this._layout=t,t.group=this,this._layout.run()}get layout(){return this._layout}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get x(){return this.bounds.x}get y(){return this.bounds.y}_updateBounds(){if(this._layout&&"grid"==this._layout.type){let t=this._layout.cellBounds;this._bounds=t[0].clone();for(let e=1;e<t.length;e++)this._bounds=this._bounds.union(t[e])}else if(this.children.length>0){this._bounds=this.children[0].bounds.clone();for(let t=0;t<this.children.length;t++)this._bounds=this._bounds.union(this.children[t].bounds)}else this._bounds=new Rectangle$1(0,0,0,0)}sortChildrenByData(t,e,i){let r;switch(this.children[0].dataScope.getFieldType(t)){case DataType.Date:break;case DataType.Number:case DataType.Integer:r=(e,i)=>e.dataScope.aggregateNumericalField(t)-i.dataScope.aggregateNumericalField(t);break;case DataType.String:r=i?(e,r)=>i.indexOf(e.dataScope.getFieldValue(t))-i.indexOf(r.dataScope.getFieldValue(t)):(e,i)=>e.dataScope.getFieldValue(t)<i.dataScope.getFieldValue(t)?-1:1}this.children.sort(r),e&&this.children.reverse(),this.layout&&this.layout.run(),this.childrenOrder={field:t,reverse:e,order:i}}sortChildren(t,e){let i;switch(t){case"x":case"y":case"width":case"height":i=(e,i)=>e.bounds[t]-i.bounds[t];break;default:i=(e,i)=>e[t]-i[t]}this.children.sort(i),e&&this.children.reverse(),this.layout&&this.layout.run(),this.childrenOrder={channel:t,reverse:e}}set visibility(t){this._visibility="hidden"==t?t:"visible";for(let e of this.children)e.visibility=t}get visibility(){return this._visibility?this._visibility:"visible"}}function validateField(t,e){if(e.hasField(t))return!0;if(e.tree&&e.tree.nodeTable.hasField(t.split(".")[1]))return!0;throw new Error(Errors.FIELD_NONEXISTENT+", field: "+t+", data table: "+e.name)}class DataScope{constructor(t){this._field2value={},this._dt=t,this._tuples=this._dt.data}toJSON(){let t={};return t.dt=this._dt.url,t.f2v=Object.assign({},this._field2value),t}isEmpty(){return 0==this._tuples.length}get numTuples(){return this._tuples.length}get fields(){return Object.keys(this._field2value)}get dataTable(){return this._dt}merge(t){let e=new DataScope(this._dt);for(let i in t._field2value)e=e.cross(i,t._field2value[i]);for(let t in this._field2value)e=e.cross(t,this._field2value[t]);return e}cross(t,e){let i=this.clone();return i._field2value[t]=e,i._updateTuples(t,e),i}clone(){let t=new DataScope(this._dt);return t._field2value=Object.assign({},this._field2value),t._tuples=this._tuples.map((t=>t)),t}getFieldValue(t){let e=this._tuples.map((e=>e[t]));return e=[...new Set(e)],e.length,e[0]}hasField(t){return t in this._field2value}getFieldType(t){return this._dt.getFieldType(t)}aggregateNumericalField(t,e){let i=this._tuples.map((e=>e[t]));switch(e){case Aggregator.Max:return Math.max(...i);case Aggregator.Min:return Math.min(...i);case Aggregator.Avg:case Aggregator.Mean:return d3__namespace.mean(i);case Aggregator.Median:return d3__namespace.median(i);case Aggregator.Count:return i.length;case Aggregator.Percentile25:return d3__namespace.quantile(i,.25);case Aggregator.Percentile75:return d3__namespace.quantile(i,.75);case Aggregator.Sum:default:return d3__namespace.sum(i)}}_updateTuples(t,e){this._tuples=this._tuples.filter((i=>i[t]==e))}}function repeatItem(t,e,i,r,s){let n=s?r.transformField(i,s):i,a=r.getFieldType(n);if(a!=DataType.String&&a!=DataType.Date)throw new Error(Errors.REPEAT_BY_NONCAT+": "+n+" is "+a);if(!_canRepeat(e))throw new Error(Errors.COMPNT_NON_REPEATABLE);return _doRepeat(t,e,n,r)}function _canRepeat(t){return!(!isMark(t)&&t.type!=ItemType.Glyph||t.dataScope)||t.type==ItemType.Collection}function _doRepeat(t,e,i,r){let s=r.getFieldSummary(i).unique.map((t=>new DataScope(r).cross(i,t))),n=t.collection();t.addChild(n),n.addChild(e);for(let t=1;t<s.length;t++){let t=e.duplicate();n.addChild(t)}return n.children.forEach(((t,e)=>t.dataScope=s[e])),t._reapplySizeBindings(e),n}class StackLayout extends Layout{constructor(t){super(t),this.type=LayoutType.Stack,this._orientation=t.orientation,this._left=t.left,this._top=t.top,this.baseline=t.baseline,this._horzCellAlignment=t.hasOwnProperty("horzCellAlignment")?t.horzCellAlignment:Alignment.Left,this._vertCellAlignment=t.hasOwnProperty("vertCellAlignment")?t.vertCellAlignment:Alignment.Bottom,this._gap=t.hasOwnProperty("gap")?t.gap:0}toJSON(){let t={args:{}};return t.type=this.type,t.args.orientation=this._orientation,t.args.left=this._left,t.args.top=this._top,t.args.baseline=this.baseline,t.args.gap=this._gap,t.args.horzCellAlignment=this._horzCellAlignment,t.args.vertCellAlignment=this._vertCellAlignment,t}clone(){let t=new StackLayout({orientation:this._orientation,left:this._left,top:this._top,baseline:this.baseline});return t._horzCellAlignment=this._horzCellAlignment,t._vertCellAlignment=this._vertCellAlignment,t}_stackAreas(){let t=this.group.children[0],e=t.vertices.length/2,i=new Array(e).fill(0),r=CheckAreaOrien(t);for(let t of this.group.children){for(let i=0;i<e;i++){let s,n=t.vertices[i],a=t.vertices[2*e-i-1];switch(r){case Orientation.Horizontal:s=this._vertCellAlignment==Alignment.Bottom?this.group.bounds.bottom-a.y:this.group.bounds.top-a.y,n.translate(0,s),a.translate(0,s);break;case Orientation.Vertical:s=this._horzCellAlignment==Alignment.Left?this.group.bounds.left-a.x:this.group.bounds.right-a.x,n.translate(s,0),a.translate(s,0)}}t._updateBounds()}for(let t of this.group.children){for(let s=0;s<e;s++){let n=t.vertices[s],a=t.vertices[2*e-s-1];switch(r){case Orientation.Horizontal:n.translate(0,i[s]),a.translate(0,i[s]),i[s]=i[s]+n.y-a.y;break;case Orientation.Vertical:n.translate(i[s],0),a.translate(i[s],0),i[s]=i[s]+n.x-a.x}}t._updateBounds()}this.group._updateBounds();let s=this.group._bounds.height,n=this.group._bounds.width;if(this.baseline==Alignment.Center||this.baseline==Alignment.Middle)for(let t of this.group.children){for(let a=0;a<e;a++){let o,h=t.vertices[a],l=t.vertices[2*e-a-1];switch(r){case Orientation.Horizontal:o=-(i[a]+s)/2,h.translate(0,o),l.translate(0,o);break;case Orientation.Vertical:o=(n-i[a])/2,h.translate(o,0),l.translate(o,0)}}t._updateBounds()}this.group._updateBounds()}_stackRects(){let t=this.group.getScene(),e=this.group,i=this._orientation,r=e.children.map((t=>t.bounds)),s=r.map((t=>t.left)),n=r.map((t=>t.top)),a=r.map((t=>t.width)),o=r.map((t=>t.height)),h=null==this._left?Math.min(...s):this._left,l=null==this._top?Math.min(...n):this._top,u=Math.max(...a),c=Math.max(...o);if(i==Orientation.Vertical){let i=h+u/2;for(let r=0;r<e.children.length;r++){let s=e.children[r],n=i-s.bounds.x,a=l+s.bounds.height/2-s.bounds.y;l+=s.bounds.height+this._gap,s.translate(n,a);let o=0,c=0;if(!t.getEncodingByItem(s,"x"))switch(this._horzCellAlignment){case Alignment.Left:o=h-s.bounds.left;break;case Alignment.Center:o=h+u/2-s.bounds.x;break;case Alignment.Right:o=h+u-s.bounds.right}s.translate(o,c)}}else{let i=l+c/2;for(let r=0;r<e.children.length;r++){let s=e.children[r],n=h+s.bounds.width/2-s.bounds.x,a=i-s.bounds.y;h+=s.bounds.width+this._gap,s.translate(n,a);let o=0,u=0;if(!t.getEncodingByItem(s,"y"))switch(this._vertCellAlignment){case Alignment.Top:u=l-s.bounds.top;break;case Alignment.Middle:u=l+c/2-s.bounds.y;break;case Alignment.Bottom:u=l+c-s.bounds.bottom}s.translate(o,u)}}this.group._updateBounds()}run(){null!=this.group&&("area"==this.group.children[0].type?this._stackAreas():this._stackRects())}set vertCellAlignment(t){if(t!=Alignment.Top&&t!=Alignment.Bottom&&t!=Alignment.Middle)throw Errors.UNKOWN_ALIGNMENT;this._vertCellAlignment=t,this.run()}get vertCellAlignment(){return this._vertCellAlignment}set horzCellAlignment(t){if(t!=Alignment.Left&&t!=Alignment.Center&&t!=Alignment.Right)throw Errors.UNKOWN_ALIGNMENT;this._horzCellAlignment=t,this.run()}get horzCellAlignment(){return this._horzCellAlignment}get cellBounds(){return this.group.children.map((t=>t.bounds))}get orientation(){return this._orientation}}function divideItem(t,e,i,r,s,n){let a=n?s.transformField(r,n):r,o=s.getFieldType(a);if(o!=DataType.String&&o!=DataType.Date)throw new Error(Errors.PARTITION_BY_NONCAT+": "+a+" is "+o);if(!_canDivide(e,a,t))throw new Error(Errors.COMPNT_NON_PARTITIONABLE);switch(e.type){case ItemType.Line:return _doLineDivide(t,e,a,s);case ItemType.Circle:return _doCircleDivide(t,e,i,a,s);case ItemType.Rect:return _doRectDivide(t,e,i,a,s);case ItemType.Area:return _doAreaDivide(t,e,i,a,s);case ItemType.Ring:return _doRingDivide(t,e,i,a,s)}}function _canDivide(t,e,i){if([ItemType.Line,ItemType.Circle,ItemType.Rect,ItemType.Area,ItemType.Ring].indexOf(t.type)<0)return!1;if(t.dataScope){let e=getPeers(t,i);for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function _doLineDivide(t,e,i,r){let s,n,a=getPeers(e,t),o=r.getFieldSummary(i).unique.map((t=>new DataScope(r).cross(i,t))),h={},l=0;for(let t of a){let e=o;t.dataScope&&(e=o.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>l&&(l=e.length),h[t.id]=e}for(let i of a){let r=t.collection();null==n&&(n=r.id),r.classId=n,r.dataScope=i.dataScope,i.parent.addChild(r);let a=h[i.id],o=i.vertices[0].x,u=i.vertices[0].y,c=i.vertices[1].x,d=i.vertices[1].y;i.classId=e.id,i.vertices[0].x=o,i.vertices[0].y=u,i.vertices[1].x=o+(c-o)/l,i.vertices[1].y=u+(d-u)/l,i.dataScope=a[0],r.addChild(i);for(let t=1;t<a.length;t++){let e=i.duplicate();e.vertices[0].x=o+(c-o)*t/l,e.vertices[0].y=u+(d-u)*t/l,e.vertices[1].x=o+(c-o)*(t+1)/l,e.vertices[1].y=u+(d-u)*(t+1)/l,e.dataScope=a[t],r.addChild(e)}i==e&&(s=r)}return s}function _doRectDivide(t,e,i,r,s){let n,a,o=getPeers(e,t),h=i||Orientation.Horizontal,l=s.getFieldSummary(r).unique.map((t=>new DataScope(s).cross(r,t))),u={},c=0;for(let t of o){let e=l;t.dataScope&&(e=l.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>c&&(c=e.length),u[t.id]=e}for(let i of o){let r=t.collection();null==a&&(a=r.id),r.classId=a,r.dataScope=i.dataScope,i.parent.addChild(r);let s=u[i.id],o=i.bounds,l=o.left,d=o.top,p=h==Orientation.Horizontal?o.width/c:o.width,f=h==Orientation.Horizontal?o.height:o.height/c;i.classId=e.id,i.resize(p,f),i.dataScope=s[0],r.addChild(i);for(let t=1;t<s.length;t++){let e=i.duplicate();e.resize(p,f),e.dataScope=s[t],r.addChild(e)}r.layout=new StackLayout({orientation:h,left:l,top:d}),i==e&&(n=r)}return t._reapplySizeBindings(n),n}function _doAreaDivide(t,e,i,r,s){let n,a=getPeers(e,t),o=a[0];if(4==o.vertices.length&&i==Orientation.Horizontal&&o.vertices[0].x!==o.vertices[1].x)for(let t of a){let e=t.vertices[1];t.vertices[1]=t.vertices[3],t.vertices[3]=e}let h,l=s.getFieldSummary(r).unique.map((t=>new DataScope(s).cross(r,t)));for(let r of a){let s=t.collection();null==h&&(h=s.id),s.classId=h,s.dataScope=r.dataScope,r.parent.addChild(s);let a=r.left,o=r.top,u=i==Orientation.Horizontal?r.width/l.length:r.width,c=i==Orientation.Horizontal?r.height:r.height/l.length;r.classId=e.id,r.resizeArea(u,c),s.addChild(r);for(let t=1;t<l.length;t++){let t=r.duplicate();t.resizeArea(u,c),s.addChild(t)}for(let t=0;t<s.children.length;t++){let e=s.children[t];e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];for(let t of e.vertices)t.dataScope?t.dataScope=e.dataScope.merge(t.dataScope):t.dataScope=e.dataScope}s.layout=new StackLayout({orientation:i,left:a,top:o}),r==e&&(n=s)}return t._reapplySizeBindings(n),n}function _doRingDivide(t,e,i,r,s){let n,a,o=i||Orientation.Angular,h=getPeers(e,t);if(o==Orientation.Angular)return h.forEach((i=>{let o=i.dataScope?i.dataScope:new DataScope(s),h=s.getFieldSummary(r).unique.map((t=>o.cross(r,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,u=t.collection();u.dataScope=o,null==a&&(a=u.id),u.classId=a;let c=i.parent,d=360/l;for(let r=0;r<l;r++){let s=t.mark("arc",{innerRadius:i.innerRadius,outerRadius:i.outerRadius,x:i.x,y:i.y,startAngle:90-d*(r+1),endAngle:90-d*r,strokeColor:i.strokeColor,fillColor:i.fillColor,strokeWidth:i.strokeWidth,opacity:i.opacity});s.dataScope=h[r],s.classId=e.id,u.addChild(s)}c.removeChild(i),c.addChild(u),i==e&&(n=u)})),n}function _doCircleDivide(t,e,i,r,s){let n,a,o=i||Orientation.Angular,h=getPeers(e,t);return o==Orientation.Angular?h.forEach((i=>{let o=i.dataScope?i.dataScope:new DataScope(s),h=s.getFieldSummary(r).unique.map((t=>o.cross(r,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,u=t.collection();u.dataScope=o,null==a&&(a=u.id),u.classId=a;let c=i.parent,d=360/l;for(let r=0;r<l;r++){let s=t.mark("pie",{radius:i.radius,x:i.x,y:i.y,startAngle:90-d*(r+1),endAngle:90-d*r,strokeColor:"#444444",fillColor:i.styles.fillColor});s.dataScope=h[r],s.classId=e.id,u.addChild(s)}c.removeChild(i),c.addChild(u),i==e&&(n=u)})):h.forEach((i=>{let o=i.dataScope?i.dataScope:new DataScope(s),h=s.getFieldSummary(r).unique.map((t=>o.cross(r,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,u=t.collection();u.dataScope=o,null==a&&(a=u.id),u.classId=a;let c=i.parent,d=360/l;for(let r=0;r<l;r++){let s=t.mark("pie",{radius:i.radius,x:i.x,y:i.y,startAng:d*r,endAng:d+d*r,strokeColor:"#444444",fillColor:i.styles.fillColor});s.dataScope=h[r],s.classId=e.id,u.addChild(s)}c.removeChild(i),c.addChild(u),i==e&&(n=u)})),n}function densifyItem(t,e,i,r,s,n,a,o){let h=n?s.transformField(r,n):r,l=s.getFieldType(h);if(l!=DataType.String&&l!=DataType.Date&&l!=DataType.Number)throw new Error(Errors.DENSIFY_BY_NONCAT+": "+h+" is "+l);if(!_canDensify(e,h,t))throw new Error(Errors.COMPNT_NON_DENSIFIABLE);switch(e.type){case ItemType.Line:return _doLineDensify(t,e,h,s);case ItemType.Circle:return _doCircleDensify(t,e,h,s,a,o);case ItemType.Rect:case ItemType.Area:return _doAreaDensify(t,e,i,h,s)}}function _canDensify(t,e,i){if([ItemType.Line,ItemType.Circle,ItemType.Rect,ItemType.Area].indexOf(t.type)<0)return!1;if(t.dataScope){let e=getPeers(t,i);for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function _doLineDensify(t,e,i,r){let s,n=getPeers(e,t);for(let a of n){let n=a.dataScope?a.dataScope:new DataScope(r),o=r.getFieldSummary(i).unique.map((t=>n.cross(i,t)));o=o.filter((t=>!t.isEmpty()));let h=Object.assign({},a.styles);for(let t of Vertex.styles)a[t]&&(h[t]=a[t]);let l=a.vertices[0].x,u=a.vertices[0].y,c=[],d=a.vertices[1].x-l,p=a.vertices[1].y-u;for(let t=0;t<o.length;t++)c.push([l+t*d/(o.length-1),u+t*p/(o.length-1)]);h.vertices=c;let f=t.mark("path",h);f.classId=e.id,f.dataScope=n;let _=a.parent;_.addChild(f),_.removeChild(a);for(let[t,e]of f.vertices.entries())e.dataScope?e.dataScope=e.dataScope.merge(o[t]):e.dataScope=o[t];a==e&&(s=f)}return s}function _doAreaDensify(t,e,i,r,s){let n,a=getPeers(e,t);for(let o of a){let a=s.getFieldType(r),h=o.dataScope?o.dataScope:new DataScope(s),l=s.getFieldSummary(r).unique.map((t=>h.cross(r,t)));l=a==DataType.Number?l:l.filter((t=>!t.isEmpty())),a!=DataType.Number&&a!=DataType.Date||l.sort(((t,e)=>t._field2value[r]>e._field2value[r]?1:-1));let u=Object.assign({},o.styles),c=o.vertices[0].x,d=o.vertices[0].y,p=o.vertices[o.vertices.length-2].x,f=o.vertices[o.vertices.length-2].y,_=[],g=p-c,m=f-d;for(let t=0;t<l.length;t++)_.push(i==Orientation.Vertical?[p,d+(l.length-1-t)*m/(l.length-1)]:[c+t*g/(l.length-1),d]);for(let t=0;t<l.length;t++)_.push(i==Orientation.Vertical?[c,d+t*m/(l.length-1)]:[c+(l.length-1-t)*g/(l.length-1),f]);u.vertices=_;let y=t.mark("area",u);y.classId="area"==o.type?o.classId:"area"+o.classId.substring(9),y.dataScope=h,y._orientation=i;let x=o.parent;x.addChild(y),x.removeChild(o);for(let[t,e]of y.vertices.entries())t>=l.length?e.dataScope=h.merge(l[2*l.length-1-t]):e.dataScope=h.merge(l[t]);o==e&&(n=y)}return n}function _doCircleDensify(t,e,i,r,s,n){let a;return getPeers(e,t).forEach((o=>{let h=o.dataScope?o.dataScope:new DataScope(r),l=r.getFieldSummary(i).unique.map((t=>h.cross(i,t)));l=l.filter((t=>!t.isEmpty()));let u=l.length;if(u<3)throw Error(Errors.INSUFFICIENT_DATA_SCOPES);let c=360/u,d=[],p=[],f="clockwise"==n?-1:1;for(let t=0;t<l.length;t++){let e=s+f*t*c;p[t]=e;let i=polar2Cartesian(o.x,o.y,o.radius,p[t]);d.push(i)}let _=t.mark("polygon",{x:o.x,y:o.y,radius:o.radius,vertices:d});_.dataScope=h,_.styles=Object.assign({},o.styles);for(let t of Vertex.styles)o[t]&&(_[t]=o[t]);let g=o.parent;g.addChild(_),g.removeChild(o);for(let[t,e]of _.vertices.entries())e.polarAngle=p[t],e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];o==e&&(a=_)})),a}class RectPath extends Path{constructor(t){super(t),this.type=ItemType.Rect,this.closed=!0,t&&"vertices"in t&&this.segments.push(new Segment(this.vertices[3],this.vertices[0],this,this.segmentCounter++))}get width(){return this.vertices[1].x-this.vertices[0].x}get height(){return this.vertices[2].y-this.vertices[1].y}set height(t){this.resize(this.width,t)}set width(t){this.resize(t,this.height)}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}get right(){return this.vertices[1].x}get bottom(){return this.vertices[2].y}resize(t,e){this.vertices[1].x=this.vertices[0].x+t,this.vertices[2].x=this.vertices[1].x,this.vertices[0].y=this.vertices[3].y-e,this.vertices[1].y=this.vertices[0].y,this._updateBounds()}get leftSegment(){return this.segments[3]}get rightSegment(){return this.segments[1]}get topSegment(){return this.segments[0]}get bottomSegment(){return this.segments[2]}}class CirclePath extends Path{constructor(t){super(t),this.type=ItemType.Circle,this.closed=!0,this.attrs.x=t.hasOwnProperty("x")?t.x:0,this.attrs.y=t.hasOwnProperty("y")?t.y:0,this.attrs.radius=t.hasOwnProperty("radius")?t.radius:100}get radius(){return this.attrs.radius}get x(){return this.attrs.x}get y(){return this.attrs.y}set x(t){this.attrs.x=t,this._updateBounds()}set y(t){this.attrs.y=t,this._updateBounds()}set radius(t){this.attrs.radius=t,this._updateBounds()}set width(t){this.attrs.radius=t/2,this._updateBounds()}set height(t){this.attrs.radius=t/2,this._updateBounds()}resize(t,e){this.attrs.radius=t/2,this._updateBounds()}translate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){this._bounds=new Rectangle$1(this.attrs.x-this.attrs.radius,this.attrs.y-this.attrs.radius,2*this.attrs.radius,2*this.attrs.radius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t.attrs.x=this.attrs.x,t.attrs.y=this.attrs.y,t.attrs.radius=this.attrs.radius}}function bindToSize(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,i=this.aggregator;switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case DataType.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,i)))}},t._map=function(){let t,e=this.items,i=this.data,r=this.channel;if(t=createScale(this.scaleType?this.scaleType:"linear"),null==this.data.find((t=>t<0))||"width"!=r&&"height"!=r||0!=e[0].type.indexOf("rect")){let s,n;t.domain=[0,Math.max(...i)],"radius"==r||"outerRadius"==r||"innerRadius"==r?(s=0,n=Math.max(...e.map((t=>t[r]))),n<20&&(n=20)):"area"==r?(s=0,n=Math.max(...e.map((t=>Math.pow(t.bounds.width,2)))),n<400&&(n=400)):"fontSize"==r?(s=2,n=Math.max(...e.map((t=>parseFloat(t.styles.fontSize))))):"strokeWidth"==r?(s=1,n=Math.max(...e.map((t=>parseFloat(t.styles.strokeWidth)))),n==s&&(n=s+5)):(s=0,n=Math.max(...e.map((t=>t.bounds[r])))),this.rangeExtent&&(n=s+this.rangeExtent),this.range&&(s=this.range[0],n=this.range[1]),t._setRange([s,n])}else this._rectNegativeValues=!0,t.domain=[Math.min(...i),Math.max(...i)],"width"==r?t._setRange([0,Math.max(...e.map((t=>t.width)))]):t._setRange([0,Math.max(...e.map((t=>t.height)))]);this.scale||(this.scale=t),this.scale._addEncoding(this)},t._apply=function(){if("radius"==this.channel||"outerRadius"==this.channel||"innerRadius"==this.channel){for(let t=0;t<this.items.length;t++){this.items[t][this.channel]=this.scale.map(this.data[t])}this.scene._relayoutAncestors(this.anyItem,this.items)}else if(this._rectNegativeValues){if("width"==this.channel){let t=Math.min(...this.items.map((t=>t.bounds.left)));for(let e=0;e<this.items.length;e++){let i,r=this.items[e],s=r.leftSegment.vertex1.x,n=r.rightSegment.vertex1.x;i=r.parent&&r.parent.type==ItemType.Collection?r.parent.bounds.left:t,r.rightSegment.translate(i+this.scale.map(this.data[e])-n,0),r.leftSegment.translate(i+this.scale.map(0)-s,0),r._updateBounds()}}else if("height"==this.channel){let t=Math.min(...this.items.map((t=>t.bounds.top)))+this.scale.rangeExtent;for(let e=0;e<this.items.length;e++){let i,r=this.items[e],s=r.topSegment.vertex1.y,n=r.bottomSegment.vertex1.y;i=r.parent&&r.parent.type==ItemType.Collection?r.parent.bounds.bottom:t,r.topSegment.translate(0,i-this.scale.map(this.data[e])-s),r.bottomSegment.translate(0,i-this.scale.map(0)-n),r._updateBounds()}}}else if("area"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=Math.sqrt(this.scale.map(this.data[t]));e.resize(i,i)}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("fontSize"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.styles.fontSize=i+"px"}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("strokeWidth"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.styles.strokeWidth=i}this.scene._relayoutAncestors(this.anyItem,this.items)}else{for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]),r="width"==this.channel?i:e.bounds.width,s="height"==this.channel?i:e.bounds.height;e.resize(r,s)}this.scene._relayoutAncestors(this.anyItem,this.items)}},t.run(),t}function bindToPosition(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t,e,i,r,s,n=this.channel,a=this.datatable.getFieldType(this.field),o=getClosestLayout(this.anyItem);if(o&&o.type==LayoutType.Grid){let e=o.cellBounds;t="x"==n?e[0].width:e[0].height}else{let e=this.items.map((t=>t[n]));t=Math.max(...e)-Math.min(...e),t<100?t=100:t>500&&(t=500)}switch(this.rangeExtent&&(t=this.rangeExtent),a){case DataType.Boolean:break;case DataType.Date:if(e=Math.min(...this.data),i=Math.max(...this.data),r=[e,i],this.scale){let t=r.concat(this.scale.domain);r=[Math.min(...t),Math.max(...t)],s=this.scale.range}else this.scale=createScale("time"),s=this.invertScale?[t,0]:[0,t];break;case DataType.String:r=Array.from(new Set(this.data)),s=[0,t],this.scale?(r=Array.from(new Set(r.concat(this.scale.domain))),s=this.scale.range):(this.scale=createScale("point"),s=this.invertScale?[t,0]:[0,t]);break;default:if(e=Math.min(...this.data),i=Math.max(...this.data),r=this.includeZero?[0,i]:[e,i],this.scale){let t=r.concat(this.scale.domain);r=[Math.min(...t),Math.max(...t)],s=this.scale.range}else this.scale=createScale(this.scaleType?this.scaleType:"linear"),s=this.invertScale?[t,0]:[0,t];r[0]==r[1]&&(r[1]=1.1*r[0])}this.scale.domain=r,this.scale._setRange(s),this.scale._addEncoding(this)},t._apply=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);if("x"==e){let i=getClosestLayout(this.anyItem);if(i&&i.type==LayoutType.Grid)for(let t=0;t<this.items.length;t++){let i=this.items[t],r=getCellBoundsInLayout(i).left+this.scale.map(this.data[t])-i[e],s=0;i.translate(r,s)}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.left))));for(let t=0;t<this.items.length;t++){let i=this.items[t],r=this.scale.offset+this.scale.map(this.data[t])-i[e],s=0;i.translate(r,s)}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t[e]))));for(let t=0;t<this.items.length;t++){let i=this.items[t],r=this.scale.offset+this.scale.map(this.data[t])-i[e],s=0;i.translate(r,s)}}}else{let i=getClosestLayout(this.anyItem);if(i&&i.type==LayoutType.Grid){let t=this.items.map((t=>getCellBoundsInLayout(t)));for(let i=0;i<this.items.length;i++){let r=this.items[i],s=0,n=t[i].bottom-this.scale.map(this.data[i])-r[e];r.translate(s,n)}}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){void 0===this.scale.offset&&(this.scale.offset=Math.min(...this.items.map((t=>t.y))));for(let t=0;t<this.items.length;t++){let i=this.items[t],r=0,s=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-i[e];i.translate(r,s)}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.y))));for(let t=0;t<this.items.length;t++){let i=this.items[t],r=0,s=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-i[e];i.translate(r,s)}}}},t.run(),t}function bindToRadialDistance(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t=this.data;this.scale||(this.scale=createScale("linear"),this.scale.domain=[0,Math.max(...t)],this.scale._setRange([0,this.radius]),this.scale._addEncoding(this))},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]),r=polar2Cartesian(this.x,this.y,i,e.polarAngle);e.x=r[0],e.y=r[1]}this.scene._relayoutAncestors(this.anyItem,this.items)},t.run(),t}function bindToColor(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:this.data=[!0,!1];break;case DataType.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){switch(this.datatable.getFieldType(this.field)){case DataType.Date:break;case DataType.Boolean:case DataType.String:if(this.scale)this.scale.domain=Array.from(new Set(this.scale.domain.concat(this.data)));else if(this.scale=createScale("ordinalColor"),this.scale.domain=this.data,this.mapping){let t=this.scale.domain.map((t=>t in this.mapping?this.mapping[t]:"black"));this.scale._scale.range(t)}break;default:if(this.scale){let t=this.scale.domain.concat(this.data);this.scale.domain=[Math.min(...t),Math.max(...t)]}else this.mapping?this.scale=createScale("linear",this.mapping):(this.scale=createScale("sequentialColor",this.scheme?this.scheme:"interpolateTurbo"),this.scale.domain=[Math.min(...this.data),Math.max(...this.data)])}},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);"vertex"==e.type||"segment"==e.type?e[this.channel]=i:e.styles[this.channel]=i,e.vertices&&"strokeColor"==this.channel&&e.vertices.forEach((t=>t.fillColor=i))}},t.run(),t}function bindToAngle(t){return t._query=function(){this.data=[];let t=this.field,e=this.items;switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case DataType.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){this.scale||(this.scale=createScale("linear"),this.scale.domain=[0,this.data.reduce(((t,e)=>t+e),0)],this.scale._setRange([0,360]),this.scale._addEncoding(this))},t._apply=function(){let t,e=this.startAngle;for(let i=0;i<this.items.length;i++){t=this.items[i];let r=this.scale.map(this.data[i]);switch(this.angleDirection){case"clockwise":t.adjustAngle(e-r,e),e-=r;break;case"anticlockwise":t.adjustAngle(e,e+r),e+=r}}},t.run(),t}function bindToArea(t){return t._query=function(){this.data=[],this.areas=getPeers(this.items[0],this.scene);let t=this.areas.length;this.areaNum=t,this.items=[],this.indicator=[];for(let t of this.areas)for(let e=0;e<t.vertices.length;e++)this.items.push(t.vertices[e]),e<t.vertices.length/2?this.indicator.push(1):this.indicator.push(0);let e=this.field,i=this.items,r="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?i.map((t=>t.dataScope)):i.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(e)){case DataType.Boolean:break;case DataType.Date:this.data=r.map((t=>t.getFieldValue(e)));break;case DataType.String:this.data=r.map((t=>0==this.indicator[r.indexOf(t)]?0:t.aggregateNumericalField(e,this.aggregator)));break;default:"x"==this.channel||"y"==this.channel?this.data=r.map((t=>t._field2value[e])):this.data=r.map((t=>0==this.indicator[r.indexOf(t)]?0:t.aggregateNumericalField(e,this.aggregator)))}},t._map=function(){let t,e,i;switch(this.datatable.getFieldType(this.field)){case DataType.Boolean:break;case DataType.Date:t=createScale("time"),e=Math.min(...this.data),i=Math.max(...this.data),t.domain=[e,i];break;case DataType.String:default:t=createScale("linear"),e=Math.min(...this.data),i=Math.max(...this.data),t.domain=this.includeZero||e<0?[0,i]:[e,i]}let r,s=CheckAreaOrien(this.areas[0]),n=getClosestLayout(this.anyItem);if(n){let t=n.cellBounds;r="width"==this.channel||"height"==this.channel?s==Orientation.Vertical?t[0].width:t[0].height:s==Orientation.Vertical?t[0].height:t[0].width}else if("width"==this.channel||"x"==this.channel){let t=this.items.map((t=>t.x));r=Math.max(...t)-Math.min(...t)}else{let t=this.items.map((t=>t.y));r=Math.max(...t)-Math.min(...t)}e<0?(t._scale.domain([e,i]),t._setRange([0,r])):t._setRange([0,r]),this.scale?this.scale._merge(t):this.scale=t,this.scale._addEncoding(this)},t._apply=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);let i=CheckAreaOrien(this.areas[0]);if("width"==e||"height"==e){let t=this.scale.domain[0]<this.scale.domain[1]?"default":"opposite",e=getAllLayouts(this.items);if(e[0]){let r=e[e.length-1].baseline==Alignment.Center||e[e.length-1].baseline==Alignment.Middle;for(let s=e.length-1;s>=0;s--){let n=e[s];if(i==Orientation.Vertical)switch(n.type){case LayoutType.Grid:if(r){n._cellHorzAlignment=Alignment.Center;break}n._cellHorzAlignment=n.baseline?n.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellHorzAlignment:n._cellHorzAlignment;break;case LayoutType.Stack:if(r){n.baseline=r?Alignment.Center:void 0;break}n._horzCellAlignment=n.baseline?n.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellHorzAlignment:"default"==t?Alignment.Left:Alignment.Right}else switch(n.type){case LayoutType.Grid:if(r){n._cellVertAlignment=Alignment.Middle;break}n._cellVertAlignment=n.baseline?n.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellVertAlignment:n._cellVertAlignment;break;case LayoutType.Stack:if(r){n.baseline=r?Alignment.Middle:void 0;break}n._vertCellAlignment=n.baseline?n.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellVertAlignment:"default"==t?Alignment.Bottom:Alignment.Top}}for(let t=0;t<this.items.length;t++){let e=this.items[t],r=getCellBoundsInLayout(e),s=getClosestLayout(e),n=i==Orientation.Vertical?s.type==LayoutType.Stack?s._horzCellAlignment==Alignment.Left:s._cellHorzAlignment==Alignment.Left:s.type==LayoutType.Stack?s._vertCellAlignment==Alignment.Bottom:s._cellVertAlignment==Alignment.Bottom,a=i==Orientation.Vertical?n?r.left+this.scale.map(this.data[t])-e.x:r.right-this.scale.map(this.data[t])-e.x:0,o=i==Orientation.Vertical?0:n?r.bottom-this.scale.map(this.data[t])-e.y:r.top+this.scale.map(this.data[t])-e.y;e.translate(a,o)}if("grid"==e[e.length-1].type&&r){let t=this.items.length/this.areaNum;for(let e=0;e<this.areaNum;e++)for(let r=0;r<t/2;r++){let s=e*t+r,n=(e+1)*t-r-1,a=this.items[s],o=this.items[n],h=getCellBoundsInLayout(a),l=i==Orientation.Vertical?a.x-o.x:o.y-a.y,u=i==Orientation.Vertical?h.x+l/2-a.x:0,c=i==Orientation.Vertical?0:h.y+l/2-a.y,d=i==Orientation.Vertical?h.x-l/2-o.x:0,p=i==Orientation.Vertical?0:h.y-l/2-o.y;a.translate(u,c),o.translate(d,p)}}}else{let t="center"==this.areas[0].baseline,e=getParents(this.items),r=i==Orientation.Vertical?this.areas[0].baseline!==Alignment.Right?Math.min(...e.map((t=>t.bounds.left))):Math.max(...e.map((t=>t.bounds.right))):this.areas[0].baseline!=Alignment.Top?Math.max(...e.map((t=>t.bounds.bottom))):Math.min(...e.map((t=>t.bounds.top)));for(let t=0;t<this.items.length;t++){let e=this.items[t],s=i==Orientation.Vertical?this.areas[0].baseline!==Alignment.Right?r+this.scale.map(this.data[t])-e.x:r-this.scale.map(this.data[t])-e.x:0,n=i==Orientation.Vertical?0:this.areas[0].baseline!=Alignment.Top?r-this.scale.map(this.data[t])-e.y:r+this.scale.map(this.data[t])-e.y;e.translate(s,n)}if(1==t){let t=this.items.length/this.areaNum,e=getParents(this.items),r=i==Orientation.Vertical?Math.min(...e.map((t=>t.bounds.x))):Math.max(...e.map((t=>t.bounds.y)));for(let e=0;e<this.areaNum;e++)for(let s=0;s<t/2;s++){let n=e*t+s,a=(e+1)*t-s-1,o=this.items[n],h=this.items[a],l=i==Orientation.Vertical?o.x-h.x:h.y-o.y,u=i==Orientation.Vertical?r+l/2-o.x:0,c=i==Orientation.Vertical?0:r+l/2-o.y,d=i==Orientation.Vertical?r-l/2-h.x:0,p=i==Orientation.Vertical?0:r-l/2-h.y;o.translate(u,c),h.translate(d,p)}}}}else{if(getClosestLayout(this.anyItem)){let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=i==Orientation.Horizontal?Math.min(...t.map((t=>t.bounds.left))):Math.max(...t.map((t=>t.bounds.top))));for(let t=0;t<this.items.length;t++){let e=this.items[t],r=getCellBoundsInLayout(e),s=i==Orientation.Vertical?0:r.left+this.scale.map(this.data[t])-e.x,n=i==Orientation.Vertical?r.bottom-this.scale.map(this.data[t])-e.y:0;e.translate(s,n)}}else{let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=i==Orientation.Horizontal?Math.min(...t.map((t=>t.bounds.left))):Math.max(...t.map((t=>t.bounds.top))));for(let t=0;t<this.items.length;t++){let e=this.items[t],r=i==Orientation.Horizontal?this.scale.offset+this.scale.map(this.data[t])-e.x:0,s=i==Orientation.Horizontal?0:this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-e.y;e.translate(r,s)}}}for(let t of this.areas)t._updateBounds();"width"!=e&&"height"!=e||this.scene._relayoutAncestors(this.areas[0],this.areas)},t.run(),t}function bindToText(t){return t._query=function(){this.data=[];let t,e,i=this.items;if(this.field.startsWith("parent.")||this.field.startsWith("child.")){e=this.datatable.tree.nodeTable,t=this.field.split(".")[1];let r=this.field.split(".")[0],s=i.map((t=>t.dataScope)).map((t=>t.getFieldValue(r)));e.getFieldType(t)==DataType.Integer||e.getFieldType(t)==DataType.Number?this.data=s.map((i=>new DataScope(e).cross(nodeId,i).aggregateNumericalField(t))):this.data=s.map((i=>new DataScope(e).cross(nodeId,i).getFieldValue(t)))}else e=this.datatable,t=this.field,e.getFieldType(t)==DataType.Integer||e.getFieldType(t)==DataType.Number?this.data=i.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator))):this.data=i.map((e=>e.dataScope.getFieldValue(t)))},t._map=function(){if(this.scale);else switch(this.datatable.getFieldType(this.field)){case DataType.Boolean:case DataType.Date:break;case DataType.String:default:this.scale=createScale("ordinal"),this.scale.domain=[...new Set(this.data)],this.scale._scale.range(this.scale.domain.map((t=>t+"")))}},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.text=i}},t.run(),t}class Encoding{constructor(t,e,i,r,s){this.items=t,this.anyItem=this.items[0],this.scene=e,this.channel=i,this.field=r,this.aggregator=s.aggregator,this.datatable=s.datatable,this.scale=s.scale,this.callback=s.callback,this.includeZero=s.includeZero,this.invertScale=s.invertScale,this.mapping=s.mapping,this.rangeExtent=s.rangeExtent,this.scheme=s.scheme,this.scaleType=s.scaleType,this.range=s.range,"angle"==this.channel&&(this.startAngle="startAngle"in s?s.startAngle:90,this.angleDirection="angleDirection"in s?s.angleDirection:"clockwise"),this._query=void 0,this._map=void 0,this._apply=void 0}toJSON(){let t={};return t.anyItem=this.anyItem.id,t.channel=this.channel,t.field=this.field,t.items=this.items.map((t=>t.id)),this.data&&(t.data=this.data),this._rectNegativeValues&&(t._rectNegativeValues=!0),t.args={},t.args.aggregator=this.aggregator,t.args.datatable=this.datatable.url,t.scale=this.scale.id,t.args.includeZero=this.includeZero,t.args.invertScale=this.invertScale,t.args.mapping=this.mapping,t.args.rangeExtent=this.rangeExtent,t.args.scheme=this.scheme,t.args.scaleType=this.scaleType,t.args.range=this.range,"angle"==this.channel&&(t.args.startAngle=this.startAngle,t.args.angleDirection=this.angleDirection),t}run(){this._query(),this._map(),this._apply()}getScaleRange(t){let e=t||this.anyItem;if(e.type!=ItemType.Area){if("x"==this.channel){let t=getClosestLayout(this.anyItem);if(t&&t.type==LayoutType.Grid){let i=t.cellBounds,r=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[i[r].left,i[r].left+this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}{let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}}if("y"==this.channel){let t=getClosestLayout(this.anyItem);if(t&&t.type==LayoutType.Grid){let i=t.cellBounds,r=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[i[r].bottom,i[r].bottom-this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}{let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}}if("width"==this.channel){let t=getPeers(e,this.scene),i=Math.min(...t.map((t=>t.bounds.left)));return[i,i+this.scale.rangeExtent]}if("height"==this.channel){let t=getPeers(e,this.scene),i=Math.max(...t.map((t=>t.bounds.bottom)));return[i,i-this.scale.rangeExtent]}if("radialDistance"==this.channel){let t=e.parent;return[t.x,t.x+this.scale.rangeExtent]}return this.scale.range}{let t,i=CheckAreaOrien(e),r=getClosestLayout(e);t=r?i==Orientation.Vertical?r.type==LayoutType.Stack?r._horzCellAlignment==Alignment.Left:r._cellHorzAlignment==Alignment.Left:r.type==LayoutType.Stack?r._vertCellAlignment==Alignment.Bottom:r._cellVertAlignment==Alignment.Bottom:i==Orientation.Vertical?e.baseline==Alignment.Left:e.baseline==Alignment.Bottom;let s=getCellBoundsInGridLayout(e);if(s)switch(this.channel){case"x":return[s.left,s.left+this.scale.rangeExtent];case"width":return t?[s.left,s.left+this.scale.rangeExtent]:[s.right,s.right-this.scale.rangeExtent];case"y":return[s.bottom,s.bottom-this.scale.rangeExtent];case"height":return t?[s.bottom,s.bottom-this.scale.rangeExtent]:[s.top,s.top+this.scale.rangeExtent]}if(i==Orientation.Horizontal)switch(this.channel){case"width":case"height":{let i=getPeers(e.firstVertex,this.scene),r=t?Math.max(...i.map((t=>t.y))):Math.min(...i.map((t=>t.y)));return t?[r,r-this.scale.rangeExtent]:[r+this.scale.rangeExtent,r]}case"x":case"y":{let t=getPeers(e.firstVertex,this.scene),i=Math.min(...t.map((t=>t.x)));return[i,i+this.scale.rangeExtent]}}else if(i==Orientation.Vertical)switch(this.channel){case"x":case"y":{let t=getPeers(e.firstVertex,this.scene),i=Math.max(...t.map((t=>t.y)));return[i,i-this.scale.rangeExtent]}case"height":case"width":{let i=getPeers(e.firstVertex,this.scene),r=t?Math.min(...i.map((t=>t.x))):Math.max(...i.map((t=>t.x)));return t?[r,r+this.scale.rangeExtent]:[r-this.scale.rangeExtent,r]}}}}}function bin(t,e,i){let r=e[0],s=t.nonNumericFields,n={};for(let e of t.data){let t=s.map((t=>String(e[t]))).join("_");n.hasOwnProperty(t)||(n[t]=s.map((t=>e[t])),n[t].push([])),n[t][n[t].length-1].push(e[r])}let a=[];for(let t in n){let e=n[t].pop(),i=d3__namespace.bin()(e);for(let e of i){let i={};n[t].forEach(((t,e)=>i[s[e]]=t)),i.x0=e.x0,i.x1=e.x1,i[r+"_count"]=e.length,a.push(i)}}let o={};s.forEach((e=>o[e]=t.getFieldType(e))),o.x0=DataType.Number,o.x1=DataType.Number,o[r+"_count"]=DataType.Number;let h=new DataTable(a,t.url,o);return h.sourceDataTable=t,h.transform={type:"bin",args:e},h}function kde(t,e,i){let r=e[0],s=t.nonNumericFields,n={};for(let e of t.data){let t=s.map((t=>String(e[t]))).join("_");t in n||(n[t]=s.map((t=>e[t])),n[t].push([])),n[t][n[t].length-1].push(e[r])}let a="min"in i?i.min:t.getFieldSummary(r).min,o="max"in i?i.max:t.getFieldSummary(r).max,h=a,l=[];for(;h<o;)l.push(h),h+=i.interval;l.push(h);let u=[];for(let t in n){let e=n[t].pop(),a=_kde(_epanechnikov(i.bandwidth),l,e);for(let e of a){let i={};n[t].forEach(((t,e)=>i[s[e]]=t)),i[r]=e[0],i[r+"_density"]=e[1],u.push(i)}}let c={};return s.forEach((e=>c[e]=t.getFieldType(e))),c[r]=DataType.Number,c[r+"_density"]=DataType.Number,new DataTable(u,t.url,c)}function _kde(t,e,i){return e.map((e=>[e,d3__namespace.mean(i,(i=>t(e-i)))]))}function _epanechnikov(t){return e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}function sort(t,e,i){t.data.sort(((t,i)=>compareRow(t,i,e))),t.summarize()}function compareRow(t,e,i,r){for(let r of i){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return 0}function filter(t,e){let i=[];for(let r of t.data){let t=!0;for(let i of e)if(!satisfy(r,i)){t=!1;break}t&&i.push(r)}let r=new DataTable(i,t.url);return r.sourceDataTable=t,r.transform={type:"filter",args:e},r}function satisfy(row,p){if(p.hasOwnProperty("field")){let t=p.field;if(p.hasOwnProperty("value"))return row[t]==p.value;if(p.hasOwnProperty("range"))return row[t]>=p.range[0]&&row[t]<=p.range[1];if(p.hasOwnProperty("values"))return p.values.indexOf(row[t])>=0}else if(p.hasOwnProperty("fields")){let f1=p.fields[0],f2=p.fields[1];return 1==eval(row[f1]+p.operator+row[f2])}}class DataTable{constructor(t,e,i){if(this.url=e,this.id=ItemType.DataTable+ItemCounter[ItemType.DataTable]++,this.data=t,this._fields=Object.keys(this.data[0]),this._newField=0,i)this._fieldTypes=i;else{this._fieldTypes={};for(let t of this._fields)this._fieldTypes[t]=_inferType(this.data.map((e=>e[t]))),"year"==t.toLowerCase()&&this._fieldTypes[t]==DataType.Integer&&(this._fieldTypes[t]=DataType.Date);_validate(this.data,this._fieldTypes)}this._fieldSummaries={};for(let t of this._fields)this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),this._fieldTypes[t]);this._addField(atlas_rowId,DataType.String,this.data.map(((t,e)=>"r"+e)))}get name(){return this.id}set sourceDataTable(t){this._sourceDataTable=t}get sourceDataTable(){return this._sourceDataTable}set transform(t){this._transform=t}get transform(){return this._transform}toJSON(){let t={};return t.data=this.data,t.fieldTypes=this._fieldTypes,t.url=this.url,t.id=this.id,t.sourceDataTable=this._sourceDataTable,t.transform=this._transform,t}transformField(t,e,i){let r=this.data.map((i=>e(i[t]))),s=_inferType(r),n=i||Date.now()+"_field"+this._newField++;return this._addField(n,s,r),n}setValueOrder(t,e){this._fieldSummaries[t].unique=e}_addField(t,e,i){this.data.forEach(((e,r)=>e[t]=i[r])),this._fieldTypes[t]=e,this._fields.push(t),this._fieldSummaries[t]=_summarize(i,e)}getFieldType(t){return this._fieldTypes[t]}get fields(){return this._fields}getFieldSummary(t){return this._fieldSummaries[t]}getFieldValues(t){return this.data.map((e=>e[t]))}getUniqueFieldValues(t){return this._fieldSummaries[t].unique}getRowCount(){return this.data.length}hasField(t){return this._fields.indexOf(t)>=0}parseFieldAsDate(t,e){let i=d3__namespace.timeParse(e);for(let e of this.data)null==e[t]||null==e[t]?e[t]=new Date(1899,11,31).getTime():e[t]=i(e[t]).getTime();this._fieldTypes[t]=DataType.Date,this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),DataType.Date)}static get RowID(){return atlas_rowId}get nonNumericFields(){let t=[];for(let e in this._fieldTypes)this._fieldTypes[e]!=DataType.Number&&this._fieldTypes[e]!=DataType.Integer&&e!=DataTable.RowID&&t.push(e);return t}transform(t,e,i){let r=i||{};switch(t){case"kde":return kde(this,e,r);case"bin":return bin(this,e);case"sort":return sort(this,e);case"filter":return filter(this,e)}}summarize(){for(let t of this._fields)this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),this._fieldTypes[t])}}function _summarize(t,e){var i={};switch(e){case DataType.Boolean:i.trueCount=t.filter((t=>t)).length,i.falseCount=t.filter((t=>!t)).length;break;case DataType.Date:i.min=d3__namespace.min(t),i.max=d3__namespace.max(t),i.extent=[i.min,i.max],i.unique=[...new Set(t)];break;case DataType.String:i.unique=[...new Set(t)];break;default:i.min=d3__namespace.min(t),i.max=d3__namespace.max(t),i.extent=[i.min,i.max],i.mean=d3__namespace.mean(t),i.median=d3__namespace.median(t),i.unique=[...new Set(t)]}return i}function _validate(t,e){for(let i of t)for(let t in e){let r,s=e[t],n=i[t];if(null==i[t]||null==i[t])switch(s){case DataType.Boolean:r=!1;break;case DataType.Date:r=new Date(1899,11,31).getTime();break;case DataType.String:r="";break;default:r=0}else switch(s){case DataType.Boolean:r=n;break;case DataType.Date:r=Number.isInteger(n)?new Date(n,0).getTime():new Date(n+"").getTime();break;case DataType.String:r=n.toString();break;default:r=n}i[t]=r}}var isValidType={boolean:function(t){return"true"===t||"false"===t||!0===t||!1===t||"[object Boolean]"==toString.call(t)},integer:function(t){return isValidType.number(t)&&(t=+t)==~~t},number:function(t){return!isNaN(+t)&&"[object Date]"!=toString.call(t)},date:function(t){return!isNaN(Date.parse(t))},string:function(t){return!0}};function _inferType(t){var e=Object.values(DataType);for(let i=0;i<t.length;i++){let r=t[i];if(null!=r){for(let t=0;t<e.length;t++)isValidType[e[t]](r)||(e.splice(t,1),t-=1);if(1==e.length)return e[0]}}return e[0]}class PointText extends Mark{constructor(t){super(t),this.type=ItemType.PointText,this.attrs.x=0,this.attrs.y=0,"fontSize"in this.styles||(this.styles.fontSize="12px"),"fontFamily"in this.styles||(this.styles.fontFamily="arial"),"fontWeight"in this.styles||(this.styles.fontWeight="regular"),"fillColor"in this.styles||(this.styles.fillColor="black"),void 0!==t&&("x"in t&&(this.attrs.x=t.x),"y"in t&&(this.attrs.y=t.y),this.attrs.text="text"in t?t.text:"",this.attrs.anchor="anchor"in t?t.anchor:["center","middle"]),this._updateBounds()}copyPropertiesTo(t){t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this.attrs.x,t.y=this.attrs.y,t.text=this.text,t.anchor=[this.anchor[0],this.anchor[1]]}get bounds(){return this._bounds||this._updateBounds(),this._bounds}set text(t){this.attrs.text=t,this._updateBounds()}get text(){return this.attrs.text}translate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){let t,e,i=getTextWidth(this.attrs.text,[this.fontWeight,this.fontSize,this.fontFamily].join(" ")),r=parseFloat(this.fontSize);switch(this.attrs.anchor[0]){case"left":t=this.attrs.x;break;case"right":t=this.attrs.x-i;break;case"center":t=this.attrs.x-i/2;break;default:t=this.attrs.x}switch(this.attrs.anchor[1]){case"top":e=this.attrs.y;break;case"bottom":e=this.attrs.y-r;break;case"middle":e=this.attrs.y-r/2}this._bounds=new Rectangle$1(t,e,i,r)}get center(){return{x:this.bounds.left+this.bounds.width/2,y:this.bounds.top+this.bounds.height/2}}get x(){return this.attrs.x}set x(t){this.attrs.x=t,this._updateBounds()}get y(){return this.attrs.y}set y(t){this.attrs.y=t,this._updateBounds()}get anchor(){return this.attrs.anchor}set anchor(t){this.attrs.anchor=t,this._updateBounds()}get fontSize(){return this.styles.fontSize}set fontSize(t){this.styles.fontSize=t,this._updateBounds()}get fontWeight(){return this.styles.fontWeight}set fontWeight(t){this.styles.fontWeight=t,this._updateBounds()}get fontFamily(){return this.styles.fontFamily}set fontFamily(t){this.styles.fontFamily=t,this._updateBounds()}}class Axis extends Group{constructor(t){super(),this.type=ItemType.Axis,this.id=this.type+ItemCounter[this.type]++,this._orientation="orientation"in t?t.orientation:"",this._strokeColor="strokeColor"in t?t.strokeColor:"#555",this._textColor="textColor"in t?t.textColor:"#555",this._tickOffset="tickOffset"in t?t.tickOffset:0,this._tickSize="tickSize"in t?t.tickSize:5,this._tickAnchor=t.tickAnchor?t.tickAnchor:"middle",this._tickVisible=!("tickVisible"in t)||t.tickVisible,this._pathVisible=!("pathVisible"in t)||t.pathVisible,this._labelOffset="labelOffset"in t?t.labelOffset:15,this._labelFormat="labelFormat"in t?t.labelFormat:"",this._titleOffset="titleOffset"in t?t.titleOffset:40,"titleAnchor"in t?this._titleAnchor=t.titleAnchor:"x"==this.channel||"width"==this.channel?this._titleAnchor="top"==this._orientation?["center","bottom"]:["center","top"]:this._titleAnchor="left"==this._orientation?["right","middle"]:["left","middle"],this._rotateYTitle=!("rotateTitle"in t&&!t.rotateTitle),this._titlePosition=t.titlePosition,"labelRotation"in t&&(this._labelRotation=t.labelRotation),this._flip="flip"in t&&t.flip}toJSON(){let t=super.toJSON();return t.field=this._field,t.channel=this._channel,"args"in t||(t.args={}),t.args.orientation=this._orientation,t.args.strokeColor=this._strokeColor,t.args.textColor=this._textColor,t.args.tickOffset=this._tickOffset,t.args.tickSize=this._tickSize,t.args.tickAnchor=this._tickAnchor,t.args.tickVisible=this._tickVisible,t.args.pathVisible=this._pathVisible,t.args.labelOffset=this._labelOffset,t.args.labelFormat=this._labelFormat,this._labelRotation&&(t.args.labelRotation=this._labelRotation),t.args.showTitle=this._showTitle,t.args.titleAnchor=this._titleAnchor,t.args.titleOffset=this._titleOffset,t.args.titlePosition=this._titlePosition,t.args.rotateTitle=this._rotateYTitle,t.args.flip=this._flip,t}get field(){return this._field}get orientation(){return this._orientation}set orientation(t){this._orientation=t}get x(){return"y"==this.channel?this._position:void 0}set x(t){"y"==this.channel&&(this._position=t)}get y(){return"x"==this.channel?this._position:void 0}set y(t){"x"==this.channel&&(this._position=t)}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get textColor(){return this._textColor}set textColor(t){this._textColor=t}get tickOffset(){return this._tickOffset}set tickOffset(t){this._tickOffset=t}get titleOffset(){return this._titleOffset}set titleOffset(t){this._titleOffset=t}get tickSize(){return this._tickSize}set tickSize(t){this._tickSize=t}set tickValues(t){this._tickValues=t,this._generateTicks(),this._positionTicks()}get tickValues(){return this._tickValues}set labelValues(t){this._labelValues=t,this._generateLabels(),this._positionLabels()}get labelValues(){return this._labelValues}get tickAnchor(){return this._tickAnchor}set tickAnchor(t){this._tickAnchor=t}get tickVisible(){return this._tickVisible}set tickVisible(t){this._tickVisible=t}get pathVisible(){return this._pathVisible}set pathVisible(t){this._pathVisible=t}get labelOffset(){return this._labelOffset}set labelOffset(t){this._labelOffset=t}get labelFormat(){return this._labelFormat}set labelFormat(t){this._labelFormat=t}get labelRotation(){return this._labelRotation}set labelRotation(t){this._labelRotation=t}get showTitle(){return this._showTitle}set showTitle(t){this._showTitle=t}get titleAnchor(){return this._titleAnchor}set titleAnchor(t){this._titleAnchor=t}get titlePosition(){return this._titlePosition}set titlePosition(t){this._titlePosition=t}get rotateTitle(){return this._rotateYTitle}set rotateTitle(t){this._rotateYTitle=t}get title(){return this._titleText}set title(t){this._titleText=t}_generatePath(){}_generateTicks(){}_generateLables(){}_generateTitle(){this._title=new PointText({text:this._titleText,fillColor:this._textColor,fontWeight:"bold"}),this._title.id=this.id+"-title",this.addChild(this._title)}_positionPath(){}_positionTicks(){}_positionLabels(){}_positionTitle(){}reposition(){this._positionPath(),this._positionTicks(),this._positionLabels(),this._showTitle&&this._positionTitle(),this._updateBounds()}}class EncodingAxis extends Axis{constructor(t,e,i){super(i),this.encoding=t,this._field=this.encoding.field,this._channel=this.encoding.channel,this._position="x"==this._channel||"width"==this._channel?i.y:i.x,this._titleText="title"in i?i.title:this.encoding.field,this._item=e,this._ticks=new Group,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Group,this._labels.id=this.id+"labels",this.addChild(this._labels),"radialDistance"==this._channel&&(this._position=this._item.parent.y,"rotation"in i&&(this._rotate=[-i.rotation,this.encoding.x,this.encoding.y])),this._showTitle=!("showTitle"in i)||i.showTitle,this._generatePath(),this._positionPath(),this._showTitle&&(this._generateTitle(),this._positionTitle())}_updateBounds(){this._bounds=this._ticks.bounds,this._bounds=this._bounds.union(this._path.bounds),this._bounds=this._bounds.union(this._labels.bounds),this._title&&(this._bounds=this._bounds.union(this._title.bounds))}toJSON(){let t=super.toJSON();return t.item=this._item.id,this._rotate&&(t.args.rotation=this._rotate[0]),"x"==this._channel||"width"==this._channel?t.args.y=this._position:t.args.x=this._position,t}get ticks(){return this._ticks}get labels(){return this._labels}get path(){return this._path}_generatePath(){this._path=new Path({strokeColor:this._strokeColor}),this._pathVisible||(this._path.visibility="hidden"),this._path.type=ItemType.Line,this._path.id=this.id+"path",this.addChild(this._path)}_generateTicks(){this._ticks.removeAll();for(let t=0;t<this._tickValues.length;t++){let e=new Path({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=ItemType.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this.encoding.datatable.getFieldType(this.encoding.field)){case DataType.Date:t=d3__namespace.timeFormat(this._labelFormat);break;case DataType.String:t=function(t){return t};break;default:t=d3__namespace.format(this._labelFormat)}for(let[e,i]of this._labelValues.entries()){let r=new PointText({text:t(i),fillColor:this._textColor});r.id=this.id+"label"+e,this._labels.addChild(r)}}_positionPath(){this._range=this.encoding.getScaleRange(this._item),void 0===this._position&&this._computePosition();let t=[];if("x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].x));t.push([Math.min(...e.concat(this._range)),this._position]),t.push([Math.max(...e.concat(this._range)),this._position])}else if("y"==this._channel||"height"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].y));t.push([this._position,Math.min(...e.concat(this._range))]),t.push([this._position,Math.max(...e.concat(this._range))])}this._path._setVertices(t),this._path._updateBounds(),this._showTitle&&this._title&&this._positionTitle(),this._updateBounds()}_positionLabels(){if(void 0===this._position&&this._computePosition(),"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize,e="bottom"==this._orientation?["center","top"]:["center","bottom"];if("area"==this._item.type&&"width"==this._channel){let t=getClosestLayout(this._item);if(t){let e=t.type==LayoutType.Stack?t._horzCellAlignment==Alignment.Left:t._cellHorzAlignment==Alignment.Left;this._flip=!e}else{let t=this._item.baseline==Alignment.Left||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[i,r]of this._labels.children.entries())r.x=this._range[1]-this.encoding.scale.map(this._labelValues[i]),r.y=this._position+t,r.anchor=e,this._labelRotation&&(r._rotate=[this._labelRotation,r.x,r.y],r.anchor=["right",e[1]]);else if(this.encoding.invertScale)for(let[i,r]of this._labels.children.entries())r.x=this._range[0]+this.encoding.scale.map(this._labelValues[i]),r.y=this._position+t,r.anchor=e,this._labelRotation&&(r._rotate=[this._labelRotation,r.x,r.y],r.anchor=["right",e[1]]);else for(let[i,r]of this._labels.children.entries())r.x=this._range[0]+this.encoding.scale.map(this._labelValues[i])-this.encoding.scale.range[0],r.y=this._position+t,r.anchor=e,this._labelRotation&&(r._rotate=[this._labelRotation,r.x,r.y],r.anchor=["right",e[1]])}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize,e="left"==this._orientation?["right","middle"]:["left","middle"];if("area"==this._item.type&&"height"==this._channel){let t=getClosestLayout(this._item);if("height"==this._channel&&t){let e=t.type==LayoutType.Stack?t._vertCellAlignment==Alignment.Bottom:t._cellVertAlignment==Alignment.Bottom;this._flip=!e}else{let t=this._item.baseline==Alignment.Bottom||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[i,r]of this._labels.children.entries())r.x=this._position+t,r.y=this._range[1]+this.encoding.scale.map(this._labelValues[i]),r.anchor=e;else if(this.encoding.invertScale)for(let[i,r]of this._labels.children.entries())r.x=this._position+t,r.y=this._range[1]-this.encoding.scale.map(this._labelValues[i])+this.encoding.scale.range[0],r.anchor=e;else for(let[i,r]of this._labels.children.entries())r.x=this._position+t,r.y=this._range[0]-this.encoding.scale.map(this._labelValues[i])+this.encoding.scale.range[0],r.anchor=e}this._labels._updateBounds(),this._updateBounds()}_computePosition(){let t;this._item.type==ItemType.Area&&(t=getCellBoundsInGridLayout(this._item)),void 0===t&&(t=getTopLevelGroup(this._item).bounds),"x"==this._channel||"width"==this._channel?this._position="top"==this._orientation?t.top-this._tickSize:t.bottom+this._tickSize:"y"!=this._channel&&"height"!=this._channel||(this._position="left"==this._orientation?t.left-this._tickSize:t.right+this._tickSize)}_positionTicks(){if(void 0===this._position&&this._computePosition(),this._range=this.encoding.getScaleRange(this._item),"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize;if("area"==this._item.type&&"width"==this._channel){let t=getClosestLayout(this._item);if(t){let e=t.type==LayoutType.Stack?t._horzCellAlignment==Alignment.Left:t._cellHorzAlignment==Alignment.Left;this._flip=!e}else{let t=this._item.baseline==Alignment.Left||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position+t]]),i._updateBounds();else if(this.encoding.invertScale)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position+t]]),i._updateBounds();else for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position+t]]),i._updateBounds()}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize;if("area"==this._item.type&&"height"==this._channel){let t=getClosestLayout(this._item);if("height"==this._channel&&t){let e=t.type==LayoutType.Stack?t._vertCellAlignment==Alignment.Bottom:t._cellVertAlignment==Alignment.Bottom;this._flip=!e}else{let t=this._item.baseline==Alignment.Bottom||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._position+t,this._range[1]+this.encoding.scale.map(this._tickValues[e])],[this._position,this._range[1]+this.encoding.scale.map(this._tickValues[e])]]),i._updateBounds();else if(this.encoding.invertScale)for(let[e,i]of this._ticks.children.entries()){let r=this._range[1]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0];i._setVertices([[this._position+t,r],[this._position,r]]),i._updateBounds()}else for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._position+t,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]],[this._position,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]]]),i._updateBounds()}this._positionPath(),this._ticks._updateBounds(),this._updateBounds()}_positionTitle(){let t=this._path.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel||"width"==this._channel?(this._title.x=t.x,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])),this._title._updateBounds(),this._updateBounds()}}class LayoutAxis extends Axis{constructor(t,e,i,r,s){super(s),this._channel=i,this._position="x"==this._channel||"width"==this._channel?s.y:s.x,this._item=t[0],this._items=t,this._layout=e,this._field=r,this._titleText="title"in s?s.title:this._field,this._showTitle="showTitle"in s&&s.showTitle,"labelRotation"in s&&(this._labelRotation=s.labelRotation),this._ticks=new Group,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Group,this._labels.id=this.id+"labels",this.addChild(this._labels),this._rules=new Group,this._rules.id=this.id+"paths",this.addChild(this._rules),this._generatePath(),this._generateTicks(),this._generateLabels(),this._positionPath(),this._positionTicks(),this._positionLabels(),this._showTitle&&(this._generateTitle(),this._positionTitle())}toJSON(){let t=super.toJSON();return t.item=this._item.id,"x"==this._channel||"width"==this._channel?t.args.y=this._position:t.args.x=this._position,this.classId&&(t.classId=this.classId),t}_updateBounds(){this._bounds=this._rules.bounds,this._bounds=this._bounds.union(this._ticks.bounds),this._bounds=this._bounds.union(this._labels.bounds),this._showTitle&&(this._bounds=this._bounds.union(this._title.bounds))}_generatePath(){if(this._rules.removeAll(),this._layout.type==LayoutType.Grid){let t="x"==this._channel?this._layout.numRows:this._layout.numCols;for(let e=0;e<t;e++){let t=new Path({strokeColor:this._strokeColor});this._pathVisible||(t.visibility="hidden"),t.type=ItemType.Line,t.id=this.id+"rule"+e,this._rules.addChild(t)}}}_generateTicks(){this._ticks.removeAll();for(let t=0;t<this._layout.group.children.length;t++){let e=new Path({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=ItemType.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this._item.dataScope.getFieldType(this._field)){case DataType.Date:t=d3__namespace.timeFormat(this._labelFormat);break;case DataType.String:t=function(t){return t};break;default:t=d3__namespace.format(this._labelFormat)}let e=this._layout.cellBounds;for(let i=0;i<e.length;i++){let e=new PointText({fillColor:this._textColor,text:t(this._items[i].dataScope.getFieldValue(this._field))});e.id=this.id+"label"+i,this._labels.addChild(e)}}_positionPath(){if(this._layout.type==LayoutType.Grid){let t=this._layout.cellBounds,e="x"==this._channel?this._layout.numRows:this._layout.numCols;if("x"==this._channel){let i=t[0].left,r=this._layout.numCols;for(let s=0;s<e;s++)this._rules.children[s]._setVertices([[i,this._position?this._position:t[s*r][this._orientation]],[i+t[0].width*r+this._layout.hGap*(r-1),this._position?this._position:t[s*r][this._orientation]]])}else{let i=t[0].top,r=this._layout.numRows;for(let s=0;s<e;s++)this._rules.children[s]._setVertices([[this._position?this._position:t[s*r][this._orientation],i],[this._position?this._position:t[s*r][this._orientation],i+t[0].height*r+this._layout.vGap*(r-1)]])}}this._rules._updateBounds(),this._updateBounds()}_positionTicks(){let t=this._layout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?1:-1;for(let[i,r]of this._ticks.children.entries()){let s=this._position?this._position+this._tickOffset*e:t[i][this._orientation]+this._tickOffset*e;r._setVertices([[t[i].x,s],[t[i].x,s+e*this._tickSize]]),r._updateBounds()}}else if("y"==this._channel){let e="left"==this._orientation?-1:1;for(let[i,r]of this._ticks.children.entries()){let s=this._position?this._position+this._tickOffset*e:t[i][this._orientation]+this._tickOffset*e,n="middle"==this._tickAnchor?t[i].y:t[i][this._tickAnchor];r._setVertices([[s,n],[s+e*this._tickSize,n]]),r._updateBounds()}}this._ticks._updateBounds(),this._updateBounds()}_positionLabels(){let t=this._layout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?["center","top"]:["center","bottom"],i="bottom"==this._orientation?this._labelOffset:-this._labelOffset;for(let[r,s]of this._labels.children.entries())s.x=t[r].x,s.y=this._position?this._position+i:t[r][this._orientation]+i,s.anchor=e,this._labelRotation&&(s._rotate=[this._labelRotation,s.x,s.y],s.anchor=["right",e[1]])}else if("y"==this._channel){let e="left"==this._orientation?["right","middle"]:["left","middle"],i="left"==this._orientation?-this._labelOffset:this._labelOffset;for(let[r,s]of this._labels.children.entries())s.x=this._position?this._position+i:t[r][this._orientation]+i,s.y="middle"==this._tickAnchor?t[r].y:t[r][this._tickAnchor],s.anchor=e,this._labelRotation&&(s._rotate=[this._labelRotation,s.x,s.y])}this._labels._updateBounds(),this._updateBounds()}_positionTitle(){let t=this._rules.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel?(this._title.x=t.x,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])),this._title._updateBounds(),this._updateBounds()}}class Legend extends Group{constructor(t,e){super(),this.type=ItemType.Legend,this.id=this.type+ItemCounter[this.type]++,this.encoding=t,this._textColor=e.hasOwnProperty("textColor")?e.textColor:"#555",this._strokeColor=e.hasOwnProperty("strokeColor")?e.strokeColor:"#555",this._x=e.hasOwnProperty("x")?e.x:0,this._y=e.hasOwnProperty("y")?e.y:0,this._orientation=e.hasOwnProperty("orientation")?e.orientation:Orientation.Vertical,this._initialize()}toJSON(){let t=super.toJSON();return"args"in t||(t.args={}),t.args.textColor=this._textColor,t.channel=this.encoding.channel,t.field=this.encoding.field,t.args.strokeColor=this._strokeColor,t.args.x=this._x,t.args.y=this._y,t.args.orientation=this._orientation,t}_initialize(){let t=this.encoding.scene,e=this.encoding.field;switch(this.encoding.datatable.getFieldType(e)){case DataType.String:this._createCategoricalColorLegend(t,e);break;case DataType.Number:case DataType.Integer:this._createNumericalColorLegend(t,e)}}_createNumericalColorLegend(t,e){let i,r;this._orientation==Orientation.Vertical?(i=15,r=300):(i=300,r=15);let s=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+i/2,y:this._y,anchor:["center","middle"]});this.addChild(s);let n,a=t.mark("rect",{top:this._y+20,left:this._x,width:i,height:r,strokeWidth:0,opacity:this.encoding.anyItem.opacity}),o=[Math.min(...this.encoding.data),Math.max(...this.encoding.data)],h=this.encoding.mapping,l=[],u=[];if(h){let e=Object.keys(h).map((t=>parseFloat(t))).sort(((t,e)=>t-e));this._orientation==Orientation.Vertical?(n=new LinearGradient({x1:0,y1:100,x2:0,y2:0}),e.forEach((e=>{let s=(e-o[0])/(o[1]-o[0]);n.addStop(100*s,h[e],1);let a=t.mark("line",{x1:this._x-5,x2:this._x+i+5,y1:this._y+20+r-s*r,y2:this._y+20+r-s*r,strokeColor:this._strokeColor});u.push(a);let c=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+i+5+5,y:this._y+20+r-s*r,anchor:["left","middle"]});l.push(c)}))):(n=new LinearGradient({x1:0,y1:0,x2:100,y2:0}),e.forEach((e=>{let s=(e-o[0])/(o[1]-o[0]);n.addStop(100*s,h[e],1);let a=t.mark("line",{x1:this._x+s*i,x2:this._x+s*i,y1:this._y+20-5,y2:this._y+20+r+5,strokeColor:this._strokeColor});u.push(a);let c=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+s*i,y:this._y+r+5+20,anchor:["center","top"]});l.push(c)})))}else{let e=this.encoding.scale.domain,s=[];for(let t=0;t<11;t++)s.push(e[0]+(e[1]-e[0])*t/10);this._orientation==Orientation.Vertical?(n=new LinearGradient({x1:0,y1:100,x2:0,y2:0}),s.forEach((s=>{let a=(s-e[0])/(e[1]-e[0]);n.addStop(100*a,this.encoding.scale.map(s),1);let o=t.mark("line",{x1:this._x-5,x2:this._x+i+5,y1:this._y+20+r-a*r,y2:this._y+20+r-a*r,strokeColor:this._strokeColor});u.push(o);let h=t.mark("text",{fillColor:this._textColor,text:s,x:this._x+i+5+5,y:this._y+20+r-a*r,anchor:["left","middle"]});l.push(h)}))):(n=new LinearGradient({x1:0,y1:0,x2:100,y2:0}),s.forEach((s=>{let a=(s-e[0])/(e[1]-e[0]);n.addStop(100*a,this.encoding.scale.map(s),1);let o=t.mark("line",{x1:this._x+a*i,x2:this._x+a*i,y1:this._y+20-5,y2:this._y+20+r+5,strokeColor:this._strokeColor});u.push(o);let h=t.mark("text",{fillColor:this._textColor,text:s,x:this._x+a*i,y:this._y+r+5+20,anchor:["center","top"]});l.push(h)})))}a.styles.fillColor=n,this.addChild(a);for(let t of l)this.addChild(t);for(let t of u)this.addChild(t)}_createCategoricalColorLegend(t,e){this.addChild(new PointText({fillColor:this._textColor,text:e,x:this._x,y:this._y,anchor:["left","top"]}));let i=t.mark("rect",{top:this._y+25,left:this._x,width:10,height:10,strokeWidth:0,opacity:this.encoding.anyItem.opacity}),r=t.mark("text",{fillColor:this._textColor,x:this._x+20,y:this._y+23,anchor:["left","top"]}),s=t.glyph(i,r),n=this.encoding.scale,a=new DataTable(n.domain.map((t=>({category:t,value:n.map(t)})))),o=t.repeat(s,a);o.layout=layout("grid",{numCols:1,vGap:8}),t.encode(r,{channel:"text",field:"category",_remember:!1}),t.encode(i,{channel:"fillColor",field:"value",_remember:!1}),this.addChild(o)}}class Glyph extends Group{constructor(t){if(super(),this.type=ItemType.Glyph,this.id=this.type+ItemCounter[this.type]++,t)for(let e of t)this.addChild(e)}duplicate(){let t=this.getScene().glyph();for(let e of this.children)t.addChild(e.duplicate());return t.classId=this.classId,this._dataScope&&(t.dataScope=this._dataScope.clone()),t}}class PiePath extends Path{constructor(t){super(t),this.radius="radius"in t?t.radius:100,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this.startAngleDeg="startAngle"in t?t.startAngle%360:0,this.endAngleDeg="endAngle"in t?t.endAngle%360:90,this.totalAng=this.endAngleDeg<this.startAngleDeg?this.endAngleDeg+360-this.startAngleDeg:this.endAngleDeg-this.startAngleDeg,this.startAngleRad=this.startAngleDeg*(Math.PI/180),this.endAngleRad=this.endAngleDeg*(Math.PI/180),this.type=ItemType.Pie,this.closed=!0;let e=[this._x,this._y],i=[this._x+this.radius*Math.cos(this.startAngleRad),this._y-this.radius*Math.sin(this.startAngleRad)],r=[this._x+this.radius*Math.cos(this.endAngleRad),this._y-this.radius*Math.sin(this.endAngleRad)];this._setVertices(new Array(e,i,r))}get x(){return this._x}get y(){return this._y}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}get quadrants(){let t=[];return this.startAngleDeg>=0&&this.startAngleDeg<90?t[0]=1:this.startAngleDeg>=90&&this.startAngleDeg<180?t[0]=2:this.startAngleDeg>=180&&this.startAngleDeg<270?t[0]=3:this.startAngleDeg>=270&&this.startAngleDeg<=360&&(t[0]=4),this.endAngleDeg>=0&&this.endAngleDeg<90?t[1]=1:this.endAngleDeg>=90&&this.endAngleDeg<180?t[1]=2:this.endAngleDeg>=180&&this.endAngleDeg<270?t[1]=3:this.endAngleDeg>=270&&this.endAngleDeg<360&&(t[1]=4),t}getSVGPathData(){let[[t,e],[i,r],[s,n]]=this.vertices.map((t=>[t.x,t.y])),a=this.radius;return`M ${t} ${e} L ${i} ${r} A ${a} ${a} ${this.totalAng} ${this.totalAng>180?1:0} 0 ${s} ${n} Z`}adjustAngle(t,e){this.startAngleDeg=t%360,this.endAngleDeg=e%360,this.startAngleRad=this.startAngleDeg*(Math.PI/180),this.endAngleRad=this.endAngleDeg*(Math.PI/180),this.totalAng=this.endAngleDeg-this.startAngleDeg,this.vertices[1].x=this.x+this.radius*Math.cos(this.startAngleRad),this.vertices[1].y=this.y-this.radius*Math.sin(this.startAngleRad),this.vertices[2].x=this.x+this.radius*Math.cos(this.endAngleRad),this.vertices[2].y=this.y-this.radius*Math.sin(this.endAngleRad)}_updateBounds(){const[t,e]=this.quadrants,i=this.vertices[1],r=this.vertices[2];let s=this.vertices[0],n=s.y,a=s.x,o=s.x,h=s.y;1===t?(i.x>a&&(a=i.x),i.y<n&&(n=i.y)):2===t?(i.x>a&&(a=i.x),i.y>h&&(h=i.y)):3===t?(i.x<o&&(o=i.x),i.y>h&&(h=i.y)):(i.x<o&&(o=i.x),i.y<n&&(n=i.y)),1===e?(r.x>a&&(a=r.x),r.y<n&&(n=r.y)):2===e?(r.x>a&&(a=r.x),r.y>h&&(h=r.y)):3===e?(r.x<o&&(o=r.x),r.y>h&&(h=r.y)):(r.x<o&&(o=r.x),r.y<n&&(n=r.y)),s.y-this.radius<n&&(n=s.y-this.radius),s.y+this.radius>h&&(h=s.y+this.radius),s.x+this.radius>a&&(a=s.x+this.radius),s.x-this.radius<o&&(o=s.x-this.radius),this._bounds=new Rectangle$1(o,n,a-o,h-n)}}class AreaPath extends Path{constructor(t){super(t),this.type=ItemType.Area,this.closed=!0,t&&"vertices"in t&&this.segments.push(new Segment(this.vertices[this.vertices.length-1],this.vertices[0],this,this.segmentCounter++))}get orientation(){return this._orientation}get firstVertexPair(){return[this.vertices[0],this.vertices[this.vertices.length-1]]}get width(){return this.vertices[this.vertices.length/2].x-this.vertices[0].x}get height(){return this.vertices[this.vertices.length/2].y-this.vertices[0].y}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}resizeArea(t,e){let i=this.vertices[this.vertices.length/2].x,r=this.vertices[this.vertices.length/2].y,s=this.width,n=this.height;for(let a of this.vertices)a.x=i+t/s*(a.x-i),a.y=r+e/n*(a.y-r);this._updateBounds()}getSVGPathData(){return super.getSVGPathData()+" z"}}class RingPath extends Path{constructor(t){super(t),this.type=ItemType.Ring,this.closed=!0,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._innerRadius=t.hasOwnProperty("innerRadius")?t.innerRadius:100,this._outerRadius=t.hasOwnProperty("outerRadius")?t.outerRadius:200}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t,this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new Point(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}translate(t,e){this._x+=t,this._y+=e,this._updateBounds()}_updateBounds(){this._bounds=new Rectangle$1(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius}getSVGPathData(){return["M "+this._x+" "+this._y,"m 0, -"+this._outerRadius,"a "+this._outerRadius+","+this._outerRadius+", 0, 1, 0, 1, 0","Z","m 0 "+(this._outerRadius-this._innerRadius),"a "+this._innerRadius+", "+this._innerRadius+", 0, 1, 1, -1, 0","Z"].join(" ")}}class PolygonPath extends Path{constructor(t){super(t),this.type=ItemType.Polygon,this.closed=!0,t.hasOwnProperty("x")&&(this._x=t.x),t.hasOwnProperty("y")&&(this._y=t.y),t.hasOwnProperty("radius")&&(this._radius=t.radius)}get radius(){return this._radius}get x(){return this._x}get y(){return this._y}get center(){return new Point(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}set radius(t){this._radius=t,this._updateBounds()}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._radius=this._radius}translate(t,e){this._x+=t,this._y+=e,super.translate(t,e)}}class AlignConstraint{constructor(t,e){this.direction=e,this.items=t,this.type=ConstraintType.Align,this.id=this.type+"_"+[...new Set(this.items.map((t=>t.classId)))].join("_")}apply(){let t,e=this.direction;this.direction==Alignment.Top||this.direction==Alignment.Left?t=Math.min(...this.items.map((t=>t.bounds[e]))):this.direction!=Alignment.Bottom&&this.direction!=Alignment.Right||(t=Math.max(...this.items.map((t=>t.bounds[e]))));let i=this.items.map((i=>t-i.bounds[e])),r=e==Alignment.TOP||e==Alignment.Middle||e==Alignment.Bottom?"y":"x";this.items.forEach(((t,e)=>{if(t.parent&&t.parent.layout&&t.parent.layout.type==LayoutType.Stack){let s="x"==r?i[e]:0,n="y"==r?i[e]:0;t.parent.translate(s,n)}else{let s="x"==r?i[e]:0,n="y"==r?i[e]:0;t.translate(s,n)}}))}toJSON(){let t={};return t.items=this.items.map((t=>t.id)),t.direction=this.direction,t.type=this.type,t.id=this.id,t}}class AffixConstraint{constructor(t,e,i,r,s,n,a){this.item=t,this.baseItem=e,this.scene=i,this.channel=r,this.itemAnchor=s,this.baseAnchor=n,this.offset=a,this.type=ConstraintType.Affix,this.id=this.type+"_"+this.item.classId+"_"+this.baseItem.classId+"_"+r}apply(){let t=getPeers(this.item,this.scene),e=getPeers(this.baseItem,this.scene),i=this.itemAnchor,r=this.baseAnchor,s=this.item.type==ItemType.PointText;if("radialDistance"==this.channel)for(let s=0;s<t.length;s++){let n,a=e[s],o=t[s];a.type!=ItemType.Arc&&a.type!=ItemType.Ring||(n="top"==r?a.outerRadius+this.offset:"bottom"==r?a.innerRadius+this.offset:(a.outerRadius+a.innerRadius)/2+this.offset),o.translate(a.x-o.x,a.y-n-o.bounds[i]),o._rotate?o._rotate=[o._rotate[0],a.x,a.y]:o._rotate=[0,a.x,a.y]}else if("angle"==this.channel)for(let s=0;s<t.length;s++){let n=e[s],a=t[s],o="left"==r?n.endAngle+this.offset:"center"==r?(n.endAngle+n.startAngle)/2+this.offset:n.startAngle+this.offset;a._rotate?a._rotate[0]=90-o:(a.translate(n.x-a.bounds[i],n.y-t[s].y),a._rotate=[90-o,e[s].x,e[s].y])}else{let n;if(this.baseItem.type==ItemType.Link)switch(r){case"left":case"top":n=0;break;case"center":case"middle":n=.5;break;case"right":case"bottom":n=1}for(let a=0;a<t.length;a++){let o=this.baseItem.type==ItemType.Link?e[a].getPointAt(n)[this.channel]:e[a].bounds[r]+this.offset;s?(t[a].anchor["x"==this.channel?0:1]=this.itemAnchor,t[a][this.channel]=o):"x"==this.channel?t[a].translate(o-t[a].bounds[i],0):t[a].translate(0,o-t[a].bounds[i])}}}toJSON(){let t={};return t.item=this.item.id,t.baseItem=this.baseItem.id,t.channel=this.channel,t.itemAnchor=this.itemAnchor,t.baseAnchor=this.baseAnchor,t.offset=this.offset,t.type="affixation",t.id=this.id,t}}class Gridlines extends Group{constructor(t,e,i){super(),this.type=ItemType.Gridlines,this.id=this.type+ItemCounter[this.type]++,this.encoding=t,this.channel=this.encoding.channel,this._item=e,this._strokeColor=i.hasOwnProperty("strokeColor")?i.strokeColor:"#ddd",this._strokeWidth=i.hasOwnProperty("strokeWidth")?i.strokeWidth:1,"radialDistance"==this.channel&&i.hasOwnProperty("angle")&&(this._rotate=[-i.angle,this.encoding.x,this.encoding.y])}toJSON(){let t=super.toJSON();return t.hasOwnProperty("args")||(t.args={}),t.args.strokeColor=this._strokeColor,t.args.strokeWidth=this._strokeWidth,t.channel=this.encoding.channel,t.field=this.encoding.field,this._rotate&&(t.args.angle=this._rotate[0]),t}get values(){return this._values}set values(t){this._values=t,this._updateLines(),this._updateLinePositions()}_updateLinePositions(){if("x"==this.channel||"width"==this.channel){let t=getTopLevelGroup(this._item).bounds,e=this.encoding.getScaleRange(this._item);for(let[i,r]of this.children.entries()){let s=e[0]+this.encoding.scale.map(this._values[i])-this.encoding.scale.range[0];r._setVertices([[s,t.top],[s,t.bottom]])}}else if("y"==this.channel||"height"==this.channel){let t=getTopLevelGroup(this._item).bounds,e=this.encoding.getScaleRange(this._item);if(this.encoding.invertScale)for(let[i,r]of this.children.entries()){let s=e[1]-this.encoding.scale.map(this._values[i])+this.encoding.scale.range[0];r._setVertices([[t.left,s],[t.right,s]])}else for(let[i,r]of this.children.entries()){let s=e[0]-this.encoding.scale.map(this._values[i])+this.encoding.scale.range[0];r._setVertices([[t.left,s],[t.right,s]])}}else if("radialDistance"==this.channel)for(let[t,e]of this.children.entries())e.x=this._item.parent.x,e.y=this._item.parent.y,e.radius=this.encoding.scale.map(this._values[t])}_updateLines(){if(this.children=[],"x"==this.channel||"y"==this.channel||"width"==this.channel||"height"==this.channel)for(let[t,e]of this._values.entries()){let e=new Path({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=ItemType.Line,e.id=this.id+"line"+t,this.addChild(e)}else if("radialDistance"==this.channel)for(let[t,e]of this._values.entries()){let e=new CirclePath({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=ItemType.Circle,e.id=this.id+"line"+t,this.addChild(e)}}}class Collection extends Group{constructor(){super(),this.type=ItemType.Collection,this.id=this.type+ItemCounter[this.type]++,this.classId=this.id}duplicate(){let t=this.getScene().collection();for(let e=0;e<this.children.length;e++){let i=this.children[e];t.addChild(i.duplicate())}if(t.classId=this.classId,t.parent=this.parent,this._layout){let e=this._layout.clone();t.layout=e}return t}}class ArcPath extends Path{constructor(t){super(t),this.type=ItemType.Arc,this.closed=!0,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._innerRadius=t.hasOwnProperty("innerRadius")?t.innerRadius:100,this._outerRadius=t.hasOwnProperty("outerRadius")?t.outerRadius:200,this._startAngle=t.hasOwnProperty("startAngle")?t.startAngle:0,this._endAngle=t.hasOwnProperty("endAngle")?t.endAngle:90,this._sr=degree2radian(this._startAngle),this._er=degree2radian(this._endAngle);let e=this._x+this._innerRadius*Math.cos(this._sr),i=this._y-this._innerRadius*Math.sin(this._sr),r=this._x+this._innerRadius*Math.cos(this._er),s=this._y-this._innerRadius*Math.sin(this._er),n=this._x+this._outerRadius*Math.cos(this._sr),a=this._y-this._outerRadius*Math.sin(this._sr),o=this._x+this._outerRadius*Math.cos(this._er),h=this._y-this._outerRadius*Math.sin(this._er);this._setVertices([[e,i],[n,a],[o,h],[r,s]])}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t,this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new Point(this._x,this._y)}set x(t){this._x=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this._updateBounds()}set y(t){this._y=t,this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}translate(t,e){this._x+=t,this._y+=e,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}_updateBounds(){this._bounds=new Rectangle$1(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius,t._startAngle=this._startAngle,t._endAngle=this._endAngle,t._sr=this._sr,t._er=this._er}getSVGPathData(){let t=this._endAngle<this._startAngle?this._endAngle+360-this._startAngle:this._endAngle-this._startAngle,e=t>180?1:0;return["M "+this.vertices[0].x+", "+this.vertices[0].y,"L "+this.vertices[1].x+", "+this.vertices[1].y,"A "+[this._outerRadius,this._outerRadius,t,e,0,this.vertices[2].x,this.vertices[2].y].join(" "),"L "+this.vertices[3].x+", "+this.vertices[3].y,"A "+[this._innerRadius,this._innerRadius,t,e,1,this.vertices[0].x,this.vertices[0].y].join(" ")].join(" ")}adjustAngle(t,e){this._startAngle=t,this._endAngle=e,this._sr=degree2radian(this._startAngle),this._er=degree2radian(this._endAngle),this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er)}}class Image$1 extends Mark{constructor(t){super(t),this.type=ItemType.Image,this._src=t.src,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._width=t.hasOwnProperty("width")?t.width:100,this._height=t.hasOwnProperty("height")?t.height:100}get src(){return this._src}set src(t){this._src=t}get width(){return this._width}set width(t){this._width=t,this._updateBounds()}get height(){return this._height}set height(t){this._height=t,this._updateBounds()}get x(){return this._x}set x(t){this._x=t,this._updateBounds()}get y(){return this._y}set y(t){this._y=t,this._updateBounds()}get bounds(){return this._bounds||this._updateBounds(),this._bounds}_updateBounds(){this._bounds=new Rectangle$1(this._x,this._y,this._width,this._height)}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this._x,t.y=this._y,t.width=this._width,t.height=this._height,t.src=this._src}translate(t,e){this._x+=t,this._y+=e,this._updateBounds()}}class Link extends Path{constructor(t){super(t),this.type=ItemType.Link,this.mode="mode"in t?t.mode:"linear",this.source=void 0,this.target=void 0,this.sourceAnchor="sourceAnchor"in t?t.sourceAnchor:["center","middle"],this.targetAnchor="targetAnchor"in t?t.targetAnchor:["center","middle"],this.sourceOffset="sourceOffset"in t?t.sourceOffset:[0,0],this.targetOffset="targetOffset"in t?t.targetOffset:[0,0]}radialvalue(t,e){let i=t-Math.PI/2;return[t=e*Math.cos(i),e*=Math.sin(t)]}bezierCurveHorizontal(t,e,i,r){return`M ${t} ${e} C ${(t+i)/2} ${e} ${t} ${r} ${i} ${r}`}bezierCurveVertical(t,e,i,r){return`M ${t} ${e} C ${t} ${(e+r)/2} ${i} ${e} ${i} ${r}`}bezierCurveRadial(t,e,i,r){let s=this.radialvalue(t,e),n=this.radialvalue(t,(e+r)/2),a=this.radialvalue(i,e),o=this.radialvalue(i,r);return`M ${s[0]} ${s[1]} C ${n[0]} ${n[1]} ${a[0]} ${a[1]} ${o[0]} ${o[1]}`}_updateBounds(){if(null!=this.source&&null!=this.target){let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],i=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],r=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];this._bounds=new Rectangle$1(Math.min(t,i),Math.min(e,r),Math.abs(t-i),Math.abs(e-r))}else this._bounds=new Rectangle$1(0,0,0,0)}getSVGPathData(){if(void 0===this.source||void 0===this.target)return"";let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],i=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],r=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];switch(this.mode){case"curveHorizontal":return this.bezierCurveHorizontal(t,e,i,r);case"curveVertical":return this.bezierCurveVertical(t,e,i,r);case"linear":default:return`M ${t} ${e} L ${i} ${r}`}}copyPropertiesTo(t){super.copyPropertiesTo(t),t.sourceAnchor=this.sourceAnchor.slice(),t.targetAnchor=this.targetAnchor.slice(),t.sourceOffset=this.sourceOffset.slice(),t.targetOffset=this.targetOffset.slice(),t.mode=this.mode}getPointAt(t){const e=SVGProvider.getSVG();let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",this.getSVGPathData()),e.appendChild(i);let r=i.getTotalLength();return i.getPointAtLength(r*t)}}function bindToLink(t){return t._query=function(){let t=this.field,e=this.channel,i=this.items.map((t=>t.dataScope));if("source"==e||"target"==e){let e=i.map((e=>e.getFieldValue(t))),r=this.scene;this.data=e.map((t=>r.find([{field:nodeId,value:t}])[0]))}else if("strokeWidth"==e)if(this.datatable.hasField(t))this.data=i.map((e=>e.getFieldValue(t)));else if(t.startsWith("parent.")||t.startsWith("child.")){let e=this.datatable.tree.nodeTable,r=t.split(".")[0],s=t.split(".")[1],n=i.map((t=>t.getFieldValue(r)));this.data=n.map((t=>new DataScope(e).cross(nodeId,t).getFieldValue(s)))}},t._map=function(){let t,e=this.channel,i=this.items;if("strokeWidth"==e){let e,r;t=createScale(this.scaleType?this.scaleType:"linear"),t.domain=[0,Math.max(...this.data)],e=1,r=Math.max(...i.map((t=>parseFloat(t.styles.strokeWidth)))),r==e&&(r=e+5),this.rangeExtent&&(r=e+this.rangeExtent),this.range&&(e=this.range[0],r=this.range[1]),t._setRange([e,r]),this.scale||(this.scale=t),this.scale._addEncoding(this)}},t._apply=function(){let t=this.channel;if("source"==t||"target"==t)for(let t=0;t<this.data.length;t++)this.items[t][this.channel]=this.data[t],this.items[t]._updateBounds();else if("strokeWidth"==t)for(let t=0;t<this.data.length;t++)this.items[t].styles.strokeWidth=this.scale.map(this.data[t])},t.run(),t}class Scene extends Group{constructor(t){super(),t&&t.fillColor&&(this.fillColor=t.fillColor),this.type=ItemType.Scene,this.id=this.type+ItemCounter[this.type]++,this.encodings={},this.constraints={},this.itemMap={}}group(t){let e=new Group;if(e.classId=e.id,this.addChild(e),t&&t.length>0)for(let i of t)e.addChild(i);return this.itemMap[e.id]=e,e}mark(t,e){let i=void 0===e?{}:e,r=null;switch(t){case ItemType.Rect:{"top"in i||(i.top=0),"left"in i||(i.left=0),"width"in i||(i.width=100),"height"in i||(i.height=100);let t=i.top,e=i.left,s=i.width,n=i.height;i.vertices=[[e,t],[e+s,t],[e+s,t+n],[e,t+n]],delete i.top,delete i.left,delete i.width,delete i.height,r=new RectPath(i);break}case ItemType.Area:if(void 0!==i&&"x1"in i&&"y1"in i&&"x2"in i&&"y2"in i){let t=i.x1,e=i.y1,r=i.x2,s=i.y2;i.vertices=[[t,e],[r,e],[r,s],[t,s]],delete i.x1,delete i.y1,delete i.x2,delete i.y2}r=new AreaPath(i);break;case ItemType.Line:if(void 0!==i&&"x1"in i&&"y1"in i&&"x2"in i&&"y2"in i){let t=i.x1,e=i.y1,r=i.x2,s=i.y2;i.vertices=[[t,e],[r,s]],delete i.x1,delete i.y1,delete i.x2,delete i.y2}r=new Path(i),r.type=ItemType.Line;break;case ItemType.Path:r=new Path(i);break;case ItemType.Circle:r=new CirclePath(i);break;case ItemType.Ring:r=new RingPath(i);break;case ItemType.Arc:r=new ArcPath(i);break;case ItemType.Polygon:r=new PolygonPath(i);break;case ItemType.Pie:r=new PiePath(i);break;case"text":case ItemType.PointText:"anchor"in i||(i.anchor=["center","middle"]),r=new PointText(i);break;case ItemType.Image:r=new Image$1(i);break;case ItemType.Link:r=new Link(i)}return null!==r&&(r.id=r.type+ItemCounter[r.type]++,r.classId=r.id,this.addChild(r),this.itemMap[r.id]=r),r}glyph(...t){let e=new Glyph(t);return e.classId=e.id,this.addChild(e),this.itemMap[e.id]=e,e}collection(){let t=new Collection;return this.itemMap[t.id]=t,t}attach(t,e){t.dataScope=new DataScope(e)}repeat(t,e,i){if(!t||void 0===e)throw Errors.INCOMPLETE_REPEAT_INFO;let r=i||{},s=r.field?r.field:DataTable.RowID,n=r.callback;validateField(s,e);let a=repeatItem(this,t,s,e,n);return r.layout&&(a.layout=r.layout),a}densify(t,e,i){if(!t||void 0===e)throw Errors.INCOMPLETE_PARTITION_INFO;let r=i||{},s=r.orientation,n=r.field?r.field:DataTable.RowID,a="startAngle"in r?r.startAngle:90,o="direction"in r?r.direction:"clockwise",h=r.callback;return validateField(n,e),densifyItem(this,t,s,n,e,h,a,o)}divide(t,e,i){if(!t||null==e)throw Errors.INCOMPLETE_PARTITION_INFO;let r=i||{},s=r.orientation,n=r.field?r.field:DataTable.RowID,a=r.callback;validateField(n,e);let o=divideItem(this,t,s,n,e,a);return r.layout&&(o.layout=r.layout),o}_validateEncodeArgs(t,e){if(!t||!("channel"in e)||!("field"in e))throw Errors.INCOMPLETE_BINDING_INFO;let i=e.field;if("vertex"==t.type||"segment"==t.type){if(!t.parent.dataScope&&!t.dataScope)throw Errors.BIND_WITHOUT_DATASCOPE}else if(!t.dataScope)throw Errors.BIND_WITHOUT_DATASCOPE;validateField(i,e.table?e.table:t.dataScope?t.dataScope._dt:t.parent.dataScope._dt)}encode(t,e){let i;if(this._validateEncodeArgs(t,e),"vertex"==t.type&&t.parent.type==ItemType.Area){let e=getPeers(t.parent,this);i=[];let r=t.parent.vertices.indexOf(t)<t.parent.vertices.length/2;for(let t of e)i=r?i.concat(t.vertices.slice(0,t.vertices.length/2)):i.concat(t.vertices.slice(t.vertices.length/2))}else i=getPeers(t,this);return this._doEncode(i,e)}_doEncode(t,e){let i=t[0],r=e.channel,s=e.field;"datatable"in e||(e.datatable=i.dataScope?i.dataScope.dataTable:i.parent.dataScope.dataTable),"aggregator"in e||(e.aggregator="sum"),"invertScale"in e||(e.invertScale=!1),"includeZero"in e||(e.includeZero=!1);let n=new Encoding(t,this,r,s,e);switch(r){case"width":case"height":case"radius":case"outerRadius":case"innerRadius":case"area":case"fontSize":i.type==ItemType.Area?bindToArea(n):bindToSize(n);break;case"strokeWidth":i.type==ItemType.Link?bindToLink(n):bindToSize(n);break;case"x":case"y":i.type==ItemType.Area?bindToArea(n):bindToPosition(n);break;case"fillColor":case"strokeColor":bindToColor(n);break;case"angle":bindToAngle(n);break;case"text":bindToText(n);break;case"radialDistance":n.x=i.parent.x,n.y=i.parent.y,n.radius=i.parent.radius,bindToRadialDistance(n);break;case"source":case"target":bindToLink(n)}return"_remember"in e&&1!=e._remember||this._registerBinding(n),r.indexOf("Color")<0&&this._updateAncestorBounds(i,n.items),n}encodeWithinCollection(t,e){this._validateEncodeArgs(t,e);let i=getPeersGroupedByParent(t,this),r=[];for(let t of i){let i=this._doEncode(t,e);r.push(i)}return r}find(t){let e=[];for(let i of t)if("field"in i)"value"in i?e.push("d.dataScope && d.dataScope.getFieldValue('"+i.field+"') == '"+i.value+"'"):"range"in i?e.push("d.dataScope && d.dataScope.getFieldValue('"+i.field+"') >= "+i.range[0]+" && d.dataScope.getFieldValue('"+i.field+"') <= "+i.range[1]):"values"in i&&e.push("d.dataScope && ["+i.values.map((t=>"'"+t+"'")).join(",")+"].indexOf(d.dataScope.getFieldValue('"+i.field+"')) >= 0 ");else if("channel"in i)"value"in i?e.push("d."+i.channel+" == '"+i.value+"'"):"range"in i?e.push("d."+i.channel+" >= "+i.range[0]+" && d."+i.channel+" <= "+i.range[1]):"values"in i&&e.push("["+i.values.map((t=>"'"+t+"'")).join(",")+"].indexOf(d."+i.channel+") >= 0 ");else if("type"in i)e.push("d.type=='"+i.type+"'");else if("id"in i)e.push("d.id=='"+i.id+"'");else if("fields"in i){let t=i.fields[0],r=i.fields[1];e.push("d.dataScope && d.dataScope.getFieldValue('"+t+"')"+i.operator+"d.dataScope.getFieldValue('"+r+"')")}return findItems(this,new Function("d","return "+e.join(" && ")))}align(t,e){if(!canAlign(t,e,this))return!1;let i=new AlignConstraint(t,e);if(i.id in this.constraints)return console.warn("constraint has been added"),!1;this.constraints[i.id]=i,i.apply(),this._updateAncestorBounds(t[0])}affix(t,e,i,r){let s=r||{},n="offset"in s?s.offset:0,a="itemAnchor"in s?s.itemAnchor:"x"==i||"angle"==i?"center":"middle",o="baseAnchor"in s?s.baseAnchor:"x"==i||"angle"==i?"center":"middle",h=new AffixConstraint(t,e,this,i,a,o,n);h.id,this.constraints,this.constraints[h.id]=h,h.apply()}axis(t,e,i){let r=this.getEncodingByField(e,t),s=i||{};if(r){let t=new EncodingAxis(r,s.item?s.item:r.anyItem,s);return"tickValues"in s?(t.tickValues=s.tickValues,t.labelValues=s.tickValues):(t.tickValues=this._inferTickValues(r),t.labelValues=this._inferTickValues(r)),this.addChildAt(t,0),this.itemMap[t.id]=t,t}let n=findItems(this,(t=>t.dataScope&&t.dataScope.hasField(e)))[0];if(void 0===n)throw Errors.INCORRECT_AXIS_INFO+e;let a=getClosestLayout(n);if(!a||"x"!=t&&"y"!=t)throw Errors.INCORRECT_AXIS_INFO+e;{let i,r,n=getPeers(a.group,this);for(let a of n){let n=getPeers(findItems(a,(t=>t.dataScope&&t.dataScope.hasField(e)))[0],a);i=new LayoutAxis(n,a.layout,t,e,s),null==r&&(r=i.id),i.classId=r,this.addChildAt(i,0),this.itemMap[i.id]=i}return i}}legend(t,e,i){let r=i||{},s=this.getEncodingByField(e,t);if(!s)throw Errors.INCORRECT_LEGEND_INFO+e;"x"in r||(r.x=100),"y"in r||(r.y=100);let n=new Legend(s,r);this.addChild(n)}gridlines(t,e,i){let r=this.getEncodingByField(e,t),s=i||{};if(!r)return!1;let n=new Gridlines(r,r.anyItem,s);return n.values="values"in s?s.values:this._inferTickValues(r),this.addChildAt(n,0),n}_inferTickValues(t){let e,i=t.scale.domain,r=t.scale.range;switch(t.scale.type){case"linear":case"log":{let s=Math.abs(r[0]-r[1]);if("width"==t.channel||"height"==t.channel){let e=getClosestLayout(t.anyItem);if(e&&e.type==LayoutType.Stack){let r=getPeers(e.group,t.scene);s=Math.max(...r.map((e=>e.bounds[t.channel]))),i[1]=Math.ceil(t.scale.invert(s))}}e="width"==t.channel||"x"==t.channel?45:30;let n=Math.floor(s/e);return d3__namespace.ticks(i[0],i[1],n)}case"point":{e="width"==t.channel||"x"==t.channel?80:30;let r=Math.floor(t.scale.rangeExtent/i.length),s=Math.ceil(e/r);return"x"==t.channel?i.filter(((t,e)=>e%s==0)):i}case"time":{e="width"==t.channel||"x"==t.channel?80:30;let s,n,a=Math.floor((r[1]-r[0])/e),o=Math.ceil((i[1]-i[0])/a)/1e3,h=[1,60,3600,86400,2628003,31536e3],l=[d3__namespace.timeSeconds,d3__namespace.timeMinutes,d3__namespace.timeHours,d3__namespace.timeDays,d3__namespace.timeMonths,d3__namespace.timeYears];for(let t=0;t<h.length-1;t++)if(o>=h[t]&&o<h[t+1])return s=Math.floor(o/h[t]),n=l[t],n(i[0],i[1],s);return o>h[h.length-1]?(s=Math.floor(o/h[h.length-1]),n=l[h.length-1],n(i[0],i[1],s)):[]}default:return[]}}propagate(t,e,...i){let r=getPeers(t,this);for(let t of r)t[e](...i)}classify(t,e,i){let r,s={};for(let i of t){let t=i.dataScope.getFieldValue(e);t in s||(s[t]=[]),s[t].push(i)}let n=[],a=t[0].dataScope._dt;for(let t in s){let o=this.collection();i.addChild(o),void 0===r&&(r=o.id),o.classId=r,o.dataScope=new DataScope(a).cross(e,t);for(let e of s[t])o.addChild(e);n.push(o)}return n}getEncodingByItem(t,e){let i=this.encodings[getEncodingKey(t)];return i&&i[e]?i[e]:null}getEncodingByField(t,e){for(let i in this.encodings){let r=this.encodings[i];if(r[e]&&r[e].field==t)return r[e]}return null}positionBound(t,e){return!!this.getEncodingByItem(t,e)||!(!isMark(t)||!this.getEncodingByItem(t.vertices[0],e))}setProperties(t,e){if(Object.values(LayoutType).indexOf(t.type)>-1&&t.group){let i=getPeers(t.group,this);for(let t of i)for(let i in e)t.layout[i]=e[i]}else{let i=getPeers(t,this);if("vertex"==t.type)for(let t of i)for(let i in e)t[i]=e[i];else if(t instanceof Mark){for(let r in e){this.getEncodingByItem(t,r)?console.log(r+" is bound to data"):r in Style2SVG?i.forEach((t=>t.styles[r]=e[r])):i.forEach((t=>t[r]=e[r]))}("width"in e||"height"in e)&&this._relayoutAncestors(t,i)}else if("collection"==t.type)for(let t in e)i.forEach((i=>i[t]=e[t]))}}_updateAncestorBounds(t,e){let i=getParents(e||getPeers(t,this));for(;i.length>0;){for(let t of i)(t.children&&t.children.length>0||t.vertices)&&t._updateBounds();i=getParents(i)}}_relayoutAncestors(t,e){let i=getParents(e||getPeers(t,this));for(;i.length>0;){for(let t of i)t.layout&&t.layout.run(),t.children&&t.children.length>0&&t._updateBounds(),t.vertices&&t._updateBounds();i=getParents(i)}}updateAxes(t){for(let e of this.children){if(e.type!==ItemType.Axis)continue;if(t.classId===e._item.classId){e.reposition();continue}let i=t,r=!1;for(;i.children&&i.children.length>0;){for(let t of i.children)if(t.classId===e._item.classId){e.reposition(),r=!0;break}if(r)break;i=i.children[0]}}}_reapplySizeBindings(t){let e=["width","height"];for(let i in this.encodings){if(t.classId!=i)continue;let r=this.encodings[i],s=findItems(this,(t=>t.classId==i));for(let t of e){let e=r[t];e&&e.run()}this._relayoutAncestors(s[0],s)}}_registerBinding(t){let e=this.encodings,i=getEncodingKey(t.anyItem);return i in e||(e[i]={}),e[i][t.channel]=t,!0}toJSON(){let t=super.toJSON();this.fillColor&&(t.fillColor=this.fillColor);let e={};t.encodings=[];for(let i in this.encodings)for(let r in this.encodings[i]){let s=this.encodings[i][r];t.encodings.push(s.toJSON()),s.scale&&!(s.scale.id in e)&&(e[s.scale.id]=s.scale.toJSON())}t.scales=e,t.constraints={};for(let e in this.constraints)t.constraints[e]=this.constraints[e].toJSON();t.tables={};let i=this.getDataTables();for(let e in i)t.tables[e]=i[e].toJSON();return t}getDataTables(){let t={};for(let e in this.encodings)for(let i in this.encodings[e]){let r=this.encodings[e][i];r.datatable.id in t||(t[r.datatable.id]=r.datatable)}return t}getItem(t){return this.itemMap[t]}}class SVGRenderer{constructor(t){this._svgId=t,this._compMap={},this._decoMap={}}render(t,e){let i=e||{};this._renderItem(t,i)}clear(){let t=document.getElementById(this._svgId);for(;t.firstChild;)t.firstChild.remove();this._compMap={},this._decoMap={}}_renderItem(t,e){let i,r=t.id,s=t.parent;i=s&&s.id&&s.id in this._compMap?s.id:this._svgId,r in this._compMap||(this._compMap[r]=d3__namespace.select("#"+i).append(this._getSVGElementType(t)));let n=this._compMap[r];if(n.attr("id",r),t.type==ItemType.Scene&&d3__namespace.select("#"+this._svgId).style("background",t.fillColor?t.fillColor:"white"),"vertex"!=t.type){if(t.type==ItemType.Path||t.type==ItemType.Polygon||t.type==ItemType.Link)n.attr("d",t.getSVGPathData()),t.closed||n.style("fill","none"),0==r.indexOf("axis")&&n.style("shape-rendering","crispEdges");else if(t.type==ItemType.Line)n.attr("x1",t.vertices[0].x),n.attr("y1",t.vertices[0].y),n.attr("x2",t.vertices[1].x),n.attr("y2",t.vertices[1].y),0==r.indexOf("axis")&&n.style("shape-rendering","crispEdges");else if(t.type==ItemType.Circle)n.attr("cx",t.x),n.attr("cy",t.y),n.attr("r",t.radius);else if(t.type==ItemType.Rect){let e=t.bounds;n.attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height)}else t.type==ItemType.PointText?n.attr("text-anchor",this._getTextAnchor(t.anchor[0])).attr("alignment-baseline",this._getTextAnchor(t.anchor[1])).attr("dominant-baseline",this._getTextAnchor(t.anchor[1])).text(t.text).attr("x",t.x).attr("y",t.y):t.type==ItemType.Pie||t.type==ItemType.Area?(n.attr("d",t.getSVGPathData()),t.closed||n.style("fill","none"),0==r.indexOf("axis")&&n.style("shape-rendering","crispEdges")):t.type==ItemType.Ring||t.type==ItemType.Arc?n.attr("d",t.getSVGPathData()):t.type==ItemType.Image&&n.attr("href",t.src).attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height);for(let e in t.styles)if(void 0!==t.styles[e])if(e.indexOf("Color")>0&&t.styles[e].type==ItemType.LinearGradient){d3__namespace.select("#"+this._svgId).select("defs").empty()&&d3__namespace.select("#"+this._svgId).append("defs");let i=d3__namespace.select("defs"),r=t.styles[e];if(i.select("#"+r.id).empty()){let t=i.append("linearGradient").attr("id",r.id);t.attr("x1",r.x1+"%").attr("x2",r.x2+"%").attr("y1",r.y1+"%").attr("y2",r.y2+"%");for(let e of r.stops)t.append("stop").attr("offset",e.offset+"%").style("stop-color",e.color).style("stop-opacity",e.opacity)}n.style(Style2SVG[e],"url(#"+r.id+")")}else n.style(Style2SVG[e],t.styles[e]);if(t._rotate&&n.attr("transform","rotate("+t._rotate.join(" ")+")"),t.vertices){t.vertices.map((t=>t.shape)).filter((t=>void 0!==t)).length>0&&this._renderVertices(t)}if(t.type==ItemType.Collection&&e&&e.collectionBounds){let e=t.bounds;t.layout&&"grid"==t.layout.type?this._renderLayout(t):(t.id in this._decoMap||(this._decoMap[t.id]=d3__namespace.select("#"+this._svgId).append("rect").attr("class","deco")),this._decoMap[t.id].attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height).attr("fill","none").attr("stroke","#1ecb40").attr("stroke-width","1px").attr("stroke-dasharray","5,5"))}if(t.children)for(let i of t.children)this._renderItem(i,e)}}_renderVertices(t){let e=t.id+"-vertices";if(!(e in this._compMap)){let i=t.parent,r=i?i.id:this._svgId;this._compMap[e]=d3__namespace.select("#"+r).append("g").attr("id",e)}let i=t.vertices.filter((t=>void 0!==t.shape));for(let t of i){let i=e+"-"+t.id;i in this._compMap||(this._compMap[i]=d3__namespace.select("#"+e).append(t.shape).attr("id",i)),"rect"==t.shape?d3__namespace.select("#"+i).attr("x",t.x-t.width/2).attr("y",t.y-t.height/2).attr("width",t.width).attr("height",t.height):"circle"==t.shape&&d3__namespace.select("#"+i).attr("cx",t.x).attr("cy",t.y).attr("r",t.radius),d3__namespace.select("#"+i).style("fill",t.fillColor).style("opacity",t.opacity).style("stroke-width",t.strokeWidth).style("stroke",t.strokeColor)}}_renderLayout(t){let e=t.id+"-grid";e in this._decoMap||(this._decoMap[e]=d3__namespace.select("#"+this._svgId).append("g").attr("id",e).attr("class","deco"));let i=t.layout.cellBounds,r=t.layout.vGap;this._decoMap[e].selectAll("rect").remove(),this._decoMap[e].selectAll("rect").data(i.slice(0,i.length-1)).enter().append("rect").attr("x",(t=>t.left)).attr("y",(t=>t.bottom)).attr("width",(t=>t.width)).attr("height",r).style("fill","pink").style("opacity",.5);let s=Math.min(...i.map((t=>t.left))),n=Math.min(...i.map((t=>t.top)));this._decoMap[e].append("rect").attr("x",s).attr("y",n).attr("width",t.bounds.width).attr("height",t.bounds.height).attr("stroke","#1ecb40").attr("stroke-width","1px").attr("stroke-dasharray","5,5").attr("fill","none")}_getTextAnchor(t){switch(t){case"top":return"text-before-edge";case"bottom":return"text-after-edge";case"left":return"start";case"right":return"end";case"center":case"middle":return"middle";default:return t}}_getSVGElementType(t){switch(t.type){case ItemType.Rect:return"rect";case ItemType.Collection:case ItemType.Group:case ItemType.Glyph:case ItemType.Scene:case ItemType.Axis:case ItemType.Legend:case ItemType.Gridlines:return"g";case ItemType.Area:case ItemType.Path:case ItemType.Polygon:case ItemType.Ring:case ItemType.Pie:case ItemType.Arc:case ItemType.Link:return"path";case ItemType.Circle:return"circle";case ItemType.Line:return"line";case ItemType.PointText:return"text";case"vertex":if("circle"==t.shape)return"circle";if("rect"==t.shape)return"rect";throw"argument exception";case"image":return"image"}}}class Scale{constructor(t,e){switch(this.type=t,this.offset=void 0,this.id="scale"+ItemCounter.scale++,t){case"linear":if(e){let t=Object.keys(e).map((t=>parseFloat(t))).sort(((t,e)=>t-e)),i=t.map((t=>e[t]));this._scale=d3__namespace.scaleLinear(t,i),"clamp"in e&&this._scale.clamp(e.clamp)}else this._scale=d3__namespace.scaleLinear();break;case"point":this._scale=d3__namespace.scalePoint();break;case"ordinal":this._scale=d3__namespace.scaleOrdinal();break;case"ordinalColor":this._scale=d3__namespace.scaleOrdinal(d3__namespace.schemeCategory10);break;case"power":case"log":this._scale=d3__namespace.scaleLog();break;case"identity":case"time":this._scale=d3__namespace.scaleTime();break;case"sequentialColor":this._scale=e&&"string"==typeof e?d3__namespace.scaleSequential(d3__namespace[e]):d3__namespace.scaleSequential()}this.encodings=[]}toJSON(){let t={};return t.type=this.type,t.id=this.id,t.offset=this.offset,t.domain=this.domain,t.range=this.range,t.clamp=this.clamp,t}_merge(t){if(this.type!=t.type)throw Errors.DIFFERENT_SCALE_TYPE;let e,i;switch(this.type){case"linear":case"time":e=[Math.min(this.domain[0],t.domain[0]),Math.max(this.domain[1],t.domain[1])],i=[0,this.map(e[1])-this.map(e[0])];break;case"point":case"ordinalColor":e=[...new Set(this.domain.concat(t.domain))],i=[];break;default:console.log("TODO: merge scale type",this.type)}this._scale.domain(e),this._scale.range(i)}get domain(){return this._scale.domain()}set domain(t){this._scale.domain(t);for(let t of this.encodings)t._apply()}get range(){return this._scale.range()}
//to support this, the argument should be in real screen coordinates and need to do internal conversion
set range(t){this._scale.range(t);for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}_setRange(t){this._scale.range(t);for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}get clamp(){return"linear"==this.type&&this._scale.clamp()}set clamp(t){"linear"==this.type&&this._scale.clamp(t)}set rangeExtent(t){let e=this._scale.range();e[0]<e[1]?this._setRange([e[0],e[0]+t]):this._setRange([e[1]+t,e[1]])}get rangeExtent(){let t=this._scale.range();return Math.abs(t[1]-t[0])}_addEncoding(t){this.encodings.indexOf(t)<0&&this.encodings.push(t)}map(t){return this._scale(t)}invert(t){return this._scale.invert(t)}}class PackingLayout extends Layout{constructor(t){super(t),this.type="packing",this.x=t.hasOwnProperty("x")?t.x:400,this.y=t.hasOwnProperty("y")?t.y:400,this.width=t.width,this.height=t.height}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this.x,t.args.y=this.y,t.args.width=this.width,t.args.height=this.height,t}clone(){return new PackingLayout({x:this.x,y:this.y,width:this.width,height:this.height})}run(){if(null==this.group)return;let t=this.group.children.map((t=>({name:t.id,radius:t.radius,itm:t}))),e=t.reduce(((t,e)=>t+Math.pow(e.radius,2)),0),i=Math.sqrt(e);void 0===this.width&&(this.width=i),void 0===this.height&&(this.height=i);let r=d3__namespace.hierarchy({name:"root",children:t}).sum((t=>t.radius?t.radius:0)).sort(((t,e)=>e.value-t.value));d3__namespace.pack().size([this.width,this.height]).radius((t=>t.value))(r);for(let t of r.children){let e=t.data.itm,i=this.x-r.x+t.x-e.x,s=this.y-r.y+t.y-e.y;e.translate(i,s)}}}class TreemapLayout extends Layout{constructor(t){super(t),this.type="treemap",this._width=t.width,this._height=t.height,this._top=t.top,this._left=t.left}toJSON(){let t={args:{}};return t.type=this.type,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}clone(){return new TreemapLayout({})}run(){if(null==this.group)return;let t=this.width?this.width:this.group.bounds.width,e=this.height?this.height:this.group.bounds.height,i=void 0===this.top?this.group.bounds.top:this.top,r=void 0===this.left?this.group.bounds.left:this.left,s=d3__namespace.hierarchy(this.group).sum((t=>"rect"==t.type?t.bounds.width*t.bounds.height:0));d3__namespace.treemap().size([t,e])(s),this._apply(s,r,i),this.group.getScene()._updateAncestorBounds(s.leaves()[0].data)}_apply(t,e,i){if("collection"==t.data.type)for(let r of t.children)this._apply(r,e,i);else"rect"==t.data.type&&(t.data.resize(t.x1-t.x0,t.y1-t.y0),t.data.translate(t.x0+e-t.data.bounds.left,t.y0+i-t.data.bounds.top))}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get top(){return this._top}set top(t){this._top=t,this.run()}get left(){return this._left}set left(t){this._left=t,this.run()}}const depth="_depth";class Tree{constructor(t,e){let i=[],r=[];this._nodeHash={},this._traverse(t,i,r),this._nodeTable=new DataTable(i,"nodes"),this._linkTable=new DataTable(r,"links"),this._nodeTable.tree=this,this._linkTable.tree=this,this._data=t,this.aggregateFromLeaves("value","average")}_traverse(t,e,i,r=0){let s={};t.hasOwnProperty(nodeId)||(t[nodeId]="n"+e.length),e.push(s),t[depth]=r;for(let n in t)if("children"==n&&t[n]&&t[n].length>0)for(let s of t[n]){let n=this._traverse(s,e,i,r+1);i.push({parent:t[nodeId],child:n})}else s[n]=t[n];return this._nodeHash[s[nodeId]]=s,s[nodeId]}getParent(t){let e,i=t[nodeId],r=this._linkTable.data,s=this._nodeTable.data;for(let t in r)if(r[t].child==i){e=r[t].parent;let i=s.findIndex((t=>t[nodeId]==e));return s[i]}}getChildren(t){let e=t[nodeId],i=[],r=this._linkTable.data,s=this._nodeTable.data;for(let t in r)if(r[t].parent==e){let e=r[t].child,n=s.findIndex((t=>t[nodeId]==e));i.push(s[n])}return i}getMaxDepth(){return this._nodeTable._fieldSummaries[depth].max}getRoot(){return this._nodeTable.data[0]}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}getNode(t){return this._nodeTable.data.filter((e=>e[nodeId]==t))[0]}sumLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];if(r=this.getChildren(t),r&&r.length>0){let t=0;for(let i of r)t+=this.sumLeaves(i,e);this.getNode(i)["sum"+e]=t}else this.getNode(i)["sum"+e]=t[e];return t["sum"+e]}countLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];r=this.getChildren(t);let s=0;if(r&&r.length>0)for(let t of r)s+=this.countLeaves(t,e);else s=1;return this.getNode(i)["count"+e]=s,t["count"+e]}averageLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];r=this.getChildren(t);let s=0;if(r&&r.length>0){for(let t of r)s+=this.averageLeaves(t,e);s/=r.length,this.getNode(i)["average"+e]=s}else this.getNode(i)["average"+e]=t[e];return t["average"+e]}medianLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];r=this.getChildren(t);let s=[];if(r&&r.length>0){for(let t of r)s.push(this.medianLeaves(t,e));s.sort((function(t,e){return t-e}));let t=Math.floor(s.length/2);s.length%2?this.getNode(i)["median"+e]=s[t]:this.getNode(i)["median"+e]=(s[t-1]+s[t])/2}else this.getNode(i)["median"+e]=t[e];return t["median"+e]}maxLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];r=this.getChildren(t);let s=[];if(r&&r.length>0){for(let t of r)s.push(this.maxLeaves(t,e));this.getNode(i)["max"+e]=Math.max(...s)}else this.getNode(i)["max"+e]=t[e];return t["max"+e]}minLeaves(t,e){if(!t)return 0;let i=t[nodeId],r=[];r=this.getChildren(t);let s=[];if(r&&r.length>0){for(let t of r)s.push(this.minLeaves(t,e));this.getNode(i)["min"+e]=Math.min(...s)}else this.getNode(i)["min"+e]=t[e];return t["min"+e]}aggregateFromLeaves(t,e){let i=this.getRoot();switch(e){case"sum":this.sumLeaves(i,t);break;case"count":this.countLeaves(i,t);break;case"average":this.averageLeaves(i,t);break;case"median":this.medianLeaves(i,t);break;case"max":this.maxLeaves(i,t);break;case"min":this.minLeaves(i,t)}}}function merge(t,e){let i=[t[0]],r=[e[0]];for(let s=1;s<e.length;s++){let n=!1,a=e[s];for(let e=0;e<r.length;e++){let o=r[e],h=new Set(a);if(o.forEach((t=>h.add(t))),h.size<a.length+o.length){r[e]=[...h],i[e]=i[e].concat(t[s]),n=!0;break}}n||(r.push(a),i.push(t[s]))}return{grouping:i,subgraphs:r}}function partition(t){let e=t.nodes,i=t.links,r=i.map(((t,e)=>[e])),s=i.map((t=>[t.source,t.target])),n=merge(r,s);for(;n.grouping.length!=r.length;)r=n.grouping,s=n.subgraphs,n=merge(r,s);let a=[];for(let[t,r]of n.grouping.entries()){let s={nodes:[],links:[]};s.links=r.map((t=>i[t]));const o=n.subgraphs[t];s.nodes=e.filter((t=>o.indexOf(t[nodeId])>=0)),a.push(new Network(s))}return a}class Network{constructor(t,e){this._nodeTable=new DataTable(t.nodes,"nodes"),this._linkTable=new DataTable(t.links,"links"),this._nodeTable.graph=this,this._linkTable.graph=this,this._nodes=t.nodes,this._links=t.links,this._nodeHash={};for(let e of t.nodes)this._nodeHash[e[nodeId]]=e}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}get nodes(){return this._nodes}get links(){return this._links}getNode(t){return this._nodeHash[t]}getSources(t){let e,i=t[nodeId],r=this._links.data,s=this._nodes.data,n=[];for(let t in r)if(r[t].target==i){e=r[t].source;let i=s.findIndex((t=>t[nodeId]===e));n.push(s[i])}return n}getTargets(t){let e,i=t[nodeId],r=this._links.data,s=this._nodes.data,n=[];for(let t in r)if(r[t].source==i){e=r[t].target;let i=s.findIndex((t=>t[nodeId]===e));n.push(s[i])}return n}transform(t,e,i){switch(t){case"partition":return partition(this)}}isLinear(){let t={},e={};for(let i of this._links)i.source in e||(e[i.source]=0),i.target in t||(t[i.target]=0),e[i.source]++,t[i.target]++;for(let e in t)if(t[e]>1)return!1;for(let t in e)if(e[t]>1)return!1;return!0}}class TidyTreeLayout extends Layout{constructor(t){super(t),this.type=LayoutType.TidyTree,this._width="width"in t?t.width:500,this._height="height"in t?t.height:500,this._left="left"in t?t.left:100,this._top="top"in t?t.top:100,this._orientation="orientation"in t?t.orientation:Orientation.Horizontal}toJSON(){let t={args:{}};return t.args.type=this.type,t.args.orientation=this._orientation,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt;if(t.tree){let e=d3__namespace.hierarchy(t.tree._data),i=Math.max(...this.group.children.map((t=>t.bounds.width))),r=Math.max(...this.group.children.map((t=>t.bounds.height))),s=this._orientation==Orientation.Horizontal?[this._height,this._width]:[this._width,this._height],n=d3__namespace.tree().nodeSize([i,r]).size(s)(e);this._apply(n,this.group)}}_apply(t,e){let i,r,s=e.children.filter((e=>e.dataScope.getFieldValue(nodeId)==t.data[nodeId]))[0];switch(this._orientation){case Orientation.Horizontal:i=t.y+this._left,r=t.x+this._top;break;case Orientation.Vertical:i=t.x+this._left,r=this._top+t.y}if(s.x=i,s.y=r,t.children&&t.children.length>0)for(let i of t.children)this._apply(i,e)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.run()}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get size(){return[this._width,this._height]}set size(t){this._width=t[0],this._height=t[1],this.run()}}class ForceLayout extends Layout{constructor(t){super(t),this.type=LayoutType.Force,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this._iterations="iterations"in t?t.iterations:1,this._repulsion="repulsion"in t?t.repulsion:30,this._attraction="attraction"in t?t.attraction:1,this._linkDistance="linkDistance"in t?t.linkDistance:30}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this._x,t.args.y=this._y,t.args.iterations=this._iterations,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt.graph;if(t){let e=t.links.map((e=>({source:t.getNode(e.source),target:t.getNode(e.target)}))),i=d3__namespace.forceSimulation(t.nodes).force("charge",d3__namespace.forceManyBody().strength(-this._repulsion)).force("link",d3__namespace.forceLink(e).id((t=>t.id)).distance(this._linkDistance)).force("x",d3__namespace.forceX()).force("y",d3__namespace.forceY()).force("center",d3__namespace.forceCenter(this._x,this._y).strength(this._attraction));i.stop(),i.tick(this._iterations);for(let e=0;e<this.group.children.length;e++)this.group.children[e].x=t.nodes[e].x,this.group.children[e].y=t.nodes[e].y}}}class SpecGenerator{constructor(){this.axes={},this.guideCmds=[],this.collectionCmds=[],this.glyphCmds=[],this.spec=[]}run(t){for(let e of t.children)switch(e.type){case ItemType.Axis:let i=e.classId?e.classId:e.id;this.axes[i]=e;break;case ItemType.Gridlines:case ItemType.Legend:{let t=e.toJSON();this.guideCmds.push({cmd:e.type,channel:t.channel,field:t.field,args:t.args});break}case ItemType.Collection:case ItemType.Group:case ItemType.Glyph:let r=[];this._analyze(e,r);for(let t=r.length-1;t>0;t--)for(let e of r[t].fields)r[t-1].fields.delete(e);for(let[t,e]of r.entries()){if(e.item instanceof Mark)this.collectionCmds.push({cmd:"mark",type:e.item.type,output:e.item,args:e.item.toJSON().args});else if(e.item instanceof Glyph)this.collectionCmds.push({cmd:"glyph",output:e.item,input:r.slice(0,t).map((t=>t.item)),args:{}});else if(e.item instanceof Collection){let i=[...r[t-1].fields][0],s={cmd:"join",input:r[t-1].item,output:e.item,data:r[t-1].item.dataScope.dataTable.id,args:{field:i}};i==atlas_rowId&&delete s.field,this.collectionCmds.push(s)}e.item.dataScope&&0==e.item.dataScope.fields.length&&!e.item.parent.dataScope&&this.collectionCmds.push({cmd:"attach",input:e.item,data:e.item.dataScope.dataTable.id})}break;default:if(e instanceof Mark){let i={cmd:"mark",type:e.type,output:e,args:e.toJSON().args};this._inferMarkArgs(i,t),this.glyphCmds.push(i)}}this._inferJoin(),this._inferArgs(t);for(let t in this.axes){let e=this.axes[t].toJSON();this.guideCmds.push({cmd:e.type,channel:e.channel,field:e.field,args:e.args})}return this._generateFullSpec(t),this.spec}_inferJoin(){for(let t of this.collectionCmds){if("join"!=t.cmd)continue;let e=t.input,i=e.parent;switch(e.type){case ItemType.Rect:i.layout&&i.layout.type==LayoutType.Stack?t.cmd="divide":t.cmd="repeat";break;default:t.cmd="repeat"}}}_inferArgs(t){for(let e of this.collectionCmds)switch(e.cmd){case"mark":this._inferMarkArgs(e,t);break;case"divide":this._inferDivideArgs(e,t)}}_inferDivideArgs(t,e){t.args.orientation=t.output.layout.orientation}_inferMarkArgs(t,e){let i=t.output,r=i.parent,s=getPeers(i,e),n=getPeers(r,e);switch(i.type){case ItemType.Rect:r.layout&&r.layout.type==LayoutType.Grid?(t.args.width=r.layout.cellBounds[0].width,t.args.height=r.layout.cellBounds[0].height):r.layout&&r.layout.type==LayoutType.Stack?(t.args.width=Math.max(...n.map((t=>t.bounds.width))),t.args.height=Math.max(...n.map((t=>t.bounds.height)))):(t.args.width=Math.max(...s.map((t=>t.bounds.width))),t.args.height=Math.max(...s.map((t=>t.bounds.height)))),t.args.left=Math.min(...s.map((t=>t.bounds.left))),t.args.top=Math.min(...s.map((t=>t.bounds.top)));break;case ItemType.Line:t.args.x1=Math.min(...s.map((t=>t.vertices[0].x))),t.args.y1=Math.min(...s.map((t=>t.vertices[0].y))),t.args.x2=Math.min(...s.map((t=>t.vertices[1].x))),t.args.y2=Math.min(...s.map((t=>t.vertices[1].y)))}for(let e in i.styles)t.args[e]=i.styles[e]}_analyze(t,e){if(t instanceof Glyph)for(let i of t.children)this._analyze(i,e);else t instanceof Group&&this._analyze(t.firstChild,e);let i={type:t.type,item:t};t.dataScope?i.fields=new Set(t.dataScope.fields):i.fields=new Set,e.push(i)}_generateFullSpec(t){this.spec=[],this.spec.push({cmd:"scene",args:{fillColor:t.fillColor}});let e=t.getDataTables(),i={},r=[];for(let t in e){let s=e[t];if(s.sourceDataTable)for(;s.sourceDataTable;)r.push({cmd:"transform",type:s.transform.type,args:s.transform.args,input:s.sourceDataTable.id,output:s.id}),s=s.sourceDataTable;i.hasOwnProperty(s.id)||(i[s.id]={cmd:"data",url:s.url,output:s.id})}this.spec=this.spec.concat(Object.values(i)),this.spec=this.spec.concat(r);let s=[];for(let t of this.collectionCmds){let e;t.output&&t.output.layout&&(e={cmd:"layout",type:t.output.layout.type,input:t.output.id,args:t.output.layout.toJSON().args}),this.spec.push(t),t.output&&t.output.childrenOrder&&s.push({cmd:"sortChildren",args:t.output.childrenOrder,input:t.output.id}),e&&this.spec.push(e),t.input&&Array.isArray(t.input)?t.input=t.input.map((t=>t.classId?t.classId:t.id)):t.input&&(t.input=t.input.classId?t.input.classId:t.input.id),t.output&&(t.output=t.output.classId?t.output.classId:t.output.id)}let n={},a=[];for(let e in t.encodings)for(let i in t.encodings[e]){let r=t.encodings[e][i];r.scale&&!n.hasOwnProperty(r.scale.id)&&(n[r.scale.id]=r.scale.toJSON());let s=r.toJSON().args;s.field=r.field,s.channel=r.channel,delete s.datatable,a.push({cmd:"encode",input:getEncodingKey(r.anyItem),scale:r.scale.id,args:s})}for(let t in n){let e=n[t];e.cmd="scale",this.spec.push(e)}this.spec=this.spec.concat(a),this.spec=this.spec.concat(s);for(let e in t.constraints){let i=t.constraints[e],r={cmd:"constraint",type:i.type,args:{}};switch(i.type){case ConstraintType.Affix:r.item=i.item.classId?i.item.classId:i.item.id,r.baseItem=i.baseItem.classId?i.baseItem.classId:i.baseItem.id,r.channel=i.channel,r.args.itemAnchor=i.itemAnchor,r.args.baseAnchor=i.baseAnchor,r.args.offset=i.offset;break;case ConstraintType.Align:r.items=i.items.map((t=>t.classId?t.classId:t.id)),r.anchor=i.anchor}this.spec.push(r)}for(let t of this.guideCmds)this.spec.push(t);for(let t of this.glyphCmds)t.output&&(t.output=t.output.classId?t.output.classId:t.output.id),this.spec.push(t)}}class SceneLoader{constructor(){this.axes={},this.legends=[],this.gridlines=[],this.scales={},this.tables={}}load(t){console.log("saved",t);let e={};t.fillColor&&(e.fillColor=t.fillColor);let i=scene(e);if(i.id=t.id,i.type=t.type,t.bounds&&(i._bounds=new Rectangle$1(t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height)),t.tables)for(let e in t.tables)this.tables[e]=new DataTable(t.tables[e].data,e,t.tables[e].fieldTypes);for(let e of t.children)this._processItem(i,e,i);if(t.scales)for(let e in t.scales)this._loadScale(t.scales[e],i);if(t.encodings)for(let e of t.encodings)this._loadEncoding(e,i);if(t.constraints)for(let e in t.constraints)this._loadConstraint(t.constraints[e],i);for(let t in this.axes)this._createGuide(i,this.axes[t]);for(let t of this.legends)this._createGuide(i,t);for(let t of this.gridlines)this._createGuide(i,t);return console.log("loaded",i),i}_loadScale(t){let e=createScale(t.type);e.id=t.id,e.domain="time"==t.type?t.domain.map((t=>new Date(t))):t.domain,e.range=t.range,"offset"in t&&(e.offset=t.offset),this.scales[e.id]=e}_loadEncoding(t,e){let i=t.items.map((t=>e.find([{id:t}])[0]));t.args.datatable&&(t.args.datatable=this.tables[t.args.datatable]);let r=new Encoding(i,e,t.channel,t.field,t.args);t.scale&&(r.scale=this.scales[t.scale],r.scale._addEncoding(r)),t.data&&(r.data=t.data),t._rectNegativeValues&&(r._rectNegativeValues=t._rectNegativeValues),e._registerBinding(r)}_createGuide(t,e){switch(e.type){case ItemType.Axis:t.axis(e.channel,e.field,e.args);break;case ItemType.Legend:t.legend(e.channel,e.field,e.args);break;case ItemType.Gridlines:t.gridlines(e.channel,e.field,e.args)}}_processItem(t,e,i){switch(e.type){case ItemType.Axis:{let t=e.classId?e.classId:e.id;this.axes[t]=e;break}case ItemType.Gridlines:this.gridlines.push(e);break;case ItemType.Legend:this.legends.push(e);break;case ItemType.Collection:{let r=i.collection();t.addChild(r),this._loadGroup(r,e,i);break}case ItemType.Group:{let r=i.group();t.addChild(r),this._loadGroup(r,e,i);break}case ItemType.Glyph:{let r=i.glyph();t.addChild(r),this._loadGroup(r,e,i);break}default:this._loadMark(t,e,i)}}_loadConstraint(t,e){switch(t.type){case"affixation":{let i=e.find([{id:t.item}])[0],r=e.find([{id:t.baseItem}])[0],s=new AffixConstraint(i,r,e,t.channel,t.itemAnchor,t.baseAnchor,t.offset);return s.id=t.id,e.constraints[t.id]=s,s}case"alignment":{let i=t.items.map((t=>e.find([{id:t}])[0])),r=new AlignConstraint(i,t.direction);return r.id=t.id,e.constraints[t.id]=r,r}}}_loadDataScope(t){let e=new DataScope(this.tables[t.dt]);for(let i in t.f2v)e._field2value[i]=t.f2v[i],e._updateTuples(i,t.f2v[i]);return e}_loadGroup(t,e,i){t.id=e.id,e.classId&&(t.classId=e.classId),e.dataScope&&(t.dataScope=this._loadDataScope(e.dataScope));for(let r of e.children)this._processItem(t,r,i);if(e.layout){let i=this._loadLayout(e.layout);i.group=t,t._layout=i}e.bounds&&(t._bounds=new Rectangle$1(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height))}_loadMark(t,e,i){let r=i.mark(e.type,e.args);if(r.id=e.id,e.classId&&(r.classId=e.classId),e.dataScope&&(r.dataScope=this._loadDataScope(e.dataScope)),e.vertices){r.vertices=e.vertices.map((t=>Vertex.fromJSON(t,r)));for(let t=1;t<r.vertices.length;t++)r.segments.push(new Segment(r.vertices[t-1],r.vertices[t],r,r.segmentCounter++))}e.bounds&&(r._bounds=new Rectangle$1(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height)),t.addChild(r)}_loadLayout(t){let e=layout(t.type,t.args);switch(t.type){case LayoutType.Grid:e._left=t.left,e._top=t.top}return e}}class SpecExecutor{constructor(){}async run(t){let e,i,r={},s={},n={};console.log("spec");for(let a of t)switch(console.log(a),a.cmd){case"scene":e=scene(a.args);break;case"data":i=await csv(a.url),s[a.output]=i;break;case"transform":s[a.output]=s[a.input].transform(a.type,a.args);break;case"mark":r[a.output]=e.mark(a.type,a.args);break;case"glyph":r[a.output]=e.glyph(...a.input.map((t=>r[t])));break;case"attach":e.attach(r[a.input],s[a.data]);break;case"repeat":{let t=e.repeat(r[a.input],s[a.data],a.args);r[a.output]=t;break}case"divide":{let t=e.divide(r[a.input],s[a.data],a.args);r[a.output]=t;break}case"layout":r[a.input].layout=layout(a.type,a.args);break;case"sortChildren":"field"in a.args?r[a.input].sortChildrenByData(a.args.field,a.args.reverse,a.args.order):"channel"in a.args&&r[a.input].sortChildren(a.args.channel,a.args.reverse);break;case"scale":{let t=createScale(a.type);t.id=a.id,t.domain="time"==a.type?a.domain.map((t=>new Date(t))):a.domain,t.range=a.range,t.clamp=a.clamp,"offset"in a&&(t.offset=a.offset),n[t.id]=t;break}case"encode":let t,o=a.input;if(o.indexOf("_v_")>0){let e=parseInt(o.split("_v_")[1]);t=r[o.split("_v_")[0]].vertices[e]}else if(o.indexOf("_v")>0);else if(o.indexOf("_s_")>0){let e=parseInt(o.split("_s_")[1]);t=r[o.split("_s_")[0]].segments[e]}else o.indexOf("_s")>0||(t=r[a.input]);a.scale&&n[a.scale]&&(a.args.scale=n[a.scale]),e.encode(t,a.args);break;case"constraint":switch(a.type){case ConstraintType.Affix:e.affix(r[a.item],r[a.baseItem],a.channel,a.args)}break;case"axis":e.axis(a.channel,a.field,a.args);break;case"legend":e.legend(a.channel,a.field,a.args);break;case"gridlines":e.gridlines(a.channel,a.field,a.args)}return e}}let DEG2RAD=Math.PI/180;class WebGLRenderer{constructor(t){this._canvasId=t,this._doesCollectionHaveBounds=!1,this._app=new PIXI__namespace.Application({antialias:!0,width:1600,height:1e3,view:document.getElementById(this._canvasId)}),this._app.renderer.autoResize=!0}render(t,e){let i=e||{};this._app.renderer.backgroundColor=toHexColor(t.fillColor?t.fillColor:"#fff"),this._doesCollectionHaveBounds=!!i.collectionBounds,this._app.stage.removeChildren(),this._app.renderer.clear();let r=this._renderItem(t);this._app.stage.addChild(r)}_renderItem(t){switch(t.type){case ItemType.Ellipse:case ItemType.LinearGradient:throwError("mark",t,Errors.FEATURE_NOT_IMPLEMENTED);break;case ItemType.Circle:return this._renderCircle(t);case ItemType.Pie:return this._renderPiePath(t);case ItemType.Area:return this._renderArea(t);case ItemType.Polygon:return this._renderPolygon(t);case ItemType.Axis:return this._renderAxis(t);case ItemType.Collection:return this._renderCollection(t);case ItemType.Glyph:case ItemType.Group:case ItemType.Gridlines:case ItemType.Legend:case ItemType.Scene:return this._renderGroup(t);case ItemType.Path:return this._renderPath(t);case ItemType.Line:return this._renderLinearPath(t);case ItemType.Rect:return this._renderRectangle(t);case ItemType.PointText:return this._renderText(t);case ItemType.Arc:return this._renderArc(t);case ItemType.Image:return this._renderImage(t);case ItemType.Link:return this._renderLink(t);default:throw new Error(`Expect: itemType, Actual: ${t}\nWait that's illegal`)}}_renderRectangle(t){let e=new PIXI.Graphics;return decorate(e,t.styles),e.lineStyle(t.styles.strokeWidth,toHexColor(t.styles.strokeColor)),beginGradientOrColorFill(t.styles,e,t.height),e.drawRect(0,0,t.width,t.height),e.x=t.left,e.y=t.top,e.endFill(),e}_renderText(t){let e=new PIXI.TextStyle({fontSize:t.styles.fontSize,fontFamily:t.styles.fontFamily,fontWeight:styleFontWeight2PixiFontWeight(t.styles.fontWeight),fill:toHexColor(t.styles.fillColor)}),i=new PIXI__namespace.Text(t.text,e),r=new PIXI.Container;decorate(i,t.styles),i.x=t.x,i.y=t.y,i.anchor.set(...styleAnchor2PixiAnchor(t.anchor)),r.addChild(i);let s=rotation2PixiPivot(t._rotate);return r.pivot.set(s[0],s[1]),r.angle=rotation2PixiAngle(t._rotate),r.position.set(s[0],s[1]),r}_renderGroup(t){let e=new PIXI.Container;for(const i of t.children){let t=this._renderItem(i);if(null==t)throw new Error;e.addChild(t)}return e}_renderAxis(t){let e=this._renderGroup(t),i=rotation2PixiPivot(t._rotate);return e.pivot.set(i[0],i[1]),e.angle=rotation2PixiAngle(t._rotate),e.position.set(i[0],i[1]),e}_renderCollection(t){let e=new PIXI.Container,i=this._renderGroup(t);if(e.addChild(i),!this._doesCollectionHaveBounds)return e;let r=new PIXI.Graphics,s=0,n=t.bounds,a=n.left,o=n.right,h=n.top,l=n.bottom,u={strokeWidth:1,color:2018112,dashLength:5,dashSpacing:5};return s=c(a,o,h,s,u,r),s=c(h,l,-o,s,u,r),s=c(o,a,l,s,u,r),c(l,h,-a,s,u,r),e.addChild(r),e;function c(t,e,i,r,s,n){let a=t<=e?1:-1,o=r>=0?{point:t+r*a}:{point:t},h=i>0?[o,{point:i}]:[{point:-i},o];n.lineStyle({width:s.strokeWidth,color:s.color}),n.moveTo(h[0].point,h[1].point),o.point=r*a+t+s.dashLength*a,n.lineTo(h[0].point,h[1].point);let l=!1;for(o.point+=s.dashLength*a;o.point*a<=e*a;)l?(n.lineTo(h[0].point,h[1].point),l=!1,o.point+=s.dashSpacing*a):(n.moveTo(h[0].point,h[1].point),l=!0,o.point+=s.dashLength*a);return l?(i>0?n.lineTo(e,i):n.lineTo(-i,e),(e-o.point)*a):(o.point-e)*a}}_renderArea(t){switch(t.curveMode){case"linear":return this._renderPolygon(t);case"basis":return this._renderBezierArea(t);default:return throwError("areaPath",t,Errors.FEATURE_NOT_IMPLEMENTED)}}_renderBezierArea(t){let e=new PIXI.Graphics;decorate(e,t.styles),e.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)});let i=parseDPath(t.getSVGPathData());return beginGradientOrColorFill(t.styles,e,t.bounds.height),drawOnGraphicsFromJSONData(e,i),e.endFill(),e}_renderPolygon(t){let e=new PIXI__namespace.Container,i=this._renderLinearPath(t);i.getChildAt(0).lineTo(t.vertices[0].x,t.vertices[0].y);let r=new PIXI__namespace.Graphics;decorate(r,t.styles);let s=[];for(const e of t.vertices)s.push(e.x-t.bounds.left),s.push(e.y-t.bounds.top);return beginGradientOrColorFill(t.styles,r,t.bounds.height),r.drawPolygon(s),r.x+=t.bounds.left,r.y+=t.bounds.top,r.endFill(),e.addChild(r),e.addChild(i),e}_renderPath(t){switch(t.curveMode){case"linear":return this._renderLinearPath(t);case"bumpX":case"natural":return this._renderBezierPath(t);default:throwError("path",t,Errors.FEATURE_NOT_IMPLEMENTED)}}_renderLinearPath(t){let e=new PIXI.Container,i=new PIXI.Graphics,r="none"==t.styles.strokeDash;decorate(i,t.styles);let s=t.vertices[0];if(i.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)}),i.moveTo(s.x,s.y),r)for(let e=1;e<t.vertices.length;e++){const r=t.vertices[e];i.lineTo(r.x,r.y)}else drawDashLine(t.vertices,t.styles.strokeDash,i);e.addChild(i);for(let i=0;i<t.vertices.length;i++){let r=t.vertices[i],s=this._renderVertex(r);null!=s&&e.addChild(s)}return e}_renderBezierPath(t){let e=new PIXI.Container,i=new PIXI.Graphics;decorate(i,t.styles),i.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)}),drawOnGraphicsFromJSONData(i,parseDPath(t.getSVGPathData())),e.addChild(i);for(let i=0;i<t.vertices.length;i++){let r=t.vertices[i],s=this._renderVertex(r);null!=s&&e.addChild(s)}return e}_renderVertex(t){switch(t.shape){case"rect":return function(t){let e=new PIXI__namespace.Graphics;return e.lineStyle({width:t.strokeWidth,color:toHexColor(t.strokeColor)}),e.beginFill(toHexColor(t.fillColor)),e.drawRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),e.endFill(),e}(t);case"circle":return function(t){let e=new PIXI__namespace.Graphics;return e.lineStyle({width:t.strokeWidth,color:toHexColor(t.strokeColor)}),e.beginFill(toHexColor(t.fillColor)),e.drawCircle(t.x,t.y,t.radius),e.endFill(),e}(t);case void 0:return null;default:throwError("vertex shape",t.shape,Errors.FEATURE_NOT_IMPLEMENTED)}}_renderCircle(t){let e=new PIXI.Graphics;return decorate(e,t.styles),e.lineStyle(t.styles.strokeWidth,toHexColor(t.styles.strokeColor)),beginGradientOrColorFill(t.styles,e,t.height),e.drawCircle(t.x,t.y,t.radius),e.endFill(),e}_renderPiePath(t){let e=new PIXI__namespace.Graphics;return e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),e.beginFill(toHexColor(t.styles.fillColor)),e.moveTo(t.x,t.y),e.arc(t.x,t.y,t.radius,-t.endAngleRad,-t.startAngleRad),e.lineTo(t.x,t.y),e.endFill(),e}_renderArc(t){let e=new PIXI.Graphics;return e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),e.beginFill(toHexColor(t.styles.fillColor)),e.arc(t.x,t.y,t.outerRadius,-t.endAngle*DEG2RAD,-t.startAngle*DEG2RAD),e.arc(t.x,t.y,t.innerRadius,-t.startAngle*DEG2RAD,-t.endAngle*DEG2RAD,!0),e.endFill(),e}_renderImage(t){let e=PIXI__namespace.Sprite.from(t.src);return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}_renderLink(t){switch(t.curveMode){case"linear":return function(t){let e=new PIXI.Graphics;return decorate(e,t.styles),e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),drawOnGraphicsFromJSONData(e,parseDPath(t.getSVGPathData())),e}(t);default:throwError("link",t.curveMode,"unexpected curvemode")}}}function decorate(t,e){t.visible=styleVisiblity2PixiVisible(e.visibility),t.alpha=styleOpacity2PixiAlpha(e.opacity)}function styleFontWeight2PixiFontWeight(t){switch(t){case"regular":return"normal";case"bold":return"bold";default:throwError("font weight",t,Errors.FEATURE_NOT_IMPLEMENTED)}}function styleAnchor2PixiAnchor(t){let e,i;switch(t[0]){case"left":e=0;break;case"center":e=.5;break;case"right":e=1;break;default:throwError("x anchor",t[0],Errors.UNKNOWN_ANCHOR)}switch(t[1]){case"hanging":case"top":i=0;break;case"central":case"middle":i=.5;break;case"bottom":i=1;break;default:throwError("y anchor",t[1],Errors.UNKNOWN_ANCHOR)}return[e,i]}function toHexColor(t){let e=d3__namespace.color(t);if(null==e)return null;{let t=e.formatHex();return PIXI__namespace.utils.string2hex(t)}}function styleVisiblity2PixiVisible(t){switch(t){case"hidden":return!1;case null:case void 0:case"visible":default:return!0}}function rotation2PixiAngle(t){return void 0===t||"number"!=typeof t[0]?0:t[0]}function rotation2PixiPivot(t){return void 0===t||"number"!=typeof t[0]?[0,0]:t.slice(1)}function styleOpacity2PixiAlpha(t){switch(t){case void 0:case null:return 1;default:return t}}function throwError(t,e,i){throw console.log(e),new Error(`${i}. Source: ${t}, Actual: `)}function beginGradientOrColorFill(t,e,i){let r=t.fillColor;if("none"==r)return;let s=toHexColor(r);null!=s?e.beginFill(s):e.beginTextureFill({color:16777215,texture:createLinearGradientTexture(i,r.stops,r.y1>r.y2)})}function createLinearGradientTexture(t,e,i){const r=document.createElement("canvas");r.height=t,r.width=1;const s=r.getContext("2d"),n=s.createLinearGradient(0,0,0,t);for(let t=0;t<e.length;t++)i?n.addColorStop(1-e[t].offset/100,e[t].color):n.addColorStop(e[t].offset/100,e[t].color);return s.fillStyle=n,s.fillRect(0,0,1,t),PIXI__namespace.Texture.from(r)}function drawOnGraphicsFromJSONData(t,e){let i=e.pop(),r=()=>{};"Z"==i.code.toUpperCase()?r=()=>t.lineTo(e[0].end.x,e[0].end.y):e.push(i);for(const i of e)draw(i,t);r()}function draw(t,e){switch(t.code.toUpperCase()){case"M":e.moveTo(t.end.x,t.end.y);break;case"L":e.lineTo(t.end.x,t.end.y);break;case"Q":e.bezierCurveTo(t.cp1.x,t.cp1.y,t.cp1.x,t.cp1.y,t.end.x,t.end.y);break;case"C":e.bezierCurveTo(t.cp1.x,t.cp1.y,t.cp2.x,t.cp2.y,t.end.x,t.end.y);break;case"Z":throw new Error('Unexpected "z" marker. There\'s something wrong, I can feel it');default:return throwError("data",t,Errors.FEATURE_NOT_IMPLEMENTED)}}function drawDashLine(t,e,i){let r,s,n,a=0,o=0,h=e.split(" "),l=Number(h[0]),u=Number(h[1]);for(r=0;r<t.length&&(s=t[r],r!=t.length-1);r++){n=t[r+1];let e=n.x-s.x,h=n.y-s.y,c=Math.sqrt(e*e+h*h),d={x:e/c,y:h/c},p=0;for(i.moveTo(s.x+o*d.x,s.y+o*d.y);p<=c;)p+=o,p+=a>0?a:l,p>c?(a=p-c,p=c):a=0,i.lineTo(s.x+p*d.x,s.y+p*d.y),p+=u,p>c&&0==a?o=p-c:(o=0,i.moveTo(s.x+p*d.x,s.y+p*d.y))}}function parseDPath(t){let e={command:/\s*([achlmqstvz])/gi,number:/\s*([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/gi,comma:/\s*(?:(,)|\s)/g,flag:/\s*([01])/g},i={number:function(t){return+a("number",t)},"coordinate pair":function(t){let e=a("number",t);return null!==e||t?(a("comma"),{x:+e,y:+a("number",!0)}):null},"arc definition":function(t){let e=i["coordinate pair"](t);if(!e&&!t)return null;a("comma");let r=+a("number",!0);a("comma",!0);let s=!!+a("flag",!0);a("comma");let n=!!+a("flag",!0);return a("comma"),{radii:e,rotation:r,large:s,clockwise:n,end:i["coordinate pair"](!0)}}},r=0,s=[];for(;r<t.length;){let t,e=a("command"),i=e.toUpperCase(),h=e!==i;switch(i){case"M":t=o("coordinate pair").map((function(t,i){return 1===i&&(e=h?"l":"L"),n({end:t},e,h)}));break;case"L":case"T":t=o("coordinate pair").map((function(t){return n({end:t},e,h)}));break;case"C":if(t=o("coordinate pair"),t.length%3)throw Error("Expected coordinate pair triplet at position "+r);t=t.reduce((function(t,i,r){let s=r%3;if(s){t[t.length-1][1===s?"cp2":"end"]=i}else t.push(n({cp1:i},e,h));return t}),[]);break;case"Q":case"S":if(t=o("coordinate pair"),1&t.length)throw Error("Expected coordinate pair couple at position "+r);t=t.reduce((function(t,i,r){if(1&r){t[t.length-1].end=i}else t.push(n({cp:i},e,h));return t}),[]);break;case"H":case"V":t=o("number").map((function(t){return n({value:t},e,h)}));break;case"A":t=o("arc definition").map(n,e,h);break;case"Z":t=[{code:"Z"}]}s.push.apply(s,t)}return s;function n(t,e,i){return t.code=e,t.relative=i,t}function a(i,s){e[i].lastIndex=r;let n=e[i].exec(t);if(!n||n.index!==r){if(!s)return null;throw Error("Expected "+i+" at position "+r)}return r=e[i].lastIndex,n[1]}function o(t){let e,r=[],s=!0;for(;null!==(e=i[t](s));)r.push(e),s=!!a("comma");return r}}var pixiRenderers={};function scene(t){return new Scene(t)}function renderer(t,e){switch(t){case"svg":return new SVGRenderer(e);case"webgl":return e in pixiRenderers||(pixiRenderers[e]=new WebGLRenderer(e)),pixiRenderers[e]}}function createScale(t,e){if(ScaleType.indexOf(t)<0)throw new Error(Errors.UNKOWNN_SCALE_TYPE+": "+t);return new Scale(t,e)}function layout(t,e){let i=e||{};switch(t.toLowerCase()){case"grid":return new GridLayout(i);case"packing":return new PackingLayout(i);case"treemap":return new TreemapLayout(i);case"stack":return new StackLayout(i);case"tidytree":return new TidyTreeLayout(i);case"force":return new ForceLayout(i)}}function linearGradient(t){return new LinearGradient(t||{})}function sceneLoader(){return new SceneLoader}function specGenerator(){return new SpecGenerator}function specExecutor(){return new SpecExecutor}function makeRequest(t,e){return new Promise((function(i,r){let s=new XMLHttpRequest;s.open(t,e),s.onload=function(){this.status>=200&&this.status<300?i(s.response):r({status:this.status,statusText:s.statusText})},s.onerror=function(){r({status:this.status,statusText:s.statusText})},s.send()}))}async function csv(t){let e=await makeRequest("GET",t),i=d3__namespace.csvParse(e.trim(),d3__namespace.autoType);return new DataTable(i,t)}async function treejson(t){let e=await makeRequest("GET",t);return new Tree(JSON.parse(e),t)}async function graphjson(t){let e=await makeRequest("GET",t);return new Network(JSON.parse(e),t)}function csvSync(t,e){let i=!!e;var r=new XMLHttpRequest;if(r.open("GET",t,i),r.send(),!i&&validResponse(r)){let e=d3__namespace.csvParse(r.responseText.trim(),d3__namespace.autoType);return new DataTable(e,t)}}function validResponse(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function cartesianToPolar(t,e,i,r){return cartesian2Polar(t,e,i,r)}function polarToCartesian(t,e,i,r){return polar2Cartesian(t,e,i,r)}function hitTest(t,e,i){if(!t.children||0==t.children.length)return t.contains(e,i)?t:null;for(let r=t.children.length-1;r>=0;r--){let s=t.children[r];if(s.contains(e,i))return s}return null}function hitTestAll(t,e,i){let r=getLeafItems(t);for(let t=r.length-1;t>=0;t--){let s=r[t];if(s.contains(e,i))return s}return null}exports.cartesianToPolar=cartesianToPolar,exports.createScale=createScale,exports.csv=csv,exports.csvSync=csvSync,exports.graphjson=graphjson,exports.hitTest=hitTest,exports.hitTestAll=hitTestAll,exports.layout=layout,exports.linearGradient=linearGradient,exports.polarToCartesian=polarToCartesian,exports.renderer=renderer,exports.scene=scene,exports.sceneLoader=sceneLoader,exports.specExecutor=specExecutor,exports.specGenerator=specGenerator,exports.treejson=treejson,Object.defineProperty(exports,"__esModule",{value:!0})}));
