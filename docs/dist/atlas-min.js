!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).atlas={})}(this,(function(exports){"use strict";function ascending(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function bisector(t){let e=t,r=t;function i(t,e,i,n){for(null==i&&(i=0),null==n&&(n=t.length);i<n;){const s=i+n>>>1;r(t[s],e)<0?i=s+1:n=s}return i}return 1===t.length&&(e=(e,r)=>t(e)-r,r=ascendingComparator(t)),{left:i,center:function(t,r,n,s){null==n&&(n=0),null==s&&(s=t.length);const a=i(t,r,n,s-1);return a>n&&e(t[a-1],r)>-e(t[a],r)?a-1:a},right:function(t,e,i,n){for(null==i&&(i=0),null==n&&(n=t.length);i<n;){const s=i+n>>>1;r(t[s],e)>0?n=s:i=s+1}return i}}}function ascendingComparator(t){return(e,r)=>ascending(t(e),r)}function number(t){return null===t?NaN:+t}function*numbers(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&(yield i)}}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectCenter=bisector(number).center;function count(t,e){let r=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++r;else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(n=+n)>=n&&++r}return r}function extent(t,e){let r,i;if(void 0===e)for(const e of t)null!=e&&(void 0===r?e>=e&&(r=i=e):(r>e&&(r=e),i<e&&(i=e)));else{let n=-1;for(let s of t)null!=(s=e(s,++n,t))&&(void 0===r?s>=s&&(r=i=s):(r>s&&(r=s),i<s&&(i=s)))}return[r,i]}function identity(t){return t}var array=Array.prototype,slice=array.slice;function constant(t){return function(){return t}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(t,e,r){var i,n,s,a,o=-1;if(r=+r,(t=+t)===(e=+e)&&r>0)return[t];if((i=e<t)&&(n=t,t=e,e=n),0===(a=tickIncrement(t,e,r))||!isFinite(a))return[];if(a>0){let r=Math.round(t/a),i=Math.round(e/a);for(r*a<t&&++r,i*a>e&&--i,s=new Array(n=i-r+1);++o<n;)s[o]=(r+o)*a}else{a=-a;let r=Math.round(t*a),i=Math.round(e*a);for(r/a<t&&++r,i/a>e&&--i,s=new Array(n=i-r+1);++o<n;)s[o]=(r+o)/a}return i&&s.reverse(),s}function tickIncrement(t,e,r){var i=(e-t)/Math.max(0,r),n=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,n);return n>=0?(s>=e10?10:s>=e5?5:s>=e2?2:1)*Math.pow(10,n):-Math.pow(10,-n)/(s>=e10?10:s>=e5?5:s>=e2?2:1)}function tickStep(t,e,r){var i=Math.abs(e-t)/Math.max(0,r),n=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/n;return s>=e10?n*=10:s>=e5?n*=5:s>=e2&&(n*=2),e<t?-n:n}function nice(t,e,r){let i;for(;;){const n=tickIncrement(t,e,r);if(n===i||0===n||!isFinite(n))return[t,e];n>0?(t=Math.floor(t/n)*n,e=Math.ceil(e/n)*n):n<0&&(t=Math.ceil(t*n)/n,e=Math.floor(e*n)/n),i=n}}function thresholdSturges(t){return Math.ceil(Math.log(count(t))/Math.LN2)+1}function bin(){var t=identity,e=extent,r=thresholdSturges;function i(i){Array.isArray(i)||(i=Array.from(i));var n,s,a=i.length,o=new Array(a);for(n=0;n<a;++n)o[n]=t(i[n],n,i);var h=e(o),l=h[0],u=h[1],c=r(o,l,u);if(!Array.isArray(c)){const t=u,r=+c;if(e===extent&&([l,u]=nice(l,u,r)),(c=ticks(l,u,r))[c.length-1]>=u)if(t>=u&&e===extent){const t=tickIncrement(l,u,r);isFinite(t)&&(t>0?u=(Math.floor(u/t)+1)*t:t<0&&(u=(Math.ceil(u*-t)+1)/-t))}else c.pop()}for(var d=c.length;c[0]<=l;)c.shift(),--d;for(;c[d-1]>u;)c.pop(),--d;var f,p=new Array(d+1);for(n=0;n<=d;++n)(f=p[n]=[]).x0=n>0?c[n-1]:l,f.x1=n<d?c[n]:u;for(n=0;n<a;++n)l<=(s=o[n])&&s<=u&&p[bisectRight(c,s,0,d)].push(i[n]);return p}return i.value=function(e){return arguments.length?(t="function"==typeof e?e:constant(e),i):t},i.domain=function(t){return arguments.length?(e="function"==typeof t?t:constant([t[0],t[1]]),i):e},i.thresholds=function(t){return arguments.length?(r="function"==typeof t?t:Array.isArray(t)?constant(slice.call(t)):constant(t),i):r},i}function max(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r<e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r<n||void 0===r&&n>=n)&&(r=n)}return r}function min(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r>e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r>n||void 0===r&&n>=n)&&(r=n)}return r}function quickselect(t,e,r=0,i=t.length-1,n=ascending){for(;i>r;){if(i-r>600){const s=i-r+1,a=e-r+1,o=Math.log(s),h=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*h*(s-h)/s)*(a-s/2<0?-1:1);quickselect(t,e,Math.max(r,Math.floor(e-a*h/s+l)),Math.min(i,Math.floor(e+(s-a)*h/s+l)),n)}const s=t[e];let a=r,o=i;for(swap(t,r,e),n(t[i],s)>0&&swap(t,r,i);a<o;){for(swap(t,a,o),++a,--o;n(t[a],s)<0;)++a;for(;n(t[o],s)>0;)--o}0===n(t[r],s)?swap(t,r,o):(++o,swap(t,o,i)),o<=e&&(r=o+1),e<=o&&(i=o-1)}return t}function swap(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function quantile(t,e,r){if(i=(t=Float64Array.from(numbers(t,r))).length){if((e=+e)<=0||i<2)return min(t);if(e>=1)return max(t);var i,n=(i-1)*e,s=Math.floor(n),a=max(quickselect(t,s).subarray(0,s+1));return a+(min(t.subarray(s+1))-a)*(n-s)}}function mean(t,e){let r=0,i=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++r,i+=e);else{let n=-1;for(let s of t)null!=(s=e(s,++n,t))&&(s=+s)>=s&&(++r,i+=s)}if(r)return i/r}function median(t,e){return quantile(t,.5,e)}function sequence(t,e,r){t=+t,e=+e,r=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+r;for(var i=-1,n=0|Math.max(0,Math.ceil((e-t)/r)),s=new Array(n);++i<n;)s[i]=t+i*r;return s}function sum(t,e){let r=0;if(void 0===e)for(let e of t)(e=+e)&&(r+=e);else{let i=-1;for(let n of t)(n=+e(n,++i,t))&&(r+=n)}return r}var noop={value:()=>{}};function dispatch(){for(var t,e=0,r=arguments.length,i={};e<r;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new Dispatch(i)}function Dispatch(t){this._=t}function parseTypenames(t,e){return t.trim().split(/^|\s+/).map((function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}}))}function get(t,e){for(var r,i=0,n=t.length;i<n;++i)if((r=t[i]).name===e)return r.value}function set(t,e,r){for(var i=0,n=t.length;i<n;++i)if(t[i].name===e){t[i]=noop,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=r&&t.push({name:e,value:r}),t}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(t,e){var r,i=this._,n=parseTypenames(t+"",i),s=-1,a=n.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<a;)if(r=(t=n[s]).type)i[r]=set(i[r],t.name,e);else if(null==e)for(r in i)i[r]=set(i[r],t.name,null);return this}for(;++s<a;)if((r=(t=n[s]).type)&&(r=get(i[r],t.name)))return r},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new Dispatch(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var r,i,n=new Array(r),s=0;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,r=(i=this._[t]).length;s<r;++s)i[s].value.apply(e,n)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],n=0,s=i.length;n<s;++n)i[n].value.apply(e,r)}};var xhtml="http://www.w3.org/1999/xhtml",namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(t){var e=t+="",r=e.indexOf(":");return r>=0&&"xmlns"!==(e=t.slice(0,r))&&(t=t.slice(r+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:t}:t}function creatorInherit(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(t):e.createElementNS(r,t)}}function creatorFixed(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function creator(t){var e=namespace(t);return(e.local?creatorFixed:creatorInherit)(e)}function none(){}function selector(t){return null==t?none:function(){return this.querySelector(t)}}function selection_select(t){"function"!=typeof t&&(t=selector(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s,a,o=e[n],h=o.length,l=i[n]=new Array(h),u=0;u<h;++u)(s=o[u])&&(a=t.call(s,s.__data__,u,o))&&("__data__"in s&&(a.__data__=s.__data__),l[u]=a);return new Selection(i,this._parents)}function array$1(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function empty(){return[]}function selectorAll(t){return null==t?empty:function(){return this.querySelectorAll(t)}}function arrayAll(t){return function(){var e=t.apply(this,arguments);return null==e?[]:array$1(e)}}function selection_selectAll(t){t="function"==typeof t?arrayAll(t):selectorAll(t);for(var e=this._groups,r=e.length,i=[],n=[],s=0;s<r;++s)for(var a,o=e[s],h=o.length,l=0;l<h;++l)(a=o[l])&&(i.push(t.call(a,a.__data__,l,o)),n.push(a));return new Selection(i,n)}function matcher(t){return function(){return this.matches(t)}}function childMatcher(t){return function(e){return e.matches(t)}}var find=Array.prototype.find;function childFind(t){return function(){return find.call(this.children,t)}}function childFirst(){return this.firstElementChild}function selection_selectChild(t){return this.select(null==t?childFirst:childFind("function"==typeof t?t:childMatcher(t)))}var filter=Array.prototype.filter;function children(){return this.children}function childrenFilter(t){return function(){return filter.call(this.children,t)}}function selection_selectChildren(t){return this.selectAll(null==t?children:childrenFilter("function"==typeof t?t:childMatcher(t)))}function selection_filter(t){"function"!=typeof t&&(t=matcher(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s,a=e[n],o=a.length,h=i[n]=[],l=0;l<o;++l)(s=a[l])&&t.call(s,s.__data__,l,a)&&h.push(s);return new Selection(i,this._parents)}function sparse(t){return new Array(t.length)}function selection_enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function constant$1(t){return function(){return t}}function bindIndex(t,e,r,i,n,s){for(var a,o=0,h=e.length,l=s.length;o<l;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):r[o]=new EnterNode(t,s[o]);for(;o<h;++o)(a=e[o])&&(n[o]=a)}function bindKey(t,e,r,i,n,s,a){var o,h,l,u=new Map,c=e.length,d=s.length,f=new Array(c);for(o=0;o<c;++o)(h=e[o])&&(f[o]=l=a.call(h,h.__data__,o,e)+"",u.has(l)?n[o]=h:u.set(l,h));for(o=0;o<d;++o)l=a.call(t,s[o],o,s)+"",(h=u.get(l))?(i[o]=h,h.__data__=s[o],u.delete(l)):r[o]=new EnterNode(t,s[o]);for(o=0;o<c;++o)(h=e[o])&&u.get(f[o])===h&&(n[o]=h)}function datum(t){return t.__data__}function selection_data(t,e){if(!arguments.length)return Array.from(this,datum);var r=e?bindKey:bindIndex,i=this._parents,n=this._groups;"function"!=typeof t&&(t=constant$1(t));for(var s=n.length,a=new Array(s),o=new Array(s),h=new Array(s),l=0;l<s;++l){var u=i[l],c=n[l],d=c.length,f=array$1(t.call(u,u&&u.__data__,l,i)),p=f.length,_=o[l]=new Array(p),g=a[l]=new Array(p),m=h[l]=new Array(d);r(u,c,_,g,m,f,e);for(var y,v,b=0,x=0;b<p;++b)if(y=_[b]){for(b>=x&&(x=b+1);!(v=g[x])&&++x<p;);y._next=v||null}}return(a=new Selection(a,i))._enter=o,a._exit=h,a}function selection_exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)}function selection_join(t,e,r){var i=this.enter(),n=this,s=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(n=e(n)),null==r?s.remove():r(s),i&&n?i.merge(n).order():n}function selection_merge(t){if(!(t instanceof Selection))throw new Error("invalid merge");for(var e=this._groups,r=t._groups,i=e.length,n=r.length,s=Math.min(i,n),a=new Array(i),o=0;o<s;++o)for(var h,l=e[o],u=r[o],c=l.length,d=a[o]=new Array(c),f=0;f<c;++f)(h=l[f]||u[f])&&(d[f]=h);for(;o<i;++o)a[o]=e[o];return new Selection(a,this._parents)}function selection_order(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var i,n=t[e],s=n.length-1,a=n[s];--s>=0;)(i=n[s])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this}function selection_sort(t){function e(e,r){return e&&r?t(e.__data__,r.__data__):!e-!r}t||(t=ascending$1);for(var r=this._groups,i=r.length,n=new Array(i),s=0;s<i;++s){for(var a,o=r[s],h=o.length,l=n[s]=new Array(h),u=0;u<h;++u)(a=o[u])&&(l[u]=a);l.sort(e)}return new Selection(n,this._parents).order()}function ascending$1(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function selection_call(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function selection_nodes(){return Array.from(this)}function selection_node(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],n=0,s=i.length;n<s;++n){var a=i[n];if(a)return a}return null}function selection_size(){let t=0;for(const e of this)++t;return t}function selection_empty(){return!this.node()}function selection_each(t){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var n,s=e[r],a=0,o=s.length;a<o;++a)(n=s[a])&&t.call(n,n.__data__,a,s);return this}function attrRemove(t){return function(){this.removeAttribute(t)}}function attrRemoveNS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function attrConstant(t,e){return function(){this.setAttribute(t,e)}}function attrConstantNS(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function attrFunction(t,e){return function(){var r=e.apply(this,arguments);null==r?this.removeAttribute(t):this.setAttribute(t,r)}}function attrFunctionNS(t,e){return function(){var r=e.apply(this,arguments);null==r?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function selection_attr(t,e){var r=namespace(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((null==e?r.local?attrRemoveNS:attrRemove:"function"==typeof e?r.local?attrFunctionNS:attrFunction:r.local?attrConstantNS:attrConstant)(r,e))}function defaultView(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function styleRemove(t){return function(){this.style.removeProperty(t)}}function styleConstant(t,e,r){return function(){this.style.setProperty(t,e,r)}}function styleFunction(t,e,r){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,r)}}function selection_style(t,e,r){return arguments.length>1?this.each((null==e?styleRemove:"function"==typeof e?styleFunction:styleConstant)(t,e,null==r?"":r)):styleValue(this.node(),t)}function styleValue(t,e){return t.style.getPropertyValue(e)||defaultView(t).getComputedStyle(t,null).getPropertyValue(e)}function propertyRemove(t){return function(){delete this[t]}}function propertyConstant(t,e){return function(){this[t]=e}}function propertyFunction(t,e){return function(){var r=e.apply(this,arguments);null==r?delete this[t]:this[t]=r}}function selection_property(t,e){return arguments.length>1?this.each((null==e?propertyRemove:"function"==typeof e?propertyFunction:propertyConstant)(t,e)):this.node()[t]}function classArray(t){return t.trim().split(/^|\s+/)}function classList(t){return t.classList||new ClassList(t)}function ClassList(t){this._node=t,this._names=classArray(t.getAttribute("class")||"")}function classedAdd(t,e){for(var r=classList(t),i=-1,n=e.length;++i<n;)r.add(e[i])}function classedRemove(t,e){for(var r=classList(t),i=-1,n=e.length;++i<n;)r.remove(e[i])}function classedTrue(t){return function(){classedAdd(this,t)}}function classedFalse(t){return function(){classedRemove(this,t)}}function classedFunction(t,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,t)}}function selection_classed(t,e){var r=classArray(t+"");if(arguments.length<2){for(var i=classList(this.node()),n=-1,s=r.length;++n<s;)if(!i.contains(r[n]))return!1;return!0}return this.each(("function"==typeof e?classedFunction:e?classedTrue:classedFalse)(r,e))}function textRemove(){this.textContent=""}function textConstant(t){return function(){this.textContent=t}}function textFunction(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function selection_text(t){return arguments.length?this.each(null==t?textRemove:("function"==typeof t?textFunction:textConstant)(t)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(t){return function(){this.innerHTML=t}}function htmlFunction(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function selection_html(t){return arguments.length?this.each(null==t?htmlRemove:("function"==typeof t?htmlFunction:htmlConstant)(t)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(t){var e="function"==typeof t?t:creator(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))}function constantNull(){return null}function selection_insert(t,e){var r="function"==typeof t?t:creator(t),i=null==e?constantNull:"function"==typeof e?e:selector(e);return this.select((function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)}))}function remove(){var t=this.parentNode;t&&t.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function selection_cloneDeep(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function selection_clone(t){return this.select(t?selection_cloneDeep:selection_cloneShallow)}function selection_datum(t){return arguments.length?this.property("__data__",t):this.node().__data__}function contextListener(t){return function(e){t.call(this,e,this.__data__)}}function parseTypenames$1(t){return t.trim().split(/^|\s+/).map((function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}}))}function onRemove(t){return function(){var e=this.__on;if(e){for(var r,i=0,n=-1,s=e.length;i<s;++i)r=e[i],t.type&&r.type!==t.type||r.name!==t.name?e[++n]=r:this.removeEventListener(r.type,r.listener,r.options);++n?e.length=n:delete this.__on}}}function onAdd(t,e,r){return function(){var i,n=this.__on,s=contextListener(e);if(n)for(var a=0,o=n.length;a<o;++a)if((i=n[a]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=r),void(i.value=e);this.addEventListener(t.type,s,r),i={type:t.type,name:t.name,value:e,listener:s,options:r},n?n.push(i):this.__on=[i]}}function selection_on(t,e,r){var i,n,s=parseTypenames$1(t+""),a=s.length;if(!(arguments.length<2)){for(o=e?onAdd:onRemove,i=0;i<a;++i)this.each(o(s[i],e,r));return this}var o=this.node().__on;if(o)for(var h,l=0,u=o.length;l<u;++l)for(i=0,h=o[l];i<a;++i)if((n=s[i]).type===h.type&&n.name===h.name)return h.value}function dispatchEvent(t,e,r){var i=defaultView(t),n=i.CustomEvent;"function"==typeof n?n=new n(e,r):(n=i.document.createEvent("Event"),r?(n.initEvent(e,r.bubbles,r.cancelable),n.detail=r.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function dispatchConstant(t,e){return function(){return dispatchEvent(this,t,e)}}function dispatchFunction(t,e){return function(){return dispatchEvent(this,t,e.apply(this,arguments))}}function selection_dispatch(t,e){return this.each(("function"==typeof e?dispatchFunction:dispatchConstant)(t,e))}function*selection_iterator(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i,n=t[e],s=0,a=n.length;s<a;++s)(i=n[s])&&(yield i)}EnterNode.prototype={constructor:EnterNode,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},ClassList.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var root=[null];function Selection(t,e){this._groups=t,this._parents=e}function selection(){return new Selection([[document.documentElement]],root)}function selection_selection(){return this}function select(t){return"string"==typeof t?new Selection([[document.querySelector(t)]],[document.documentElement]):new Selection([[t]],root)}function define(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function extend(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function Color(){}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,selectChild:selection_selectChild,selectChildren:selection_selectChildren,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,selection:selection_selection,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch,[Symbol.iterator]:selection_iterator};var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=reHex.exec(t))?(r=e[1].length,e=parseInt(e[1],16),6===r?rgbn(e):3===r?new Rgb(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===r?rgba(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===r?rgba(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=reRgbInteger.exec(t))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(t))?new Rgb(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=reRgbaInteger.exec(t))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(t))?rgba(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=reHslPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(t)?rgbn(named[t]):"transparent"===t?new Rgb(NaN,NaN,NaN,0):null}function rgbn(t){return new Rgb(t>>16&255,t>>8&255,255&t,1)}function rgba(t,e,r,i){return i<=0&&(t=e=r=NaN),new Rgb(t,e,r,i)}function rgbConvert(t){return t instanceof Color||(t=color(t)),t?new Rgb((t=t.rgb()).r,t.g,t.b,t.opacity):new Rgb}function rgb(t,e,r,i){return 1===arguments.length?rgbConvert(t):new Rgb(t,e,r,null==i?1:i)}function Rgb(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function hex(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function hsla(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Hsl(t,e,r,i)}function hslConvert(t){if(t instanceof Hsl)return new Hsl(t.h,t.s,t.l,t.opacity);if(t instanceof Color||(t=color(t)),!t)return new Hsl;if(t instanceof Hsl)return t;var e=(t=t.rgb()).r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),s=Math.max(e,r,i),a=NaN,o=s-n,h=(s+n)/2;return o?(a=e===s?(r-i)/o+6*(r<i):r===s?(i-e)/o+2:(e-r)/o+4,o/=h<.5?s+n:2-s-n,a*=60):o=h>0&&h<1?0:a,new Hsl(a,o,h,t.opacity)}function hsl(t,e,r,i){return 1===arguments.length?hslConvert(t):new Hsl(t,e,r,null==i?1:i)}function Hsl(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}function hsl2rgb(t,e,r){return 255*(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)}define(Color,color,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new Rgb(hsl2rgb(t>=240?t-240:t+120,n,i),hsl2rgb(t,n,i),hsl2rgb(t<120?t+240:t-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(t){if(t instanceof Cubehelix)return new Cubehelix(t.h,t.s,t.l,t.opacity);t instanceof Rgb||(t=rgbConvert(t));var e=t.r/255,r=t.g/255,i=t.b/255,n=(BC_DA*i+ED*e-EB*r)/(BC_DA+ED-EB),s=i-n,a=(E*(r-n)-C*s)/D,o=Math.sqrt(a*a+s*s)/(E*n*(1-n)),h=o?Math.atan2(a,s)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,o,n,t.opacity)}function cubehelix(t,e,r,i){return 1===arguments.length?cubehelixConvert(t):new Cubehelix(t,e,r,null==i?1:i)}function Cubehelix(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}function basis(t,e,r,i,n){var s=t*t,a=s*t;return((1-3*t+3*s-a)*e+(4-6*s+3*a)*r+(1+3*t+3*s-3*a)*i+a*n)/6}function basis$1(t){var e=t.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),n=t[i],s=t[i+1],a=i>0?t[i-1]:2*n-s,o=i<e-1?t[i+2]:2*s-n;return basis((r-i/e)*e,a,n,s,o)}}function constant$2(t){return function(){return t}}function linear(t,e){return function(r){return t+r*e}}function exponential(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function hue(t,e){var r=e-t;return r?linear(t,r>180||r<-180?r-360*Math.round(r/360):r):constant$2(isNaN(t)?e:t)}function gamma(t){return 1==(t=+t)?nogamma:function(e,r){return r-e?exponential(e,r,t):constant$2(isNaN(e)?r:e)}}function nogamma(t,e){var r=e-t;return r?linear(t,r):constant$2(isNaN(t)?e:t)}define(Cubehelix,cubehelix,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Cubehelix(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Cubehelix(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*deg2rad,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),n=Math.sin(t);return new Rgb(255*(e+r*(A*i+B*n)),255*(e+r*(C*i+D*n)),255*(e+r*(E*i)),this.opacity)}}));var interpolateRgb=function t(e){var r=gamma(e);function i(t,e){var i=r((t=rgb(t)).r,(e=rgb(e)).r),n=r(t.g,e.g),s=r(t.b,e.b),a=nogamma(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=n(e),t.b=s(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);function rgbSpline(t){return function(e){var r,i,n=e.length,s=new Array(n),a=new Array(n),o=new Array(n);for(r=0;r<n;++r)i=rgb(e[r]),s[r]=i.r||0,a[r]=i.g||0,o[r]=i.b||0;return s=t(s),a=t(a),o=t(o),i.opacity=1,function(t){return i.r=s(t),i.g=a(t),i.b=o(t),i+""}}}var rgbBasis=rgbSpline(basis$1);function numberArray(t,e){e||(e=[]);var r,i=t?Math.min(e.length,t.length):0,n=e.slice();return function(s){for(r=0;r<i;++r)n[r]=t[r]*(1-s)+e[r]*s;return n}}function isNumberArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function genericArray(t,e){var r,i=e?e.length:0,n=t?Math.min(i,t.length):0,s=new Array(n),a=new Array(i);for(r=0;r<n;++r)s[r]=interpolate(t[r],e[r]);for(;r<i;++r)a[r]=e[r];return function(t){for(r=0;r<n;++r)a[r]=s[r](t);return a}}function date(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function interpolateNumber(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function object(t,e){var r,i={},n={};for(r in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)r in t?i[r]=interpolate(t[r],e[r]):n[r]=e[r];return function(t){for(r in i)n[r]=i[r](t);return n}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(t){return function(){return t}}function one(t){return function(e){return t(e)+""}}function interpolateString(t,e){var r,i,n,s=reA.lastIndex=reB.lastIndex=0,a=-1,o=[],h=[];for(t+="",e+="";(r=reA.exec(t))&&(i=reB.exec(e));)(n=i.index)>s&&(n=e.slice(s,n),o[a]?o[a]+=n:o[++a]=n),(r=r[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,h.push({i:a,x:interpolateNumber(r,i)})),s=reB.lastIndex;return s<e.length&&(n=e.slice(s),o[a]?o[a]+=n:o[++a]=n),o.length<2?h[0]?one(h[0].x):zero(e):(e=h.length,function(t){for(var r,i=0;i<e;++i)o[(r=h[i]).i]=r.x(t);return o.join("")})}function interpolate(t,e){var r,i=typeof e;return null==e||"boolean"===i?constant$2(e):("number"===i?interpolateNumber:"string"===i?(r=color(e))?(e=r,interpolateRgb):interpolateString:e instanceof color?interpolateRgb:e instanceof Date?date:isNumberArray(e)?numberArray:Array.isArray(e)?genericArray:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?object:interpolateNumber)(t,e)}function interpolateRound(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}var degrees=180/Math.PI,identity$1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},cssNode,cssRoot,cssView,svgNode;function decompose(t,e,r,i,n,s){var a,o,h;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(h=t*r+e*i)&&(r-=t*h,i-=e*h),(o=Math.sqrt(r*r+i*i))&&(r/=o,i/=o,h/=o),t*i<e*r&&(t=-t,e=-e,h=-h,a=-a),{translateX:n,translateY:s,rotate:Math.atan2(e,t)*degrees,skewX:Math.atan(h)*degrees,scaleX:a,scaleY:o}}function parseCss(t){return"none"===t?identity$1:(cssNode||(cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView),cssNode.style.transform=t,t=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform"),cssRoot.removeChild(cssNode),decompose(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function parseSvg(t){return null==t?identity$1:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",t),(t=svgNode.transform.baseVal.consolidate())?decompose((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):identity$1)}function interpolateTransform(t,e,r,i){function n(t){return t.length?t.pop()+" ":""}return function(s,a){var o=[],h=[];return s=t(s),a=t(a),function(t,i,n,s,a,o){if(t!==n||i!==s){var h=a.push("translate(",null,e,null,r);o.push({i:h-4,x:interpolateNumber(t,n)},{i:h-2,x:interpolateNumber(i,s)})}else(n||s)&&a.push("translate("+n+e+s+r)}(s.translateX,s.translateY,a.translateX,a.translateY,o,h),function(t,e,r,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:r.push(n(r)+"rotate(",null,i)-2,x:interpolateNumber(t,e)})):e&&r.push(n(r)+"rotate("+e+i)}(s.rotate,a.rotate,o,h),function(t,e,r,s){t!==e?s.push({i:r.push(n(r)+"skewX(",null,i)-2,x:interpolateNumber(t,e)}):e&&r.push(n(r)+"skewX("+e+i)}(s.skewX,a.skewX,o,h),function(t,e,r,i,s,a){if(t!==r||e!==i){var o=s.push(n(s)+"scale(",null,",",null,")");a.push({i:o-4,x:interpolateNumber(t,r)},{i:o-2,x:interpolateNumber(e,i)})}else 1===r&&1===i||s.push(n(s)+"scale("+r+","+i+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,h),s=a=null,function(t){for(var e,r=-1,i=h.length;++r<i;)o[(e=h[r]).i]=e.x(t);return o.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");function cubehelix$1(t){return function e(r){function i(e,i){var n=t((e=cubehelix(e)).h,(i=cubehelix(i)).h),s=nogamma(e.s,i.s),a=nogamma(e.l,i.l),o=nogamma(e.opacity,i.opacity);return function(t){return e.h=n(t),e.s=s(t),e.l=a(Math.pow(t,r)),e.opacity=o(t),e+""}}return r=+r,i.gamma=e,i}(1)}cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma),frame=0,timeout=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(t,e,r){var i=new Timer;return i.restart(t,e,r),i}function timerFlush(){now(),++frame;for(var t,e=taskHead;e;)(t=clockNow-e._time)>=0&&e._call.call(null,t),e=e._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var t=clock.now(),e=t-clockLast;e>pokeDelay&&(clockSkew-=e,clockLast=t)}function nap(){for(var t,e,r=taskHead,i=1/0;r;)r._call?(i>r._time&&(i=r._time),t=r,r=r._next):(e=r._next,r._next=null,r=t?t._next=e:taskHead=e);taskTail=t,sleep(i)}function sleep(t){frame||(timeout&&(timeout=clearTimeout(timeout)),t-clockNow>24?(t<1/0&&(timeout=setTimeout(wake,t-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake)))}function timeout$1(t,e,r){var i=new Timer;return e=null==e?0:+e,i.restart((r=>{i.stop(),t(r+e)}),e,r),i}Timer.prototype=timer.prototype={constructor:Timer,restart:function(t,e,r){if("function"!=typeof t)throw new TypeError("callback is not a function");r=(null==r?now():+r)+(null==e?0:+e),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=t,this._time=r,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(t,e,r,i,n,s){var a=t.__transition;if(a){if(r in a)return}else t.__transition={};create(t,r,{name:e,index:i,group:n,on:emptyOn,tween:emptyTween,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:CREATED})}function init(t,e){var r=get$1(t,e);if(r.state>CREATED)throw new Error("too late; already scheduled");return r}function set$1(t,e){var r=get$1(t,e);if(r.state>STARTED)throw new Error("too late; already running");return r}function get$1(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function create(t,e,r){var i,n=t.__transition;function s(h){var l,u,c,d;if(r.state!==SCHEDULED)return o();for(l in n)if((d=n[l]).name===r.name){if(d.state===STARTED)return timeout$1(s);d.state===RUNNING?(d.state=ENDED,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete n[l]):+l<e&&(d.state=ENDED,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete n[l])}if(timeout$1((function(){r.state===STARTED&&(r.state=RUNNING,r.timer.restart(a,r.delay,r.time),a(h))})),r.state=STARTING,r.on.call("start",t,t.__data__,r.index,r.group),r.state===STARTING){for(r.state=STARTED,i=new Array(c=r.tween.length),l=0,u=-1;l<c;++l)(d=r.tween[l].value.call(t,t.__data__,r.index,r.group))&&(i[++u]=d);i.length=u+1}}function a(e){for(var n=e<r.duration?r.ease.call(null,e/r.duration):(r.timer.restart(o),r.state=ENDING,1),s=-1,a=i.length;++s<a;)i[s].call(t,n);r.state===ENDING&&(r.on.call("end",t,t.__data__,r.index,r.group),o())}function o(){for(var i in r.state=ENDED,r.timer.stop(),delete n[e],n)return;delete t.__transition}n[e]=r,r.timer=timer((function(t){r.state=SCHEDULED,r.timer.restart(s,r.delay,r.time),r.delay<=t&&s(t-r.delay)}),0,r.time)}function interrupt(t,e){var r,i,n,s=t.__transition,a=!0;if(s){for(n in e=null==e?null:e+"",s)(r=s[n]).name===e?(i=r.state>STARTING&&r.state<ENDING,r.state=ENDED,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete s[n]):a=!1;a&&delete t.__transition}}function selection_interrupt(t){return this.each((function(){interrupt(this,t)}))}function tweenRemove(t,e){var r,i;return function(){var n=set$1(this,t),s=n.tween;if(s!==r)for(var a=0,o=(i=r=s).length;a<o;++a)if(i[a].name===e){(i=i.slice()).splice(a,1);break}n.tween=i}}function tweenFunction(t,e,r){var i,n;if("function"!=typeof r)throw new Error;return function(){var s=set$1(this,t),a=s.tween;if(a!==i){n=(i=a).slice();for(var o={name:e,value:r},h=0,l=n.length;h<l;++h)if(n[h].name===e){n[h]=o;break}h===l&&n.push(o)}s.tween=n}}function transition_tween(t,e){var r=this._id;if(t+="",arguments.length<2){for(var i,n=get$1(this.node(),r).tween,s=0,a=n.length;s<a;++s)if((i=n[s]).name===t)return i.value;return null}return this.each((null==e?tweenRemove:tweenFunction)(r,t,e))}function tweenValue(t,e,r){var i=t._id;return t.each((function(){var t=set$1(this,i);(t.value||(t.value={}))[e]=r.apply(this,arguments)})),function(t){return get$1(t,i).value[e]}}function interpolate$1(t,e){var r;return("number"==typeof e?interpolateNumber:e instanceof color?interpolateRgb:(r=color(e))?(e=r,interpolateRgb):interpolateString)(t,e)}function attrRemove$1(t){return function(){this.removeAttribute(t)}}function attrRemoveNS$1(t){return function(){this.removeAttributeNS(t.space,t.local)}}function attrConstant$1(t,e,r){var i,n,s=r+"";return function(){var a=this.getAttribute(t);return a===s?null:a===i?n:n=e(i=a,r)}}function attrConstantNS$1(t,e,r){var i,n,s=r+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===s?null:a===i?n:n=e(i=a,r)}}function attrFunction$1(t,e,r){var i,n,s;return function(){var a,o,h=r(this);if(null!=h)return(a=this.getAttribute(t))===(o=h+"")?null:a===i&&o===n?s:(n=o,s=e(i=a,h));this.removeAttribute(t)}}function attrFunctionNS$1(t,e,r){var i,n,s;return function(){var a,o,h=r(this);if(null!=h)return(a=this.getAttributeNS(t.space,t.local))===(o=h+"")?null:a===i&&o===n?s:(n=o,s=e(i=a,h));this.removeAttributeNS(t.space,t.local)}}function transition_attr(t,e){var r=namespace(t),i="transform"===r?interpolateTransformSvg:interpolate$1;return this.attrTween(t,"function"==typeof e?(r.local?attrFunctionNS$1:attrFunction$1)(r,i,tweenValue(this,"attr."+t,e)):null==e?(r.local?attrRemoveNS$1:attrRemove$1)(r):(r.local?attrConstantNS$1:attrConstant$1)(r,i,e))}function attrInterpolate(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function attrInterpolateNS(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function attrTweenNS(t,e){var r,i;function n(){var n=e.apply(this,arguments);return n!==i&&(r=(i=n)&&attrInterpolateNS(t,n)),r}return n._value=e,n}function attrTween(t,e){var r,i;function n(){var n=e.apply(this,arguments);return n!==i&&(r=(i=n)&&attrInterpolate(t,n)),r}return n._value=e,n}function transition_attrTween(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;var i=namespace(t);return this.tween(r,(i.local?attrTweenNS:attrTween)(i,e))}function delayFunction(t,e){return function(){init(this,t).delay=+e.apply(this,arguments)}}function delayConstant(t,e){return e=+e,function(){init(this,t).delay=e}}function transition_delay(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?delayFunction:delayConstant)(e,t)):get$1(this.node(),e).delay}function durationFunction(t,e){return function(){set$1(this,t).duration=+e.apply(this,arguments)}}function durationConstant(t,e){return e=+e,function(){set$1(this,t).duration=e}}function transition_duration(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?durationFunction:durationConstant)(e,t)):get$1(this.node(),e).duration}function easeConstant(t,e){if("function"!=typeof e)throw new Error;return function(){set$1(this,t).ease=e}}function transition_ease(t){var e=this._id;return arguments.length?this.each(easeConstant(e,t)):get$1(this.node(),e).ease}function easeVarying(t,e){return function(){var r=e.apply(this,arguments);if("function"!=typeof r)throw new Error;set$1(this,t).ease=r}}function transition_easeVarying(t){if("function"!=typeof t)throw new Error;return this.each(easeVarying(this._id,t))}function transition_filter(t){"function"!=typeof t&&(t=matcher(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s,a=e[n],o=a.length,h=i[n]=[],l=0;l<o;++l)(s=a[l])&&t.call(s,s.__data__,l,a)&&h.push(s);return new Transition(i,this._parents,this._name,this._id)}function transition_merge(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,i=e.length,n=r.length,s=Math.min(i,n),a=new Array(i),o=0;o<s;++o)for(var h,l=e[o],u=r[o],c=l.length,d=a[o]=new Array(c),f=0;f<c;++f)(h=l[f]||u[f])&&(d[f]=h);for(;o<i;++o)a[o]=e[o];return new Transition(a,this._parents,this._name,this._id)}function start(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}function onFunction(t,e,r){var i,n,s=start(e)?init:set$1;return function(){var a=s(this,t),o=a.on;o!==i&&(n=(i=o).copy()).on(e,r),a.on=n}}function transition_on(t,e){var r=this._id;return arguments.length<2?get$1(this.node(),r).on.on(t):this.each(onFunction(r,t,e))}function removeFunction(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(t){var e=this._name,r=this._id;"function"!=typeof t&&(t=selector(t));for(var i=this._groups,n=i.length,s=new Array(n),a=0;a<n;++a)for(var o,h,l=i[a],u=l.length,c=s[a]=new Array(u),d=0;d<u;++d)(o=l[d])&&(h=t.call(o,o.__data__,d,l))&&("__data__"in o&&(h.__data__=o.__data__),c[d]=h,schedule(c[d],e,r,d,c,get$1(o,r)));return new Transition(s,this._parents,e,r)}function transition_selectAll(t){var e=this._name,r=this._id;"function"!=typeof t&&(t=selectorAll(t));for(var i=this._groups,n=i.length,s=[],a=[],o=0;o<n;++o)for(var h,l=i[o],u=l.length,c=0;c<u;++c)if(h=l[c]){for(var d,f=t.call(h,h.__data__,c,l),p=get$1(h,r),_=0,g=f.length;_<g;++_)(d=f[_])&&schedule(d,e,r,_,f,p);s.push(f),a.push(h)}return new Transition(s,a,e,r)}var Selection$1=selection.prototype.constructor;function transition_selection(){return new Selection$1(this._groups,this._parents)}function styleNull(t,e){var r,i,n;return function(){var s=styleValue(this,t),a=(this.style.removeProperty(t),styleValue(this,t));return s===a?null:s===r&&a===i?n:n=e(r=s,i=a)}}function styleRemove$1(t){return function(){this.style.removeProperty(t)}}function styleConstant$1(t,e,r){var i,n,s=r+"";return function(){var a=styleValue(this,t);return a===s?null:a===i?n:n=e(i=a,r)}}function styleFunction$1(t,e,r){var i,n,s;return function(){var a=styleValue(this,t),o=r(this),h=o+"";return null==o&&(this.style.removeProperty(t),h=o=styleValue(this,t)),a===h?null:a===i&&h===n?s:(n=h,s=e(i=a,o))}}function styleMaybeRemove(t,e){var r,i,n,s,a="style."+e,o="end."+a;return function(){var h=set$1(this,t),l=h.on,u=null==h.value[a]?s||(s=styleRemove$1(e)):void 0;l===r&&n===u||(i=(r=l).copy()).on(o,n=u),h.on=i}}function transition_style(t,e,r){var i="transform"==(t+="")?interpolateTransformCss:interpolate$1;return null==e?this.styleTween(t,styleNull(t,i)).on("end.style."+t,styleRemove$1(t)):"function"==typeof e?this.styleTween(t,styleFunction$1(t,i,tweenValue(this,"style."+t,e))).each(styleMaybeRemove(this._id,t)):this.styleTween(t,styleConstant$1(t,i,e),r).on("end.style."+t,null)}function styleInterpolate(t,e,r){return function(i){this.style.setProperty(t,e.call(this,i),r)}}function styleTween(t,e,r){var i,n;function s(){var s=e.apply(this,arguments);return s!==n&&(i=(n=s)&&styleInterpolate(t,s,r)),i}return s._value=e,s}function transition_styleTween(t,e,r){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,styleTween(t,e,null==r?"":r))}function textConstant$1(t){return function(){this.textContent=t}}function textFunction$1(t){return function(){var e=t(this);this.textContent=null==e?"":e}}function transition_text(t){return this.tween("text","function"==typeof t?textFunction$1(tweenValue(this,"text",t)):textConstant$1(null==t?"":t+""))}function textInterpolate(t){return function(e){this.textContent=t.call(this,e)}}function textTween(t){var e,r;function i(){var i=t.apply(this,arguments);return i!==r&&(e=(r=i)&&textInterpolate(i)),e}return i._value=t,i}function transition_textTween(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,textTween(t))}function transition_transition(){for(var t=this._name,e=this._id,r=newId(),i=this._groups,n=i.length,s=0;s<n;++s)for(var a,o=i[s],h=o.length,l=0;l<h;++l)if(a=o[l]){var u=get$1(a,e);schedule(a,t,r,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Transition(i,this._parents,t,r)}function transition_end(){var t,e,r=this,i=r._id,n=r.size();return new Promise((function(s,a){var o={value:a},h={value:function(){0==--n&&s()}};r.each((function(){var r=set$1(this,i),n=r.on;n!==t&&((e=(t=n).copy())._.cancel.push(o),e._.interrupt.push(o),e._.end.push(h)),r.on=e})),0===n&&s()}))}var id=0;function Transition(t,e,r,i){this._groups=t,this._parents=e,this._name=r,this._id=i}function transition(t){return selection().transition(t)}function newId(){return++id}var selection_prototype=selection.prototype;function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}Transition.prototype=transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,easeVarying:transition_easeVarying,end:transition_end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function selection_transition(t){var e,r;t instanceof Transition?(e=t._id,t=t._name):(e=newId(),(r=defaultTiming).time=now(),t=null==t?null:t+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var a,o=i[s],h=o.length,l=0;l<h;++l)(a=o[l])&&schedule(a,t,e,l,o,r||inherit(a,e));return new Transition(i,this._parents,t,e)}selection.prototype.interrupt=selection_interrupt,selection.prototype.transition=selection_transition;const pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}function define$1(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function extend$1(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function Color$1(){}Path.prototype=path.prototype={constructor:Path,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,r,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+r)+","+(this._y1=+i)},bezierCurveTo:function(t,e,r,i,n,s){this._+="C"+ +t+","+ +e+","+ +r+","+ +i+","+(this._x1=+n)+","+(this._y1=+s)},arcTo:function(t,e,r,i,n){t=+t,e=+e,r=+r,i=+i,n=+n;var s=this._x1,a=this._y1,o=r-t,h=i-e,l=s-t,u=a-e,c=l*l+u*u;if(n<0)throw new Error("negative radius: "+n);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>epsilon)if(Math.abs(u*o-h*l)>epsilon&&n){var d=r-s,f=i-a,p=o*o+h*h,_=d*d+f*f,g=Math.sqrt(p),m=Math.sqrt(c),y=n*Math.tan((pi-Math.acos((p+c-_)/(2*g*m)))/2),v=y/m,b=y/g;Math.abs(v-1)>epsilon&&(this._+="L"+(t+v*l)+","+(e+v*u)),this._+="A"+n+","+n+",0,0,"+ +(u*d>l*f)+","+(this._x1=t+b*o)+","+(this._y1=e+b*h)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,r,i,n,s){t=+t,e=+e,s=!!s;var a=(r=+r)*Math.cos(i),o=r*Math.sin(i),h=t+a,l=e+o,u=1^s,c=s?i-n:n-i;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+h+","+l:(Math.abs(this._x1-h)>epsilon||Math.abs(this._y1-l)>epsilon)&&(this._+="L"+h+","+l),r&&(c<0&&(c=c%tau+tau),c>tauEpsilon?this._+="A"+r+","+r+",0,1,"+u+","+(t-a)+","+(e-o)+"A"+r+","+r+",0,1,"+u+","+(this._x1=h)+","+(this._y1=l):c>epsilon&&(this._+="A"+r+","+r+",0,"+ +(c>=pi)+","+u+","+(this._x1=t+r*Math.cos(n))+","+(this._y1=e+r*Math.sin(n))))},rect:function(t,e,r,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +r+"v"+ +i+"h"+-r+"Z"},toString:function(){return this._}};var darker$1=.7,brighter$1=1/darker$1,reI$1="\\s*([+-]?\\d+)\\s*",reN$1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP$1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex$1=/^#([0-9a-f]{3,8})$/,reRgbInteger$1=new RegExp("^rgb\\("+[reI$1,reI$1,reI$1]+"\\)$"),reRgbPercent$1=new RegExp("^rgb\\("+[reP$1,reP$1,reP$1]+"\\)$"),reRgbaInteger$1=new RegExp("^rgba\\("+[reI$1,reI$1,reI$1,reN$1]+"\\)$"),reRgbaPercent$1=new RegExp("^rgba\\("+[reP$1,reP$1,reP$1,reN$1]+"\\)$"),reHslPercent$1=new RegExp("^hsl\\("+[reN$1,reP$1,reP$1]+"\\)$"),reHslaPercent$1=new RegExp("^hsla\\("+[reN$1,reP$1,reP$1,reN$1]+"\\)$"),named$1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex$1(){return this.rgb().formatHex()}function color_formatHsl$1(){return hslConvert$1(this).formatHsl()}function color_formatRgb$1(){return this.rgb().formatRgb()}function color$1(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=reHex$1.exec(t))?(r=e[1].length,e=parseInt(e[1],16),6===r?rgbn$1(e):3===r?new Rgb$1(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===r?rgba$1(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===r?rgba$1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=reRgbInteger$1.exec(t))?new Rgb$1(e[1],e[2],e[3],1):(e=reRgbPercent$1.exec(t))?new Rgb$1(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=reRgbaInteger$1.exec(t))?rgba$1(e[1],e[2],e[3],e[4]):(e=reRgbaPercent$1.exec(t))?rgba$1(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=reHslPercent$1.exec(t))?hsla$1(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent$1.exec(t))?hsla$1(e[1],e[2]/100,e[3]/100,e[4]):named$1.hasOwnProperty(t)?rgbn$1(named$1[t]):"transparent"===t?new Rgb$1(NaN,NaN,NaN,0):null}function rgbn$1(t){return new Rgb$1(t>>16&255,t>>8&255,255&t,1)}function rgba$1(t,e,r,i){return i<=0&&(t=e=r=NaN),new Rgb$1(t,e,r,i)}function rgbConvert$1(t){return t instanceof Color$1||(t=color$1(t)),t?new Rgb$1((t=t.rgb()).r,t.g,t.b,t.opacity):new Rgb$1}function rgb$1(t,e,r,i){return 1===arguments.length?rgbConvert$1(t):new Rgb$1(t,e,r,null==i?1:i)}function Rgb$1(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}function rgb_formatHex$1(){return"#"+hex$1(this.r)+hex$1(this.g)+hex$1(this.b)}function rgb_formatRgb$1(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function hex$1(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function hsla$1(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Hsl$1(t,e,r,i)}function hslConvert$1(t){if(t instanceof Hsl$1)return new Hsl$1(t.h,t.s,t.l,t.opacity);if(t instanceof Color$1||(t=color$1(t)),!t)return new Hsl$1;if(t instanceof Hsl$1)return t;var e=(t=t.rgb()).r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),s=Math.max(e,r,i),a=NaN,o=s-n,h=(s+n)/2;return o?(a=e===s?(r-i)/o+6*(r<i):r===s?(i-e)/o+2:(e-r)/o+4,o/=h<.5?s+n:2-s-n,a*=60):o=h>0&&h<1?0:a,new Hsl$1(a,o,h,t.opacity)}function hsl$1(t,e,r,i){return 1===arguments.length?hslConvert$1(t):new Hsl$1(t,e,r,null==i?1:i)}function Hsl$1(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}function hsl2rgb$1(t,e,r){return 255*(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)}define$1(Color$1,color$1,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex$1,formatHex:color_formatHex$1,formatHsl:color_formatHsl$1,formatRgb:color_formatRgb$1,toString:color_formatRgb$1}),define$1(Rgb$1,rgb$1,extend$1(Color$1,{brighter:function(t){return t=null==t?brighter$1:Math.pow(brighter$1,t),new Rgb$1(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?darker$1:Math.pow(darker$1,t),new Rgb$1(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex$1,formatHex:rgb_formatHex$1,formatRgb:rgb_formatRgb$1,toString:rgb_formatRgb$1})),define$1(Hsl$1,hsl$1,extend$1(Color$1,{brighter:function(t){return t=null==t?brighter$1:Math.pow(brighter$1,t),new Hsl$1(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?darker$1:Math.pow(darker$1,t),new Hsl$1(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new Rgb$1(hsl2rgb$1(t>=240?t-240:t+120,n,i),hsl2rgb$1(t,n,i),hsl2rgb$1(t<120?t+240:t-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function customConverter(t,e){var r=objectConverter(t);return function(i,n){return e(r(i),n,t)}}function inferColumns(t){var e=Object.create(null),r=[];return t.forEach((function(t){for(var i in t)i in e||r.push(e[i]=i)})),r}function pad(t,e){var r=t+"",i=r.length;return i<e?new Array(e-i+1).join(0)+r:r}function formatYear(t){return t<0?"-"+pad(-t,6):t>9999?"+"+pad(t,6):pad(t,4)}function formatDate(t){var e=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),n=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":formatYear(t.getUTCFullYear())+"-"+pad(t.getUTCMonth()+1,2)+"-"+pad(t.getUTCDate(),2)+(n?"T"+pad(e,2)+":"+pad(r,2)+":"+pad(i,2)+"."+pad(n,3)+"Z":i?"T"+pad(e,2)+":"+pad(r,2)+":"+pad(i,2)+"Z":r||e?"T"+pad(e,2)+":"+pad(r,2)+"Z":"")}function dsvFormat(t){var e=new RegExp('["'+t+"\n\r]"),r=t.charCodeAt(0);function i(t,e){var i,n=[],s=t.length,a=0,o=0,h=s<=0,l=!1;function u(){if(h)return EOF;if(l)return l=!1,EOL;var e,i,n=a;if(t.charCodeAt(n)===QUOTE){for(;a++<s&&t.charCodeAt(a)!==QUOTE||t.charCodeAt(++a)===QUOTE;);return(e=a)>=s?h=!0:(i=t.charCodeAt(a++))===NEWLINE?l=!0:i===RETURN&&(l=!0,t.charCodeAt(a)===NEWLINE&&++a),t.slice(n+1,e-1).replace(/""/g,'"')}for(;a<s;){if((i=t.charCodeAt(e=a++))===NEWLINE)l=!0;else if(i===RETURN)l=!0,t.charCodeAt(a)===NEWLINE&&++a;else if(i!==r)continue;return t.slice(n,e)}return h=!0,t.slice(n,s)}for(t.charCodeAt(s-1)===NEWLINE&&--s,t.charCodeAt(s-1)===RETURN&&--s;(i=u())!==EOF;){for(var c=[];i!==EOL&&i!==EOF;)c.push(i),i=u();e&&null==(c=e(c,o++))||n.push(c)}return n}function n(e,r){return e.map((function(e){return r.map((function(t){return a(e[t])})).join(t)}))}function s(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?formatDate(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var r,n,s=i(t,(function(t,i){if(r)return r(t,i-1);n=t,r=e?customConverter(t,e):objectConverter(t)}));return s.columns=n||[],s},parseRows:i,format:function(e,r){return null==r&&(r=inferColumns(e)),[r.map(a).join(t)].concat(n(e,r)).join("\n")},formatBody:function(t,e){return null==e&&(e=inferColumns(t)),n(t,e).join("\n")},formatRows:function(t){return t.map(s).join("\n")},formatRow:s,formatValue:a}}var csv=dsvFormat(","),csvParse=csv.parse;function autoType(t){for(var e in t){var r,i,n=t[e].trim();if(n)if("true"===n)n=!0;else if("false"===n)n=!1;else if("NaN"===n)n=NaN;else if(isNaN(r=+n)){if(!(i=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;fixtz&&i[4]&&!i[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n)}else n=r;else n=null;t[e]=n}return t}const fixtz=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function center(t,e){var r,i=1;function n(){var n,s,a=r.length,o=0,h=0;for(n=0;n<a;++n)o+=(s=r[n]).x,h+=s.y;for(o=(o/a-t)*i,h=(h/a-e)*i,n=0;n<a;++n)(s=r[n]).x-=o,s.y-=h}return null==t&&(t=0),null==e&&(e=0),n.initialize=function(t){r=t},n.x=function(e){return arguments.length?(t=+e,n):t},n.y=function(t){return arguments.length?(e=+t,n):e},n.strength=function(t){return arguments.length?(i=+t,n):i},n}function tree_add(t){const e=+this._x.call(null,t),r=+this._y.call(null,t);return add(this.cover(e,r),e,r,t)}function add(t,e,r,i){if(isNaN(e)||isNaN(r))return t;var n,s,a,o,h,l,u,c,d,f=t._root,p={data:i},_=t._x0,g=t._y0,m=t._x1,y=t._y1;if(!f)return t._root=p,t;for(;f.length;)if((l=e>=(s=(_+m)/2))?_=s:m=s,(u=r>=(a=(g+y)/2))?g=a:y=a,n=f,!(f=f[c=u<<1|l]))return n[c]=p,t;if(o=+t._x.call(null,f.data),h=+t._y.call(null,f.data),e===o&&r===h)return p.next=f,n?n[c]=p:t._root=p,t;do{n=n?n[c]=new Array(4):t._root=new Array(4),(l=e>=(s=(_+m)/2))?_=s:m=s,(u=r>=(a=(g+y)/2))?g=a:y=a}while((c=u<<1|l)==(d=(h>=a)<<1|o>=s));return n[d]=f,n[c]=p,t}function addAll(t){var e,r,i,n,s=t.length,a=new Array(s),o=new Array(s),h=1/0,l=1/0,u=-1/0,c=-1/0;for(r=0;r<s;++r)isNaN(i=+this._x.call(null,e=t[r]))||isNaN(n=+this._y.call(null,e))||(a[r]=i,o[r]=n,i<h&&(h=i),i>u&&(u=i),n<l&&(l=n),n>c&&(c=n));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),r=0;r<s;++r)add(this,a[r],o[r],t[r]);return this}function tree_cover(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var r=this._x0,i=this._y0,n=this._x1,s=this._y1;if(isNaN(r))n=(r=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var a,o,h=n-r||1,l=this._root;r>t||t>=n||i>e||e>=s;)switch(o=(e<i)<<1|t<r,(a=new Array(4))[o]=l,l=a,h*=2,o){case 0:n=r+h,s=i+h;break;case 1:r=n-h,s=i+h;break;case 2:n=r+h,i=s-h;break;case 3:r=n-h,i=s-h}this._root&&this._root.length&&(this._root=l)}return this._x0=r,this._y0=i,this._x1=n,this._y1=s,this}function tree_data(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t}function tree_extent(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Quad(t,e,r,i,n){this.node=t,this.x0=e,this.y0=r,this.x1=i,this.y1=n}function tree_find(t,e,r){var i,n,s,a,o,h,l,u=this._x0,c=this._y0,d=this._x1,f=this._y1,p=[],_=this._root;for(_&&p.push(new Quad(_,u,c,d,f)),null==r?r=1/0:(u=t-r,c=e-r,d=t+r,f=e+r,r*=r);h=p.pop();)if(!(!(_=h.node)||(n=h.x0)>d||(s=h.y0)>f||(a=h.x1)<u||(o=h.y1)<c))if(_.length){var g=(n+a)/2,m=(s+o)/2;p.push(new Quad(_[3],g,m,a,o),new Quad(_[2],n,m,g,o),new Quad(_[1],g,s,a,m),new Quad(_[0],n,s,g,m)),(l=(e>=m)<<1|t>=g)&&(h=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=h)}else{var y=t-+this._x.call(null,_.data),v=e-+this._y.call(null,_.data),b=y*y+v*v;if(b<r){var x=Math.sqrt(r=b);u=t-x,c=e-x,d=t+x,f=e+x,i=_.data}}return i}function tree_remove(t){if(isNaN(s=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,r,i,n,s,a,o,h,l,u,c,d,f=this._root,p=this._x0,_=this._y0,g=this._x1,m=this._y1;if(!f)return this;if(f.length)for(;;){if((l=s>=(o=(p+g)/2))?p=o:g=o,(u=a>=(h=(_+m)/2))?_=h:m=h,e=f,!(f=f[c=u<<1|l]))return this;if(!f.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(r=e,d=c)}for(;f.data!==t;)if(i=f,!(f=f.next))return this;return(n=f.next)&&delete f.next,i?(n?i.next=n:delete i.next,this):e?(n?e[c]=n:delete e[c],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(r?r[d]=f:this._root=f),this):(this._root=n,this)}function removeAll(t){for(var e=0,r=t.length;e<r;++e)this.remove(t[e]);return this}function tree_root(){return this._root}function tree_size(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t}function tree_visit(t){var e,r,i,n,s,a,o=[],h=this._root;for(h&&o.push(new Quad(h,this._x0,this._y0,this._x1,this._y1));e=o.pop();)if(!t(h=e.node,i=e.x0,n=e.y0,s=e.x1,a=e.y1)&&h.length){var l=(i+s)/2,u=(n+a)/2;(r=h[3])&&o.push(new Quad(r,l,u,s,a)),(r=h[2])&&o.push(new Quad(r,i,u,l,a)),(r=h[1])&&o.push(new Quad(r,l,n,s,u)),(r=h[0])&&o.push(new Quad(r,i,n,l,u))}return this}function tree_visitAfter(t){var e,r=[],i=[];for(this._root&&r.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));e=r.pop();){var n=e.node;if(n.length){var s,a=e.x0,o=e.y0,h=e.x1,l=e.y1,u=(a+h)/2,c=(o+l)/2;(s=n[0])&&r.push(new Quad(s,a,o,u,c)),(s=n[1])&&r.push(new Quad(s,u,o,h,c)),(s=n[2])&&r.push(new Quad(s,a,c,u,l)),(s=n[3])&&r.push(new Quad(s,u,c,h,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function defaultX(t){return t[0]}function tree_x(t){return arguments.length?(this._x=t,this):this._x}function defaultY(t){return t[1]}function tree_y(t){return arguments.length?(this._y=t,this):this._y}function quadtree(t,e,r){var i=new Quadtree(null==e?defaultX:e,null==r?defaultY:r,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function Quadtree(t,e,r,i,n,s){this._x=t,this._y=e,this._x0=r,this._y0=i,this._x1=n,this._y1=s,this._root=void 0}function leaf_copy(t){for(var e={data:t.data},r=e;t=t.next;)r=r.next={data:t.data};return e}var treeProto=quadtree.prototype=Quadtree.prototype;function constant$3(t){return function(){return t}}function jiggle(t){return 1e-6*(t()-.5)}function index(t){return t.index}function find$1(t,e){var r=t.get(e);if(!r)throw new Error("node not found: "+e);return r}function link(t){var e,r,i,n,s,a,o=index,h=function(t){return 1/Math.min(n[t.source.index],n[t.target.index])},l=constant$3(30),u=1;function c(i){for(var n=0,o=t.length;n<u;++n)for(var h,l,c,d,f,p,_,g=0;g<o;++g)l=(h=t[g]).source,d=(c=h.target).x+c.vx-l.x-l.vx||jiggle(a),f=c.y+c.vy-l.y-l.vy||jiggle(a),d*=p=((p=Math.sqrt(d*d+f*f))-r[g])/p*i*e[g],f*=p,c.vx-=d*(_=s[g]),c.vy-=f*_,l.vx+=d*(_=1-_),l.vy+=f*_}function d(){if(i){var a,h,l=i.length,u=t.length,c=new Map(i.map(((t,e)=>[o(t,e,i),t])));for(a=0,n=new Array(l);a<u;++a)(h=t[a]).index=a,"object"!=typeof h.source&&(h.source=find$1(c,h.source)),"object"!=typeof h.target&&(h.target=find$1(c,h.target)),n[h.source.index]=(n[h.source.index]||0)+1,n[h.target.index]=(n[h.target.index]||0)+1;for(a=0,s=new Array(u);a<u;++a)h=t[a],s[a]=n[h.source.index]/(n[h.source.index]+n[h.target.index]);e=new Array(u),f(),r=new Array(u),p()}}function f(){if(i)for(var r=0,n=t.length;r<n;++r)e[r]=+h(t[r],r,t)}function p(){if(i)for(var e=0,n=t.length;e<n;++e)r[e]=+l(t[e],e,t)}return null==t&&(t=[]),c.initialize=function(t,e){i=t,a=e,d()},c.links=function(e){return arguments.length?(t=e,d(),c):t},c.id=function(t){return arguments.length?(o=t,c):o},c.iterations=function(t){return arguments.length?(u=+t,c):u},c.strength=function(t){return arguments.length?(h="function"==typeof t?t:constant$3(+t),f(),c):h},c.distance=function(t){return arguments.length?(l="function"==typeof t?t:constant$3(+t),p(),c):l},c}treeProto.copy=function(){var t,e,r=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return r;if(!i.length)return r._root=leaf_copy(i),r;for(t=[{source:i,target:r._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=leaf_copy(e));return r},treeProto.add=tree_add,treeProto.addAll=addAll,treeProto.cover=tree_cover,treeProto.data=tree_data,treeProto.extent=tree_extent,treeProto.find=tree_find,treeProto.remove=tree_remove,treeProto.removeAll=removeAll,treeProto.root=tree_root,treeProto.size=tree_size,treeProto.visit=tree_visit,treeProto.visitAfter=tree_visitAfter,treeProto.x=tree_x,treeProto.y=tree_y;const a=1664525,c=1013904223,m=4294967296;function lcg(){let t=1;return()=>(t=(a*t+c)%m)/m}function x(t){return t.x}function y(t){return t.y}var initialRadius=10,initialAngle=Math.PI*(3-Math.sqrt(5));function simulation(t){var e,r=1,i=.001,n=1-Math.pow(i,1/300),s=0,a=.6,o=new Map,h=timer(c),l=dispatch("tick","end"),u=lcg();function c(){d(),l.call("tick",e),r<i&&(h.stop(),l.call("end",e))}function d(i){var h,l,u=t.length;void 0===i&&(i=1);for(var c=0;c<i;++c)for(r+=(s-r)*n,o.forEach((function(t){t(r)})),h=0;h<u;++h)null==(l=t[h]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return e}function f(){for(var e,r=0,i=t.length;r<i;++r){if((e=t[r]).index=r,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var n=initialRadius*Math.sqrt(.5+r),s=r*initialAngle;e.x=n*Math.cos(s),e.y=n*Math.sin(s)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),f(),e={tick:d,restart:function(){return h.restart(c),e},stop:function(){return h.stop(),e},nodes:function(r){return arguments.length?(t=r,f(),o.forEach(p),e):t},alpha:function(t){return arguments.length?(r=+t,e):r},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(n=+t,e):+n},alphaTarget:function(t){return arguments.length?(s=+t,e):s},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(u=t,o.forEach(p),e):u},force:function(t,r){return arguments.length>1?(null==r?o.delete(t):o.set(t,p(r)),e):o.get(t)},find:function(e,r,i){var n,s,a,o,h,l=0,u=t.length;for(null==i?i=1/0:i*=i,l=0;l<u;++l)(a=(n=e-(o=t[l]).x)*n+(s=r-o.y)*s)<i&&(h=o,i=a);return h},on:function(t,r){return arguments.length>1?(l.on(t,r),e):l.on(t)}}}function manyBody(){var t,e,r,i,n,s=constant$3(-30),a=1,o=1/0,h=.81;function l(r){var n,s=t.length,a=quadtree(t,x,y).visitAfter(c);for(i=r,n=0;n<s;++n)e=t[n],a.visit(d)}function u(){if(t){var e,r,i=t.length;for(n=new Array(i),e=0;e<i;++e)r=t[e],n[r.index]=+s(r,e,t)}}function c(t){var e,r,i,s,a,o=0,h=0;if(t.length){for(i=s=a=0;a<4;++a)(e=t[a])&&(r=Math.abs(e.value))&&(o+=e.value,h+=r,i+=r*e.x,s+=r*e.y);t.x=i/h,t.y=s/h}else{(e=t).x=e.data.x,e.y=e.data.y;do{o+=n[e.data.index]}while(e=e.next)}t.value=o}function d(t,s,l,u){if(!t.value)return!0;var c=t.x-e.x,d=t.y-e.y,f=u-s,p=c*c+d*d;if(f*f/h<p)return p<o&&(0===c&&(p+=(c=jiggle(r))*c),0===d&&(p+=(d=jiggle(r))*d),p<a&&(p=Math.sqrt(a*p)),e.vx+=c*t.value*i/p,e.vy+=d*t.value*i/p),!0;if(!(t.length||p>=o)){(t.data!==e||t.next)&&(0===c&&(p+=(c=jiggle(r))*c),0===d&&(p+=(d=jiggle(r))*d),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(f=n[t.data.index]*i/p,e.vx+=c*f,e.vy+=d*f)}while(t=t.next)}}return l.initialize=function(e,i){t=e,r=i,u()},l.strength=function(t){return arguments.length?(s="function"==typeof t?t:constant$3(+t),u(),l):s},l.distanceMin=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.distanceMax=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.theta=function(t){return arguments.length?(h=t*t,l):Math.sqrt(h)},l}function x$1(t){var e,r,i,n=constant$3(.1);function s(t){for(var n,s=0,a=e.length;s<a;++s)(n=e[s]).vx+=(i[s]-n.x)*r[s]*t}function a(){if(e){var s,a=e.length;for(r=new Array(a),i=new Array(a),s=0;s<a;++s)r[s]=isNaN(i[s]=+t(e[s],s,e))?0:+n(e[s],s,e)}}return"function"!=typeof t&&(t=constant$3(null==t?0:+t)),s.initialize=function(t){e=t,a()},s.strength=function(t){return arguments.length?(n="function"==typeof t?t:constant$3(+t),a(),s):n},s.x=function(e){return arguments.length?(t="function"==typeof e?e:constant$3(+e),a(),s):t},s}function y$1(t){var e,r,i,n=constant$3(.1);function s(t){for(var n,s=0,a=e.length;s<a;++s)(n=e[s]).vy+=(i[s]-n.y)*r[s]*t}function a(){if(e){var s,a=e.length;for(r=new Array(a),i=new Array(a),s=0;s<a;++s)r[s]=isNaN(i[s]=+t(e[s],s,e))?0:+n(e[s],s,e)}}return"function"!=typeof t&&(t=constant$3(null==t?0:+t)),s.initialize=function(t){e=t,a()},s.strength=function(t){return arguments.length?(n="function"==typeof t?t:constant$3(+t),a(),s):n},s.y=function(e){return arguments.length?(t="function"==typeof e?e:constant$3(+e),a(),s):t},s}function formatDecimal(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function formatDecimalParts(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function exponent(t){return(t=formatDecimalParts(Math.abs(t)))?t[1]:NaN}function formatGroup(t,e){return function(r,i){for(var n=r.length,s=[],a=0,o=t[0],h=0;n>0&&o>0&&(h+o+1>i&&(o=Math.max(1,i-h)),s.push(r.substring(n-=o,n+o)),!((h+=o+1)>i));)o=t[a=(a+1)%t.length];return s.reverse().join(e)}}function formatNumerals(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i,prefixExponent;function formatSpecifier(t){if(!(e=re.exec(t)))throw new Error("invalid format: "+t);var e;return new FormatSpecifier({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function FormatSpecifier(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function formatTrim(t){t:for(var e,r=t.length,i=1,n=-1;i<r;++i)switch(t[i]){case".":n=e=i;break;case"0":0===n&&(n=i),e=i;break;default:if(!+t[i])break t;n>0&&(n=0)}return n>0?t.slice(0,n)+t.slice(e+1):t}function formatPrefixAuto(t,e){var r=formatDecimalParts(t,e);if(!r)return t+"";var i=r[0],n=r[1],s=n-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=i.length;return s===a?i:s>a?i+new Array(s-a+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+formatDecimalParts(t,Math.max(0,e+s-1))[0]}function formatRounded(t,e){var r=formatDecimalParts(t,e);if(!r)return t+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var formatTypes={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:formatDecimal,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>formatRounded(100*t,e),r:formatRounded,s:formatPrefixAuto,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function identity$2(t){return t}var map=Array.prototype.map,prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],locale,format,formatPrefix;function formatLocale(t){var e=void 0===t.grouping||void 0===t.thousands?identity$2:formatGroup(map.call(t.grouping,Number),t.thousands+""),r=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",n=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?identity$2:formatNumerals(map.call(t.numerals,String)),a=void 0===t.percent?"%":t.percent+"",o=void 0===t.minus?"":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function l(t){var l=(t=formatSpecifier(t)).fill,u=t.align,c=t.sign,d=t.symbol,f=t.zero,p=t.width,_=t.comma,g=t.precision,m=t.trim,y=t.type;"n"===y?(_=!0,y="g"):formatTypes[y]||(void 0===g&&(g=12),m=!0,y="g"),(f||"0"===l&&"="===u)&&(f=!0,l="0",u="=");var v="$"===d?r:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===d?i:/[%p]/.test(y)?a:"",x=formatTypes[y],T=/[defgprs%]/.test(y);function E(t){var r,i,a,d=v,E=b;if("c"===y)E=x(t)+E,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:x(Math.abs(t),g),m&&(t=formatTrim(t)),S&&0==+t&&"+"!==c&&(S=!1),d=(S?"("===c?c:o:"-"===c||"("===c?"":c)+d,E=("s"===y?prefixes[8+prefixExponent/3]:"")+E+(S&&"("===c?")":""),T)for(r=-1,i=t.length;++r<i;)if(48>(a=t.charCodeAt(r))||a>57){E=(46===a?n+t.slice(r+1):t.slice(r))+E,t=t.slice(0,r);break}}_&&!f&&(t=e(t,1/0));var A=d.length+t.length+E.length,R=A<p?new Array(p-A+1).join(l):"";switch(_&&f&&(t=e(R+t,R.length?p-E.length:1/0),R=""),u){case"<":t=d+t+E+R;break;case"=":t=d+R+t+E;break;case"^":t=R.slice(0,A=R.length>>1)+d+t+E+R.slice(A);break;default:t=R+d+t+E}return s(t)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return t+""},E}return{format:l,formatPrefix:function(t,e){var r=l(((t=formatSpecifier(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(exponent(e)/3))),n=Math.pow(10,-i),s=prefixes[8+i/3];return function(t){return r(n*t)+s}}}}function defaultLocale(t){return locale=formatLocale(t),format=locale.format,formatPrefix=locale.formatPrefix,locale}function precisionFixed(t){return Math.max(0,-exponent(Math.abs(t)))}function precisionPrefix(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(e)/3)))-exponent(Math.abs(t)))}function precisionRound(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,exponent(e)-exponent(t))+1}function count$1(t){var e=0,r=t.children,i=r&&r.length;if(i)for(;--i>=0;)e+=r[i].value;else e=1;t.value=e}function node_count(){return this.eachAfter(count$1)}function node_each(t,e){let r=-1;for(const i of this)t.call(e,i,++r,this);return this}function node_eachBefore(t,e){for(var r,i,n=this,s=[n],a=-1;n=s.pop();)if(t.call(e,n,++a,this),r=n.children)for(i=r.length-1;i>=0;--i)s.push(r[i]);return this}function node_eachAfter(t,e){for(var r,i,n,s=this,a=[s],o=[],h=-1;s=a.pop();)if(o.push(s),r=s.children)for(i=0,n=r.length;i<n;++i)a.push(r[i]);for(;s=o.pop();)t.call(e,s,++h,this);return this}function node_find(t,e){let r=-1;for(const i of this)if(t.call(e,i,++r,this))return i}function node_sum(t){return this.eachAfter((function(e){for(var r=+t(e.data)||0,i=e.children,n=i&&i.length;--n>=0;)r+=i[n].value;e.value=r}))}function node_sort(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))}function node_path(t){for(var e=this,r=leastCommonAncestor(e,t),i=[e];e!==r;)e=e.parent,i.push(e);for(var n=i.length;t!==r;)i.splice(n,0,t),t=t.parent;return i}function leastCommonAncestor(t,e){if(t===e)return t;var r=t.ancestors(),i=e.ancestors(),n=null;for(t=r.pop(),e=i.pop();t===e;)n=t,t=r.pop(),e=i.pop();return n}function node_ancestors(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function node_descendants(){return Array.from(this)}function node_leaves(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t}function node_links(){var t=this,e=[];return t.each((function(r){r!==t&&e.push({source:r.parent,target:r})})),e}function*node_iterator(){var t,e,r,i,n=this,s=[n];do{for(t=s.reverse(),s=[];n=t.pop();)if(yield n,e=n.children)for(r=0,i=e.length;r<i;++r)s.push(e[r])}while(s.length)}function hierarchy(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=mapChildren)):void 0===e&&(e=objectChildren);for(var r,i,n,s,a,o=new Node(t),h=[o];r=h.pop();)if((n=e(r.data))&&(a=(n=Array.from(n)).length))for(r.children=n,s=a-1;s>=0;--s)h.push(i=n[s]=new Node(n[s])),i.parent=r,i.depth=r.depth+1;return o.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function objectChildren(t){return t.children}function mapChildren(t){return Array.isArray(t)?t[1]:null}function copyData(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function computeHeight(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Node(t){this.data=t,this.depth=this.height=0,this.parent=null}function array$2(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function shuffle(t){for(var e,r,i=t.length;i;)r=Math.random()*i--|0,e=t[i],t[i]=t[r],t[r]=e;return t}function enclose(t){for(var e,r,i=0,n=(t=shuffle(Array.from(t))).length,s=[];i<n;)e=t[i],r&&enclosesWeak(r,e)?++i:(r=encloseBasis(s=extendBasis(s,e)),i=0);return r}function extendBasis(t,e){var r,i;if(enclosesWeakAll(e,t))return[e];for(r=0;r<t.length;++r)if(enclosesNot(e,t[r])&&enclosesWeakAll(encloseBasis2(t[r],e),t))return[t[r],e];for(r=0;r<t.length-1;++r)for(i=r+1;i<t.length;++i)if(enclosesNot(encloseBasis2(t[r],t[i]),e)&&enclosesNot(encloseBasis2(t[r],e),t[i])&&enclosesNot(encloseBasis2(t[i],e),t[r])&&enclosesWeakAll(encloseBasis3(t[r],t[i],e),t))return[t[r],t[i],e];throw new Error}function enclosesNot(t,e){var r=t.r-e.r,i=e.x-t.x,n=e.y-t.y;return r<0||r*r<i*i+n*n}function enclosesWeak(t,e){var r=t.r-e.r+1e-9*Math.max(t.r,e.r,1),i=e.x-t.x,n=e.y-t.y;return r>0&&r*r>i*i+n*n}function enclosesWeakAll(t,e){for(var r=0;r<e.length;++r)if(!enclosesWeak(t,e[r]))return!1;return!0}function encloseBasis(t){switch(t.length){case 1:return encloseBasis1(t[0]);case 2:return encloseBasis2(t[0],t[1]);case 3:return encloseBasis3(t[0],t[1],t[2])}}function encloseBasis1(t){return{x:t.x,y:t.y,r:t.r}}function encloseBasis2(t,e){var r=t.x,i=t.y,n=t.r,s=e.x,a=e.y,o=e.r,h=s-r,l=a-i,u=o-n,c=Math.sqrt(h*h+l*l);return{x:(r+s+h/c*u)/2,y:(i+a+l/c*u)/2,r:(c+n+o)/2}}function encloseBasis3(t,e,r){var i=t.x,n=t.y,s=t.r,a=e.x,o=e.y,h=e.r,l=r.x,u=r.y,c=r.r,d=i-a,f=i-l,p=n-o,_=n-u,g=h-s,m=c-s,y=i*i+n*n-s*s,v=y-a*a-o*o+h*h,b=y-l*l-u*u+c*c,x=f*p-d*_,T=(p*b-_*v)/(2*x)-i,E=(_*g-p*m)/x,S=(f*v-d*b)/(2*x)-n,A=(d*m-f*g)/x,R=E*E+A*A-1,w=2*(s+T*E+S*A),O=T*T+S*S-s*s,P=-(R?(w+Math.sqrt(w*w-4*R*O))/(2*R):O/w);return{x:i+T+E*P,y:n+S+A*P,r:P}}function place(t,e,r){var i,n,s,a,o=t.x-e.x,h=t.y-e.y,l=o*o+h*h;l?(n=e.r+r.r,n*=n,a=t.r+r.r,n>(a*=a)?(i=(l+a-n)/(2*l),s=Math.sqrt(Math.max(0,a/l-i*i)),r.x=t.x-i*o-s*h,r.y=t.y-i*h+s*o):(i=(l+n-a)/(2*l),s=Math.sqrt(Math.max(0,n/l-i*i)),r.x=e.x+i*o-s*h,r.y=e.y+i*h+s*o)):(r.x=e.x+r.r,r.y=e.y)}function intersects(t,e){var r=t.r+e.r-1e-6,i=e.x-t.x,n=e.y-t.y;return r>0&&r*r>i*i+n*n}function score(t){var e=t._,r=t.next._,i=e.r+r.r,n=(e.x*r.r+r.x*e.r)/i,s=(e.y*r.r+r.y*e.r)/i;return n*n+s*s}function Node$1(t){this._=t,this.next=null,this.previous=null}function packEnclose(t){if(!(n=(t=array$2(t)).length))return 0;var e,r,i,n,s,a,o,h,l,u,c;if((e=t[0]).x=0,e.y=0,!(n>1))return e.r;if(r=t[1],e.x=-r.r,r.x=e.r,r.y=0,!(n>2))return e.r+r.r;place(r,e,i=t[2]),e=new Node$1(e),r=new Node$1(r),i=new Node$1(i),e.next=i.previous=r,r.next=e.previous=i,i.next=r.previous=e;t:for(o=3;o<n;++o){place(e._,r._,i=t[o]),i=new Node$1(i),h=r.next,l=e.previous,u=r._.r,c=e._.r;do{if(u<=c){if(intersects(h._,i._)){r=h,e.next=r,r.previous=e,--o;continue t}u+=h._.r,h=h.next}else{if(intersects(l._,i._)){(e=l).next=r,r.previous=e,--o;continue t}c+=l._.r,l=l.previous}}while(h!==l.next);for(i.previous=e,i.next=r,e.next=r.previous=r=i,s=score(e);(i=i.next)!==r;)(a=score(i))<s&&(e=i,s=a);r=e.next}for(e=[r._],i=r;(i=i.next)!==r;)e.push(i._);for(i=enclose(e),o=0;o<n;++o)(e=t[o]).x-=i.x,e.y-=i.y;return i.r}function optional(t){return null==t?null:required(t)}function required(t){if("function"!=typeof t)throw new Error;return t}function constantZero(){return 0}function constant$4(t){return function(){return t}}function defaultRadius(t){return Math.sqrt(t.value)}function index$1(){var t=null,e=1,r=1,i=constantZero;function n(n){return n.x=e/2,n.y=r/2,t?n.eachBefore(radiusLeaf(t)).eachAfter(packChildren(i,.5)).eachBefore(translateChild(1)):n.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(i,n.r/Math.min(e,r))).eachBefore(translateChild(Math.min(e,r)/(2*n.r))),n}return n.radius=function(e){return arguments.length?(t=optional(e),n):t},n.size=function(t){return arguments.length?(e=+t[0],r=+t[1],n):[e,r]},n.padding=function(t){return arguments.length?(i="function"==typeof t?t:constant$4(+t),n):i},n}function radiusLeaf(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function packChildren(t,e){return function(r){if(i=r.children){var i,n,s,a=i.length,o=t(r)*e||0;if(o)for(n=0;n<a;++n)i[n].r+=o;if(s=packEnclose(i),o)for(n=0;n<a;++n)i[n].r-=o;r.r=s+o}}}function translateChild(t){return function(e){var r=e.parent;e.r*=t,r&&(e.x=r.x+t*e.x,e.y=r.y+t*e.y)}}function roundNode(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function treemapDice(t,e,r,i,n){for(var s,a=t.children,o=-1,h=a.length,l=t.value&&(i-e)/t.value;++o<h;)(s=a[o]).y0=r,s.y1=n,s.x0=e,s.x1=e+=s.value*l}function defaultSeparation(t,e){return t.parent===e.parent?1:2}function nextLeft(t){var e=t.children;return e?e[0]:t.t}function nextRight(t){var e=t.children;return e?e[e.length-1]:t.t}function moveSubtree(t,e,r){var i=r/(e.i-t.i);e.c-=i,e.s+=r,t.c+=i,e.z+=r,e.m+=r}function executeShifts(t){for(var e,r=0,i=0,n=t.children,s=n.length;--s>=0;)(e=n[s]).z+=r,e.m+=r,r+=e.s+(i+=e.c)}function nextAncestor(t,e,r){return t.a.parent===e.parent?t.a:r}function TreeNode(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function treeRoot(t){for(var e,r,i,n,s,a=new TreeNode(t,0),o=[a];e=o.pop();)if(i=e._.children)for(e.children=new Array(s=i.length),n=s-1;n>=0;--n)o.push(r=e.children[n]=new TreeNode(i[n],n)),r.parent=e;return(a.parent=new TreeNode(null,0)).children=[a],a}function tree(){var t=defaultSeparation,e=1,r=1,i=null;function n(n){var h=treeRoot(n);if(h.eachAfter(s),h.parent.m=-h.z,h.eachBefore(a),i)n.eachBefore(o);else{var l=n,u=n,c=n;n.eachBefore((function(t){t.x<l.x&&(l=t),t.x>u.x&&(u=t),t.depth>c.depth&&(c=t)}));var d=l===u?1:t(l,u)/2,f=d-l.x,p=e/(u.x+d+f),_=r/(c.depth||1);n.eachBefore((function(t){t.x=(t.x+f)*p,t.y=t.depth*_}))}return n}function s(e){var r=e.children,i=e.parent.children,n=e.i?i[e.i-1]:null;if(r){executeShifts(e);var s=(r[0].z+r[r.length-1].z)/2;n?(e.z=n.z+t(e._,n._),e.m=e.z-s):e.z=s}else n&&(e.z=n.z+t(e._,n._));e.parent.A=function(e,r,i){if(r){for(var n,s=e,a=e,o=r,h=s.parent.children[0],l=s.m,u=a.m,c=o.m,d=h.m;o=nextRight(o),s=nextLeft(s),o&&s;)h=nextLeft(h),(a=nextRight(a)).a=e,(n=o.z+c-s.z-l+t(o._,s._))>0&&(moveSubtree(nextAncestor(o,e,i),e,n),l+=n,u+=n),c+=o.m,l+=s.m,d+=h.m,u+=a.m;o&&!nextRight(a)&&(a.t=o,a.m+=c-u),s&&!nextLeft(h)&&(h.t=s,h.m+=l-d,i=e)}return i}(e,n,e.parent.A||i[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function o(t){t.x*=e,t.y=t.depth*r}return n.separation=function(e){return arguments.length?(t=e,n):t},n.size=function(t){return arguments.length?(i=!1,e=+t[0],r=+t[1],n):i?null:[e,r]},n.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],r=+t[1],n):i?[e,r]:null},n}function treemapSlice(t,e,r,i,n){for(var s,a=t.children,o=-1,h=a.length,l=t.value&&(n-r)/t.value;++o<h;)(s=a[o]).x0=e,s.x1=i,s.y0=r,s.y1=r+=s.value*l}defaultLocale({thousands:",",grouping:[3],currency:["$",""]}),Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,find:node_find,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy,[Symbol.iterator]:node_iterator},TreeNode.prototype=Object.create(Node.prototype);var phi=(1+Math.sqrt(5))/2;function squarifyRatio(t,e,r,i,n,s){for(var a,o,h,l,u,c,d,f,p,_,g,m=[],y=e.children,v=0,b=0,x=y.length,T=e.value;v<x;){h=n-r,l=s-i;do{u=y[b++].value}while(!u&&b<x);for(c=d=u,g=u*u*(_=Math.max(l/h,h/l)/(T*t)),p=Math.max(d/g,g/c);b<x;++b){if(u+=o=y[b].value,o<c&&(c=o),o>d&&(d=o),g=u*u*_,(f=Math.max(d/g,g/c))>p){u-=o;break}p=f}m.push(a={value:u,dice:h<l,children:y.slice(v,b)}),a.dice?treemapDice(a,r,i,n,T?i+=l*u/T:s):treemapSlice(a,r,i,T?r+=h*u/T:n,s),T-=u,v=b}return m}var squarify=function t(e){function r(t,r,i,n,s){squarifyRatio(e,t,r,i,n,s)}return r.ratio=function(e){return t((e=+e)>1?e:1)},r}(phi);function index$2(){var t=squarify,e=!1,r=1,i=1,n=[0],s=constantZero,a=constantZero,o=constantZero,h=constantZero,l=constantZero;function u(t){return t.x0=t.y0=0,t.x1=r,t.y1=i,t.eachBefore(c),n=[0],e&&t.eachBefore(roundNode),t}function c(e){var r=n[e.depth],i=e.x0+r,u=e.y0+r,c=e.x1-r,d=e.y1-r;c<i&&(i=c=(i+c)/2),d<u&&(u=d=(u+d)/2),e.x0=i,e.y0=u,e.x1=c,e.y1=d,e.children&&(r=n[e.depth+1]=s(e)/2,i+=l(e)-r,u+=a(e)-r,(c-=o(e)-r)<i&&(i=c=(i+c)/2),(d-=h(e)-r)<u&&(u=d=(u+d)/2),t(e,i,u,c,d))}return u.round=function(t){return arguments.length?(e=!!t,u):e},u.size=function(t){return arguments.length?(r=+t[0],i=+t[1],u):[r,i]},u.tile=function(e){return arguments.length?(t=required(e),u):t},u.padding=function(t){return arguments.length?u.paddingInner(t).paddingOuter(t):u.paddingInner()},u.paddingInner=function(t){return arguments.length?(s="function"==typeof t?t:constant$4(+t),u):s},u.paddingOuter=function(t){return arguments.length?u.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):u.paddingTop()},u.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:constant$4(+t),u):a},u.paddingRight=function(t){return arguments.length?(o="function"==typeof t?t:constant$4(+t),u):o},u.paddingBottom=function(t){return arguments.length?(h="function"==typeof t?t:constant$4(+t),u):h},u.paddingLeft=function(t){return arguments.length?(l="function"==typeof t?t:constant$4(+t),u):l},u}function initRange(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function initInterpolator(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const implicit=Symbol("implicit");function ordinal(){var t=new Map,e=[],r=[],i=implicit;function n(n){var s=n+"",a=t.get(s);if(!a){if(i!==implicit)return i;t.set(s,a=e.push(n))}return r[(a-1)%r.length]}return n.domain=function(r){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of r){const r=i+"";t.has(r)||t.set(r,e.push(i))}return n},n.range=function(t){return arguments.length?(r=Array.from(t),n):r.slice()},n.unknown=function(t){return arguments.length?(i=t,n):i},n.copy=function(){return ordinal(e,r).unknown(i)},initRange.apply(n,arguments),n}function band(){var t,e,r=ordinal().unknown(void 0),i=r.domain,n=r.range,s=0,a=1,o=!1,h=0,l=0,u=.5;function c(){var r=i().length,c=a<s,d=c?a:s,f=c?s:a;t=(f-d)/Math.max(1,r-h+2*l),o&&(t=Math.floor(t)),d+=(f-d-t*(r-h))*u,e=t*(1-h),o&&(d=Math.round(d),e=Math.round(e));var p=sequence(r).map((function(e){return d+t*e}));return n(c?p.reverse():p)}return delete r.unknown,r.domain=function(t){return arguments.length?(i(t),c()):i()},r.range=function(t){return arguments.length?([s,a]=t,s=+s,a=+a,c()):[s,a]},r.rangeRound=function(t){return[s,a]=t,s=+s,a=+a,o=!0,c()},r.bandwidth=function(){return e},r.step=function(){return t},r.round=function(t){return arguments.length?(o=!!t,c()):o},r.padding=function(t){return arguments.length?(h=Math.min(1,l=+t),c()):h},r.paddingInner=function(t){return arguments.length?(h=Math.min(1,t),c()):h},r.paddingOuter=function(t){return arguments.length?(l=+t,c()):l},r.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},r.copy=function(){return band(i(),[s,a]).round(o).paddingInner(h).paddingOuter(l).align(u)},initRange.apply(c(),arguments)}function pointish(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return pointish(e())},t}function point(){return pointish(band.apply(null,arguments).paddingInner(1))}function constants(t){return function(){return t}}function number$1(t){return+t}var unit=[0,1];function identity$3(t){return t}function normalize(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:constants(isNaN(e)?NaN:.5)}function clamper(t,e){var r;return t>e&&(r=t,t=e,e=r),function(r){return Math.max(t,Math.min(e,r))}}function bimap(t,e,r){var i=t[0],n=t[1],s=e[0],a=e[1];return n<i?(i=normalize(n,i),s=r(a,s)):(i=normalize(i,n),s=r(s,a)),function(t){return s(i(t))}}function polymap(t,e,r){var i=Math.min(t.length,e.length)-1,n=new Array(i),s=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<i;)n[a]=normalize(t[a],t[a+1]),s[a]=r(e[a],e[a+1]);return function(e){var r=bisectRight(t,e,1,i)-1;return s[r](n[r](e))}}function copy(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function transformer(){var t,e,r,i,n,s,a=unit,o=unit,h=interpolate,l=identity$3;function u(){var t=Math.min(a.length,o.length);return l!==identity$3&&(l=clamper(a[0],a[t-1])),i=t>2?polymap:bimap,n=s=null,c}function c(e){return null==e||isNaN(e=+e)?r:(n||(n=i(a.map(t),o,h)))(t(l(e)))}return c.invert=function(r){return l(e((s||(s=i(o,a.map(t),interpolateNumber)))(r)))},c.domain=function(t){return arguments.length?(a=Array.from(t,number$1),u()):a.slice()},c.range=function(t){return arguments.length?(o=Array.from(t),u()):o.slice()},c.rangeRound=function(t){return o=Array.from(t),h=interpolateRound,u()},c.clamp=function(t){return arguments.length?(l=!!t||identity$3,u()):l!==identity$3},c.interpolate=function(t){return arguments.length?(h=t,u()):h},c.unknown=function(t){return arguments.length?(r=t,c):r},function(r,i){return t=r,e=i,u()}}function continuous(){return transformer()(identity$3,identity$3)}function tickFormat(t,e,r,i){var n,s=tickStep(t,e,r);switch((i=formatSpecifier(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(n=precisionPrefix(s,a))||(i.precision=n),formatPrefix(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(n=precisionRound(s,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=n-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(n=precisionFixed(s))||(i.precision=n-2*("%"===i.type))}return format(i)}function linearish(t){var e=t.domain;return t.ticks=function(t){var r=e();return ticks(r[0],r[r.length-1],null==t?10:t)},t.tickFormat=function(t,r){var i=e();return tickFormat(i[0],i[i.length-1],null==t?10:t,r)},t.nice=function(r){null==r&&(r=10);var i,n,s=e(),a=0,o=s.length-1,h=s[a],l=s[o],u=10;for(l<h&&(n=h,h=l,l=n,n=a,a=o,o=n);u-- >0;){if((n=tickIncrement(h,l,r))===i)return s[a]=h,s[o]=l,e(s);if(n>0)h=Math.floor(h/n)*n,l=Math.ceil(l/n)*n;else{if(!(n<0))break;h=Math.ceil(h*n)/n,l=Math.floor(l*n)/n}i=n}return t},t}function linear$1(){var t=continuous();return t.copy=function(){return copy(t,linear$1())},initRange.apply(t,arguments),linearish(t)}function nice$1(t,e){var r,i=0,n=(t=t.slice()).length-1,s=t[i],a=t[n];return a<s&&(r=i,i=n,n=r,r=s,s=a,a=r),t[i]=e.floor(s),t[n]=e.ceil(a),t}function transformLog(t){return Math.log(t)}function transformExp(t){return Math.exp(t)}function transformLogn(t){return-Math.log(-t)}function transformExpn(t){return-Math.exp(-t)}function pow10(t){return isFinite(t)?+("1e"+t):t<0?0:t}function powp(t){return 10===t?pow10:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}function logp(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}function reflect(t){return function(e){return-t(-e)}}function loggish(t){var e,r,i=t(transformLog,transformExp),n=i.domain,s=10;function a(){return e=logp(s),r=powp(s),n()[0]<0?(e=reflect(e),r=reflect(r),t(transformLogn,transformExpn)):t(transformLog,transformExp),i}return i.base=function(t){return arguments.length?(s=+t,a()):s},i.domain=function(t){return arguments.length?(n(t),a()):n()},i.ticks=function(t){var i,a=n(),o=a[0],h=a[a.length-1];(i=h<o)&&(d=o,o=h,h=d);var l,u,c,d=e(o),f=e(h),p=null==t?10:+t,_=[];if(!(s%1)&&f-d<p){if(d=Math.floor(d),f=Math.ceil(f),o>0){for(;d<=f;++d)for(u=1,l=r(d);u<s;++u)if(!((c=l*u)<o)){if(c>h)break;_.push(c)}}else for(;d<=f;++d)for(u=s-1,l=r(d);u>=1;--u)if(!((c=l*u)<o)){if(c>h)break;_.push(c)}2*_.length<p&&(_=ticks(o,h,p))}else _=ticks(d,f,Math.min(f-d,p)).map(r);return i?_.reverse():_},i.tickFormat=function(t,n){if(null==n&&(n=10===s?".0e":","),"function"!=typeof n&&(n=format(n)),t===1/0)return n;null==t&&(t=10);var a=Math.max(1,s*t/i.ticks().length);return function(t){var i=t/r(Math.round(e(t)));return i*s<s-.5&&(i*=s),i<=a?n(t):""}},i.nice=function(){return n(nice$1(n(),{floor:function(t){return r(Math.floor(e(t)))},ceil:function(t){return r(Math.ceil(e(t)))}}))},i}function log(){var t=loggish(transformer()).domain([1,10]);return t.copy=function(){return copy(t,log()).base(t.base())},initRange.apply(t,arguments),t}var t0=new Date,t1=new Date;function newInterval(t,e,r,i){function n(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return n.floor=function(e){return t(e=new Date(+e)),e},n.ceil=function(r){return t(r=new Date(r-1)),e(r,1),t(r),r},n.round=function(t){var e=n(t),r=n.ceil(t);return t-e<r-t?e:r},n.offset=function(t,r){return e(t=new Date(+t),null==r?1:Math.floor(r)),t},n.range=function(r,i,s){var a,o=[];if(r=n.ceil(r),s=null==s?1:Math.floor(s),!(r<i&&s>0))return o;do{o.push(a=new Date(+r)),e(r,s),t(r)}while(a<r&&r<i);return o},n.filter=function(r){return newInterval((function(e){if(e>=e)for(;t(e),!r(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!r(t););else for(;--i>=0;)for(;e(t,1),!r(t););}))},r&&(n.count=function(e,i){return t0.setTime(+e),t1.setTime(+i),t(t0),t(t1),Math.floor(r(t0,t1))},n.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?n.filter(i?function(e){return i(e)%t==0}:function(e){return n.count(0,e)%t==0}):n:null}),n}var millisecond=newInterval((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));millisecond.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?newInterval((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,r){e.setTime(+e+r*t)}),(function(e,r){return(r-e)/t})):millisecond:null};const durationSecond=1e3,durationMinute=60*durationSecond,durationHour=60*durationMinute,durationDay=24*durationHour,durationWeek=7*durationDay;var second=newInterval((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*durationSecond)}),(function(t,e){return(e-t)/durationSecond}),(function(t){return t.getUTCSeconds()})),seconds=second.range,minute=newInterval((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*durationSecond)}),(function(t,e){t.setTime(+t+e*durationMinute)}),(function(t,e){return(e-t)/durationMinute}),(function(t){return t.getMinutes()})),minutes=minute.range,hour=newInterval((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*durationSecond-t.getMinutes()*durationMinute)}),(function(t,e){t.setTime(+t+e*durationHour)}),(function(t,e){return(e-t)/durationHour}),(function(t){return t.getHours()})),hours=hour.range,day=newInterval((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*durationMinute)/durationDay),(t=>t.getDate()-1)),days=day.range;function weekday(t){return newInterval((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*durationMinute)/durationWeek}))}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),month=newInterval((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),months=month.range,year=newInterval((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));year.every=function(t){return isFinite(t=Math.floor(t))&&t>0?newInterval((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,r){e.setFullYear(e.getFullYear()+r*t)})):null};var years=year.range,utcDay=newInterval((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/durationDay}),(function(t){return t.getUTCDate()-1}));function utcWeekday(t){return newInterval((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/durationWeek}))}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcYear=newInterval((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));function localDate(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function utcDate(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function newDate(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function formatLocale$1(t){var e=t.dateTime,r=t.date,i=t.time,n=t.periods,s=t.days,a=t.shortDays,o=t.months,h=t.shortMonths,l=formatRe(n),u=formatLookup(n),c=formatRe(s),d=formatLookup(s),f=formatRe(a),p=formatLookup(a),_=formatRe(o),g=formatLookup(o),m=formatRe(h),y=formatLookup(h),v={a:function(t){return a[t.getDay()]},A:function(t){return s[t.getDay()]},b:function(t){return h[t.getMonth()]},B:function(t){return o[t.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function(t){return n[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear$1,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},b={a:function(t){return a[t.getUTCDay()]},A:function(t){return s[t.getUTCDay()]},b:function(t){return h[t.getUTCMonth()]},B:function(t){return o[t.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function(t){return n[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},x={a:function(t,e,r){var i=f.exec(e.slice(r));return i?(t.w=p.get(i[0].toLowerCase()),r+i[0].length):-1},A:function(t,e,r){var i=c.exec(e.slice(r));return i?(t.w=d.get(i[0].toLowerCase()),r+i[0].length):-1},b:function(t,e,r){var i=m.exec(e.slice(r));return i?(t.m=y.get(i[0].toLowerCase()),r+i[0].length):-1},B:function(t,e,r){var i=_.exec(e.slice(r));return i?(t.m=g.get(i[0].toLowerCase()),r+i[0].length):-1},c:function(t,r,i){return S(t,e,r,i)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function(t,e,r){var i=l.exec(e.slice(r));return i?(t.p=u.get(i[0].toLowerCase()),r+i[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function(t,e,i){return S(t,r,e,i)},X:function(t,e,r){return S(t,i,e,r)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function T(t,e){return function(r){var i,n,s,a=[],o=-1,h=0,l=t.length;for(r instanceof Date||(r=new Date(+r));++o<l;)37===t.charCodeAt(o)&&(a.push(t.slice(h,o)),null!=(n=pads[i=t.charAt(++o)])?i=t.charAt(++o):n="e"===i?" ":"0",(s=e[i])&&(i=s(r,n)),a.push(i),h=o+1);return a.push(t.slice(h,o)),a.join("")}}function E(t,e){return function(r){var i,n,s=newDate(1900,void 0,1);if(S(s,t,r+="",0)!=r.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(e&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(n=(i=utcDate(newDate(s.y,0,1))).getUTCDay(),i=n>4||0===n?utcMonday.ceil(i):utcMonday(i),i=utcDay.offset(i,7*(s.V-1)),s.y=i.getUTCFullYear(),s.m=i.getUTCMonth(),s.d=i.getUTCDate()+(s.w+6)%7):(n=(i=localDate(newDate(s.y,0,1))).getDay(),i=n>4||0===n?monday.ceil(i):monday(i),i=day.offset(i,7*(s.V-1)),s.y=i.getFullYear(),s.m=i.getMonth(),s.d=i.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),n="Z"in s?utcDate(newDate(s.y,0,1)).getUTCDay():localDate(newDate(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(n+5)%7:s.w+7*s.U-(n+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,utcDate(s)):localDate(s)}}function S(t,e,r,i){for(var n,s,a=0,o=e.length,h=r.length;a<o;){if(i>=h)return-1;if(37===(n=e.charCodeAt(a++))){if(n=e.charAt(a++),!(s=x[n in pads?e.charAt(a++):n])||(i=s(t,r,i))<0)return-1}else if(n!=r.charCodeAt(i++))return-1}return i}return v.x=T(r,v),v.X=T(i,v),v.c=T(e,v),b.x=T(r,b),b.X=T(i,b),b.c=T(e,b),{format:function(t){var e=T(t+="",v);return e.toString=function(){return t},e},parse:function(t){var e=E(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=T(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=E(t+="",!0);return e.toString=function(){return t},e}}}utcYear.every=function(t){return isFinite(t=Math.floor(t))&&t>0?newInterval((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})):null};var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g,locale$1,timeFormat,timeParse,utcFormat,utcParse;function pad$1(t,e,r){var i=t<0?"-":"",n=(i?-t:t)+"",s=n.length;return i+(s<r?new Array(r-s+1).join(e)+n:n)}function requote(t){return t.replace(requoteRe,"\\$&")}function formatRe(t){return new RegExp("^(?:"+t.map(requote).join("|")+")","i")}function formatLookup(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function parseWeekdayNumberSunday(t,e,r){var i=numberRe.exec(e.slice(r,r+1));return i?(t.w=+i[0],r+i[0].length):-1}function parseWeekdayNumberMonday(t,e,r){var i=numberRe.exec(e.slice(r,r+1));return i?(t.u=+i[0],r+i[0].length):-1}function parseWeekNumberSunday(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.U=+i[0],r+i[0].length):-1}function parseWeekNumberISO(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.V=+i[0],r+i[0].length):-1}function parseWeekNumberMonday(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.W=+i[0],r+i[0].length):-1}function parseFullYear(t,e,r){var i=numberRe.exec(e.slice(r,r+4));return i?(t.y=+i[0],r+i[0].length):-1}function parseYear(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function parseZone(t,e,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function parseQuarter(t,e,r){var i=numberRe.exec(e.slice(r,r+1));return i?(t.q=3*i[0]-3,r+i[0].length):-1}function parseMonthNumber(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.m=i[0]-1,r+i[0].length):-1}function parseDayOfMonth(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.d=+i[0],r+i[0].length):-1}function parseDayOfYear(t,e,r){var i=numberRe.exec(e.slice(r,r+3));return i?(t.m=0,t.d=+i[0],r+i[0].length):-1}function parseHour24(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.H=+i[0],r+i[0].length):-1}function parseMinutes(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.M=+i[0],r+i[0].length):-1}function parseSeconds(t,e,r){var i=numberRe.exec(e.slice(r,r+2));return i?(t.S=+i[0],r+i[0].length):-1}function parseMilliseconds(t,e,r){var i=numberRe.exec(e.slice(r,r+3));return i?(t.L=+i[0],r+i[0].length):-1}function parseMicroseconds(t,e,r){var i=numberRe.exec(e.slice(r,r+6));return i?(t.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function parseLiteralPercent(t,e,r){var i=percentRe.exec(e.slice(r,r+1));return i?r+i[0].length:-1}function parseUnixTimestamp(t,e,r){var i=numberRe.exec(e.slice(r));return i?(t.Q=+i[0],r+i[0].length):-1}function parseUnixTimestampSeconds(t,e,r){var i=numberRe.exec(e.slice(r));return i?(t.s=+i[0],r+i[0].length):-1}function formatDayOfMonth(t,e){return pad$1(t.getDate(),e,2)}function formatHour24(t,e){return pad$1(t.getHours(),e,2)}function formatHour12(t,e){return pad$1(t.getHours()%12||12,e,2)}function formatDayOfYear(t,e){return pad$1(1+day.count(year(t),t),e,3)}function formatMilliseconds(t,e){return pad$1(t.getMilliseconds(),e,3)}function formatMicroseconds(t,e){return formatMilliseconds(t,e)+"000"}function formatMonthNumber(t,e){return pad$1(t.getMonth()+1,e,2)}function formatMinutes(t,e){return pad$1(t.getMinutes(),e,2)}function formatSeconds(t,e){return pad$1(t.getSeconds(),e,2)}function formatWeekdayNumberMonday(t){var e=t.getDay();return 0===e?7:e}function formatWeekNumberSunday(t,e){return pad$1(sunday.count(year(t)-1,t),e,2)}function dISO(t){var e=t.getDay();return e>=4||0===e?thursday(t):thursday.ceil(t)}function formatWeekNumberISO(t,e){return t=dISO(t),pad$1(thursday.count(year(t),t)+(4===year(t).getDay()),e,2)}function formatWeekdayNumberSunday(t){return t.getDay()}function formatWeekNumberMonday(t,e){return pad$1(monday.count(year(t)-1,t),e,2)}function formatYear$1(t,e){return pad$1(t.getFullYear()%100,e,2)}function formatYearISO(t,e){return pad$1((t=dISO(t)).getFullYear()%100,e,2)}function formatFullYear(t,e){return pad$1(t.getFullYear()%1e4,e,4)}function formatFullYearISO(t,e){var r=t.getDay();return pad$1((t=r>=4||0===r?thursday(t):thursday.ceil(t)).getFullYear()%1e4,e,4)}function formatZone(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+pad$1(e/60|0,"0",2)+pad$1(e%60,"0",2)}function formatUTCDayOfMonth(t,e){return pad$1(t.getUTCDate(),e,2)}function formatUTCHour24(t,e){return pad$1(t.getUTCHours(),e,2)}function formatUTCHour12(t,e){return pad$1(t.getUTCHours()%12||12,e,2)}function formatUTCDayOfYear(t,e){return pad$1(1+utcDay.count(utcYear(t),t),e,3)}function formatUTCMilliseconds(t,e){return pad$1(t.getUTCMilliseconds(),e,3)}function formatUTCMicroseconds(t,e){return formatUTCMilliseconds(t,e)+"000"}function formatUTCMonthNumber(t,e){return pad$1(t.getUTCMonth()+1,e,2)}function formatUTCMinutes(t,e){return pad$1(t.getUTCMinutes(),e,2)}function formatUTCSeconds(t,e){return pad$1(t.getUTCSeconds(),e,2)}function formatUTCWeekdayNumberMonday(t){var e=t.getUTCDay();return 0===e?7:e}function formatUTCWeekNumberSunday(t,e){return pad$1(utcSunday.count(utcYear(t)-1,t),e,2)}function UTCdISO(t){var e=t.getUTCDay();return e>=4||0===e?utcThursday(t):utcThursday.ceil(t)}function formatUTCWeekNumberISO(t,e){return t=UTCdISO(t),pad$1(utcThursday.count(utcYear(t),t)+(4===utcYear(t).getUTCDay()),e,2)}function formatUTCWeekdayNumberSunday(t){return t.getUTCDay()}function formatUTCWeekNumberMonday(t,e){return pad$1(utcMonday.count(utcYear(t)-1,t),e,2)}function formatUTCYear(t,e){return pad$1(t.getUTCFullYear()%100,e,2)}function formatUTCYearISO(t,e){return pad$1((t=UTCdISO(t)).getUTCFullYear()%100,e,2)}function formatUTCFullYear(t,e){return pad$1(t.getUTCFullYear()%1e4,e,4)}function formatUTCFullYearISO(t,e){var r=t.getUTCDay();return pad$1((t=r>=4||0===r?utcThursday(t):utcThursday.ceil(t)).getUTCFullYear()%1e4,e,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(t){return+t}function formatUnixTimestampSeconds(t){return Math.floor(+t/1e3)}function defaultLocale$1(t){return locale$1=formatLocale$1(t),timeFormat=locale$1.format,timeParse=locale$1.parse,utcFormat=locale$1.utcFormat,utcParse=locale$1.utcParse,locale$1}defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var durationSecond$1=1e3,durationMinute$1=60*durationSecond$1,durationHour$1=60*durationMinute$1,durationDay$1=24*durationHour$1,durationWeek$1=7*durationDay$1,durationMonth=30*durationDay$1,durationYear=365*durationDay$1;function date$1(t){return new Date(t)}function number$2(t){return t instanceof Date?+t:+new Date(+t)}function calendar(t,e,r,i,n,s,a,o,h){var l=continuous(),u=l.invert,c=l.domain,d=h(".%L"),f=h(":%S"),p=h("%I:%M"),_=h("%I %p"),g=h("%a %d"),m=h("%b %d"),y=h("%B"),v=h("%Y"),b=[[a,1,durationSecond$1],[a,5,5*durationSecond$1],[a,15,15*durationSecond$1],[a,30,30*durationSecond$1],[s,1,durationMinute$1],[s,5,5*durationMinute$1],[s,15,15*durationMinute$1],[s,30,30*durationMinute$1],[n,1,durationHour$1],[n,3,3*durationHour$1],[n,6,6*durationHour$1],[n,12,12*durationHour$1],[i,1,durationDay$1],[i,2,2*durationDay$1],[r,1,durationWeek$1],[e,1,durationMonth],[e,3,3*durationMonth],[t,1,durationYear]];function x(o){return(a(o)<o?d:s(o)<o?f:n(o)<o?p:i(o)<o?_:e(o)<o?r(o)<o?g:m:t(o)<o?y:v)(o)}function T(e,r,i){if(null==e&&(e=10),"number"==typeof e){var n,s=Math.abs(i-r)/e,a=bisector((function(t){return t[2]})).right(b,s);return a===b.length?(n=tickStep(r/durationYear,i/durationYear,e),e=t):a?(n=(a=b[s/b[a-1][2]<b[a][2]/s?a-1:a])[1],e=a[0]):(n=Math.max(tickStep(r,i,e),1),e=o),e.every(n)}return e}return l.invert=function(t){return new Date(u(t))},l.domain=function(t){return arguments.length?c(Array.from(t,number$2)):c().map(date$1)},l.ticks=function(t){var e,r=c(),i=r[0],n=r[r.length-1],s=n<i;return s&&(e=i,i=n,n=e),e=(e=T(t,i,n))?e.range(i,n+1):[],s?e.reverse():e},l.tickFormat=function(t,e){return null==e?x:h(e)},l.nice=function(t){var e=c();return(t=T(t,e[0],e[e.length-1]))?c(nice$1(e,t)):l},l.copy=function(){return copy(l,calendar(t,e,r,i,n,s,a,o,h))},l}function time(){return initRange.apply(calendar(year,month,sunday,day,hour,minute,second,millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function transformer$1(){var t,e,r,i,n,s=0,a=1,o=identity$3,h=!1;function l(e){return null==e||isNaN(e=+e)?n:o(0===r?.5:(e=(i(e)-t)*r,h?Math.max(0,Math.min(1,e)):e))}function u(t){return function(e){var r,i;return arguments.length?([r,i]=e,o=t(r,i),l):[o(0),o(1)]}}return l.domain=function(n){return arguments.length?([s,a]=n,t=i(s=+s),e=i(a=+a),r=t===e?0:1/(e-t),l):[s,a]},l.clamp=function(t){return arguments.length?(h=!!t,l):h},l.interpolator=function(t){return arguments.length?(o=t,l):o},l.range=u(interpolate),l.rangeRound=u(interpolateRound),l.unknown=function(t){return arguments.length?(n=t,l):n},function(n){return i=n,t=n(s),e=n(a),r=t===e?0:1/(e-t),l}}function copy$1(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function sequential(){var t=linearish(transformer$1()(identity$3));return t.copy=function(){return copy$1(t,sequential())},initInterpolator.apply(t,arguments)}function colors(t){for(var e=t.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+t.slice(6*i,6*++i);return r}var category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),epsilon$1=1e-12;function Linear(t){this._context=t}function curveLinear(t){return new Linear(t)}function point$1(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function Basis(t){this._context=t}function basis$2(t){return new Basis(t)}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point$1(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point$1(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};class Bump{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e)}this._x0=t,this._y0=e}}function bumpX(t){return new Bump(t,!0)}function bumpY(t){return new Bump(t,!1)}function point$2(t,e,r){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-r),t._x2,t._y2)}function Cardinal(t,e){this._context=t,this._k=(1-e)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$2(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:point$2(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var cardinal=function t(e){function r(t){return new Cardinal(t,e)}return r.tension=function(e){return t(+e)},r}(0);function point$3(t,e,r){var i=t._x1,n=t._y1,s=t._x2,a=t._y2;if(t._l01_a>epsilon$1){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,h=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/h,n=(n*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/h}if(t._l23_a>epsilon$1){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*l+t._x1*t._l23_2a-e*t._l12_2a)/u,a=(a*l+t._y1*t._l23_2a-r*t._l12_2a)/u}t._context.bezierCurveTo(i,n,s,a,t._x2,t._y2)}function CatmullRom(t,e){this._context=t,this._alpha=e}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:point$3(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var catmullRom=function t(e){function r(t){return e?new CatmullRom(t,e):new Cardinal(t,0)}return r.alpha=function(e){return t(+e)},r}(.5);function Natural(t){this._context=t}function controlPoints(t){var e,r,i=t.length-1,n=new Array(i),s=new Array(i),a=new Array(i);for(n[0]=0,s[0]=2,a[0]=t[0]+2*t[1],e=1;e<i-1;++e)n[e]=1,s[e]=4,a[e]=4*t[e]+2*t[e+1];for(n[i-1]=2,s[i-1]=7,a[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)r=n[e]/s[e-1],s[e]-=r,a[e]-=r*a[e-1];for(n[i-1]=a[i-1]/s[i-1],e=i-2;e>=0;--e)n[e]=(a[e]-n[e+1])/s[e];for(s[i-1]=(t[i]+n[i-1])/2,e=0;e<i-1;++e)s[e]=2*t[e+1]-n[e+1];return[n,s]}function natural(t){return new Natural(t)}function Step(t,e){this._context=t,this._t=e}function step(t){return new Step(t,.5)}Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===r)this._context.lineTo(t[1],e[1]);else for(var i=controlPoints(t),n=controlPoints(e),s=0,a=1;a<r;++s,++a)this._context.bezierCurveTo(i[0][s],n[0][s],i[1][s],n[1][s],t[a],e[a]);(this._line||0!==this._line&&1===r)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,e)}}this._x=t,this._y=e}};class Rectangle{constructor(t,e,r,i){this.left=t,this.top=e,this.width=r,this.height=i}toJSON(){let t={};return t.left=this.left,t.top=this.top,t.width=this.width,t.height=this.height,t}union(t){let e=Math.min(this.left,t.left),r=Math.min(this.top,t.top),i=Math.max(this.right,t.right),n=Math.max(this.bottom,t.bottom);return new Rectangle(e,r,i-e,n-r)}clone(){return new Rectangle(this.left,this.top,this.width,this.height)}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get x(){return(this.left+this.right)/2}get y(){return(this.top+this.bottom)/2}get center(){return(this.left+this.right)/2}get middle(){return(this.top+this.bottom)/2}contains(t){return this.left<=t.x&&this.right>=t.x&&this.top<=t.y&&this.bottom>=t.y}}const nodeId="id",atlas_rowId="atlas_rowId",ScaleType=["linear","power","log","sqrt","symlog","identity","time","ordinal","band","point","ordinalColor","sequentialColor"],CurveMode={Natural:"natural",Basis:"basis",BumpX:"bumpX",BumpY:"bumpY",Linear:"linear",Step:"step",CatmullRom:"CatmullRom",Cardinal:"cardinal"},LayoutType={Grid:"grid",Circular:"circular",Stack:"stack",Treemap:"treemap",Packing:"packing",Force:"force",TidyTree:"tidytree"},Orientation={Vertical:"vertical",Horizontal:"horizontal",Angular:"angular",Radial:"radial"},Alignment={Top:"top",Left:"left",Bottom:"bottom",Right:"right",Center:"center",Middle:"middle"},ConstraintType={Align:"alignment",Distribute:"distribution",Affix:"affixation"},ItemType={Area:"area",Rect:"rect",Ellipse:"ellipse",Circle:"circle",Pie:"pie",Ring:"ring",Arc:"arc",Line:"line",Path:"path",Image:"image",PointText:"pointText",Collection:"collection",Group:"group",Scene:"scene",Axis:"axis",Glyph:"glyph",Legend:"legend",Polygon:"polygon",Gridlines:"gridlines",LinearGradient:"LinearGradient",Link:"link",DataTable:"datatable"},DataType={Boolean:"boolean",Integer:"integer",Number:"number",Date:"date",String:"string"},Aggregator={Max:"max",Min:"min",Avg:"avg",Median:"median",Sum:"sum",Count:"count",Mean:"mean",Percentile25:"percentile 25",Percentile75:"percentile 75"},Style2SVG={fillColor:"fill",strokeColor:"stroke",strokeWidth:"stroke-width",fillOpacity:"fill-opacity",strokeOpacity:"stroke-opacity",strokeDash:"stroke-dasharray",opacity:"opacity",fontSize:"font-size",fontFamily:"font-family",fontWeight:"font-weight",visibility:"visibility"},Attr2SVG={width:"width",height:"height",id:"id",top:"y",left:"x",x1:"x1",x2:"x2",y1:"y1",y2:"y2"},Errors$1={FIELD_NONEXISTENT:"Data field does not exist in the data table",INCOMPLETE_REPEAT_INFO:"Incomplete information to do repeat. You must specify an item, a categorical data field and a data table",REPEAT_BY_NONCAT:"Repeat only works on a string or date field",PARTITION_BY_NONCAT:"Divide only works on a string or date field",DENSIFY_BY_NONCAT:"Densify only works on a string or date field",COMPNT_NON_REPEATABLE:"Item not repeatable",INCOMPLETE_PARTITION_INFO:"Incomplete information to divide. You must specify an item, a categorical data field and a data table",COMPNT_NON_PARTITIONABLE:"Item cannot be divided",INCOMPLETE_DENSIFY_INFO:"Incomplete information to densify. You must specify an item, a categorical data field and a data table",COMPNT_NON_DENSIFIABLE:"Item cannot be densified",BIND_WITHOUT_DATASCOPE:"Item must be repeated or divided by data first before applyng binding",UNKNOWN_ALIGNMENT:"Unkown alignment",UNKOWNN_SCALE_TYPE:"Unknown scale type",UNKNOWN_ANCHOR:"Unknown anchor",INCOMPLETE_BINDING_INFO:"Incomplete binding information. You must specify an item, a data field and a visual channel",MULTIPLE_VALUES_PER_FIELD:"Multiple distinct field values exist",DIFFERENT_SCALE_TYPE:"Cannot merge different types of scale",INCORRECT_AXIS_INFO:"Cannot find relevant information to create an axis for ",INCORRECT_LEGEND_INFO:"Cannot find relevant information to create a legend for ",INSUFFICIENT_DATA_SCOPES:"Insufficient data to divide or densify a mark",INCORRECT_CONSTRAINT_INFO:"Constrain information is incorreclty passed",FEATURE_NOT_IMPLEMENTED:"This feature has not been implemented yet"};class Layout{constructor(t){this.group=void 0}run(){}clone(){}}class GridLayout extends Layout{constructor(t){super(),this.type="grid",this._numCols=t.numCols,this._numRows=t.numRows,this.baseline=t.baseline,this._horzDir=t.hasOwnProperty("hDir")?t.hDir:GridLayout.direction.Left2Right,this._vert2Dir=t.hasOwnProperty("vDir")?t.vDir:GridLayout.direction.Top2Bottom,this._hGap=t.hasOwnProperty("hGap")?t.hGap:5,this._vGap=t.hasOwnProperty("vGap")?t.vGap:5,this._cellHorzAlignment=Alignment.Left,this._cellVertAlignment=Alignment.Bottom}toJSON(){let t={args:{}};return t.type=this.type,t.args.numCols=this._numCols,t.args.numRows=this._numRows,t.args.baseline=this.baseline,t.args.hGap=this._hGap,t.args.vGap=this._vGap,t.args.horzCellAlignment=this._cellHorzAlignment,t.args.vertCellAlignment=this._cellVertAlignment,t.left=this._left,t.top=this._top,t}clone(){return new GridLayout({numCols:this._numCols,numRows:this._numRows,hDir:this._horzDir,vDir:this._vert2Dir,hGap:this._hGap,vGap:this._vGap})}get cellBounds(){let t,e,r=this.group,i=this._hGap,n=this._vGap;this._numRows?(t=this._numRows,e=Math.ceil(this.group.children.length/this._numRows)):this._numCols&&(e=this._numCols,t=Math.ceil(this.group.children.length/this._numCols));let s=r.children.map((t=>t.bounds));if(void 0===this._left){let t=s.map((t=>t.left)),e=s.map((t=>t.top));this._left=Math.min(...t),this._top=Math.min(...e)}let a=s.map((t=>t.width)),o=s.map((t=>t.height)),h=Math.max(...a),l=Math.max(...o),u=r.getInternalEncodings("x"),c=r.getInternalEncodings("y"),d=r.getInternalEncodings("width"),f=r.getInternalEncodings("height"),p=0;return u.length>0?(h=u[u.length-1].scale.rangeExtent,p=u[u.length-1].scale.range[0]):d.length>0&&d[d.length-1]._rectNegativeValues&&(h=d[d.length-1].scale.rangeExtent,p=d[d.length-1].scale.range[0]),c.length>0?l=c[c.length-1].scale.rangeExtent:f.length>0&&f[f.length-1]._rectNegativeValues&&(l=f[f.length-1].scale.rangeExtent),r.children.map(((t,r)=>new Rectangle(this._left+(h+i)*(r%e)+p,this._top+(l+n)*Math.floor(r/e),h,l)))}run(){if(null==this.group)return;let t=this.cellBounds,e=this.group.getInternalEncodings("x"),r=this.group.getInternalEncodings("y"),i=this.group.getInternalEncodings("width"),n=this.group.getInternalEncodings("height");for(let i=0;i<this.group.children.length;i++){let n=this.group.children[i],s=t[i],a=s.x-n.bounds.x,o=s.y-n.bounds.y;n.translate(a,o);let h=0,l=0;if(0==e.length)switch(this._cellHorzAlignment){case Alignment.Left:h=s.left-n.bounds.left;break;case Alignment.Center:h=s.x-n.bounds.x;break;case Alignment.Right:h=s.right-n.bounds.right}if(0==r.length)switch(this._cellVertAlignment){case Alignment.Top:l=s.top-n.bounds.top;break;case Alignment.Middle:l=s.y-n.bounds.y;break;case Alignment.Bottom:l=s.bottom-n.bounds.bottom}n.translate(h,l)}if(e.length>0){e[e.length-1]._apply()}else if(i.length>0){let t=i[i.length-1];t._rectNegativeValues&&t._apply()}if(r.length>0)r[r.length-1]._apply();else if(n.length>0){let t=n[n.length-1];t._rectNegativeValues&&t._apply()}this.group._updateBounds()}set hGap(t){this._hGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get hGap(){return this._hGap}set vGap(t){this._vGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get vGap(){return this._vGap}set numCols(t){this._numCols=t,this._numRows=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group)}get numCols(){return this._numCols?this._numCols:this._numRows?Math.ceil(this.group.children.length/this._numRows):void 0}set numRows(t){this._numRows=t,this._numCols=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group)}get numRows(){return this._numRows?this._numRows:this._numCols?Math.ceil(this.group.children.length/this._numCols):void 0}set vertCellAlignment(t){if(t!=Alignment.Top&&t!=Alignment.Bottom&&t!=Alignment.Middle)throw Errors.UNKOWN_ALIGNMENT;this._cellVertAlignment=t,this.run()}get vertCellAlignment(){return this._cellVertAlignment}set horzCellAlignment(t){if(t!=Alignment.Left&&t!=Alignment.Center&&t!=Alignment.Right)throw Errors.UNKOWN_ALIGNMENT;this._cellHorzAlignment=t,this.run()}get horzCellAlignment(){return this._cellHorzAlignment}}GridLayout.direction={Left2Right:"l2r",Right2Left:"r2l",Top2Bottom:"t2b",Bottom2Top:"b2t"};class LinearGradient{constructor(t){this._stops=[],this.type=ItemType.LinearGradient,this.id=this.type+ItemCounter[this.type]++,this.x1=t.hasOwnProperty("x1")?t.x1:0,this.x2=t.hasOwnProperty("x2")?t.x2:100,this.y1=t.hasOwnProperty("y1")?t.y1:0,this.y2=t.hasOwnProperty("y2")?t.y2:0}toJSON(){let t={};t.type=this.type,t.id=this.id,t.x1=this.x1,t.x2=this.x2,t.y1=this.y1,t.y2=this.y2,t.stops=this._stops}addStop(t,e,r){this._stops.push({offset:t,color:e,opacity:r})}get stops(){return this._stops}}class Mark{constructor(t){if(this._dataScope=void 0,this.attrs={},this.styles={},void 0!==t){for(let e in Attr2SVG)t.hasOwnProperty(e)&&(this.attrs[e]=t[e]);for(let e in Style2SVG)t.hasOwnProperty(e)&&(this.styles[e]=t[e])}}toJSON(){let t={};t.type=this.type,t.id=this.id,this.classId&&(t.classId=this.classId),this._dataScope&&(t.dataScope=this._dataScope.toJSON()),t.args={};for(let e in this.attrs)t.args[e]=this.attrs[e];for(let e in this.styles)e.indexOf("color")>0&&this.styles[e]instanceof LinearGradient?t.args[e]=this.styles[e].toJSON():t.args[e]=this.styles[e];return t}getScene(){let t=this;for(;t;){if(t.type==ItemType.Scene)return t;t=t.parent}}set dataScope(t){this._dataScope=t}get dataScope(){return this._dataScope}duplicate(){let t=this.getScene().mark(this.type);return this.copyPropertiesTo(t),t.classId=this.classId,this._dataScope&&(t._dataScope=this._dataScope.clone()),t}translate(t,e){}set visibility(t){this.styles.visibility=t}get visibility(){return this.styles.visibility}get opacity(){return this.styles.opacity}set opacity(t){this.styles.opacity=t}}const EPSILON=1e-12,TRIGONOMETRIC_EPSILON=1e-8;function isZero(t){return t>=-EPSILON&&t<=EPSILON}class Point$1{constructor(t,e){this.x=t,this.y=e}transform(t){return t?t._transformPoint(this):this}negate(){return new Point$1(-this.x,-this.y)}subtract(t){return new Point$1(this.x-t.x,this.y-t.y)}isZero(){return isZero(this.x)&&isZero(this.y)}isCollinear(t){let e=this.x,r=this.y,i=t.x,n=t.y;return Math.abs(e*n-r*i)<=Math.sqrt((e*e+r*r)*(i*i+n*n))*TRIGONOMETRIC_EPSILON}}class Vertex{constructor(t,e,r){this.type="vertex",this._id=r,this.x=t.x,this.y=t.y,this.dataScope=void 0,this.parent=e,this.shape=void 0,this.width=0,this.height=0,this.radius=0,this.fillColor="#555",this.opacity=1,this.strokeWidth=0,this.strokeColor="#aaa"}get id(){return this.parent.id+"v"+this._id}toJSON(){let t={};return t.type=this.type,t.id=this._id,t.x=this.x,t.y=this.y,this._dataScope&&(t.dataScope=this._dataScope.toJSON()),t.shape=this.shape,t.width=this.width,t.height=this.height,t.radius=this.radius,t.fillColor=this.fillColor,t.opacity=this.opacity,t.strokeWidth=this.strokeWidth,t.strokeColor=this.strokeColor,t}static fromJSON(t,e){let r=new Vertex(t,e,t.id);return t.dataScope&&(r.dataScope=t.dataScope),r.shape=t.shape,r.width=t.width,r.height=t.height,r.radius=t.radius,r.fillColor=t.fillColor,r.opacity=t.opacity,r.strokeWidth=t.strokeWidth,r.strokeColor=t.strokeColor,r}translate(t,e){this.x+=t,this.y+=e}_clone(t){let e=new Vertex(new Point$1(this.x,this.y),t,this._id);return this.dataScope&&(e.dataScope=this.dataScope.clone()),e.shape=this.shape,e.width=this.width,e.height=this.height,e.radius=this.radius,e.fillColor=this.fillColor,e.opacity=this.opacity,e.strokeWidth=this.strokeWidth,e.strokeColor=this.strokeColor,e}}Vertex.styles=["vxShape","vxWidth","vxHeight","vxRadius","vxFillColor","vxStrokeColor","vxStrokeWidth","vxOpacity"];class Segment{constructor(t,e,r,i){this.type="segment",this._id=i,this.vertex1=t,this.vertex2=e,this.dataScope=void 0,this.parent=r}get id(){return this.parent.id+"s"+this._id}translate(t,e){this.vertex1.translate(t,e),this.vertex2.translate(t,e)}get x(){return(this.vertex1.x+this.vertex2.x)/2}get y(){return(this.vertex1.y+this.vertex2.y)/2}}class Path$1 extends Mark{constructor(t){if(super(t),this.type=ItemType.Path,this.styles.hasOwnProperty("strokeColor")||(this.styles.strokeColor="#ccc"),this.styles.hasOwnProperty("strokeWidth")||(this.styles.strokeWidth=1),this.styles.hasOwnProperty("strokeDash")||(this.styles.strokeDash="none"),this.vertices=[],this.vertexCounter=0,this.segmentCounter=0,this.segments=[],this.anchor=void 0,this.closed=!1,this.curveMode="linear",this._vxShape=void 0,this._vxWidth=0,this._vxHeight=0,this._vxRadius=0,this._vxFillColor="#555",this._vxStrokeColor="#aaa",this._vxStrokeWidth=0,this._vxOpacity=1,void 0!==t){for(let e of Vertex.styles)t.hasOwnProperty(e)&&(this["_"+e]=t[e]);t.hasOwnProperty("vertices")&&this._setVertices(t.vertices)}}toJSON(){let t=super.toJSON();t.type=this.type,t.id=this.id,t.vertices=[];for(let e of this.vertices)t.vertices.push(e.toJSON());t.vertexCounter=this.vertexCounter,t.segmentCounter=this.segmentCounter,t.curveMode=this.curveMode,this._bounds&&(t.bounds=this._bounds.toJSON());for(let e of Vertex.styles)t.args[e]=this[e];return t}_setVertices(t){let e,r;this.vertices=[],this.segments=[];for(let i=0;i<t.length;i++){r=new Point$1(t[i][0],t[i][1]),e=new Vertex(r,this,this.vertexCounter++);for(let t of Vertex.styles)if(this[t]){let r=t.replace("vx","");e[r[0].toLowerCase()+r.slice(1)]=this[t]}this.vertices.push(e),i>0&&this.segments.push(new Segment(this.vertices[i-1],this.vertices[i],this,this.segmentCounter++))}}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles);for(let e of Vertex.styles)this["_"+e]&&(t["_"+e]=this["_"+e]);this._dataScope&&(t._dataScope=this._dataScope.clone()),t.closed=this.closed,t.curveMode=this.curveMode,t.vertices=[],t.segments=[];for(let e of this.vertices)t.vertices.push(e._clone(t));t.segmentCounter=0;for(let e=1;e<t.vertices.length;e++)t.segments.push(new Segment(t.vertices[e-1],t.vertices[e],t,t.segmentCounter++));t.closed&&t.segments.push(new Segment(t.vertices[t.vertices.length-1],t.vertices[0],t,t.segmentCounter++))}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get x(){return this.bounds.x}get y(){return this.bounds.y}get strokeColor(){return this.styles.strokeColor}set strokeColor(t){this.styles.strokeColor=t}get strokeWidth(){return this.styles.strokeWidth}set strokeWidth(t){this.styles.strokeWidth=t}get fillColor(){return this.styles.fillColor}set fillColor(t){this.styles.fillColor=t}get strokeDash(){return this.styles.strokeDash}set strokeDash(t){this.styles.strokeDash=t}translate(t,e){for(let r of this.vertices)r.translate(t,e);this._updateBounds()}resize(t,e){let r=this.bounds;for(let i of this.vertices)i.x=r.x+t/r.width*(i.x-r.x),i.y=r.y+e/r.height*(i.y-r.y);this._updateBounds()}_updateBounds(){let t=this.vertices.map((t=>t.x)),e=this.vertices.map((t=>t.y)),r=Math.min(...t),i=Math.min(...e),n=Math.max(...t),s=Math.max(...e);this._bounds=new Rectangle(r,i,n-r,s-i)}addVertex(t,e,r){let i=new Vertex(new Point$1(t,e),this,this.vertexCounter++);this.vertices.splice(r,0,i)}sortVertices(t,e){this.vertices.sort(((e,r)=>e[t]-r[t])),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){let e=this.segments[t];e.vertex1=this.vertices[t],e.vertex2=this.vertices[(t+1)%this.vertices.length]}}sortVerticesByData(t,e,r){let i;i=r?(e,i)=>r.indexOf(e.dataScope.getFieldValue(t))-r.indexOf(i.dataScope.getFieldValue(t)):(e,r)=>e.dataScope.getFieldValue(t)<r.dataScope.getFieldValue(t)?-1:1,this.vertices.sort(i),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){this.segments[t].vertex1=this.vertices[t],egment.vertex2=this.vertices[(t+1)%this.vertices.length]}}getSVGPathData(){let t=path(),e=this._getD3CurveFunction(this.curveMode)(t);e.lineStart();for(let t of this.vertices)e.point(t.x,t.y);return this.closed&&e.point(this.vertices[0].x,this.vertices[0].y),e.lineEnd(),t._}get firstVertex(){return this.vertices[0]}_getD3CurveFunction(t){switch(t){case CurveMode.Natural:return natural;case CurveMode.Basis:return basis$2;case CurveMode.BumpX:return bumpX;case CurveMode.BumpY:return bumpY;case CurveMode.Linear:return curveLinear;case CurveMode.Step:return step;case CurveMode.CatmullRom:return catmullRom;case CurveMode.Cardinal:return cardinal;default:return curveLinear}}get vxShape(){return this._vxShape}set vxShape(t){this._vxShape=t;for(let e of this.vertices)e.shape=t}get vxWidth(){return this._vxWidth}set vxWidth(t){this._vxWidth=t;for(let e of this.vertices)e.width=t}get vxHeight(){return this._vxHeight}set vxHeight(t){this._vxHeight=t;for(let e of this.vertices)e.height=t}get vxRadius(){return this._vxRadius}set vxRadius(t){this._vxRadius=t;for(let e of this.vertices)e.radius=t}get vxFillColor(){return this._vxFillColor}set vxFillColor(t){this._vxFillColor=t;for(let e of this.vertices)e.fillColor=t}get vxStrokeColor(){return this._vxStrokeColor}set vxStrokeColor(t){this._vxStrokeColor=t;for(let e of this.vertices)e.strokeColor=t}get vxStrokeWidth(){return this._vxStrokeWidth}set vxStrokeWidth(t){this._vxStrokeWidth=t;for(let e of this.vertices)e.strokeWidth=t}get vxOpacity(){return this._vxOpacity}set vxOpacity(t){this._vxOpacity=t;for(let e of this.vertices)e.opacity=t}}function findItems(t,e){let r=[];return _findItemsRecursive(t,e,r),r}function getPeers(t,e){return"vertex"==t.type?_getPeerVertices(t,e):"segment"==t.type?_getPeerSegments(t,e):findItems(e,(e=>e.classId==t.classId))}function getPeersGroupedByParent(t,e){let r={},i=getPeers(t,e);for(let t of i){let e=t.parent.id;r.hasOwnProperty(e)||(r[e]=[]),r[e].push(t)}return Object.keys(r).map((t=>r[t]))}function _getPeerSegments(t,e){if(t.dataScope){let r=t.parent;if(!r)throw new Error("segment has no parent mark");let i=findItems(e,(t=>t.classId==r.classId)),n=[];for(let t of i)n=n.concat(t.segments);return n}{let r=t.parent;if(!r)throw new Error("segment has no parent mark");let i=r.segments.indexOf(t),n=findItems(e,(t=>t.classId==r.classId)),s=[];for(let t of n)s.push(t.segments[i]);return s}}function _getPeerVertices(t,e){if(!t.classId){if(t.dataScope){let r=t.parent;if(!r)throw new Error("vertex has no parent mark");let i=findItems(e,(t=>t.classId==r.classId)),n=[];for(let t of i)n=n.concat(t.vertices);return n}{let r=t.parent;if(!r)throw new Error("vertex has no parent mark");let i=r.vertices.indexOf(t),n=findItems(e,(t=>t.classId==r.classId)),s=[];for(let t of n)s.push(t.vertices[i]);return s}}}function _findItemsRecursive(t,e,r){if(t&&"axis"!=t.type&&"legend"!=t.type&&"gridlines"!=t.type)if(_matchCriteria(t,e)&&r.push(t),t.vertices)for(let i of t.vertices.concat(t.segments))_matchCriteria(i,e)&&r.push(i);else if(t.children&&t.children.length>0)for(let i of t.children)_findItemsRecursive(i,e,r)}function _matchCriteria(t,e){return e(t)}function getClosestLayout(t){let e=t.parent;for(;e&&e.type!=ItemType.Scene;){if(e.layout)return e.layout;e=e.parent}}function getAllLayouts(t){let e=getParents(t),r=[];for(;e&&e[0].type!=ItemType.Scene;){for(let t of e)t.layout&&r.push(t.layout);e=getParents(e)}return r}function getCellBoundsInLayout(t){let e=t,r=t.parent;for(;r&&r.type!=ItemType.Scene;){if(r.layout){let t=r.children.findIndex((t=>t==e));return r.layout.cellBounds[t]}e=e.parent,r=e.parent}}function getCellBoundsInGridLayout(t){let e=t,r=t.parent;for(;r&&r.type!=ItemType.Scene;){if(r.layout&&r.layout.type==LayoutType.Grid){let t=r.children.findIndex((t=>t==e));return r.layout.cellBounds[t]}e=e.parent,r=e.parent}}function getEncodingKey(t){return t.classId?t.classId:"vertex"==t.type&&t.dataScope?t.parent.classId+"_v":"vertex"==t.type?t.parent.classId+"_v_"+t.parent.vertices.indexOf(t):"segment"==t.type&&t.dataScope?t.parent.classId+"_s":"segment"==t.type?t.parent.classId+"_s_"+t.parent.segments.indexOf(t):null}function getParents(t){let e=[];for(let r of t)r.parent&&e.indexOf(r.parent)<0&&e.push(r.parent);return e}function isMark(t){return t instanceof Mark}const ItemCounter={area:0,rect:0,circle:0,pie:0,line:0,path:0,ring:0,arc:0,image:0,pointText:0,collection:0,group:0,scene:0,axis:0,glyph:0,legend:0,polygon:0,gridlines:0,LinearGradient:0,link:0,scale:0,datatable:0};function canAlign(t,e,r){if(e==Alignment.Top||e==Alignment.Bottom||e==Alignment.Middle){for(let e of t)if(!canMoveVertically(e,r))return!1;return!0}if(e==Alignment.Left||e==Alignment.Right||e==Alignment.Center){for(let e of t)if(!canMoveHorizontally(e,r))return!1;return!0}}function canMoveHorizontally(t,e){if(e.getEncodingByItem(t,"x"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==LayoutType.Grid&&e.numCols>1)return!1}return!t.parent||t.parent.type==ItemType.Scene||canMoveHorizontally(t.parent,e)}function canMoveVertically(t,e){if(e.getEncodingByItem(t,"y"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==LayoutType.Grid&&e.numRows>1)return!1}return!t.parent||t.parent.type==ItemType.Scene||canMoveVertically(t.parent,e)}function getTextWidth(t,e){let r=(getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");return r.font=e,r.measureText(t).width}function getTopLevelGroup(t){let e=t.parent;return e.type==ItemType.Scene?t:getTopLevelGroup(e)}function polar2Cartesian(t,e,r,i){return[r*Math.cos(degree2radian(i))+t,e-r*Math.sin(degree2radian(i))]}function cartesian2Polar(t,e,r,i){let n=radian2degree(Math.atan2(i-e,t-r));n=Math.round(10*n+Number.EPSILON)/10,n<0&&(n+=360);let s=Math.sqrt(Math.pow(t-r,2)+Math.pow(e-i,2));return s=Math.round(10*s+Number.EPSILON)/10,[n,s]}function degree2radian(t){return t*Math.PI/180}function radian2degree(t){return 180*t/Math.PI}function CheckAreaOrien(t){let e=t.vertices.length;for(let r=0;r<t.vertices.length/2;r++){let i=r,n=e-r-1,s=t.vertices[i],a=t.vertices[n];if(s.x!=a.x||s.y!=a.y)return s.x==a.x?"horizontal":"vertical"}}class Group{constructor(){this.children=[],this._dataScope=void 0,this._layout=void 0,this.type=ItemType.Group,this.id=this.type+ItemCounter[this.type]++}toJSON(){let t={};if(t.type=this.type,t.id=this.id,this._dataScope&&(t.dataScope=this._dataScope.toJSON()),this.classId&&(t.classId=this.classId),this._layout&&(t.layout=this._layout.toJSON()),this._bounds&&(t.bounds=this._bounds.toJSON()),this.children.length>0&&this.type!=ItemType.Axis){t.children=[];for(let e of this.children)t.children.push(e.toJSON())}return this.childrenOrder&&(t.childrenOrder=this.childrenOrder),t}addChild(t){t.parent&&t.parent.removeChild(t),this.children.push(t),t.parent=this}addChildAt(t,e){t.parent&&t.parent.removeChild(t),this.children.splice(e,0,t),t.parent=this}removeChild(t){let e=this.children.indexOf(t);e>=0&&this.children.splice(e,1),t.parent=null}removeAll(){for(let t of this.children)t.parent=null;this.children=[]}getScene(){let t=this;for(;t;){if(t.type==ItemType.Scene)return t;t=t.parent}}get dataScope(){return this._dataScope}set dataScope(t){this._dataScope=t;for(let e of this.children)e.dataScope?e.dataScope=e.dataScope.merge(t):e.dataScope=t}translate(t,e){for(let r of this.children)r.translate(t,e);this._updateBounds(),this._layout&&(null!=this._layout._left&&(this._layout._left+=t),null!=this._layout._top&&(this._layout._top+=e),this._layout.run()),this._updateBounds()}getInternalEncodings(t){if(0==this.children.length)return[];let e=this.children[0],r=this.getScene(),i=Object.keys(r.encodings),n=[];for(;e&&(e.classId&&n.indexOf(e.classId)<0&&n.push(e.classId),e.children);)e=e.children[0];let s=[];for(let e of i){let i=e.split("_");for(let a of n)i[0]==a&&r.encodings[e][t]&&s.push(r.encodings[e][t])}return s}get firstChild(){return this.children[0]}set layout(t){this._layout=t,t.group=this,this._layout.run()}get layout(){return this._layout}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get x(){return this.bounds.x}get y(){return this.bounds.y}_updateBounds(){if(this._layout&&"grid"==this._layout.type){let t=this._layout.cellBounds;this._bounds=t[0].clone();for(let e=1;e<t.length;e++)this._bounds=this._bounds.union(t[e])}else if(this.children.length>0){this._bounds=this.children[0].bounds.clone();for(let t=0;t<this.children.length;t++)this._bounds=this._bounds.union(this.children[t].bounds)}else this._bounds=new Rectangle(0,0,0,0)}sortChildrenByData(t,e,r){let i;switch(this.children[0].dataScope.getFieldType(t)){case DataType.Date:break;case DataType.Number:case DataType.Integer:i=(e,r)=>e.dataScope.aggregateNumericalField(t)-r.dataScope.aggregateNumericalField(t);break;case DataType.String:i=r?(e,i)=>r.indexOf(e.dataScope.getFieldValue(t))-r.indexOf(i.dataScope.getFieldValue(t)):(e,r)=>e.dataScope.getFieldValue(t)<r.dataScope.getFieldValue(t)?-1:1}this.children.sort(i),e&&this.children.reverse(),this.layout&&this.layout.run(),this.childrenOrder={field:t,reverse:e,order:r}}sortChildren(t,e){let r;switch(t){case"x":case"y":case"width":case"height":r=(e,r)=>e.bounds[t]-r.bounds[t];break;default:r=(e,r)=>e[t]-r[t]}this.children.sort(r),e&&this.children.reverse(),this.layout&&this.layout.run(),this.childrenOrder={channel:t,reverse:e}}}function validateField(t,e){if(e.hasField(t))return!0;if(e.tree&&e.tree.nodeTable.hasField(t.split(".")[1]))return!0;throw new Error(Errors$1.FIELD_NONEXISTENT+", field: "+t+", data table: "+e.name)}class DataScope{constructor(t){this._field2value={},this._dt=t,this._tuples=this._dt.data}toJSON(){let t={};return t.dt=this._dt.url,t.f2v=Object.assign({},this._field2value),t}isEmpty(){return 0==this._tuples.length}get numTuples(){return this._tuples.length}get fields(){return Object.keys(this._field2value)}get dataTable(){return this._dt}merge(t){let e=new DataScope(this._dt);for(let r in t._field2value)e=e.cross(r,t._field2value[r]);for(let t in this._field2value)e=e.cross(t,this._field2value[t]);return e}cross(t,e){let r=this.clone();return r._field2value[t]=e,r._updateTuples(t,e),r}clone(){let t=new DataScope(this._dt);return t._field2value=Object.assign({},this._field2value),t._tuples=this._tuples.map((t=>t)),t}getFieldValue(t){let e=this._tuples.map((e=>e[t]));return e=[...new Set(e)],e.length,e[0]}hasField(t){return this._field2value.hasOwnProperty(t)}getFieldType(t){return this._dt.getFieldType(t)}aggregateNumericalField(t,e){let r=this._tuples.map((e=>e[t]));switch(e){case Aggregator.Max:return Math.max(...r);case Aggregator.Min:return Math.min(...r);case Aggregator.Avg:case Aggregator.Mean:return mean(r);case Aggregator.Median:return median(r);case Aggregator.Count:return r.length;case Aggregator.Percentile25:return quantile(r,.25);case Aggregator.Percentile75:return quantile(r,.75);case Aggregator.Sum:default:return sum(r)}}_updateTuples(t,e){this._tuples=this._tuples.filter((r=>r[t]==e))}}class Collection extends Group{constructor(){super(),this.type=ItemType.Collection,this.id=this.type+ItemCounter[this.type]++,this.classId=this.id}duplicate(){let t=new Collection;for(let e=0;e<this.children.length;e++){let r=this.children[e];t.addChild(r.duplicate())}if(t.classId=this.classId,t.parent=this.parent,this._layout){let e=this._layout.clone();t.layout=e}return t}}function repeatItem(t,e,r,i,n){let s=n?i.transformField(r,n):r,a=i.getFieldType(s);if(a!=DataType.String&&a!=DataType.Date)throw new Error(Errors$1.REPEAT_BY_NONCAT+": "+s+" is "+a);if(!_canRepeat(e))throw new Error(Errors$1.COMPNT_NON_REPEATABLE);return _doRepeat(t,e,s,i)}function _canRepeat(t,e,r){return!(!isMark(t)&&t.type!=ItemType.Glyph||t.dataScope)||t.type==ItemType.Collection}function _doRepeat(t,e,r,i){let n=i.getFieldSummary(r).unique.map((t=>new DataScope(i).cross(r,t))),s=new Collection;t.addChild(s),s.addChild(e);for(let t=1;t<n.length;t++){let t=e.duplicate();s.addChild(t)}return s.children.forEach(((t,e)=>t.dataScope=n[e])),t._reapplySizeBindings(e),s}class StackLayout extends Layout{constructor(t){super(t),this.type=LayoutType.Stack,this._orientation=t.orientation,this._left=t.left,this._top=t.top,this.baseline=t.baseline,this._horzCellAlignment=t.hasOwnProperty("horzCellAlignment")?t.horzCellAlignment:Alignment.Left,this._vertCellAlignment=t.hasOwnProperty("vertCellAlignment")?t.vertCellAlignment:Alignment.Bottom,this._gap=t.hasOwnProperty("gap")?t.gap:0}toJSON(){let t={args:{}};return t.type=this.type,t.args.orientation=this._orientation,t.args.left=this._left,t.args.top=this._top,t.args.baseline=this.baseline,t.args.gap=this._gap,t.args.horzCellAlignment=this._horzCellAlignment,t.args.vertCellAlignment=this._vertCellAlignment,t}clone(){let t=new StackLayout({orientation:this._orientation,left:this._left,top:this._top,baseline:this.baseline});return t._horzCellAlignment=this._horzCellAlignment,t._vertCellAlignment=this._vertCellAlignment,t}_stackAreas(){let t=this.group.children[0],e=t.vertices.length/2,r=new Array(e).fill(0),i=CheckAreaOrien(t);for(let t of this.group.children){for(let r=0;r<e;r++){let n,s=t.vertices[r],a=t.vertices[2*e-r-1];switch(i){case Orientation.Horizontal:n=this._vertCellAlignment==Alignment.Bottom?this.group.bounds.bottom-a.y:this.group.bounds.top-a.y,s.translate(0,n),a.translate(0,n);break;case Orientation.Vertical:n=this._horzCellAlignment==Alignment.Left?this.group.bounds.left-a.x:this.group.bounds.right-a.x,s.translate(n,0),a.translate(n,0)}}t._updateBounds()}for(let t of this.group.children){for(let n=0;n<e;n++){let s=t.vertices[n],a=t.vertices[2*e-n-1];switch(i){case Orientation.Horizontal:s.translate(0,r[n]),a.translate(0,r[n]),r[n]=r[n]+s.y-a.y;break;case Orientation.Vertical:s.translate(r[n],0),a.translate(r[n],0),r[n]=r[n]+s.x-a.x}}t._updateBounds()}this.group._updateBounds();let n=this.group._bounds.height,s=this.group._bounds.width;if(this.baseline==Alignment.Center||this.baseline==Alignment.Middle)for(let t of this.group.children){for(let a=0;a<e;a++){let o,h=t.vertices[a],l=t.vertices[2*e-a-1];switch(i){case Orientation.Horizontal:o=-(r[a]+n)/2,h.translate(0,o),l.translate(0,o);break;case Orientation.Vertical:o=(s-r[a])/2,h.translate(o,0),l.translate(o,0)}}t._updateBounds()}this.group._updateBounds()}_stackRects(){let t=this.group.getScene(),e=this.group,r=this._orientation,i=e.children.map((t=>t.bounds)),n=i.map((t=>t.left)),s=i.map((t=>t.top)),a=i.map((t=>t.width)),o=i.map((t=>t.height)),h=null==this._left?Math.min(...n):this._left,l=null==this._top?Math.min(...s):this._top,u=Math.max(...a),c=Math.max(...o);if(r==Orientation.Vertical){let r=h+u/2;for(let i=0;i<e.children.length;i++){let n=e.children[i],s=r-n.bounds.x,a=l+n.bounds.height/2-n.bounds.y;l+=n.bounds.height+this._gap,n.translate(s,a);let o=0,c=0;if(!t.getEncodingByItem(n,"x"))switch(this._horzCellAlignment){case Alignment.Left:o=h-n.bounds.left;break;case Alignment.Center:o=h+u/2-n.bounds.x;break;case Alignment.Right:o=h+u-n.bounds.right}n.translate(o,c)}}else{let r=l+c/2;for(let i=0;i<e.children.length;i++){let n=e.children[i],s=h+n.bounds.width/2-n.bounds.x,a=r-n.bounds.y;h+=n.bounds.width+this._gap,n.translate(s,a);let o=0,u=0;if(!t.getEncodingByItem(n,"y"))switch(this._vertCellAlignment){case Alignment.Top:u=l-n.bounds.top;break;case Alignment.Middle:u=l+c/2-n.bounds.y;break;case Alignment.Bottom:u=l+c-n.bounds.bottom}n.translate(o,u)}}this.group._updateBounds()}run(){null!=this.group&&("area"==this.group.children[0].type?this._stackAreas():this._stackRects())}set vertCellAlignment(t){if(t!=Alignment.Top&&t!=Alignment.Bottom&&t!=Alignment.Middle)throw Errors.UNKOWN_ALIGNMENT;this._vertCellAlignment=t,this.run()}get vertCellAlignment(){return this._vertCellAlignment}set horzCellAlignment(t){if(t!=Alignment.Left&&t!=Alignment.Center&&t!=Alignment.Right)throw Errors.UNKOWN_ALIGNMENT;this._horzCellAlignment=t,this.run()}get horzCellAlignment(){return this._horzCellAlignment}get cellBounds(){return this.group.children.map((t=>t.bounds))}get orientation(){return this._orientation}}function divideItem(t,e,r,i,n,s){let a=s?n.transformField(i,s):i,o=n.getFieldType(a);if(o!=DataType.String&&o!=DataType.Date)throw new Error(Errors$1.PARTITION_BY_NONCAT+": "+a+" is "+o);if(!_canDivide(e,a,t))throw new Error(Errors$1.COMPNT_NON_PARTITIONABLE);switch(e.type){case ItemType.Line:return _doLineDivide();case ItemType.Circle:return _doCircleDivide(t,e,r,a,n);case ItemType.Rect:return _doRectDivide(t,e,r,a,n);case ItemType.Area:return _doAreaDivide(t,e,r,a,n);case ItemType.Ring:return _doRingDivide(t,e,r,a,n)}}function _canDivide(t,e,r){if([ItemType.Line,ItemType.Circle,ItemType.Rect,ItemType.Area,ItemType.Ring].indexOf(t.type)<0)return!1;if(t.dataScope){let e=getPeers(t,r);for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function _doLineDivide(t,e,r,i){}function _doRectDivide(t,e,r,i,n){let s,a,o=getPeers(e,t),h=r||Orientation.Horizontal,l=n.getFieldSummary(i).unique.map((t=>new DataScope(n).cross(i,t))),u={},c=0;for(let t of o){let e=l;t.dataScope&&(e=l.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>c&&(c=e.length),u[t.id]=e}for(let t of o){let r=new Collection;null==a&&(a=r.id),r.classId=a,r.dataScope=t.dataScope;let i=t.parent;i.children.indexOf(t);i.addChild(r);let n=u[t.id],o=t.bounds,l=o.left,d=o.top,f=h==Orientation.Horizontal?o.width/c:o.width,p=h==Orientation.Horizontal?o.height:o.height/c;t.classId=e.id,t.resize(f,p),t.dataScope=n[0],r.addChild(t);for(let e=1;e<n.length;e++){let i=t.duplicate();i.resize(f,p),i.dataScope=n[e],r.addChild(i)}r.layout=new StackLayout({orientation:h,left:l,top:d}),t==e&&(s=r)}return t._reapplySizeBindings(s),s}function _doAreaDivide(t,e,r,i,n){let s,a=getPeers(e,t),o=a[0];if(4==o.vertices.length&&r==Orientation.Horizontal&&o.vertices[0].x!==o.vertices[1].x)for(let t of a){let e=t.vertices[1];t.vertices[1]=t.vertices[3],t.vertices[3]=e}let h,l=n.getFieldSummary(i).unique.map((t=>new DataScope(n).cross(i,t)));for(let t of a){let i=new Collection;null==h&&(h=i.id),i.classId=h,i.dataScope=t.dataScope,t.parent.addChild(i);let n=t.left,a=t.top,o=r==Orientation.Horizontal?t.width/l.length:t.width,u=r==Orientation.Horizontal?t.height:t.height/l.length;t.classId=e.id,t.resizeArea(o,u),i.addChild(t);for(let e=1;e<l.length;e++){let e=t.duplicate();e.resizeArea(o,u),i.addChild(e)}for(let t=0;t<i.children.length;t++){let e=i.children[t];e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];for(let[t,r]of e.vertices.entries())r.dataScope?r.dataScope=e.dataScope.merge(r.dataScope):r.dataScope=e.dataScope}i.layout=new StackLayout({orientation:r,left:n,top:a}),t==e&&(s=i)}return t._reapplySizeBindings(s),s}function _doRingDivide(t,e,r,i,n){let s,a,o=r||Orientation.Angular,h=getPeers(e,t);if(o==Orientation.Angular)return h.forEach((r=>{let o=r.dataScope?r.dataScope:new DataScope(n),h=n.getFieldSummary(i).unique.map((t=>o.cross(i,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,u=new Collection;u.dataScope=o,null==a&&(a=u.id),u.classId=a;let c=r.parent,d=360/l;for(let i=0;i<l;i++){let n=t.mark("arc",{innerRadius:r.innerRadius,outerRadius:r.outerRadius,x:r.x,y:r.y,startAngle:90-d*(i+1),endAngle:90-d*i,strokeColor:r.strokeColor,fillColor:r.fillColor,strokeWidth:r.strokeWidth,opacity:r.opacity});n.dataScope=h[i],n.classId=e.id,u.addChild(n)}c.removeChild(r),c.addChild(u),r==e&&(s=u)})),s}function _doCircleDivide(t,e,r,i,n){let s,a,o=r||Orientation.Angular,h=getPeers(e,t);return o==Orientation.Angular?h.forEach((r=>{let o=r.dataScope?r.dataScope:new DataScope(n),h=n.getFieldSummary(i).unique.map((t=>o.cross(i,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,u=new Collection;u.dataScope=o,null==a&&(a=u.id),u.classId=a;let c=r.parent,d=360/l;for(let i=0;i<l;i++){let n=t.mark("pie",{radius:r.radius,x:r.x,y:r.y,startAngle:90-d*(i+1),endAngle:90-d*i,strokeColor:"#444444",fillColor:r.styles.fillColor});n.dataScope=h[i],n.classId=e.id,u.addChild(n)}c.removeChild(r),c.addChild(u),r==e&&(s=u)})):h.forEach((r=>{let o=r.dataScope?r.dataScope:new DataScope(n),h=n.getFieldSummary(i).unique.map((t=>o.cross(i,t)));h=h.filter((t=>!t.isEmpty()));h.length;let l=new Collection;l.dataScope=o,null==a&&(a=l.id),l.classId=a;let u=r.parent,c=360/numPies;for(let i=0;i<numPies;i++){let n=t.mark("pie",{radius:r.radius,x:r.x,y:r.y,startAng:c*i,endAng:c+c*i,strokeColor:"#444444",fillColor:r.styles.fillColor});n.dataScope=h[i],n.classId=e.id,l.addChild(n)}u.removeChild(r),u.addChild(l),r==e&&(s=l)})),s}function densifyItem(t,e,r,i,n,s,a,o){let h=s?n.transformField(i,s):i,l=n.getFieldType(h);if(l!=DataType.String&&l!=DataType.Date&&l!=DataType.Number)throw new Error(Errors$1.DENSIFY_BY_NONCAT+": "+h+" is "+l);if(!_canDensify(e,h,t))throw new Error(Errors$1.COMPNT_NON_DENSIFIABLE);switch(e.type){case ItemType.Line:return _doLineDensify(t,e,h,n);case ItemType.Circle:return _doCircleDensify(t,e,h,n,a,o);case ItemType.Rect:case ItemType.Area:return _doAreaDensify(t,e,r,h,n)}}function _canDensify(t,e,r){if([ItemType.Line,ItemType.Circle,ItemType.Rect,ItemType.Area].indexOf(t.type)<0)return!1;if(t.dataScope){let e=getPeers(t,r);for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function _doLineDensify(t,e,r,i){let n,s=getPeers(e,t);for(let a of s){let s=a.dataScope?a.dataScope:new DataScope(i),o=i.getFieldSummary(r).unique.map((t=>s.cross(r,t)));o=o.filter((t=>!t.isEmpty()));let h=Object.assign({},a.styles);for(let t of Vertex.styles)a[t]&&(h[t]=a[t]);let l=a.vertices[0].x,u=a.vertices[0].y,c=[],d=a.vertices[1].x-l,f=a.vertices[1].y-u;for(let t=0;t<o.length;t++)c.push([l+t*d/(o.length-1),u+t*f/(o.length-1)]);h.vertices=c;let p=t.mark("path",h);p.classId=e.id,p.dataScope=s;let _=a.parent;_.addChild(p),_.removeChild(a);for(let[t,e]of p.vertices.entries())e.dataScope?e.dataScope=e.dataScope.merge(o[t]):e.dataScope=o[t];a==e&&(n=p)}return n}function _doAreaDensify(t,e,r,i,n){let s,a=getPeers(e,t);for(let o of a){let a=n.getFieldType(i),h=o.dataScope?o.dataScope:new DataScope(n),l=n.getFieldSummary(i).unique.map((t=>h.cross(i,t)));l=a==DataType.Number?l:l.filter((t=>!t.isEmpty())),a!=DataType.Number&&a!=DataType.Date||l.sort(((t,e)=>t._field2value[i]>e._field2value[i]?1:-1));let u=Object.assign({},o.styles),c=o.vertices[0].x,d=o.vertices[0].y,f=o.vertices[o.vertices.length-2].x,p=o.vertices[o.vertices.length-2].y,_=[],g=f-c,m=p-d;for(let t=0;t<l.length;t++)_.push(r==Orientation.Vertical?[f,d+(l.length-1-t)*m/(l.length-1)]:[c+t*g/(l.length-1),d]);for(let t=0;t<l.length;t++)_.push(r==Orientation.Vertical?[c,d+t*m/(l.length-1)]:[c+(l.length-1-t)*g/(l.length-1),p]);u.vertices=_;let y=t.mark("area",u);y.classId="area"==o.type?o.classId:"area"+o.classId.substring(9),y.dataScope=h,y._orientation=r;let v=o.parent;v.addChild(y),v.removeChild(o);for(let[t,e]of y.vertices.entries())t>=l.length?e.dataScope=h.merge(l[2*l.length-1-t]):e.dataScope=h.merge(l[t]);o==e&&(s=y)}return s}function _doCircleDensify(t,e,r,i,n,s){let a;return getPeers(e,t).forEach((o=>{let h=o.dataScope?o.dataScope:new DataScope(i),l=i.getFieldSummary(r).unique.map((t=>h.cross(r,t)));l=l.filter((t=>!t.isEmpty()));let u=l.length;if(u<3)throw Error(Errors$1.INSUFFICIENT_DATA_SCOPES);let c=360/u,d=[],f=[],p="clockwise"==s?-1:1;for(let t=0;t<l.length;t++){let e=n+p*t*c;f[t]=e;let r=polar2Cartesian(o.x,o.y,o.radius,f[t]);d.push(r)}let _=t.mark("polygon",{x:o.x,y:o.y,radius:o.radius,vertices:d});_.dataScope=h,_.styles=Object.assign({},o.styles);for(let t of Vertex.styles)o[t]&&(_[t]=o[t]);let g=o.parent;g.addChild(_),g.removeChild(o);for(let[t,e]of _.vertices.entries())e.polarAngle=f[t],e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];o==e&&(a=_)})),a}class RectPath extends Path$1{constructor(t){super(t),this.type=ItemType.Rect,this.closed=!0,t&&t.hasOwnProperty("vertices")&&this.segments.push(new Segment(this.vertices[3],this.vertices[0],this,this.segmentCounter++))}get width(){return this.vertices[1].x-this.vertices[0].x}get height(){return this.vertices[2].y-this.vertices[1].y}set height(t){this.resize(this.width,t)}set width(t){this.resize(t,this.height)}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}get right(){return this.vertices[1].x}get bottom(){return this.vertices[2].y}resize(t,e){this.vertices[1].x=this.vertices[0].x+t,this.vertices[2].x=this.vertices[1].x,this.vertices[0].y=this.vertices[3].y-e,this.vertices[1].y=this.vertices[0].y,this._updateBounds()}get leftSegment(){return this.segments[3]}get rightSegment(){return this.segments[1]}get topSegment(){return this.segments[0]}get bottomSegment(){return this.segments[2]}}class CirclePath extends Path$1{constructor(t){super(t),this.type=ItemType.Circle,this.closed=!0,this.attrs.x=t.hasOwnProperty("x")?t.x:0,this.attrs.y=t.hasOwnProperty("y")?t.y:0,this.attrs.radius=t.hasOwnProperty("radius")?t.radius:100}get radius(){return this.attrs.radius}get x(){return this.attrs.x}get y(){return this.attrs.y}set x(t){this.attrs.x=t,this._updateBounds()}set y(t){this.attrs.y=t,this._updateBounds()}set radius(t){this.attrs.radius=t,this._updateBounds()}set width(t){this.attrs.radius=t/2,this._updateBounds()}set height(t){this.attrs.radius=t/2,this._updateBounds()}resize(t,e){this.attrs.radius=t/2,this._updateBounds()}translate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){this._bounds=new Rectangle(this.attrs.x-this.attrs.radius,this.attrs.y-this.attrs.radius,2*this.attrs.radius,2*this.attrs.radius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t.attrs.x=this.attrs.x,t.attrs.y=this.attrs.y,t.attrs.radius=this.attrs.radius}}function bindToSize(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,r=this.aggregator;switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case DataType.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,r)))}},t._map=function(){let t,e=this.items,r=this.data,i=this.channel;if(t=createScale(this.scaleType?this.scaleType:"linear"),null==this.data.find((t=>t<0))||"width"!=i&&"height"!=i||0!=e[0].type.indexOf("rect")){let n,s;t.domain=[0,Math.max(...r)],"radius"==i||"outerRadius"==i||"innerRadius"==i?(n=0,s=Math.max(...e.map((t=>t[i]))),s<20&&(s=20)):"area"==i?(n=0,s=Math.max(...e.map((t=>Math.pow(t.bounds.width,2)))),s<400&&(s=400)):"fontSize"==i?(n=2,s=Math.max(...e.map((t=>parseFloat(t.styles.fontSize))))):"strokeWidth"==i?(n=1,s=Math.max(...e.map((t=>parseFloat(t.styles.strokeWidth)))),s==n&&(s=n+5)):(n=0,s=Math.max(...e.map((t=>t.bounds[i])))),this.rangeExtent&&(s=n+this.rangeExtent),this.range&&(n=this.range[0],s=this.range[1]),t._setRange([n,s])}else this._rectNegativeValues=!0,t.domain=[Math.min(...r),Math.max(...r)],"width"==i?t._setRange([0,Math.max(...e.map((t=>t.width)))]):t._setRange([0,Math.max(...e.map((t=>t.height)))]);this.scale||(this.scale=t),this.scale._addEncoding(this)},t._apply=function(){if("radius"==this.channel||"outerRadius"==this.channel||"innerRadius"==this.channel){for(let t=0;t<this.items.length;t++){this.items[t][this.channel]=this.scale.map(this.data[t])}this.scene._relayoutAncestors(this.anyItem,this.items)}else if(this._rectNegativeValues){if("width"==this.channel){let t=Math.min(...this.items.map((t=>t.bounds.left)));for(let e=0;e<this.items.length;e++){let r,i=this.items[e],n=i.leftSegment.vertex1.x,s=i.rightSegment.vertex1.x;r=i.parent&&i.parent.type==ItemType.Collection?i.parent.bounds.left:t,i.rightSegment.translate(r+this.scale.map(this.data[e])-s,0),i.leftSegment.translate(r+this.scale.map(0)-n,0),i._updateBounds()}}else if("height"==this.channel){let t=Math.min(...this.items.map((t=>t.bounds.top)))+this.scale.rangeExtent;for(let e=0;e<this.items.length;e++){let r,i=this.items[e],n=i.topSegment.vertex1.y,s=i.bottomSegment.vertex1.y;r=i.parent&&i.parent.type==ItemType.Collection?i.parent.bounds.bottom:t,i.topSegment.translate(0,r-this.scale.map(this.data[e])-n),i.bottomSegment.translate(0,r-this.scale.map(0)-s),i._updateBounds()}}}else if("area"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=Math.sqrt(this.scale.map(this.data[t]));e.resize(r,r)}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("fontSize"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]);e.styles.fontSize=r+"px"}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("strokeWidth"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]);e.styles.strokeWidth=r}this.scene._relayoutAncestors(this.anyItem,this.items)}else{for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]),i="width"==this.channel?r:e.bounds.width,n="height"==this.channel?r:e.bounds.height;e.resize(i,n)}this.scene._relayoutAncestors(this.anyItem,this.items)}},t.run(),t}function colors$1(t){for(var e=t.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+t.slice(6*i,6*++i);return r}var category10$1=colors$1("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Accent=colors$1("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Dark2=colors$1("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Paired=colors$1("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Pastel1=colors$1("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Pastel2=colors$1("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Set1=colors$1("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Set2=colors$1("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Set3=colors$1("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Tableau10=colors$1("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function ramp(t){return rgbBasis(t[t.length-1])}var scheme=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(colors$1),BrBG=ramp(scheme),scheme$1=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(colors$1),PRGn=ramp(scheme$1),scheme$2=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(colors$1),PiYG=ramp(scheme$2),scheme$3=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(colors$1),PuOr=ramp(scheme$3),scheme$4=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(colors$1),RdBu=ramp(scheme$4),scheme$5=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(colors$1),RdGy=ramp(scheme$5),scheme$6=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(colors$1),RdYlBu=ramp(scheme$6),scheme$7=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(colors$1),RdYlGn=ramp(scheme$7),scheme$8=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(colors$1),Spectral=ramp(scheme$8),scheme$9=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(colors$1),BuGn=ramp(scheme$9),scheme$a=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(colors$1),BuPu=ramp(scheme$a),scheme$b=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(colors$1),GnBu=ramp(scheme$b),scheme$c=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(colors$1),OrRd=ramp(scheme$c),scheme$d=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(colors$1),PuBuGn=ramp(scheme$d),scheme$e=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(colors$1),PuBu=ramp(scheme$e),scheme$f=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(colors$1),PuRd=ramp(scheme$f),scheme$g=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(colors$1),RdPu=ramp(scheme$g),scheme$h=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(colors$1),YlGnBu=ramp(scheme$h),scheme$i=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(colors$1),YlGn=ramp(scheme$i),scheme$j=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(colors$1),YlOrBr=ramp(scheme$j),scheme$k=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(colors$1),YlOrRd=ramp(scheme$k),scheme$l=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(colors$1),Blues=ramp(scheme$l),scheme$m=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(colors$1),Greens=ramp(scheme$m),scheme$n=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(colors$1),Greys=ramp(scheme$n),scheme$o=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(colors$1),Purples=ramp(scheme$o),scheme$p=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(colors$1),Reds=ramp(scheme$p),scheme$q=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(colors$1),Oranges=ramp(scheme$q);function cividis(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"}var cubehelix$2=cubehelixLong(cubehelix(300,.5,0),cubehelix(-240,.5,1)),warm=cubehelixLong(cubehelix(-100,.75,.35),cubehelix(80,1.5,.8)),cool=cubehelixLong(cubehelix(260,.75,.35),cubehelix(80,1.5,.8)),c$1=cubehelix();function rainbow(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return c$1.h=360*t-100,c$1.s=1.5-1.5*e,c$1.l=.8-.9*e,c$1+""}var c$2=rgb(),pi_1_3=Math.PI/3,pi_2_3=2*Math.PI/3;function sinebow(t){var e;return t=(.5-t)*Math.PI,c$2.r=255*(e=Math.sin(t))*e,c$2.g=255*(e=Math.sin(t+pi_1_3))*e,c$2.b=255*(e=Math.sin(t+pi_2_3))*e,c$2+""}function turbo(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"}function ramp$1(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}var viridis=ramp$1(colors$1("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),magma=ramp$1(colors$1("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),inferno=ramp$1(colors$1("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),plasma=ramp$1(colors$1("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),d3Chromatic=Object.freeze({__proto__:null,schemeCategory10:category10$1,schemeAccent:Accent,schemeDark2:Dark2,schemePaired:Paired,schemePastel1:Pastel1,schemePastel2:Pastel2,schemeSet1:Set1,schemeSet2:Set2,schemeSet3:Set3,schemeTableau10:Tableau10,interpolateBrBG:BrBG,schemeBrBG:scheme,interpolatePRGn:PRGn,schemePRGn:scheme$1,interpolatePiYG:PiYG,schemePiYG:scheme$2,interpolatePuOr:PuOr,schemePuOr:scheme$3,interpolateRdBu:RdBu,schemeRdBu:scheme$4,interpolateRdGy:RdGy,schemeRdGy:scheme$5,interpolateRdYlBu:RdYlBu,schemeRdYlBu:scheme$6,interpolateRdYlGn:RdYlGn,schemeRdYlGn:scheme$7,interpolateSpectral:Spectral,schemeSpectral:scheme$8,interpolateBuGn:BuGn,schemeBuGn:scheme$9,interpolateBuPu:BuPu,schemeBuPu:scheme$a,interpolateGnBu:GnBu,schemeGnBu:scheme$b,interpolateOrRd:OrRd,schemeOrRd:scheme$c,interpolatePuBuGn:PuBuGn,schemePuBuGn:scheme$d,interpolatePuBu:PuBu,schemePuBu:scheme$e,interpolatePuRd:PuRd,schemePuRd:scheme$f,interpolateRdPu:RdPu,schemeRdPu:scheme$g,interpolateYlGnBu:YlGnBu,schemeYlGnBu:scheme$h,interpolateYlGn:YlGn,schemeYlGn:scheme$i,interpolateYlOrBr:YlOrBr,schemeYlOrBr:scheme$j,interpolateYlOrRd:YlOrRd,schemeYlOrRd:scheme$k,interpolateBlues:Blues,schemeBlues:scheme$l,interpolateGreens:Greens,schemeGreens:scheme$m,interpolateGreys:Greys,schemeGreys:scheme$n,interpolatePurples:Purples,schemePurples:scheme$o,interpolateReds:Reds,schemeReds:scheme$p,interpolateOranges:Oranges,schemeOranges:scheme$q,interpolateCividis:cividis,interpolateCubehelixDefault:cubehelix$2,interpolateRainbow:rainbow,interpolateWarm:warm,interpolateCool:cool,interpolateSinebow:sinebow,interpolateTurbo:turbo,interpolateViridis:viridis,interpolateMagma:magma,interpolateInferno:inferno,interpolatePlasma:plasma});class Scale{constructor(t,e){switch(this.type=t,this.offset=void 0,this.id="scale"+ItemCounter.scale++,t){case"linear":if(e){let t=Object.keys(e).map((t=>parseFloat(t))).sort(((t,e)=>t-e)),r=t.map((t=>e[t]));this._scale=linear$1(t,r),e.hasOwnProperty("clamp")&&this._scale.clamp(e.clamp)}else this._scale=linear$1();break;case"point":this._scale=point();break;case"ordinal":this._scale=ordinal();break;case"ordinalColor":this._scale=ordinal(category10);break;case"power":case"log":this._scale=log();break;case"identity":case"time":this._scale=time();break;case"sequentialColor":this._scale=e&&"string"==typeof e?sequential(d3Chromatic[e]):sequential()}this.encodings=[]}toJSON(){let t={};return t.type=this.type,t.id=this.id,t.offset=this.offset,t.domain=this.domain,t.range=this.range,t.clamp=this.clamp,t}static mergeDomain(t,e){return[Math.min(t[0],e[0]),Math.max(t[1],e[1])]}_merge(t){if(this.type!=t.type)throw Errors.DIFFERENT_SCALE_TYPE;let e,r;switch(this.type){case"linear":case"time":e=[Math.min(this.domain[0],t.domain[0]),Math.max(this.domain[1],t.domain[1])],r=[0,this.map(e[1])-this.map(e[0])];break;case"point":case"ordinalColor":e=[...new Set(this.domain.concat(t.domain))],r=[];break;default:console.log("TODO: merge scale type",this.type)}this._scale.domain(e),this._scale.range(r)}get domain(){return this._scale.domain()}set domain(t){this._scale.domain(t);for(let t of this.encodings)t._apply()}get range(){return this._scale.range()}set range(t){this._scale.range(t);for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}_setRange(t){this._scale.range(t);for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}get clamp(){return"linear"==this.type&&this._scale.clamp()}set clamp(t){"linear"==this.type&&this._scale.clamp(t)}set rangeExtent(t){let e=this._scale.range();e[0]<e[1]?this._setRange([e[0],e[0]+t]):this._setRange([e[1]+t,e[1]])}get rangeExtent(){let t=this._scale.range();return Math.abs(t[1]-t[0])}_addEncoding(t){this.encodings.indexOf(t)<0&&this.encodings.push(t)}map(t){return this._scale(t)}invert(t){return this._scale.invert(t)}}function bindToPosition(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,r="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=r.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=r.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=r.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t,e,r,i,n,s=this.channel,a=this.datatable.getFieldType(this.field),o=getClosestLayout(this.anyItem);if(o&&o.type==LayoutType.Grid){let e=o.cellBounds;t="x"==s?e[0].width:e[0].height}else{let e=this.items.map((t=>t[s]));t=Math.max(...e)-Math.min(...e),t<100?t=100:t>500&&(t=500)}switch(this.rangeExtent&&(t=this.rangeExtent),a){case DataType.Boolean:break;case DataType.Date:e=Math.min(...this.data),r=Math.max(...this.data),i=[e,r],this.scale?(i=Scale.mergeDomain(i,this.scale.domain),t=Math.abs(this.scale.map(i[0])-this.scale.map(i[1]))):this.scale=createScale("time"),n=[0,t];break;case DataType.String:i=this.data,n=[0,t],this.scale||(this.scale=createScale("point"));break;default:e=Math.min(...this.data),r=Math.max(...this.data),i=this.includeZero?[0,r]:[e,r],this.scale?(i=Scale.mergeDomain(i,this.scale.domain),t=Math.abs(this.scale.map(i[0])-this.scale.map(i[1]))):this.scale=createScale(this.scaleType?this.scaleType:"linear"),i[0]==i[1]&&(i[1]=1.1*i[0]),n=this.invertScale?[t,0]:[0,t]}this.scale.domain=i,this.scale._setRange(n),this.scale._addEncoding(this)},t._apply=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);if("x"==e){let r=getClosestLayout(this.anyItem);if(r&&r.type==LayoutType.Grid)for(let t=0;t<this.items.length;t++){let r=this.items[t],i=getCellBoundsInLayout(r).left+this.scale.map(this.data[t])-r[e],n=0;r.translate(i,n)}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.left))));for(let t=0;t<this.items.length;t++){let r=this.items[t],i=this.scale.offset+this.scale.map(this.data[t])-r[e],n=0;r.translate(i,n)}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t[e]))));for(let t=0;t<this.items.length;t++){let r=this.items[t],i=this.scale.offset+this.scale.map(this.data[t])-r[e],n=0;r.translate(i,n)}}}else{let r=getClosestLayout(this.anyItem);if(r&&r.type==LayoutType.Grid){let t=this.items.map((t=>getCellBoundsInLayout(t)));for(let r=0;r<this.items.length;r++){let i=this.items[r],n=0,s=t[r].bottom-this.scale.map(this.data[r])-i[e];i.translate(n,s)}}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){void 0===this.scale.offset&&(this.scale.offset=Math.min(...this.items.map((t=>t.y))));for(let t=0;t<this.items.length;t++){let r=this.items[t],i=0,n=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-r[e];r.translate(i,n)}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.y))));for(let t=0;t<this.items.length;t++){let r=this.items[t],i=0,n=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-r[e];r.translate(i,n)}}}},t.run(),t}function bindToRadialDistance(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,r="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=r.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=r.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=r.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t=this.data;this.scale||(this.scale=createScale("linear"),this.scale.domain=[0,Math.max(...t)],this.scale._setRange([0,this.radius]),this.scale._addEncoding(this))},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]),i=polar2Cartesian(this.x,this.y,r,e.polarAngle);e.x=i[0],e.y=i[1]}this.scene._relayoutAncestors(this.anyItem,this.items)},t.run(),t}function bindToColor(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,r="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=r.map((e=>e.getFieldValue(t)));break;case DataType.String:try{this.data=r.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=r.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){if(this.scale);else switch(this.datatable.getFieldType(this.field)){case DataType.Boolean:case DataType.Date:break;case DataType.String:this.scale=createScale("ordinalColor"),this.scale.domain=this.data;let t=this.mapping;if(t){let e=this.scale.domain.map((e=>t.hasOwnProperty(e)?t[e]:"black"));this.scale._scale.range(e)}break;default:this.mapping?this.scale=createScale("linear",this.mapping):(this.scale=createScale("sequentialColor",this.scheme?this.scheme:"interpolateTurbo"),this.scale.domain=[Math.min(...this.data),Math.max(...this.data)])}},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]);"vertex"==e.type||"segment"==e.type?e[this.channel]=r:e.styles[this.channel]=r,e.vertices&&"strokeColor"==this.channel&&e.vertices.forEach((t=>t.fillColor=r))}},t.run(),t}function bindToAngle(t){return t._query=function(){this.data=[];let t=this.field,e=this.items;switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case DataType.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){this.scale||(this.scale=createScale("linear"),this.scale.domain=[0,this.data.reduce(((t,e)=>t+e),0)],this.scale._setRange([0,360]),this.scale._addEncoding(this))},t._apply=function(){let t,e=this.startAngle;for(let r=0;r<this.items.length;r++){t=this.items[r];let i=this.scale.map(this.data[r]);switch(this.angleDirection){case"clockwise":t.adjustAngle(e-i,e),e-=i;break;case"anticlockwise":t.adjustAngle(e,e+i),e+=i}}},t.run(),t}function bindToArea(t){return t._query=function(){this.data=[],this.areas=getPeers(this.items[0],this.scene);let t=this.areas.length;this.areaNum=t,this.items=[],this.indicator=[];for(let t of this.areas)for(let e=0;e<t.vertices.length;e++)this.items.push(t.vertices[e]),e<t.vertices.length/2?this.indicator.push(1):this.indicator.push(0);let e=this.field,r=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?r.map((t=>t.dataScope)):r.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(e)){case DataType.Boolean:break;case DataType.Date:this.data=i.map((t=>t.getFieldValue(e)));break;case DataType.String:this.data=i.map((t=>0==this.indicator[i.indexOf(t)]?0:t.aggregateNumericalField(e,this.aggregator)));break;default:"x"==this.channel||"y"==this.channel?this.data=i.map((t=>t._field2value[e])):this.data=i.map((t=>0==this.indicator[i.indexOf(t)]?0:t.aggregateNumericalField(e,this.aggregator)))}},t._map=function(){let t,e,r;this.channel;switch(this.datatable.getFieldType(this.field)){case DataType.Boolean:break;case DataType.Date:t=createScale("time"),e=Math.min(...this.data),r=Math.max(...this.data),t.domain=[e,r];break;case DataType.String:default:t=createScale("linear"),e=Math.min(...this.data),r=Math.max(...this.data),t.domain=this.includeZero||e<0?[0,r]:[e,r]}let i,n=CheckAreaOrien(this.areas[0]),s=getClosestLayout(this.anyItem);if(s){let t=s.cellBounds;i="width"==this.channel||"height"==this.channel?n==Orientation.Vertical?t[0].width:t[0].height:n==Orientation.Vertical?t[0].height:t[0].width}else if("width"==this.channel||"x"==this.channel){let t=this.items.map((t=>t.x));i=Math.max(...t)-Math.min(...t)}else{let t=this.items.map((t=>t.y));i=Math.max(...t)-Math.min(...t)}e<0?(t._scale.domain([e,r]),t._setRange([0,i])):t._setRange([0,i]),this.scale?this.scale._merge(t):this.scale=t,this.scale._addEncoding(this)},t._apply=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);let r=CheckAreaOrien(this.areas[0]);if("width"==e||"height"==e){let t=this.scale.domain[0]<this.scale.domain[1]?"default":"opposite",e=getAllLayouts(this.items);if(e[0]){let i=e[e.length-1].baseline==Alignment.Center||e[e.length-1].baseline==Alignment.Middle;for(let n=e.length-1;n>=0;n--){let s=e[n];if(r==Orientation.Vertical)switch(s.type){case LayoutType.Grid:if(i){s._cellHorzAlignment=Alignment.Center;break}s._cellHorzAlignment=s.baseline?s.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellHorzAlignment:s._cellHorzAlignment;break;case LayoutType.Stack:if(i){s.baseline=i?Alignment.Center:void 0;break}s._horzCellAlignment=s.baseline?s.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellHorzAlignment:"default"==t?Alignment.Left:Alignment.Right}else switch(s.type){case LayoutType.Grid:if(i){s._cellVertAlignment=Alignment.Middle;break}s._cellVertAlignment=s.baseline?s.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellVertAlignment:s._cellVertAlignment;break;case LayoutType.Stack:if(i){s.baseline=i?Alignment.Middle:void 0;break}s._vertCellAlignment=s.baseline?s.baseline:e[e.length-1].type==LayoutType.Grid?e[e.length-1]._cellVertAlignment:"default"==t?Alignment.Bottom:Alignment.Top}}for(let t=0;t<this.items.length;t++){let e=this.items[t],i=getCellBoundsInLayout(e),n=getClosestLayout(e),s=r==Orientation.Vertical?n.type==LayoutType.Stack?n._horzCellAlignment==Alignment.Left:n._cellHorzAlignment==Alignment.Left:n.type==LayoutType.Stack?n._vertCellAlignment==Alignment.Bottom:n._cellVertAlignment==Alignment.Bottom,a=r==Orientation.Vertical?s?i.left+this.scale.map(this.data[t])-e.x:i.right-this.scale.map(this.data[t])-e.x:0,o=r==Orientation.Vertical?0:s?i.bottom-this.scale.map(this.data[t])-e.y:i.top+this.scale.map(this.data[t])-e.y;e.translate(a,o)}if("grid"==e[e.length-1].type&&i){let t=this.items.length/this.areaNum;for(let e=0;e<this.areaNum;e++)for(let i=0;i<t/2;i++){let n=e*t+i,s=(e+1)*t-i-1,a=this.items[n],o=this.items[s],h=getCellBoundsInLayout(a),l=r==Orientation.Vertical?a.x-o.x:o.y-a.y,u=r==Orientation.Vertical?h.x+l/2-a.x:0,c=r==Orientation.Vertical?0:h.y+l/2-a.y,d=r==Orientation.Vertical?h.x-l/2-o.x:0,f=r==Orientation.Vertical?0:h.y-l/2-o.y;a.translate(u,c),o.translate(d,f)}}}else{let t="center"==this.areas[0].baseline,e=getParents(this.items),i=r==Orientation.Vertical?this.areas[0].baseline!==Alignment.Right?Math.min(...e.map((t=>t.bounds.left))):Math.max(...e.map((t=>t.bounds.right))):this.areas[0].baseline!=Alignment.Top?Math.max(...e.map((t=>t.bounds.bottom))):Math.min(...e.map((t=>t.bounds.top)));for(let t=0;t<this.items.length;t++){let e=this.items[t],n=r==Orientation.Vertical?this.areas[0].baseline!==Alignment.Right?i+this.scale.map(this.data[t])-e.x:i-this.scale.map(this.data[t])-e.x:0,s=r==Orientation.Vertical?0:this.areas[0].baseline!=Alignment.Top?i-this.scale.map(this.data[t])-e.y:i+this.scale.map(this.data[t])-e.y;e.translate(n,s)}if(1==t){let t=this.items.length/this.areaNum,e=getParents(this.items),i=r==Orientation.Vertical?Math.min(...e.map((t=>t.bounds.x))):Math.max(...e.map((t=>t.bounds.y)));for(let e=0;e<this.areaNum;e++)for(let n=0;n<t/2;n++){let s=e*t+n,a=(e+1)*t-n-1,o=this.items[s],h=this.items[a],l=r==Orientation.Vertical?o.x-h.x:h.y-o.y,u=r==Orientation.Vertical?i+l/2-o.x:0,c=r==Orientation.Vertical?0:i+l/2-o.y,d=r==Orientation.Vertical?i-l/2-h.x:0,f=r==Orientation.Vertical?0:i-l/2-h.y;o.translate(u,c),h.translate(d,f)}}}}else{if(getClosestLayout(this.anyItem)){let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=r==Orientation.Horizontal?Math.min(...t.map((t=>t.bounds.left))):Math.max(...t.map((t=>t.bounds.top))));for(let t=0;t<this.items.length;t++){let e=this.items[t],i=getCellBoundsInLayout(e),n=r==Orientation.Vertical?0:i.left+this.scale.map(this.data[t])-e.x,s=r==Orientation.Vertical?i.bottom-this.scale.map(this.data[t])-e.y:0;e.translate(n,s)}}else{let t=getParents(this.items);void 0===this.scale.offset&&(this.scale.offset=r==Orientation.Horizontal?Math.min(...t.map((t=>t.bounds.left))):Math.max(...t.map((t=>t.bounds.top))));for(let t=0;t<this.items.length;t++){let e=this.items[t],i=r==Orientation.Horizontal?this.scale.offset+this.scale.map(this.data[t])-e.x:0,n=r==Orientation.Horizontal?0:this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-e.y;e.translate(i,n)}}}for(let t of this.areas)t._updateBounds();"width"!=e&&"height"!=e||this.scene._relayoutAncestors(this.areas[0],this.areas)},t.run(),t}function bindToText(t){return t._query=function(){this.data=[];let t=this.field,e=this.items;switch(this.datatable.getFieldType(t)){case DataType.Boolean:break;case DataType.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case DataType.String:try{this.data=e.map((e=>e.dataScope.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){if(this.scale);else switch(this.datatable.getFieldType(this.field)){case DataType.Boolean:case DataType.Date:break;case DataType.String:default:this.scale=createScale("ordinal"),this.scale.domain=[...new Set(this.data)],this.scale._scale.range(this.scale.domain.map((t=>t+"")))}},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],r=this.scale.map(this.data[t]);e.text=r}},t.run(),t}class Encoding{constructor(t,e,r,i,n){this.items=t,this.anyItem=this.items[0],this.scene=e,this.channel=r,this.field=i,this.aggregator=n.aggregator,this.datatable=n.datatable,this.scale=n.scale,this.callback=n.callback,this.includeZero=n.includeZero,this.invertScale=n.invertScale,this.mapping=n.mapping,this.rangeExtent=n.rangeExtent,this.scheme=n.scheme,this.scaleType=n.scaleType,this.range=n.range,"angle"==this.channel&&(this.startAngle=n.hasOwnProperty("startAngle")?n.startAngle:90,this.angleDirection=n.hasOwnProperty("angleDirection")?n.angleDirection:"clockwise"),this._query=void 0,this._map=void 0,this._apply=void 0}toJSON(){let t={};return t.anyItem=this.anyItem.id,t.channel=this.channel,t.field=this.field,t.items=this.items.map((t=>t.id)),this.data&&(t.data=this.data),this._rectNegativeValues&&(t._rectNegativeValues=!0),t.args={},t.args.aggregator=this.aggregator,t.args.datatable=this.datatable.url,t.scale=this.scale.id,t.args.includeZero=this.includeZero,t.args.invertScale=this.invertScale,t.args.mapping=this.mapping,t.args.rangeExtent=this.rangeExtent,t.args.scheme=this.scheme,t.args.scaleType=this.scaleType,t.args.range=this.range,"angle"==this.channel&&(t.args.startAngle=this.startAngle,t.args.angleDirection=this.angleDirection),t}run(){this._query(),this._map(),this._apply()}getScaleRange(t){let e=t||this.anyItem;if(e.type!=ItemType.Area){if("x"==this.channel){let t=getClosestLayout(this.anyItem);if(t&&t.type==LayoutType.Grid){let r=t.cellBounds,i=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[r[i].left,r[i].left+this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}{let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}}if("y"==this.channel){let t=getClosestLayout(this.anyItem);if(t&&t.type==LayoutType.Grid){let r=t.cellBounds,i=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[r[i].bottom,r[i].bottom-this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}{let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}}if("width"==this.channel){let t=getPeers(e,this.scene),r=Math.min(...t.map((t=>t.bounds.left)));return[r,r+this.scale.rangeExtent]}if("height"==this.channel){let t=getPeers(e,this.scene),r=Math.max(...t.map((t=>t.bounds.bottom)));return[r,r-this.scale.rangeExtent]}if("radialDistance"==this.channel){let t=e.parent;return[t.x,t.x+this.scale.rangeExtent]}return this.scale.range}{let t,r=CheckAreaOrien(e),i=getClosestLayout(e);t=i?r==Orientation.Vertical?i.type==LayoutType.Stack?i._horzCellAlignment==Alignment.Left:i._cellHorzAlignment==Alignment.Left:i.type==LayoutType.Stack?i._vertCellAlignment==Alignment.Bottom:i._cellVertAlignment==Alignment.Bottom:r==Orientation.Vertical?e.baseline==Alignment.Left:e.baseline==Alignment.Bottom;let n=getCellBoundsInGridLayout(e);if(n)switch(this.channel){case"x":return[n.left,n.left+this.scale.rangeExtent];case"width":return t?[n.left,n.left+this.scale.rangeExtent]:[n.right,n.right-this.scale.rangeExtent];case"y":return[n.bottom,n.bottom-this.scale.rangeExtent];case"height":return t?[n.bottom,n.bottom-this.scale.rangeExtent]:[n.top,n.top+this.scale.rangeExtent]}if(r==Orientation.Horizontal)switch(this.channel){case"width":case"height":{let r=getPeers(e.firstVertex,this.scene),i=t?Math.max(...r.map((t=>t.y))):Math.min(...r.map((t=>t.y)));return t?[i,i-this.scale.rangeExtent]:[i+this.scale.rangeExtent,i]}case"x":case"y":{let t=getPeers(e.firstVertex,this.scene),r=Math.min(...t.map((t=>t.x)));return[r,r+this.scale.rangeExtent]}}else if(r==Orientation.Vertical)switch(this.channel){case"x":case"y":{let t=getPeers(e.firstVertex,this.scene),r=Math.max(...t.map((t=>t.y)));return[r,r-this.scale.rangeExtent]}case"height":case"width":{let r=getPeers(e.firstVertex,this.scene),i=t?Math.min(...r.map((t=>t.x))):Math.max(...r.map((t=>t.x)));return t?[i,i+this.scale.rangeExtent]:[i-this.scale.rangeExtent,i]}}}}}function bin$1(t,e,r){let i=e[0],n=t.nonNumericFields,s={};for(let e of t.data){let t=n.map((t=>String(e[t]))).join("_");s.hasOwnProperty(t)||(s[t]=n.map((t=>e[t])),s[t].push([])),s[t][s[t].length-1].push(e[i])}let a=[];for(let t in s){let e=s[t].pop(),r=bin()(e);for(let e of r){let r={};s[t].forEach(((t,e)=>r[n[e]]=t)),r.x0=e.x0,r.x1=e.x1,r[i+"_count"]=e.length,a.push(r)}}let o={};n.forEach((e=>o[e]=t.getFieldType(e))),o.x0=DataType.Number,o.x1=DataType.Number,o[i+"_count"]=DataType.Number;let h=new DataTable(a,t.url,o);return h.sourceDataTable=t,h.transform={type:"bin",args:e},h}function kde(t,e,r){let i=e[0],n=t.nonNumericFields,s={};for(let e of t.data){let t=n.map((t=>String(e[t]))).join("_");s.hasOwnProperty(t)||(s[t]=n.map((t=>e[t])),s[t].push([])),s[t][s[t].length-1].push(e[i])}let a=r.hasOwnProperty("min")?r.min:t.getFieldSummary(i).min,o=r.hasOwnProperty("max")?r.max:t.getFieldSummary(i).max,h=a,l=[];for(;h<o;)l.push(h),h+=r.interval;l.push(h);let u=[];for(let t in s){let e=s[t].pop(),a=_kde(_epanechnikov(r.bandwidth),l,e);for(let e of a){let r={};s[t].forEach(((t,e)=>r[n[e]]=t)),r[i]=e[0],r[i+"_density"]=e[1],u.push(r)}}let c={};return n.forEach((e=>c[e]=t.getFieldType(e))),c[i]=DataType.Number,c[i+"_density"]=DataType.Number,new DataTable(u,t.url,c)}function _kde(t,e,r){return e.map((e=>[e,mean(r,(r=>t(e-r)))]))}function _epanechnikov(t){return e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}function sort(t,e,r){t.data.sort(((t,r)=>compareRow(t,r,e))),t.summarize()}function compareRow(t,e,r,i){for(let i of r){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1}return 0}function filter$1(t,e){let r=[];for(let i of t.data){let t=!0;for(let r of e)if(!satisfy(i,r)){t=!1;break}t&&r.push(i)}let i=new DataTable(r,t.url);return i.sourceDataTable=t,i.transform={type:"filter",args:e},i}function satisfy(row,p){if(p.hasOwnProperty("field")){let t=p.field;if(p.hasOwnProperty("value"))return row[t]==p.value;if(p.hasOwnProperty("range"))return row[t]>=p.range[0]&&row[t]<=p.range[1];if(p.hasOwnProperty("values"))return p.values.indexOf(row[t])>=0}else if(p.hasOwnProperty("fields")){let f1=p.fields[0],f2=p.fields[1];return 1==eval(row[f1]+p.operator+row[f2])}}class DataTable{constructor(t,e,r){if(this.url=e,this.id=ItemType.DataTable+ItemCounter[ItemType.DataTable]++,this.data=t,this._fields=Object.keys(this.data[0]),this._newField=0,r)this._fieldTypes=r;else{this._fieldTypes={};for(let t of this._fields)this._fieldTypes[t]=_inferType(this.data.map((e=>e[t]))),"year"==t.toLowerCase()&&this._fieldTypes[t]==DataType.Integer&&(this._fieldTypes[t]=DataType.Date);_validate(this.data,this._fieldTypes)}this._fieldSummaries={};for(let t of this._fields)this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),this._fieldTypes[t]);this._addField(atlas_rowId,DataType.String,this.data.map(((t,e)=>"r"+e)))}get name(){return this.id}set sourceDataTable(t){this._sourceDataTable=t}get sourceDataTable(){return this._sourceDataTable}set transform(t){this._transform=t}get transform(){return this._transform}toJSON(){let t={};return t.data=this.data,t.fieldTypes=this._fieldTypes,t.url=this.url,t.id=this.id,t.sourceDataTable=this._sourceDataTable,t.transform=this._transform,t}transformField(t,e,r){let i=this.data.map((r=>e(r[t]))),n=_inferType(i),s=r||Date.now()+"_field"+this._newField++;return this._addField(s,n,i),s}setValueOrder(t,e){this._fieldSummaries[t].unique=e}_addField(t,e,r){this.data.forEach(((e,i)=>e[t]=r[i])),this._fieldTypes[t]=e,this._fields.push(t),this._fieldSummaries[t]=_summarize(r,e)}getFieldType(t){return this._fieldTypes[t]}get fields(){return this._fields}getFieldSummary(t){return this._fieldSummaries[t]}getFieldValues(t){return this.data.map((e=>e[t]))}getUniqueFieldValues(t){return this._fieldSummaries[t].unique}getRowCount(){return this.data.length}hasField(t){return this._fields.indexOf(t)>=0}parseFieldAsDate(t,e){let r=timeParse(e);for(let e of this.data)null==e[t]||null==e[t]?e[t]=new Date(1899,11,31).getTime():e[t]=r(e[t]).getTime();this._fieldTypes[t]=DataType.Date,this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),DataType.Date)}static get RowID(){return atlas_rowId}get nonNumericFields(){let t=[];for(let e in this._fieldTypes)this._fieldTypes[e]!=DataType.Number&&this._fieldTypes[e]!=DataType.Integer&&e!=DataTable.RowID&&t.push(e);return t}transform(t,e,r){let i=r||{};switch(t){case"kde":return kde(this,e,i);case"bin":return bin$1(this,e);case"sort":return sort(this,e);case"filter":return filter$1(this,e)}}summarize(){for(let t of this._fields)this._fieldSummaries[t]=_summarize(this.data.map((e=>e[t])),this._fieldTypes[t])}}function _summarize(t,e){var r={};switch(e){case DataType.Boolean:r.trueCount=t.filter((t=>t)).length,r.falseCount=t.filter((t=>!t)).length;break;case DataType.Date:r.min=min(t),r.max=max(t),r.extent=[r.min,r.max],r.unique=[...new Set(t)];break;case DataType.String:r.unique=[...new Set(t)];break;default:r.min=min(t),r.max=max(t),r.extent=[r.min,r.max],r.mean=mean(t),r.median=median(t),r.unique=[...new Set(t)]}return r}function _validate(t,e){for(let r of t)for(let t in e){let i,n=e[t],s=r[t];if(null==r[t]||null==r[t])switch(n){case DataType.Boolean:i=!1;break;case DataType.Date:i=new Date(1899,11,31).getTime();break;case DataType.String:i="";break;default:i=0}else switch(n){case DataType.Boolean:i=s;break;case DataType.Date:i=Number.isInteger(s)?new Date(s,0).getTime():new Date(s+"").getTime();break;case DataType.String:i=s.toString();break;default:i=s}r[t]=i}}var isValidType={boolean:function(t){return"true"===t||"false"===t||!0===t||!1===t||"[object Boolean]"==toString.call(t)},integer:function(t){return isValidType.number(t)&&(t=+t)==~~t},number:function(t){return!isNaN(+t)&&"[object Date]"!=toString.call(t)},date:function(t){return!isNaN(Date.parse(t))},string:function(t){return!0}};function _inferType(t){var e=Object.values(DataType);for(let r=0;r<t.length;r++){let i=t[r];if(null!=i){for(let t=0;t<e.length;t++)isValidType[e[t]](i)||(e.splice(t,1),t-=1);if(1==e.length)return e[0]}}return e[0]}class PointText extends Mark{constructor(t){super(t),this.type=ItemType.PointText,this.attrs.x=0,this.attrs.y=0,this.styles.hasOwnProperty("fontSize")||(this.styles.fontSize="12px"),this.styles.hasOwnProperty("fontFamily")||(this.styles.fontFamily="arial"),this.styles.hasOwnProperty("fontWeight")||(this.styles.fontWeight="regular"),this.styles.hasOwnProperty("fillColor")||(this.styles.fillColor="black"),void 0!==t&&(t.hasOwnProperty("x")&&(this.attrs.x=t.x),t.hasOwnProperty("y")&&(this.attrs.y=t.y),t.hasOwnProperty("text")?this.attrs.text=t.text:this.attrs.text="",t.hasOwnProperty("anchor")?this.attrs.anchor=t.anchor:this.attrs.anchor=["center","middle"]),this._updateBounds()}copyPropertiesTo(t){t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this.attrs.x,t.y=this.attrs.y,t.text=this.text,t.anchor=[this.anchor[0],this.anchor[1]]}get bounds(){return this._bounds||this._updateBounds(),this._bounds}set text(t){this.attrs.text=t,this._updateBounds()}get text(){return this.attrs.text}translate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){let t,e,r=getTextWidth(this.attrs.text,[this.fontWeight,this.fontSize,this.fontFamily].join(" ")),i=parseFloat(this.fontSize);switch(this.attrs.anchor[0]){case"left":t=this.attrs.x;break;case"right":t=this.attrs.x-r;break;case"center":t=this.attrs.x-r/2;break;default:t=this.attrs.x}switch(this.attrs.anchor[1]){case"top":e=this.attrs.y;break;case"bottom":e=this.attrs.y-i;break;case"middle":e=this.attrs.y-i/2}this._bounds=new Rectangle(t,e,r,i)}get center(){return{x:this.bounds.left+this.bounds.width/2,y:this.bounds.top+this.bounds.height/2}}get x(){return this.attrs.x}set x(t){this.attrs.x=t,this._updateBounds()}get y(){return this.attrs.y}set y(t){this.attrs.y=t,this._updateBounds()}get anchor(){return this.attrs.anchor}set anchor(t){this.attrs.anchor=t,this._updateBounds()}get fontSize(){return this.styles.fontSize}set fontSize(t){this.styles.fontSize=t,this._updateBounds()}get fontWeight(){return this.styles.fontWeight}set fontWeight(t){this.styles.fontWeight=t,this._updateBounds()}get fontFamily(){return this.styles.fontFamily}set fontFamily(t){this.styles.fontFamily=t,this._updateBounds()}}class Axis extends Group{constructor(t){super(),this.type=ItemType.Axis,this.id=this.type+ItemCounter[this.type]++,this._orientation=t.hasOwnProperty("orientation")?t.orientation:"",this._strokeColor=t.hasOwnProperty("strokeColor")?t.strokeColor:"#555",this._textColor=t.hasOwnProperty("textColor")?t.textColor:"#555",this._tickOffset=t.hasOwnProperty("tickOffset")?t.tickOffset:0,this._tickSize=t.hasOwnProperty("tickSize")?t.tickSize:5,this._tickAnchor=t.tickAnchor?t.tickAnchor:"middle",this._tickVisible=!t.hasOwnProperty("tickVisible")||t.tickVisible,this._pathVisible=!t.hasOwnProperty("pathVisible")||t.pathVisible,this._labelOffset=t.hasOwnProperty("labelOffset")?t.labelOffset:15,this._labelFormat=t.hasOwnProperty("labelFormat")?t.labelFormat:"",this._titleOffset=t.hasOwnProperty("titleOffset")?t.titleOffset:40,this._titleAnchor,t.hasOwnProperty("titleAnchor")?this._titleAnchor=t.titleAnchor:"x"==this.channel||"width"==this.channel?this._titleAnchor="top"==this._orientation?["center","bottom"]:["center","top"]:this._titleAnchor="left"==this._orientation?["right","middle"]:["left","middle"],this._rotateYTitle=!(t.hasOwnProperty("rotateTitle")&&!t.rotateTitle),this._titlePosition=t.titlePosition,t.hasOwnProperty("labelRotation")&&(this._labelRotation=t.labelRotation),this._flip=!!t.hasOwnProperty("flip")&&t.flip}toJSON(){let t=super.toJSON();return t.field=this._field,t.channel=this._channel,t.hasOwnProperty("args")||(t.args={}),t.args.orientation=this._orientation,t.args.strokeColor=this._strokeColor,t.args.textColor=this._textColor,t.args.tickOffset=this._tickOffset,t.args.tickSize=this._tickSize,t.args.tickAnchor=this._tickAnchor,t.args.tickVisible=this._tickVisible,t.args.pathVisible=this._pathVisible,t.args.labelOffset=this._labelOffset,t.args.labelFormat=this._labelFormat,this._labelRotation&&(t.args.labelRotation=this._labelRotation),t.args.showTitle=this._showTitle,t.args.titleAnchor=this._titleAnchor,t.args.titleOffset=this._titleOffset,t.args.titlePosition=this._titlePosition,t.args.rotateTitle=this._rotateYTitle,t.args.flip=this._flip,t}get field(){return this._field}get orientation(){return this._orientation}set orientation(t){this._orientation=t}get x(){return"y"==this.channel?this._position:void 0}set x(t){"y"==this.channel&&(this._position=t)}get y(){return"x"==this.channel?this._position:void 0}set y(t){"x"==this.channel&&(this._position=t)}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get textColor(){return this._textColor}set textColor(t){this._textColor=t}get tickOffset(){return this._tickOffset}set tickOffset(t){this._tickOffset=t}get titleOffset(){return this._titleOffset}set titleOffset(t){this._titleOffset=t}get tickSize(){return this._tickSize}set tickSize(t){this._tickSize=t}set tickValues(t){this._tickValues=t,this._generateTicks(),this._positionTicks()}get tickValues(){return this._tickValues}set labelValues(t){this._labelValues=t,this._generateLabels(),this._positionLabels()}get labelValues(){return this._labelValues}get tickAnchor(){return this._tickAnchor}set tickAnchor(t){this._tickAnchor=t}get tickVisible(){return this._tickVisible}set tickVisible(t){this._tickVisible=t}get pathVisible(){return this._pathVisible}set pathVisible(t){this._pathVisible=t}get labelOffset(){return this._labelOffset}set labelOffset(t){this._labelOffset=t}get labelFormat(){return this._labelFormat}set labelFormat(t){this._labelFormat=t}get labelRotation(){return this._labelRotation}set labelRotation(t){this._labelRotation=t}get showTitle(){return this._showTitle}set showTitle(t){this._showTitle=t}get titleAnchor(){return this._titleAnchor}set titleAnchor(t){this._titleAnchor=t}get titlePosition(){return this._titlePosition}set titlePosition(t){this._titlePosition=t}get rotateTitle(){return this._rotateYTitle}set rotateTitle(t){this._rotateYTitle=t}get title(){return this._titleText}set title(t){this._titleText=t}_generatePath(){}_generateTicks(){}_generateLables(){}_generateTitle(){this._title=new PointText({text:this._titleText,fillColor:this._textColor,fontWeight:"bold"}),this._title.id=this.id+"-title",this.addChild(this._title)}_positionPath(){}_positionTicks(){}_positionLabels(){}_positionTitle(){}}class EncodingAxis extends Axis{constructor(t,e,r){super(r),this.encoding=t,this._field=this.encoding.field,this._channel=this.encoding.channel,this._position="x"==this._channel||"width"==this._channel?r.y:r.x,this._titleText=r.hasOwnProperty("title")?r.title:this.encoding.field,this._item=e,this._ticks=new Group,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Group,this._labels.id=this.id+"labels",this.addChild(this._labels),"radialDistance"==this._channel&&(this._position=this._item.parent.y,r.hasOwnProperty("rotation")&&(this._rotate=[-r.rotation,this.encoding.x,this.encoding.y])),this._showTitle=!r.hasOwnProperty("showTitle")||r.showTitle,this._generatePath(),this._positionPath(),this._showTitle&&(this._generateTitle(),this._positionTitle())}toJSON(){let t=super.toJSON();return t.item=this._item.id,this._rotate&&(t.args.rotation=this._rotate[0]),"x"==this._channel||"width"==this._channel?t.args.y=this._position:t.args.x=this._position,t}get ticks(){return this._ticks}get labels(){return this._labels}get path(){return this._path}_generatePath(){this._path=new Path$1({strokeColor:this._strokeColor}),this._pathVisible||(this._path.visibility="hidden"),this._path.type=ItemType.Line,this._path.id=this.id+"path",this.addChild(this._path)}_generateTicks(){this._ticks.removeAll();for(let[t,e]of this._tickValues.entries()){let e=new Path$1({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=ItemType.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this.encoding.datatable.getFieldType(this.encoding.field)){case DataType.Date:t=timeFormat(this._labelFormat);break;case DataType.String:t=function(t){return t};break;default:t=format(this._labelFormat)}for(let[e,r]of this._labelValues.entries()){let i=new PointText({text:t(r),fillColor:this._textColor});i.id=this.id+"label"+e,this._labels.addChild(i)}}_positionPath(){this._range=this.encoding.getScaleRange(this._item),void 0===this._position&&this._computePosition();let t=[];if("x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].x));t.push([Math.min(...e.concat(this._range)),this._position]),t.push([Math.max(...e.concat(this._range)),this._position])}else if("y"==this._channel||"height"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].y));t.push([this._position,Math.min(...e.concat(this._range))]),t.push([this._position,Math.max(...e.concat(this._range))])}this._path._setVertices(t),this._path._updateBounds(),this._showTitle&&this._title&&this._positionTitle()}_positionLabels(){if(void 0===this._position&&this._computePosition(),"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize,e="bottom"==this._orientation?["center","top"]:["center","bottom"];if("area"==this._item.type&&"width"==this._channel){let t=getClosestLayout(this._item);if(t){let e=t.type==LayoutType.Stack?t._horzCellAlignment==Alignment.Left:t._cellHorzAlignment==Alignment.Left;this._flip=!e}else{let t=this._item.baseline==Alignment.Left||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[r,i]of this._labels.children.entries())i.x=this._range[1]-this.encoding.scale.map(this._labelValues[r]),i.y=this._position+t,i.anchor=e,this._labelRotation&&(i._rotate=[this._labelRotation,i.x,i.y],i.anchor=["right",e[1]]);else if(this.encoding.invertScale)for(let[r,i]of this._labels.children.entries())i.x=this._range[0]+this.encoding.scale.map(this._labelValues[r]),i.y=this._position+t,i.anchor=e,this._labelRotation&&(i._rotate=[this._labelRotation,i.x,i.y],i.anchor=["right",e[1]]);else for(let[r,i]of this._labels.children.entries())i.x=this._range[0]+this.encoding.scale.map(this._labelValues[r])-this.encoding.scale.range[0],i.y=this._position+t,i.anchor=e,this._labelRotation&&(i._rotate=[this._labelRotation,i.x,i.y],i.anchor=["right",e[1]])}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize,e="left"==this._orientation?["right","middle"]:["left","middle"];if("area"==this._item.type&&"height"==this._channel){let t=getClosestLayout(this._item);if("height"==this._channel&&t){let e=t.type==LayoutType.Stack?t._vertCellAlignment==Alignment.Bottom:t._cellVertAlignment==Alignment.Bottom;this._flip=!e}else{let t=this._item.baseline==Alignment.Bottom||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[r,i]of this._labels.children.entries())i.x=this._position+t,i.y=this._range[1]+this.encoding.scale.map(this._labelValues[r]),i.anchor=e;else if(this.encoding.invertScale)for(let[r,i]of this._labels.children.entries())i.x=this._position+t,i.y=this._range[1]-this.encoding.scale.map(this._labelValues[r])+this.encoding.scale.range[0],i.anchor=e;else for(let[r,i]of this._labels.children.entries())i.x=this._position+t,i.y=this._range[0]-this.encoding.scale.map(this._labelValues[r])+this.encoding.scale.range[0],i.anchor=e}}_computePosition(){let t;this._item.type==ItemType.Area&&(t=getCellBoundsInGridLayout(this._item)),void 0===t&&(t=getTopLevelGroup(this._item).bounds),"x"==this._channel||"width"==this._channel?this._position="top"==this._orientation?t.top-this._tickSize:t.bottom+this._tickSize:"y"!=this._channel&&"height"!=this._channel||(this._position="left"==this._orientation?t.left-this._tickSize:t.right+this._tickSize)}_positionTicks(){if(void 0===this._position&&this._computePosition(),this._range=this.encoding.getScaleRange(this._item),"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize;if("area"==this._item.type&&"width"==this._channel){let t=getClosestLayout(this._item);if(t){let e=t.type==LayoutType.Stack?t._horzCellAlignment==Alignment.Left:t._cellHorzAlignment==Alignment.Left;this._flip=!e}else{let t=this._item.baseline==Alignment.Left||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[e,r]of this._ticks.children.entries())r._setVertices([[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position+t]]);else if(this.encoding.invertScale)for(let[e,r]of this._ticks.children.entries())r._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position+t]]);else for(let[e,r]of this._ticks.children.entries())r._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position+t]])}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize;if("area"==this._item.type&&"height"==this._channel){let t=getClosestLayout(this._item);if("height"==this._channel&&t){let e=t.type==LayoutType.Stack?t._vertCellAlignment==Alignment.Bottom:t._cellVertAlignment==Alignment.Bottom;this._flip=!e}else{let t=this._item.baseline==Alignment.Bottom||this._item.baseline==Alignment.Center||this._item.baseline==Alignment.Middle||null==this._item.baseline;this._flip=!t}}if(this._flip)for(let[e,r]of this._ticks.children.entries())r._setVertices([[this._position+t,this._range[1]+this.encoding.scale.map(this._tickValues[e])],[this._position,this._range[1]+this.encoding.scale.map(this._tickValues[e])]]);else if(this.encoding.invertScale)for(let[e,r]of this._ticks.children.entries()){let i=this._range[1]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0];r._setVertices([[this._position+t,i],[this._position,i]])}else for(let[e,r]of this._ticks.children.entries())r._setVertices([[this._position+t,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]],[this._position,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]]])}this._positionPath()}_positionTitle(){let t=this._path.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel||"width"==this._channel?(this._title.x=t.x,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y]))}}class LayoutAxis extends Axis{constructor(t,e,r,i,n){super(n),this._channel=r,this._position="x"==this._channel||"width"==this._channel?n.y:n.x,this._item=t[0],this._items=t,this._layout=e,this._field=i,this._titleText=n.hasOwnProperty("title")?n.title:this._field,this._showTitle=!!n.hasOwnProperty("showTitle")&&n.showTitle,n.hasOwnProperty("labelRotation")&&(this._labelRotation=n.labelRotation),this._ticks=new Group,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Group,this._labels.id=this.id+"labels",this.addChild(this._labels),this._rules=new Group,this._rules.id=this.id+"paths",this.addChild(this._rules),this._generatePath(),this._generateTicks(),this._generateLabels(),this._positionPath(),this._positionTicks(),this._positionLabels(),this._showTitle&&(this._generateTitle(),this._positionTitle())}toJSON(){let t=super.toJSON();return t.item=this._item.id,"x"==this._channel||"width"==this._channel?t.args.y=this._position:t.args.x=this._position,this.classId&&(t.classId=this.classId),t}_generatePath(){if(this._rules.removeAll(),this._layout.type==LayoutType.Grid){let t="x"==this._channel?this._layout.numRows:this._layout.numCols;for(let e=0;e<t;e++){let t=new Path$1({strokeColor:this._strokeColor});this._pathVisible||(t.visibility="hidden"),t.type=ItemType.Line,t.id=this.id+"rule"+e,this._rules.addChild(t)}}}_generateTicks(){this._ticks.removeAll();for(let t=0;t<this._layout.group.children.length;t++){let e=new Path$1({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=ItemType.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this._item.dataScope.getFieldType(this._field)){case DataType.Date:t=timeFormat(this._labelFormat);break;case DataType.String:t=function(t){return t};break;default:t=format(this._labelFormat)}let e=this._layout.cellBounds;for(let r=0;r<e.length;r++){let e=new PointText({fillColor:this._textColor,text:t(this._items[r].dataScope.getFieldValue(this._field))});e.id=this.id+"label"+r,this._labels.addChild(e)}}_positionPath(){if(this._layout.type==LayoutType.Grid){let t=this._layout.cellBounds,e="x"==this._channel?this._layout.numRows:this._layout.numCols;if("x"==this._channel){let r=t[0].left,i=this._layout.numCols;for(let n=0;n<e;n++)this._rules.children[n]._setVertices([[r,this._position?this._position:t[n*i][this._orientation]],[r+t[0].width*i+this._layout.hGap*(i-1),this._position?this._position:t[n*i][this._orientation]]])}else{let r=t[0].top,i=this._layout.numRows;for(let n=0;n<e;n++)this._rules.children[n]._setVertices([[this._position?this._position:t[n*i][this._orientation],r],[this._position?this._position:t[n*i][this._orientation],r+t[0].height*i+this._layout.vGap*(i-1)]])}}}_positionTitle(){this._channel}_positionTicks(){let t=this._layout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?1:-1;for(let[r,i]of this._ticks.children.entries()){let n=this._position?this._position+this._tickOffset*e:t[r][this._orientation]+this._tickOffset*e;i._setVertices([[t[r].x,n],[t[r].x,n+e*this._tickSize]])}}else if("y"==this._channel){let e="left"==this._orientation?-1:1;for(let[r,i]of this._ticks.children.entries()){let n=this._position?this._position+this._tickOffset*e:t[r][this._orientation]+this._tickOffset*e,s="middle"==this._tickAnchor?t[r].y:t[r][this._tickAnchor];i._setVertices([[n,s],[n+e*this._tickSize,s]])}}}_positionLabels(){let t=this._layout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?["center","top"]:["center","bottom"],r="bottom"==this._orientation?this._labelOffset:-this._labelOffset;for(let[i,n]of this._labels.children.entries())n.x=t[i].x,n.y=this._position?this._position+r:t[i][this._orientation]+r,n.anchor=e,this._labelRotation&&(n._rotate=[this._labelRotation,n.x,n.y],n.anchor=["right",e[1]])}else if("y"==this._channel){let e="left"==this._orientation?["right","middle"]:["left","middle"],r="left"==this._orientation?-this._labelOffset:this._labelOffset;for(let[i,n]of this._labels.children.entries())n.x=this._position?this._position+r:t[i][this._orientation]+r,n.y="middle"==this._tickAnchor?t[i].y:t[i][this._tickAnchor],n.anchor=e,this._labelRotation&&(n._rotate=[this._labelRotation,n.x,n.y])}}_positionTitle(){let t=this._rules.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel?(this._title.x=t.x,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y]))}}class Legend extends Group{constructor(t,e){super(),this.type=ItemType.Legend,this.id=this.type+ItemCounter[this.type]++,this.encoding=t,this._textColor=e.hasOwnProperty("textColor")?e.textColor:"#555",this._strokeColor=e.hasOwnProperty("strokeColor")?e.strokeColor:"#555",this._x=e.hasOwnProperty("x")?e.x:0,this._y=e.hasOwnProperty("y")?e.y:0,this._orientation=e.hasOwnProperty("orientation")?e.orientation:Orientation.Vertical,this._initialize()}toJSON(){let t=super.toJSON();return t.hasOwnProperty("args")||(t.args={}),t.args.textColor=this._textColor,t.channel=this.encoding.channel,t.field=this.encoding.field,t.args.strokeColor=this._strokeColor,t.args.x=this._x,t.args.y=this._y,t.args.orientation=this._orientation,t}_initialize(){let t=this.encoding.scene,e=this.encoding.field;switch(this.encoding.datatable.getFieldType(e)){case DataType.String:this._createCategoricalColorLegend(t,e);break;case DataType.Number:case DataType.Integer:this._createNumericalColorLegend(t,e)}}_createNumericalColorLegend(t,e){let r,i;this._orientation==Orientation.Vertical?(r=15,i=300):(r=300,i=15);let n=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+r/2,y:this._y,anchor:["center","middle"]});this.addChild(n);let s,a=t.mark("rect",{top:this._y+20,left:this._x,width:r,height:i,strokeWidth:0,opacity:this.encoding.anyItem.opacity}),o=[Math.min(...this.encoding.data),Math.max(...this.encoding.data)],h=this.encoding.mapping,l=(this.encoding.scheme,[]),u=[];if(h){let e=Object.keys(h).map((t=>parseFloat(t))).sort(((t,e)=>t-e));this._orientation==Orientation.Vertical?(s=new LinearGradient({x1:0,y1:100,x2:0,y2:0}),e.forEach((e=>{let n=(e-o[0])/(o[1]-o[0]);s.addStop(100*n,h[e],1);let a=t.mark("line",{x1:this._x-5,x2:this._x+r+5,y1:this._y+20+i-n*i,y2:this._y+20+i-n*i,strokeColor:this._strokeColor});u.push(a);let c=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+r+5+5,y:this._y+20+i-n*i,anchor:["left","middle"]});l.push(c)}))):(s=new LinearGradient({x1:0,y1:0,x2:100,y2:0}),e.forEach((e=>{let n=(e-o[0])/(o[1]-o[0]);s.addStop(100*n,h[e],1);let a=t.mark("line",{x1:this._x+n*r,x2:this._x+n*r,y1:this._y+20-5,y2:this._y+20+i+5,strokeColor:this._strokeColor});u.push(a);let c=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+n*r,y:this._y+i+5+20,anchor:["center","top"]});l.push(c)})))}else{let e=this.encoding.scale.domain,n=[];for(let t=0;t<11;t++)n.push(e[0]+(e[1]-e[0])*t/10);this._orientation==Orientation.Vertical?(s=new LinearGradient({x1:0,y1:100,x2:0,y2:0}),n.forEach((n=>{let a=(n-e[0])/(e[1]-e[0]);s.addStop(100*a,this.encoding.scale.map(n),1);let o=t.mark("line",{x1:this._x-5,x2:this._x+r+5,y1:this._y+20+i-a*i,y2:this._y+20+i-a*i,strokeColor:this._strokeColor});u.push(o);let h=t.mark("text",{fillColor:this._textColor,text:n,x:this._x+r+5+5,y:this._y+20+i-a*i,anchor:["left","middle"]});l.push(h)}))):(s=new LinearGradient({x1:0,y1:0,x2:100,y2:0}),n.forEach((n=>{let a=(n-e[0])/(e[1]-e[0]);s.addStop(100*a,this.encoding.scale.map(n),1);let o=t.mark("line",{x1:this._x+a*r,x2:this._x+a*r,y1:this._y+20-5,y2:this._y+20+i+5,strokeColor:this._strokeColor});u.push(o);let h=t.mark("text",{fillColor:this._textColor,text:n,x:this._x+a*r,y:this._y+i+5+20,anchor:["center","top"]});l.push(h)})))}a.styles.fillColor=s,this.addChild(a);for(let t of l)this.addChild(t);for(let t of u)this.addChild(t)}_createCategoricalColorLegend(t,e){this.addChild(new PointText({fillColor:this._textColor,text:e,x:this._x,y:this._y,anchor:["left","top"]}));let r=t.mark("rect",{top:this._y+25,left:this._x,width:10,height:10,strokeWidth:0,opacity:this.encoding.anyItem.opacity}),i=t.mark("text",{fillColor:this._textColor,x:this._x+20,y:this._y+25,anchor:["left","top"]}),n=t.glyph(r,i),s=t.repeat(n,this.encoding.datatable,{field:e});s.layout=layout("grid",{numCols:1,vGap:8}),t.encode(i,{channel:"text",field:e,_remember:!1}),t.encode(r,{channel:"fillColor",field:e,scale:this.encoding.scale,_remember:!1}),this.addChild(s)}}class Glyph extends Group{constructor(t){if(super(),this.type=ItemType.Glyph,this.id=this.type+ItemCounter[this.type]++,t)for(let e of t)this.addChild(e)}duplicate(){let t=new Glyph;for(let e of this.children)t.addChild(e.duplicate());return t.classId=this.classId,this._dataScope&&(t.dataScope=this._dataScope.clone()),t}}class PiePath extends Path$1{constructor(t){super(t),this.radius=t.hasOwnProperty("radius")?t.radius:100,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this.startAngleDeg=t.hasOwnProperty("startAngle")?t.startAngle%360:0,this.endAngleDeg=t.hasOwnProperty("endAngle")?t.endAngle%360:90,this.totalAng=this.endAngleDeg<this.startAngleDeg?this.endAngleDeg+360-this.startAngleDeg:this.endAngleDeg-this.startAngleDeg,this.startAngleRad=this.startAngleDeg*(Math.PI/180),this.endAngleRad=this.endAngleDeg*(Math.PI/180),this.type=ItemType.Pie,this.closed=!0;let e=[this._x,this._y],r=[this._x+this.radius*Math.cos(this.startAngleRad),this._y-this.radius*Math.sin(this.startAngleRad)],i=[this._x+this.radius*Math.cos(this.endAngleRad),this._y-this.radius*Math.sin(this.endAngleRad)];this._setVertices(new Array(e,r,i))}get x(){return this._x}get y(){return this._y}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}get quadrants(){let t=[];return this.startAngleDeg>=0&&this.startAngleDeg<90?t[0]=1:this.startAngleDeg>=90&&this.startAngleDeg<180?t[0]=2:this.startAngleDeg>=180&&this.startAngleDeg<270?t[0]=3:this.startAngleDeg>=270&&this.startAngleDeg<=360&&(t[0]=4),this.endAngleDeg>=0&&this.endAngleDeg<90?t[1]=1:this.endAngleDeg>=90&&this.endAngleDeg<180?t[1]=2:this.endAngleDeg>=180&&this.endAngleDeg<270?t[1]=3:this.endAngleDeg>=270&&this.endAngleDeg<360&&(t[1]=4),t}getSVGPathData(){let[[t,e],[r,i],[n,s]]=this.vertices.map((t=>[t.x,t.y])),a=this.radius;return`M ${t} ${e} L ${r} ${i} A ${a} ${a} ${this.totalAng} ${this.totalAng>180?1:0} 0 ${n} ${s} Z`}adjustAngle(t,e){this.startAngleDeg=t%360,this.endAngleDeg=e%360,this.startAngleRad=this.startAngleDeg*(Math.PI/180),this.endAngleRad=this.endAngleDeg*(Math.PI/180),this.totalAng=this.endAngleDeg-this.startAngleDeg,this.vertices[1].x=this.x+this.radius*Math.cos(this.startAngleRad),this.vertices[1].y=this.y-this.radius*Math.sin(this.startAngleRad),this.vertices[2].x=this.x+this.radius*Math.cos(this.endAngleRad),this.vertices[2].y=this.y-this.radius*Math.sin(this.endAngleRad)}_updateBounds(){this.vertices.map((t=>t.x)),this.vertices.map((t=>t.y));const[t,e]=this.quadrants,r=this.vertices[1],i=this.vertices[2];let n=this.vertices[0],s=n.y,a=n.x,o=n.x,h=n.y;1===t?(r.x>a&&(a=r.x),r.y<s&&(s=r.y)):2===t?(r.x>a&&(a=r.x),r.y>h&&(h=r.y)):3===t?(r.x<o&&(o=r.x),r.y>h&&(h=r.y)):(r.x<o&&(o=r.x),r.y<s&&(s=r.y)),1===e?(i.x>a&&(a=i.x),i.y<s&&(s=i.y)):2===e?(i.x>a&&(a=i.x),i.y>h&&(h=i.y)):3===e?(i.x<o&&(o=i.x),i.y>h&&(h=i.y)):(i.x<o&&(o=i.x),i.y<s&&(s=i.y)),n.y-this.radius<s&&(s=n.y-this.radius),n.y+this.radius>h&&(h=n.y+this.radius),n.x+this.radius>a&&(a=n.x+this.radius),n.x-this.radius<o&&(o=n.x-this.radius),this._bounds=new Rectangle(o,s,a-o,h-s)}}class AreaPath extends Path$1{constructor(t){super(t),this.type=ItemType.Area,this.closed=!0,t&&t.hasOwnProperty("vertices")&&this.segments.push(new Segment(this.vertices[this.vertices.length-1],this.vertices[0],this,this.segmentCounter++))}get orientation(){return this._orientation}get firstVertexPair(){return[this.vertices[0],this.vertices[this.vertices.length-1]]}get width(){return this.vertices[this.vertices.length/2].x-this.vertices[0].x}get height(){return this.vertices[this.vertices.length/2].y-this.vertices[0].y}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}resizeArea(t,e){let r=this.vertices[this.vertices.length/2].x,i=this.vertices[this.vertices.length/2].y,n=this.width,s=this.height;for(let a of this.vertices)a.x=r+t/n*(a.x-r),a.y=i+e/s*(a.y-i);this._updateBounds()}getSVGPathData(){return super.getSVGPathData()+" z"}}class RingPath extends Path$1{constructor(t){super(t),this.type=ItemType.Ring,this.closed=!0,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._innerRadius=t.hasOwnProperty("innerRadius")?t.innerRadius:100,this._outerRadius=t.hasOwnProperty("outerRadius")?t.outerRadius:200}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t,this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new Point$1(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}translate(t,e){this._x+=t,this._y+=e,this._updateBounds()}_updateBounds(){this._bounds=new Rectangle(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius}getSVGPathData(){return["M "+this._x+" "+this._y,"m 0, -"+this._outerRadius,"a "+this._outerRadius+","+this._outerRadius+", 0, 1, 0, 1, 0","Z","m 0 "+(this._outerRadius-this._innerRadius),"a "+this._innerRadius+", "+this._innerRadius+", 0, 1, 1, -1, 0","Z"].join(" ")}}class PolygonPath extends Path$1{constructor(t){super(t),this.type=ItemType.Polygon,this.closed=!0,t.hasOwnProperty("x")&&(this._x=t.x),t.hasOwnProperty("y")&&(this._y=t.y),t.hasOwnProperty("radius")&&(this._radius=t.radius)}get radius(){return this._radius}get x(){return this._x}get y(){return this._y}get center(){return new Point(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}set radius(t){this._radius=t,this._updateBounds()}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._radius=this._radius}translate(t,e){this._x+=t,this._y+=e,super.translate(t,e)}}class AlignConstraint{constructor(t,e){this.direction=e,this.items=t,this.type=ConstraintType.Align,this.id=this.type+"_"+[...new Set(this.items.map((t=>t.classId)))].join("_")}apply(){let t,e=this.direction;this.direction==Alignment.Top||this.direction==Alignment.Left?t=Math.min(...this.items.map((t=>t.bounds[e]))):this.direction!=Alignment.Bottom&&this.direction!=Alignment.Right||(t=Math.max(...this.items.map((t=>t.bounds[e]))));let r=this.items.map((r=>t-r.bounds[e])),i=e==Alignment.TOP||e==Alignment.Middle||e==Alignment.Bottom?"y":"x";this.items.forEach(((t,e)=>{if(t.parent&&t.parent.layout&&t.parent.layout.type==LayoutType.Stack){let n="x"==i?r[e]:0,s="y"==i?r[e]:0;t.parent.translate(n,s)}else{let n="x"==i?r[e]:0,s="y"==i?r[e]:0;t.translate(n,s)}}))}toJSON(){let t={};return t.items=this.items.map((t=>t.id)),t.direction=this.direction,t.type=this.type,t.id=this.id,t}}class AffixConstraint{constructor(t,e,r,i,n,s,a){this.item=t,this.baseItem=e,this.scene=r,this.channel=i,this.itemAnchor=n,this.baseAnchor=s,this.offset=a,this.type=ConstraintType.Affix,this.id=this.type+"_"+this.item.classId+"_"+this.baseItem.classId+"_"+i}apply(){let t=getPeers(this.item,this.scene),e=getPeers(this.baseItem,this.scene),r=this.itemAnchor,i=this.baseAnchor,n=this.item.type==ItemType.PointText;if("radialDistance"==this.channel)for(let n=0;n<t.length;n++){let s,a=e[n],o=t[n];a.type!=ItemType.Arc&&a.type!=ItemType.Ring||(s="top"==i?a.outerRadius+this.offset:"bottom"==i?a.innerRadius+this.offset:(a.outerRadius+a.innerRadius)/2+this.offset),o.translate(a.x-o.x,a.y-s-o.bounds[r]),o._rotate?o._rotate=[o._rotate[0],a.x,a.y]:o._rotate=[0,a.x,a.y]}else if("angle"==this.channel)for(let n=0;n<t.length;n++){let s=e[n],a=t[n],o="left"==i?s.endAngle+this.offset:"center"==i?(s.endAngle+s.startAngle)/2+this.offset:s.startAngle+this.offset;a._rotate?a._rotate[0]=90-o:(a.translate(s.x-a.bounds[r],s.y-t[n].y),a._rotate=[90-o,e[n].x,e[n].y])}else if(n)for(let r=0;r<t.length;r++){t[r].anchor["x"==this.channel?0:1]=this.itemAnchor;let n=e[r].bounds[i]+this.offset;t[r][this.channel]=n}else for(let n=0;n<t.length;n++){let s=e[n].bounds[i]+this.offset-t[n].bounds[r];"x"==this.channel?t[n].translate(s,0):t[n].translate(0,s)}}toJSON(){let t={};return t.item=this.item.id,t.baseItem=this.baseItem.id,t.channel=this.channel,t.itemAnchor=this.itemAnchor,t.baseAnchor=this.baseAnchor,t.offset=this.offset,t.type="affixation",t.id=this.id,t}}class Gridlines extends Group{constructor(t,e,r){super(),this.type=ItemType.Gridlines,this.id=this.type+ItemCounter[this.type]++,this.encoding=t,this.channel=this.encoding.channel,this._item=e,this._strokeColor=r.hasOwnProperty("strokeColor")?r.strokeColor:"#ddd",this._strokeWidth=r.hasOwnProperty("strokeWidth")?r.strokeWidth:1,"radialDistance"==this.channel&&r.hasOwnProperty("angle")&&(this._rotate=[-r.angle,this.encoding.x,this.encoding.y])}toJSON(){let t=super.toJSON();return t.hasOwnProperty("args")||(t.args={}),t.args.strokeColor=this._strokeColor,t.args.strokeWidth=this._strokeWidth,t.channel=this.encoding.channel,t.field=this.encoding.field,this._rotate&&(t.args.angle=this._rotate[0]),t}get values(){return this._values}set values(t){this._values=t,this._updateLines(),this._updateLinePositions()}_updateLinePositions(){if("x"==this.channel||"width"==this.channel){let t=getTopLevelGroup(this._item).bounds,e=this.encoding.getScaleRange(this._item);for(let[r,i]of this.children.entries()){let n=e[0]+this.encoding.scale.map(this._values[r])-this.encoding.scale.range[0];i._setVertices([[n,t.top],[n,t.bottom]])}}else if("y"==this.channel||"height"==this.channel){let t=getTopLevelGroup(this._item).bounds,e=this.encoding.getScaleRange(this._item);if(this.encoding.invertScale)for(let[r,i]of this.children.entries()){let n=e[1]-this.encoding.scale.map(this._values[r])+this.encoding.scale.range[0];i._setVertices([[t.left,n],[t.right,n]])}else for(let[r,i]of this.children.entries()){let n=e[0]-this.encoding.scale.map(this._values[r])+this.encoding.scale.range[0];i._setVertices([[t.left,n],[t.right,n]])}}else if("radialDistance"==this.channel)for(let[t,e]of this.children.entries())e.x=this._item.parent.x,e.y=this._item.parent.y,e.radius=this.encoding.scale.map(this._values[t])}_updateLines(){if(this.children=[],"x"==this.channel||"y"==this.channel||"width"==this.channel||"height"==this.channel)for(let[t,e]of this._values.entries()){let e=new Path$1({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=ItemType.Line,e.id=this.id+"line"+t,this.addChild(e)}else if("radialDistance"==this.channel)for(let[t,e]of this._values.entries()){let e=new CirclePath({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=ItemType.Circle,e.id=this.id+"line"+t,this.addChild(e)}}}class ArcPath extends Path$1{constructor(t){super(t),this.type=ItemType.Arc,this.closed=!0,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._innerRadius=t.hasOwnProperty("innerRadius")?t.innerRadius:100,this._outerRadius=t.hasOwnProperty("outerRadius")?t.outerRadius:200,this._startAngle=t.hasOwnProperty("startAngle")?t.startAngle:0,this._endAngle=t.hasOwnProperty("endAngle")?t.endAngle:90,this._sr=degree2radian(this._startAngle),this._er=degree2radian(this._endAngle);let e=this._x+this._innerRadius*Math.cos(this._sr),r=this._y-this._innerRadius*Math.sin(this._sr),i=this._x+this._innerRadius*Math.cos(this._er),n=this._y-this._innerRadius*Math.sin(this._er),s=this._x+this._outerRadius*Math.cos(this._sr),a=this._y-this._outerRadius*Math.sin(this._sr),o=this._x+this._outerRadius*Math.cos(this._er),h=this._y-this._outerRadius*Math.sin(this._er);this._setVertices([[e,r],[s,a],[o,h],[i,n]])}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t,this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new Point$1(this._x,this._y)}set x(t){this._x=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this._updateBounds()}set y(t){this._y=t,this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}translate(t,e){this._x+=t,this._y+=e,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}_updateBounds(){this._bounds=new Rectangle(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius,t._startAngle=this._startAngle,t._endAngle=this._endAngle,t._sr=this._sr,t._er=this._er}getSVGPathData(){let t=this._endAngle<this._startAngle?this._endAngle+360-this._startAngle:this._endAngle-this._startAngle,e=t>180?1:0;return["M "+this.vertices[0].x+", "+this.vertices[0].y,"L "+this.vertices[1].x+", "+this.vertices[1].y,"A "+[this._outerRadius,this._outerRadius,t,e,0,this.vertices[2].x,this.vertices[2].y].join(" "),"L "+this.vertices[3].x+", "+this.vertices[3].y,"A "+[this._innerRadius,this._innerRadius,t,e,1,this.vertices[0].x,this.vertices[0].y].join(" ")].join(" ")}adjustAngle(t,e){this._startAngle=t,this._endAngle=e,this._sr=degree2radian(this._startAngle),this._er=degree2radian(this._endAngle),this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er)}}class Image$1 extends Mark{constructor(t){super(t),this.type=ItemType.Image,this._src=t.src,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._width=t.hasOwnProperty("width")?t.width:100,this._height=t.hasOwnProperty("height")?t.height:100}get src(){return this._src}set src(t){this._src=t}get width(){return this._width}set width(t){this._width=t,this._updateBounds()}get height(){return this._height}set height(t){this._height=t,this._updateBounds()}get x(){return this._x}set x(t){this._x=t,this._updateBounds()}get y(){return this._y}set y(t){this._y=t,this._updateBounds()}get bounds(){return this._bounds||this._updateBounds(),this._bounds}_updateBounds(){this._bounds=new Rectangle(this._x,this._y,this._width,this._height)}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this._x,t.y=this._y,t.width=this._width,t.height=this._height,t.src=this._src}translate(t,e){this._x+=t,this._y+=e,this._updateBounds()}}class Link extends Path$1{constructor(t){super(t),this.type=ItemType.Link,this.mode=t.hasOwnProperty("mode")?t.mode:"linear",this.source=void 0,this.target=void 0,this.sourceAnchor=t.hasOwnProperty("sourceAnchor")?t.sourceAnchor:["center","middle"],this.targetAnchor=t.hasOwnProperty("targetAnchor")?t.targetAnchor:["center","middle"],this.sourceOffset=t.hasOwnProperty("sourceOffset")?t.sourceOffset:[0,0],this.targetOffset=t.hasOwnProperty("targetOffset")?t.targetOffset:[0,0]}radialvalue(t,e){let r=t-Math.PI/2;return[t=e*Math.cos(r),e*=Math.sin(t)]}bezierCurveHorizontal(t,e,r,i){return`M ${t} ${e} C ${(t+r)/2} ${e} ${t} ${i} ${r} ${i}`}bezierCurveVertical(t,e,r,i){return`M ${t} ${e} C ${t} ${(e+i)/2} ${r} ${e} ${r} ${i}`}bezierCurveRadial(t,e,r,i){let n=this.radialvalue(t,e),s=this.radialvalue(t,(e+i)/2),a=this.radialvalue(r,e),o=this.radialvalue(r,i);return`M ${n[0]} ${n[1]} C ${s[0]} ${s[1]} ${a[0]} ${a[1]} ${o[0]} ${o[1]}`}_updateBounds(){if(null!=this.source&&null!=this.target){let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],r=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],i=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];this._bounds=new Rectangle(Math.min(t,r),Math.min(e,i),Math.abs(t-r),Math.abs(e-i))}else this._bounds=new Rectangle(0,0,0,0)}getSVGPathData(){if(void 0===this.source||void 0===this.target)return"";let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],r=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],i=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];switch(this.mode){case"curveHorizontal":return this.bezierCurveHorizontal(t,e,r,i);case"linear":default:return`M ${t} ${e} L ${r} ${i}`}}copyPropertiesTo(t){super.copyPropertiesTo(t),t.sourceAnchor=this.sourceAnchor.slice(),t.targetAnchor=this.targetAnchor.slice(),t.sourceOffset=this.sourceOffset.slice(),t.targetOffset=this.targetOffset.slice(),t.mode=this.mode}}function bindToLink(t){return t._query=function(){let t=this.field,e=this.channel,r=this.items.map((t=>t.dataScope));if("source"==e||"target"==e){let e=r.map((e=>e.getFieldValue(t))),i=this.scene;this.data=e.map((t=>i.find([{field:nodeId,value:t}])[0]))}else if("strokeWidth"==e)if(this.datatable.hasField(t))this.data=r.map((e=>e.getFieldValue(t)));else if(t.startsWith("parent.")||t.startsWith("child.")){let e=this.datatable.tree.nodeTable,i=t.split(".")[0],n=t.split(".")[1],s=r.map((t=>t.getFieldValue(i)));this.data=s.map((t=>new DataScope(e).cross(nodeId,t).getFieldValue(n)))}},t._map=function(){let t,e=this.channel,r=this.items;if("strokeWidth"==e){let e,i;t=createScale(this.scaleType?this.scaleType:"linear"),t.domain=[0,Math.max(...this.data)],e=1,i=Math.max(...r.map((t=>parseFloat(t.styles.strokeWidth)))),i==e&&(i=e+5),this.rangeExtent&&(i=e+this.rangeExtent),this.range&&(e=this.range[0],i=this.range[1]),t._setRange([e,i]),this.scale||(this.scale=t),this.scale._addEncoding(this)}},t._apply=function(){let t=this.channel;if("source"==t||"target"==t)for(let t=0;t<this.data.length;t++)this.items[t][this.channel]=this.data[t],this.items[t]._updateBounds();else if("strokeWidth"==t)for(let t=0;t<this.data.length;t++)this.items[t].styles.strokeWidth=this.scale.map(this.data[t])},t.run(),t}class Scene extends Group{constructor(t){super(),t&&t.fillColor&&(this.fillColor=t.fillColor),this.type=ItemType.Scene,this.id=this.type+ItemCounter[this.type]++,this.encodings={},this.constraints={}}group(t){let e=new Group;if(e.classId=e.id,this.addChild(e),t&&t.length>0)for(let r of t)e.addChild(r);return e}mark(t,e){let r=void 0===e?{}:e;switch(t){case ItemType.Rect:{r.hasOwnProperty("top")||(r.top=0),r.hasOwnProperty("left")||(r.left=0),r.hasOwnProperty("width")||(r.width=100),r.hasOwnProperty("height")||(r.height=100);let t=r.top,e=r.left,i=r.width,n=r.height;r.vertices=[[e,t],[e+i,t],[e+i,t+n],[e,t+n]],delete r.top,delete r.left,delete r.width,delete r.height;let s=new RectPath(r);return s.id=s.type+ItemCounter[s.type]++,s.classId=s.id,this.addChild(s),s}case ItemType.Area:{if(void 0!==r&&r.hasOwnProperty("x1")&&r.hasOwnProperty("y1")&&r.hasOwnProperty("x2")&&r.hasOwnProperty("y2")){let t=r.x1,e=r.y1,i=r.x2,n=r.y2;r.vertices=[[t,e],[i,e],[i,n],[t,n]],delete r.x1,delete r.y1,delete r.x2,delete r.y2}let e=new AreaPath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case ItemType.Line:{if(void 0!==r&&r.hasOwnProperty("x1")&&r.hasOwnProperty("y1")&&r.hasOwnProperty("x2")&&r.hasOwnProperty("y2")){let t=r.x1,e=r.y1,i=r.x2,n=r.y2;r.vertices=[[t,e],[i,n]],delete r.x1,delete r.y1,delete r.x2,delete r.y2}let e=new Path$1(r);return e.type=ItemType.Line,e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case ItemType.Path:{let e=new Path$1(r);return e.id=e.type+ItemCounter[t]++,this.addChild(e),e.classId=e.id,e}case ItemType.Circle:{let e=new CirclePath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case ItemType.Ring:{let e=new RingPath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case ItemType.Arc:{let e=new ArcPath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case ItemType.Polygon:let e=new PolygonPath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e;case ItemType.Pie:{let e=new PiePath(r);return e.id=e.type+ItemCounter[t]++,e.classId=e.id,this.addChild(e),e}case"text":case ItemType.PointText:r.hasOwnProperty("anchor")||(r.anchor=["center","middle"]);let i=new PointText(r);return i.id=i.type+ItemCounter[i.type]++,i.classId=i.id,this.addChild(i),i;case ItemType.Image:let n=new Image$1(r);return n.id=n.type+ItemCounter[n.type]++,n.classId=n.id,this.addChild(n),n;case ItemType.Link:let s=new Link(r);return s.id=s.type+ItemCounter[s.type]++,s.classId=s.id,this.addChild(s),s;default:return null}}glyph(...t){let e=new Glyph(t);return e.classId=e.id,this.addChild(e),e}attach(t,e){t.dataScope=new DataScope(e)}repeat(t,e,r){if(!t||void 0===e)throw Errors$1.INCOMPLETE_REPEAT_INFO;let i=r||{},n=i.field?i.field:DataTable.RowID,s=i.callback;validateField(n,e);let a=repeatItem(this,t,n,e,s);return i.layout&&(a.layout=i.layout),a}densify(t,e,r){if(!t||void 0===e)throw Errors$1.INCOMPLETE_PARTITION_INFO;let i=r||{},n=i.orientation,s=i.field?i.field:DataTable.RowID,a=i.hasOwnProperty("startAngle")?i.startAngle:90,o=i.hasOwnProperty("direction")?i.direction:"clockwise",h=i.callback;return validateField(s,e),densifyItem(this,t,n,s,e,h,a,o)}divide(t,e,r){if(!t||null==e)throw Errors$1.INCOMPLETE_PARTITION_INFO;let i=r||{},n=i.orientation,s=i.field?i.field:DataTable.RowID,a=i.callback;validateField(s,e);let o=divideItem(this,t,n,s,e,a);return i.layout&&(o.layout=i.layout),o}_validateEncodeArgs(t,e){if(!t||!e.hasOwnProperty("channel")||!e.hasOwnProperty("field"))throw Errors$1.INCOMPLETE_BINDING_INFO;e.channel;let r=e.field;e.options;if("vertex"==t.type||"segment"==t.type){if(!t.parent.dataScope&&!t.dataScope)throw Errors$1.BIND_WITHOUT_DATASCOPE}else if(!t.dataScope)throw Errors$1.BIND_WITHOUT_DATASCOPE;validateField(r,e.table?e.table:t.dataScope?t.dataScope._dt:t.parent.dataScope._dt)}encode(t,e){let r;if(this._validateEncodeArgs(t,e),"vertex"==t.type&&t.parent.type==ItemType.Area){let e=getPeers(t.parent,this);r=[];let i=t.parent.vertices.indexOf(t)<t.parent.vertices.length/2;for(let t of e)r=i?r.concat(t.vertices.slice(0,t.vertices.length/2)):r.concat(t.vertices.slice(t.vertices.length/2))}else r=getPeers(t,this);return this._doEncode(r,e)}_doEncode(t,e){let r=t[0],i=e.channel,n=e.field;e.hasOwnProperty("datatable")||(e.datatable=r.dataScope?r.dataScope.dataTable:r.parent.dataScope.dataTable),e.hasOwnProperty("aggregator")||(e.aggregator="sum"),e.hasOwnProperty("invertScale")||(e.invertScale=!1),e.hasOwnProperty("includeZero")||(e.includeZero=!1);let s=new Encoding(t,this,i,n,e);switch(i){case"width":case"height":case"radius":case"outerRadius":case"innerRadius":case"area":case"fontSize":r.type==ItemType.Area?bindToArea(s):bindToSize(s);break;case"strokeWidth":r.type==ItemType.Link?bindToLink(s):bindToSize(enocoding);case"x":case"y":r.type==ItemType.Area?bindToArea(s):bindToPosition(s);break;case"fillColor":case"strokeColor":bindToColor(s);break;case"angle":bindToAngle(s);break;case"text":bindToText(s);break;case"radialDistance":s.x=r.parent.x,s.y=r.parent.y,s.radius=r.parent.radius,bindToRadialDistance(s);break;case"source":case"target":bindToLink(s)}return e.hasOwnProperty("_remember")&&1!=e._remember||this._registerBinding(s),i.indexOf("Color")<0&&this._updateAncestorBounds(r,s.items),s}encodeWithinCollection(t,e){this._validateEncodeArgs(t,e);let r=getPeersGroupedByParent(t,this),i=[];for(let t of r){let r=this._doEncode(t,e);i.push(r)}return i}find(t){let e=[];for(let r of t)if(r.hasOwnProperty("field"))r.hasOwnProperty("value")?e.push("d.dataScope && d.dataScope.getFieldValue('"+r.field+"') == '"+r.value+"'"):r.hasOwnProperty("range")?e.push("d.dataScope && d.dataScope.getFieldValue('"+r.field+"') >= "+r.range[0]+" && d.dataScope.getFieldValue('"+r.field+"') <= "+r.range[1]):r.hasOwnProperty("values")&&e.push("d.dataScope && ["+r.values.map((t=>"'"+t+"'")).join(",")+"].indexOf(d.dataScope.getFieldValue('"+r.field+"')) >= 0 ");else if(r.hasOwnProperty("channel"))r.hasOwnProperty("value")?e.push("d."+r.channel+" == '"+r.value+"'"):r.hasOwnProperty("range")?e.push("d."+r.channel+" >= "+r.range[0]+" && d."+r.channel+" <= "+r.range[1]):r.hasOwnProperty("values")&&e.push("["+r.values.map((t=>"'"+t+"'")).join(",")+"].indexOf(d."+r.channel+") >= 0 ");else if(r.hasOwnProperty("type"))e.push("d.type=='"+r.type+"'");else if(r.hasOwnProperty("id"))e.push("d.id=='"+r.id+"'");else if(r.hasOwnProperty("fields")){let t=r.fields[0],i=r.fields[1];e.push("d.dataScope && d.dataScope.getFieldValue('"+t+"')"+r.operator+"d.dataScope.getFieldValue('"+i+"')")}return findItems(this,new Function("d","return "+e.join(" && ")))}align(t,e){if(!canAlign(t,e,this))return!1;let r=new AlignConstraint(t,e);if(this.constraints.hasOwnProperty(r.id))return console.warn("constraint has been added"),!1;this.constraints[r.id]=r,r.apply(),this._updateAncestorBounds(t[0])}alignInCell(t,e){}affix(t,e,r,i){let n=i||{},s=n.hasOwnProperty("offset")?n.offset:0,a=n.hasOwnProperty("itemAnchor")?n.itemAnchor:"x"==r||"angle"==r?"center":"middle",o=n.hasOwnProperty("baseAnchor")?n.baseAnchor:"x"==r||"angle"==r?"center":"middle",h=new AffixConstraint(t,e,this,r,a,o,s);this.constraints.hasOwnProperty(h.id),this.constraints[h.id]=h,h.apply()}axis(t,e,r){let i=this.getEncodingByField(e,t),n=r||{};if(i){let t=new EncodingAxis(i,n.item?n.item:i.anyItem,n);return n.hasOwnProperty("tickValues")?(t.tickValues=n.tickValues,t.labelValues=n.tickValues):(t.tickValues=this._inferTickValues(i),t.labelValues=this._inferTickValues(i)),this.addChildAt(t,0),t}let s=findItems(this,(t=>t.dataScope&&t.dataScope.hasField(e)))[0];if(void 0===s)throw Errors$1.INCORRECT_AXIS_INFO+e;let a=getClosestLayout(s);if(!a||"x"!=t&&"y"!=t)throw Errors$1.INCORRECT_AXIS_INFO+e;{let r,i,s=getPeers(a.group,this);for(let a of s){let s=getPeers(findItems(a,(t=>t.dataScope&&t.dataScope.hasField(e)))[0],a);r=new LayoutAxis(s,a.layout,t,e,n),null==i&&(i=r.id),r.classId=i,this.addChildAt(r,0)}return r}}legend(t,e,r){let i=r||{},n=this.getEncodingByField(e,t);if(!n)throw Errors$1.INCORRECT_LEGEND_INFO+e;i.hasOwnProperty("x")||(i.x=100),i.hasOwnProperty("y")||(i.y=100);let s=new Legend(n,i);this.addChild(s)}gridlines(t,e,r){let i=this.getEncodingByField(e,t),n=r||{};if(!i)return!1;let s=new Gridlines(i,i.anyItem,n);return n.hasOwnProperty("values")?s.values=n.values:s.values=this._inferTickValues(i),this.addChildAt(s,0),s}_inferTickValues(t){let e,r=t.scale.domain,i=t.scale.range;switch(t.scale.type){case"linear":case"log":let n=Math.abs(i[0]-i[1]);if("width"==t.channel||"height"==t.channel){let e=getClosestLayout(t.anyItem);if(e&&e.type==LayoutType.Stack){let i=getPeers(e.group,t.scene);n=Math.max(...i.map((e=>e.bounds[t.channel]))),r[1]=Math.ceil(t.scale.invert(n))}}e="width"==t.channel||"x"==t.channel?45:30;let s=Math.floor(n/e);tickStep(r[0],r[1],s);return ticks(r[0],r[1],s);case"point":e="width"==t.channel||"x"==t.channel?80:30;let a=Math.floor(t.scale.rangeExtent/r.length),o=Math.ceil(e/a);return"x"==t.channel?r.filter(((t,e)=>e%o==0)):r;case"time":e="width"==t.channel||"x"==t.channel?80:30;let h,l,u=Math.floor((i[1]-i[0])/e),c=Math.ceil((r[1]-r[0])/u)/1e3,d=[1,60,3600,86400,2628003,31536e3],f=[seconds,minutes,hours,days,months,years];for(let t=0;t<d.length-1;t++)if(c>=d[t]&&c<d[t+1])return h=Math.floor(c/d[t]),l=f[t],l(r[0],r[1],h);if(c>d[d.length-1])return h=Math.floor(c/d[d.length-1]),l=f[d.length-1],l(r[0],r[1],h);default:return[]}}propagate(t,e,...r){let i=getPeers(t,this);for(let t of i)t[e](...r)}classify(t,e,r){let i,n={};for(let r of t){let t=r.dataScope.getFieldValue(e);n.hasOwnProperty(t)||(n[t]=[]),n[t].push(r)}let s=[],a=t[0].dataScope._dt;for(let t in n){let o=new Collection;r.addChild(o),void 0===i&&(i=o.id),o.classId=i,o.dataScope=new DataScope(a).cross(e,t);for(let e of n[t])o.addChild(e);s.push(o)}return s}getEncodingByItem(t,e){let r=this.encodings[getEncodingKey(t)];return r&&e?r[e]:null}getEncodingByField(t,e){for(let r in this.encodings){let i=this.encodings[r];if(i[e]&&i[e].field==t)return i[e]}return null}positionBound(t,e){return!!this.getEncodingByItem(t,e)||!(!isMark(t)||!this.getEncodingByItem(t.vertices[0],e))}setProperties(t,e){if(Object.values(LayoutType).indexOf(t.type)>-1&&t.group){let r=getPeers(t.group,this);for(let t of r)for(let r in e)t.layout[r]=e[r]}else{let r=getPeers(t,this);if("vertex"==t.type)for(let t of r)for(let r in e)t[r]=e[r];else if("segment"==t.type);else if(t instanceof Mark){for(let t in e)Attr2SVG.hasOwnProperty(t)?r.forEach((r=>r.attrs[t]=e[t])):Style2SVG.hasOwnProperty(t)?r.forEach((r=>r.styles[t]=e[t])):r.forEach((r=>r[t]=e[t]));(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&this._relayoutAncestors(t,r)}else if("collection"==t.type)for(let t in e)r.forEach((r=>r[t]=e[t]))}}_updateAncestorBounds(t,e){let r=getParents(e||getPeers(t,this));for(;r.length>0;){for(let t of r)(t.children&&t.children.length>0||t.vertices)&&t._updateBounds();r=getParents(r)}}_relayoutAncestors(t,e){let r=getParents(e||getPeers(t,this));for(;r.length>0;){for(let t of r)t.layout&&t.layout.run(),t.children&&t.children.length>0&&t._updateBounds(),t.vertices&&t._updateBounds();r=getParents(r)}}_reapplySizeBindings(t){let e=["width","height"];for(let r in this.encodings){if(t.classId!=r)continue;let i=this.encodings[r],n=findItems(this,(t=>t.classId==r));for(let t of e){let e=i[t];e&&e.run()}this._relayoutAncestors(n[0],n)}}_registerBinding(t){let e=this.encodings,r=getEncodingKey(t.anyItem);return e.hasOwnProperty(r)||(e[r]={}),e[r][t.channel]=t,!0}toJSON(){let t=super.toJSON();this.fillColor&&(t.fillColor=this.fillColor);let e={};t.encodings=[];for(let r in this.encodings)for(let i in this.encodings[r]){let n=this.encodings[r][i];t.encodings.push(n.toJSON()),n.scale&&!e.hasOwnProperty(n.scale.id)&&(e[n.scale.id]=n.scale.toJSON())}t.scales=e,t.constraints={};for(let e in this.constraints)t.constraints[e]=this.constraints[e].toJSON();t.tables={};let r=this.getDataTables();for(let e in r)t.tables[e]=r[e].toJSON();return t}getDataTables(){let t={};for(let e in this.encodings)for(let r in this.encodings[e]){let i=this.encodings[e][r];t.hasOwnProperty(i.datatable.id)||(t[i.datatable.id]=i.datatable)}return t}}class SVGRenderer{constructor(t){this._svgId=t,this._compMap={},this._decoMap={}}render(t,e){this._renderItem(t,e)}clear(){let t=document.getElementById(this._svgId);for(;t.firstChild;)t.firstChild.remove();this._compMap={},this._decoMap={}}_renderItem(t,e){let r=t.id,i=t.parent,n=i?i.id:this._svgId;this._compMap.hasOwnProperty(r)||(this._compMap[r]=select("#"+n).append(this._getSVGElementType(t)));let s=this._compMap[r];if(s.attr("id",r),t.type==ItemType.Scene&&select("#"+this._svgId).style("background",t.fillColor?t.fillColor:"white"),"vertex"!=t.type){if(t.type==ItemType.Path||t.type==ItemType.Polygon||t.type==ItemType.Link)s.attr("d",t.getSVGPathData()),t.closed||s.style("fill","none"),0==r.indexOf("axis")&&s.style("shape-rendering","crispEdges");else if(t.type==ItemType.Line)s.attr("x1",t.vertices[0].x),s.attr("y1",t.vertices[0].y),s.attr("x2",t.vertices[1].x),s.attr("y2",t.vertices[1].y),0==r.indexOf("axis")&&s.style("shape-rendering","crispEdges");else if(t.type==ItemType.Circle)s.attr("cx",t.x),s.attr("cy",t.y),s.attr("r",t.radius);else if(t.type==ItemType.Rect){let e=t.bounds;s.attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height)}else t.type==ItemType.PointText?s.attr("text-anchor",this._getTextAnchor(t.anchor[0])).attr("alignment-baseline",this._getTextAnchor(t.anchor[1])).attr("dominant-baseline",this._getTextAnchor(t.anchor[1])).text(t.text).attr("x",t.x).attr("y",t.y):t.type==ItemType.Pie||t.type==ItemType.Area?(s.attr("d",t.getSVGPathData()),t.closed||s.style("fill","none"),0==r.indexOf("axis")&&s.style("shape-rendering","crispEdges")):t.type==ItemType.Ring||t.type==ItemType.Arc?s.attr("d",t.getSVGPathData()):t.type==ItemType.Image&&s.attr("href",t.src).attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height);for(let e in t.attrs)s.attr(Attr2SVG[e],t.attrs[e]);for(let e in t.styles)if(void 0!==t.styles[e])if(e.indexOf("Color")>0&&t.styles[e].type==ItemType.LinearGradient){select("#"+this._svgId).select("defs").empty()&&select("#"+this._svgId).append("defs");let r=select("defs"),i=t.styles[e];if(r.select("#"+i.id).empty()){let t=r.append("linearGradient").attr("id",i.id);t.attr("x1",i.x1+"%").attr("x2",i.x2+"%").attr("y1",i.y1+"%").attr("y2",i.y2+"%");for(let e of i.stops)t.append("stop").attr("offset",e.offset+"%").style("stop-color",e.color).style("stop-opacity",e.opacity)}s.style(Style2SVG[e],"url(#"+i.id+")")}else s.style(Style2SVG[e],t.styles[e]);if(t._rotate&&s.attr("transform","rotate("+t._rotate.join(" ")+")"),t.vertices){t.vertices.map((t=>t.shape)).filter((t=>void 0!==t)).length>0&&this._renderVertices(t)}if(t.type==ItemType.Collection&&e&&e.collectionBounds){let e=t.bounds;t.layout&&"grid"==t.layout.type?this._renderLayout(t):(this._decoMap.hasOwnProperty(t.id)||(this._decoMap[t.id]=select("#"+this._svgId).append("rect").attr("class","deco")),this._decoMap[t.id].attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height).attr("fill","none").attr("stroke","#1ecb40").attr("stroke-width","1px").attr("stroke-dasharray","5,5"))}if(t.children)for(let r of t.children)this._renderItem(r,e)}}_renderVertices(t){let e=t.id+"-vertices";if(!this._compMap.hasOwnProperty(e)){let r=t.parent,i=r?r.id:this._svgId;this._compMap[e]=select("#"+i).append("g").attr("id",e)}let r=t.vertices.filter((t=>void 0!==t.shape));for(let t of r){let r=e+"-"+t.id;this._compMap.hasOwnProperty(r)||(this._compMap[r]=select("#"+e).append(t.shape).attr("id",r)),"rect"==t.shape?select("#"+r).attr("x",t.x-t.width/2).attr("y",t.y-t.height/2).attr("width",t.width).attr("height",t.height):"circle"==t.shape&&select("#"+r).attr("cx",t.x).attr("cy",t.y).attr("r",t.radius),select("#"+r).style("fill",t.fillColor).style("opacity",t.opacity).style("stroke-width",t.strokeWidth).style("stroke",t.strokeColor)}}_renderLayout(t){let e=t.id+"-grid";this._decoMap.hasOwnProperty(e)||(this._decoMap[e]=select("#"+this._svgId).append("g").attr("id",e).attr("class","deco"));let r=t.layout.cellBounds,i=(t.layout.hGap,t.layout.vGap);this._decoMap[e].selectAll("rect").remove(),this._decoMap[e].selectAll("rect").data(r.slice(0,r.length-1)).enter().append("rect").attr("x",(t=>t.left)).attr("y",(t=>t.bottom)).attr("width",(t=>t.width)).attr("height",i).style("fill","pink").style("opacity",.5);let n=Math.min(...r.map((t=>t.left))),s=Math.min(...r.map((t=>t.top)));this._decoMap[e].append("rect").attr("x",n).attr("y",s).attr("width",t.bounds.width).attr("height",t.bounds.height).attr("stroke","#1ecb40").attr("stroke-width","1px").attr("stroke-dasharray","5,5").attr("fill","none")}_getTextAnchor(t){switch(t){case"top":return"text-before-edge";case"bottom":return"text-after-edge";case"left":return"start";case"right":return"end";case"center":case"middle":return"middle";default:return t}}_getSVGElementType(t){switch(t.type){case ItemType.Rect:return"rect";case ItemType.Collection:case ItemType.Group:case ItemType.Glyph:case ItemType.Scene:case ItemType.Axis:case ItemType.Legend:case ItemType.Gridlines:return"g";case ItemType.Area:case ItemType.Path:case ItemType.Polygon:case ItemType.Ring:case ItemType.Pie:case ItemType.Arc:case ItemType.Link:return"path";case ItemType.Circle:return"circle";case ItemType.Line:return"line";case ItemType.PointText:return"text";case"vertex":if("circle"==t.shape)return"circle";if("rect"==t.shape)return"rect";throw"argument exception";case"image":return"image"}}}class PackingLayout extends Layout{constructor(t){super(t),this.type="packing",this.x=t.hasOwnProperty("x")?t.x:400,this.y=t.hasOwnProperty("y")?t.y:400,this.width=t.width,this.height=t.height}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this.x,t.args.y=this.y,t.args.width=this.width,t.args.height=this.height,t}clone(){return new PackingLayout({x:this.x,y:this.y,width:this.width,height:this.height})}run(){if(null==this.group)return;let t=this.group.children.map((t=>({name:t.id,radius:t.radius,itm:t}))),e=t.reduce(((t,e)=>t+Math.pow(e.radius,2)),0),r=Math.sqrt(e);void 0===this.width&&(this.width=r),void 0===this.height&&(this.height=r);let i=hierarchy({name:"root",children:t}).sum((t=>t.radius?t.radius:0)).sort(((t,e)=>e.value-t.value));index$1().size([this.width,this.height]).radius((t=>t.value))(i);for(let t of i.children){let e=t.data.itm,r=this.x-i.x+t.x-e.x,n=this.y-i.y+t.y-e.y;e.translate(r,n)}}}class TreemapLayout extends Layout{constructor(t){super(t),this.type="treemap",this._width=t.width,this._height=t.height,this._top=t.top,this._left=t.left}toJSON(){let t={args:{}};return t.type=this.type,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}clone(){return new TreemapLayout({})}run(){if(null==this.group)return;let t=this.width?this.width:this.group.bounds.width,e=this.height?this.height:this.group.bounds.height,r=void 0===this.top?this.group.bounds.top:this.top,i=void 0===this.left?this.group.bounds.left:this.left,n=hierarchy(this.group).sum((t=>"rect"==t.type?t.bounds.width*t.bounds.height:0));index$2().size([t,e])(n);this._apply(n,i,r);this.group.getScene()._updateAncestorBounds(n.leaves()[0].data)}_apply(t,e,r){if("collection"==t.data.type)for(let i of t.children)this._apply(i,e,r);else"rect"==t.data.type&&(t.data.resize(t.x1-t.x0,t.y1-t.y0),t.data.translate(t.x0+e-t.data.bounds.left,t.y0+r-t.data.bounds.top))}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get top(){return this._top}set top(t){this._top=t,this.run()}get left(){return this._left}set left(t){this._left=t,this.run()}}function finallyConstructor(t){var e=this.constructor;return this.then((function(r){return e.resolve(t()).then((function(){return r}))}),(function(r){return e.resolve(t()).then((function(){return e.reject(r)}))}))}function allSettled(t){return new this((function(e,r){if(!t||void 0===t.length)return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var n=i.length;function s(t,r){if(r&&("object"==typeof r||"function"==typeof r)){var a=r.then;if("function"==typeof a)return void a.call(r,(function(e){s(t,e)}),(function(r){i[t]={status:"rejected",reason:r},0==--n&&e(i)}))}i[t]={status:"fulfilled",value:r},0==--n&&e(i)}for(var a=0;a<i.length;a++)s(a,i[a])}))}var setTimeoutFunc=setTimeout;function isArray(t){return Boolean(t&&void 0!==t.length)}function noop$1(){}function bind(t,e){return function(){t.apply(e,arguments)}}function Promise$1(t){if(!(this instanceof Promise$1))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(t,this)}function handle(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,Promise$1._immediateFn((function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var i;try{i=r(t._value)}catch(t){return void reject(e.promise,t)}resolve(e.promise,i)}else(1===t._state?resolve:reject)(e.promise,t._value)}))):t._deferreds.push(e)}function resolve(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof Promise$1)return t._state=3,t._value=e,void finale(t);if("function"==typeof r)return void doResolve(bind(r,e),t)}t._state=1,t._value=e,finale(t)}catch(e){reject(t,e)}}function reject(t,e){t._state=2,t._value=e,finale(t)}function finale(t){2===t._state&&0===t._deferreds.length&&Promise$1._immediateFn((function(){t._handled||Promise$1._unhandledRejectionFn(t._value)}));for(var e=0,r=t._deferreds.length;e<r;e++)handle(t,t._deferreds[e]);t._deferreds=null}function Handler(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}function doResolve(t,e){var r=!1;try{t((function(t){r||(r=!0,resolve(e,t))}),(function(t){r||(r=!0,reject(e,t))}))}catch(t){if(r)return;r=!0,reject(e,t)}}Promise$1.prototype.catch=function(t){return this.then(null,t)},Promise$1.prototype.then=function(t,e){var r=new this.constructor(noop$1);return handle(this,new Handler(t,e,r)),r},Promise$1.prototype.finally=finallyConstructor,Promise$1.all=function(t){return new Promise$1((function(e,r){if(!isArray(t))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var n=i.length;function s(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var o=a.then;if("function"==typeof o)return void o.call(a,(function(e){s(t,e)}),r)}i[t]=a,0==--n&&e(i)}catch(t){r(t)}}for(var a=0;a<i.length;a++)s(a,i[a])}))},Promise$1.allSettled=allSettled,Promise$1.resolve=function(t){return t&&"object"==typeof t&&t.constructor===Promise$1?t:new Promise$1((function(e){e(t)}))},Promise$1.reject=function(t){return new Promise$1((function(e,r){r(t)}))},Promise$1.race=function(t){return new Promise$1((function(e,r){if(!isArray(t))return r(new TypeError("Promise.race accepts an array"));for(var i=0,n=t.length;i<n;i++)Promise$1.resolve(t[i]).then(e,r)}))},Promise$1._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){setTimeoutFunc(t,0)},Promise$1._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};
/*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */
var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(t,e){for(var r,i,n=toObject(t),s=1;s<arguments.length;s++){for(var a in r=Object(arguments[s]))hasOwnProperty.call(r,a)&&(n[a]=r[a]);if(getOwnPropertySymbols){i=getOwnPropertySymbols(r);for(var o=0;o<i.length;o++)propIsEnumerable.call(r,i[o])&&(n[i[o]]=r[i[o]])}}return n};
/*!
   * @pixi/polyfill - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/polyfill is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */self.Promise||(self.Promise=Promise$1),Object.assign||(Object.assign=objectAssign);var ONE_FRAME_TIME=16;if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var startTime_1=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-startTime_1}}for(var lastTime=Date.now(),vendors=["ms","moz","webkit","o"],x$2=0;x$2<vendors.length&&!self.requestAnimationFrame;++x$2){var p=vendors[x$2];self.requestAnimationFrame=self[p+"RequestAnimationFrame"],self.cancelAnimationFrame=self[p+"CancelAnimationFrame"]||self[p+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=ONE_FRAME_TIME+lastTime-e;return r<0&&(r=0),lastTime=e,self.setTimeout((function(){lastTime=Date.now(),t(performance.now())}),r)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function createMatch(t){return function(e){return e.test(t)}}function isMobile(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var n=createMatch(r),s={apple:{phone:n(appleIphone)&&!n(windowsPhone),ipod:n(appleIpod),tablet:!n(appleIphone)&&(n(appleTablet)||isAppleTabletOnIos13(e))&&!n(windowsPhone),universal:n(appleUniversal),device:(n(appleIphone)||n(appleIpod)||n(appleTablet)||n(appleUniversal)||isAppleTabletOnIos13(e))&&!n(windowsPhone)},amazon:{phone:n(amazonPhone),tablet:!n(amazonPhone)&&n(amazonTablet),device:n(amazonPhone)||n(amazonTablet)},android:{phone:!n(windowsPhone)&&n(amazonPhone)||!n(windowsPhone)&&n(androidPhone),tablet:!n(windowsPhone)&&!n(amazonPhone)&&!n(androidPhone)&&(n(amazonTablet)||n(androidTablet)),device:!n(windowsPhone)&&(n(amazonPhone)||n(amazonTablet)||n(androidPhone)||n(androidTablet))||n(/\bokhttp\b/i)},windows:{phone:n(windowsPhone),tablet:n(windowsTablet),device:n(windowsPhone)||n(windowsTablet)},other:{blackberry:n(otherBlackBerry),blackberry10:n(otherBlackBerry10),opera:n(otherOpera),firefox:n(otherFirefox),chrome:n(otherChrome),device:n(otherBlackBerry)||n(otherBlackBerry10)||n(otherOpera)||n(otherFirefox)||n(otherChrome)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}
/*!
   * @pixi/settings - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/settings is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */var isMobile$1=isMobile(self.navigator),ENV,RENDERER_TYPE,BUFFER_BITS,BLEND_MODES,DRAW_MODES,FORMATS,TARGETS,TYPES,SAMPLER_TYPES,SCALE_MODES,WRAP_MODES,MIPMAP_MODES,ALPHA_MODES,CLEAR_MODES,GC_MODES,PRECISION,MASK_TYPES,MSAA_QUALITY;function maxRecommendedTextures(t){var e=!0;if(isMobile$1.tablet||isMobile$1.phone){var r;if(isMobile$1.apple.device)if(r=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(r[1],10)<11&&(e=!1);if(isMobile$1.android.device)if(r=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(r[1],10)<7&&(e=!1)}return e?t:4}function canUploadSameBuffer(){return!isMobile$1.apple.device}!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ENV||(ENV={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(RENDERER_TYPE||(RENDERER_TYPE={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(BUFFER_BITS||(BUFFER_BITS={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(BLEND_MODES||(BLEND_MODES={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES||(DRAW_MODES={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS||(FORMATS={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS||(TARGETS={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES||(TYPES={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(SAMPLER_TYPES||(SAMPLER_TYPES={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(SCALE_MODES||(SCALE_MODES={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES||(WRAP_MODES={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES||(MIPMAP_MODES={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES||(ALPHA_MODES={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(CLEAR_MODES||(CLEAR_MODES={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(GC_MODES||(GC_MODES={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(PRECISION||(PRECISION={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(MASK_TYPES||(MASK_TYPES={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(MSAA_QUALITY||(MSAA_QUALITY={}));var settings={MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile$1.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var eventemitter3=createCommonjsModule((function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new n(i,s||t,a),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),o.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,a=new Array(s);n<s;n++)a[n]=i[n].fn;return a},o.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,n,s,a){var o=r?r+t:t;if(!this._events[o])return!1;var h,l,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,s),!0;case 6:return u.fn.call(u.context,e,i,n,s,a),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,n);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},o.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},o.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},o.prototype.removeListener=function(t,e,i,n){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||n&&!o.once||i&&o.context!==i||a(this,s);else{for(var h=0,l=[],u=o.length;h<u;h++)(o[h].fn!==e||n&&!o[h].once||i&&o[h].context!==i)&&l.push(o[h]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o})),earcut_1=earcut,default_1=earcut;function earcut(t,e,r){r=r||2;var i,n,s,a,o,h,l,u=e&&e.length,c=u?e[0]*r:t.length,d=linkedList(t,0,c,r,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=eliminateHoles(t,e,d,r)),t.length>80*r){i=s=t[0],n=a=t[1];for(var p=r;p<c;p+=r)(o=t[p])<i&&(i=o),(h=t[p+1])<n&&(n=h),o>s&&(s=o),h>a&&(a=h);l=0!==(l=Math.max(s-i,a-n))?1/l:0}return earcutLinked(d,f,r,i,n,l),f}function linkedList(t,e,r,i,n){var s,a;if(n===signedArea(t,e,r,i)>0)for(s=e;s<r;s+=i)a=insertNode(s,t[s],t[s+1],a);else for(s=r-i;s>=e;s-=i)a=insertNode(s,t[s],t[s+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!equals(i,i.next)&&0!==area(i.prev,i,i.next))i=i.next;else{if(removeNode(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function earcutLinked(t,e,r,i,n,s,a){if(t){!a&&s&&indexCurve(t,i,n,s);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,s?isEarHashed(t,i,n,s):isEar(t))e.push(o.i/r),e.push(t.i/r),e.push(h.i/r),removeNode(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?earcutLinked(t=cureLocalIntersections(filterPoints(t),e,r),e,r,i,n,s,2):2===a&&splitEarcut(t,e,r,i,n,s):earcutLinked(filterPoints(t),e,r,i,n,s,1);break}}}function isEar(t){var e=t.prev,r=t,i=t.next;if(area(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(pointInTriangle(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(t,e,r,i){var n=t.prev,s=t,a=t.next;if(area(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,h=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,l=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,c=zOrder(o,h,e,r,i),d=zOrder(l,u,e,r,i),f=t.prevZ,p=t.nextZ;f&&f.z>=c&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(t,e,r){var i=t;do{var n=i.prev,s=i.next.next;!equals(n,s)&&intersects$1(n,i,i.next,s)&&locallyInside(n,s)&&locallyInside(s,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(s.i/r),removeNode(i),removeNode(i.next),i=t=s),i=i.next}while(i!==t);return filterPoints(i)}function splitEarcut(t,e,r,i,n,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var h=splitPolygon(a,o);return a=filterPoints(a,a.next),h=filterPoints(h,h.next),earcutLinked(a,e,r,i,n,s),void earcutLinked(h,e,r,i,n,s)}o=o.next}a=a.next}while(a!==t)}function eliminateHoles(t,e,r,i){var n,s,a,o=[];for(n=0,s=e.length;n<s;n++)(a=linkedList(t,e[n]*i,n<s-1?e[n+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),o.push(getLeftmost(a));for(o.sort(compareX),n=0;n<o.length;n++)eliminateHole(o[n],r),r=filterPoints(r,r.next);return r}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){var r=splitPolygon(e,t);filterPoints(e,e.next),filterPoints(r,r.next)}}function findHoleBridge(t,e){var r,i=e,n=t.x,s=t.y,a=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>a){if(a=o,o===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r;var h,l=r,u=r.x,c=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&pointInTriangle(s<c?n:a,s,u,c,s<c?a:n,s,i.x,i.y)&&(h=Math.abs(s-i.y)/(n-i.x),locallyInside(i,t)&&(h<d||h===d&&(i.x>r.x||i.x===r.x&&sectorContainsSector(r,i)))&&(r=i,d=h)),i=i.next}while(i!==l);return r}function sectorContainsSector(t,e){return area(t.prev,t,e.prev)<0&&area(e.next,t,t.next)<0}function indexCurve(t,e,r,i){var n=t;do{null===n.z&&(n.z=zOrder(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(t){var e,r,i,n,s,a,o,h,l=1;do{for(r=t,t=null,s=null,a=0;r;){for(a++,i=r,o=0,e=0;e<l&&(o++,i=i.nextZ);e++);for(h=l;o>0||h>0&&i;)0!==o&&(0===h||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,l*=2}while(a>1);return t}function zOrder(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function pointInTriangle(t,e,r,i,n,s,a,o){return(n-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(i-o)-(r-a)*(e-o)>=0&&(r-a)*(s-o)-(n-a)*(i-o)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(area(t.prev,t,e.prev)||area(t,e.prev,e))||equals(t,e)&&area(t.prev,t,t.next)>0&&area(e.prev,e,e.next)>0)}function area(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects$1(t,e,r,i){var n=sign(area(t,e,r)),s=sign(area(t,e,i)),a=sign(area(r,i,t)),o=sign(area(r,i,e));return n!==s&&a!==o||(!(0!==n||!onSegment(t,r,e))||(!(0!==s||!onSegment(t,i,e))||(!(0!==a||!onSegment(r,t,i))||!(0!==o||!onSegment(r,e,i)))))}function onSegment(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function sign(t){return t>0?1:t<0?-1:0}function intersectsPolygon(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&intersects$1(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){var r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}function splitPolygon(t,e){var r=new Node$2(t.i,t.x,t.y),i=new Node$2(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function insertNode(t,e,r,i){var n=new Node$2(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node$2(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,r,i){for(var n=0,s=e,a=r-i;s<r;s+=i)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}earcut.deviation=function(t,e,r,i){var n=e&&e.length,s=n?e[0]*r:t.length,a=Math.abs(signedArea(t,0,s,r));if(n)for(var o=0,h=e.length;o<h;o++){var l=e[o]*r,u=o<h-1?e[o+1]*r:t.length;a-=Math.abs(signedArea(t,l,u,r))}var c=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,f=i[o+1]*r,p=i[o+2]*r;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},earcut.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)r.vertices.push(t[n][s][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r},earcut_1.default=default_1;var punycode=createCommonjsModule((function(t,e){!function(r){var i=e&&!e.nodeType&&e,n=t&&!t.nodeType&&t,s="object"==typeof commonjsGlobal&&commonjsGlobal;s.global!==s&&s.window!==s&&s.self!==s||(r=s);var a,o,h=2147483647,l=36,u=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,f={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,_=String.fromCharCode;function g(t){throw RangeError(f[t])}function m(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function y(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),i+m((t=t.replace(d,".")).split("."),e).join(".")}function v(t){for(var e,r,i=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function b(t){return m(t,(function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)})).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function T(t,e,r){var i=0;for(t=r?p(t/700):t>>1,t+=p(t/e);t>455;i+=l)t=p(t/35);return p(i+36*t/(t+38))}function E(t){var e,r,i,n,s,a,o,u,c,d,f,_=[],m=t.length,y=0,v=128,x=72;for((r=t.lastIndexOf("-"))<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&g("not-basic"),_.push(t.charCodeAt(i));for(n=r>0?r+1:0;n<m;){for(s=y,a=1,o=l;n>=m&&g("invalid-input"),((u=(f=t.charCodeAt(n++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:l)>=l||u>p((h-y)/a))&&g("overflow"),y+=u*a,!(u<(c=o<=x?1:o>=x+26?26:o-x));o+=l)a>p(h/(d=l-c))&&g("overflow"),a*=d;x=T(y-s,e=_.length+1,0==s),p(y/e)>h-v&&g("overflow"),v+=p(y/e),y%=e,_.splice(y++,0,v)}return b(_)}function S(t){var e,r,i,n,s,a,o,u,c,d,f,m,y,b,E,S=[];for(m=(t=v(t)).length,e=128,r=0,s=72,a=0;a<m;++a)(f=t[a])<128&&S.push(_(f));for(i=n=S.length,n&&S.push("-");i<m;){for(o=h,a=0;a<m;++a)(f=t[a])>=e&&f<o&&(o=f);for(o-e>p((h-r)/(y=i+1))&&g("overflow"),r+=(o-e)*y,e=o,a=0;a<m;++a)if((f=t[a])<e&&++r>h&&g("overflow"),f==e){for(u=r,c=l;!(u<(d=c<=s?1:c>=s+26?26:c-s));c+=l)E=u-d,b=l-d,S.push(_(x(d+E%b,0))),u=p(E/b);S.push(_(x(u,0))),s=T(r,y,i==n),r=0,++i}++r,++e}return S.join("")}if(a={version:"1.3.2",ucs2:{decode:v,encode:b},decode:E,encode:S,toASCII:function(t){return y(t,(function(t){return c.test(t)?"xn--"+S(t):t}))},toUnicode:function(t){return y(t,(function(t){return u.test(t)?E(t.slice(4).toLowerCase()):t}))}},i&&n)if(t.exports==i)n.exports=a;else for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);else r.punycode=a}(commonjsGlobal)})),util={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function hasOwnProperty$1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var decode=function(t,e,r,i){e=e||"&",r=r||"=";var n={};if("string"!=typeof t||0===t.length)return n;var s=/\+/g;t=t.split(e);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var o=t.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l,u,c,d,f=t[h].replace(s,"%20"),p=f.indexOf(r);p>=0?(l=f.substr(0,p),u=f.substr(p+1)):(l=f,u=""),c=decodeURIComponent(l),d=decodeURIComponent(u),hasOwnProperty$1(n,c)?Array.isArray(n[c])?n[c].push(d):n[c]=[n[c],d]:n[c]=d}return n},stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},encode=function(t,e,r,i){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var n=encodeURIComponent(stringifyPrimitive(i))+r;return Array.isArray(t[i])?t[i].map((function(t){return n+encodeURIComponent(stringifyPrimitive(t))})).join(e):n+encodeURIComponent(stringifyPrimitive(t[i]))})).join(e):i?encodeURIComponent(stringifyPrimitive(i))+r+encodeURIComponent(stringifyPrimitive(t)):""},querystring=createCommonjsModule((function(t,e){e.decode=e.parse=decode,e.encode=e.stringify=encode})),querystring_1=querystring.decode,querystring_2=querystring.parse,querystring_3=querystring.encode,querystring_4=querystring.stringify,parse=urlParse,resolve$1=urlResolve,format$1=urlFormat;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},ENV$1,RENDERER_TYPE$1,BUFFER_BITS$1,BLEND_MODES$1,DRAW_MODES$1,FORMATS$1,TARGETS$1,TYPES$1,SAMPLER_TYPES$1,SCALE_MODES$1,WRAP_MODES$1,MIPMAP_MODES$1,ALPHA_MODES$1,CLEAR_MODES$1,GC_MODES$1,PRECISION$1,MASK_TYPES$1,MSAA_QUALITY$1;function urlParse(t,e,r){if(t&&util.isObject(t)&&t instanceof Url)return t;var i=new Url;return i.parse(t,e,r),i}function urlFormat(t){return util.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)}Url.prototype.parse=function(t,e,r){if(!util.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",s=t.split(n);s[0]=s[0].replace(/\\/g,"/");var a=t=s.join(n);if(a=a.trim(),!r&&1===t.split("#").length){var o=simplePathPattern.exec(a);if(o)return this.path=a,this.href=a,this.pathname=o[1],o[2]?(this.search=o[2],this.query=e?querystring.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=protocolPattern.exec(a);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,a=a.substr(h.length)}if(r||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===a.substr(0,2);!u||h&&hostlessProtocol[h]||(a=a.substr(2),this.slashes=!0)}if(!hostlessProtocol[h]&&(u||h&&!slashedProtocol[h])){for(var c,d,f=-1,p=0;p<hostEndingChars.length;p++){-1!==(_=a.indexOf(hostEndingChars[p]))&&(-1===f||_<f)&&(f=_)}-1!==(d=-1===f?a.lastIndexOf("@"):a.lastIndexOf("@",f))&&(c=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(c)),f=-1;for(p=0;p<nonHostChars.length;p++){var _;-1!==(_=a.indexOf(nonHostChars[p]))&&(-1===f||_<f)&&(f=_)}-1===f&&(f=a.length),this.host=a.slice(0,f),a=a.slice(f),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),y=(p=0,m.length);p<y;p++){var v=m[p];if(v&&!v.match(hostnamePartPattern)){for(var b="",x=0,T=v.length;x<T;x++)v.charCodeAt(x)>127?b+="x":b+=v[x];if(!b.match(hostnamePartPattern)){var E=m.slice(0,p),S=m.slice(p+1),A=v.match(hostnamePartStart);A&&(E.push(A[1]),S.unshift(A[2])),S.length&&(a="/"+S.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=punycode.toASCII(this.hostname));var R=this.port?":"+this.port:"",w=this.hostname||"";this.host=w+R,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!unsafeProtocol[l])for(p=0,y=autoEscape.length;p<y;p++){var O=autoEscape[p];if(-1!==a.indexOf(O)){var P=encodeURIComponent(O);P===O&&(P=escape(O)),a=a.split(O).join(P)}}var I=a.indexOf("#");-1!==I&&(this.hash=a.substr(I),a=a.slice(0,I));var M=a.indexOf("?");if(-1!==M?(this.search=a.substr(M),this.query=a.substr(M+1),e&&(this.query=querystring.parse(this.query)),a=a.slice(0,M)):e&&(this.search="",this.query={}),a&&(this.pathname=a),slashedProtocol[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var C=this.search||"";this.path=R+C}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(s=querystring.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+i},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(util.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var r=new Url,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];r[s]=this[s]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),o=0;o<a.length;o++){var h=a[o];"protocol"!==h&&(r[h]=t[h])}return slashedProtocol[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!slashedProtocol[t.protocol]){for(var l=Object.keys(t),u=0;u<l.length;u++){var c=l[u];r[c]=t[c]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var f=r.pathname||"",p=r.search||"";r.path=f+p}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),m=g||_||r.host&&t.pathname,y=m,v=r.pathname&&r.pathname.split("/")||[],b=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!slashedProtocol[r.protocol]);if(b&&(r.hostname="",r.port=null,r.host&&(""===v[0]?v[0]=r.host:v.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),m=m&&(""===d[0]||""===v[0])),g)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,v=d;else if(d.length)v||(v=[]),v.pop(),v=v.concat(d),r.search=t.search,r.query=t.query;else if(!util.isNullOrUndefined(t.search)){if(b)r.hostname=r.host=v.shift(),(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift());return r.search=t.search,r.query=t.query,util.isNull(r.pathname)&&util.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!v.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=v.slice(-1)[0],T=(r.host||t.host||v.length>1)&&("."===x||".."===x)||""===x,E=0,S=v.length;S>=0;S--)"."===(x=v[S])?v.splice(S,1):".."===x?(v.splice(S,1),E++):E&&(v.splice(S,1),E--);if(!m&&!y)for(;E--;E)v.unshift("..");!m||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),T&&"/"!==v.join("/").substr(-1)&&v.push("");var A,R=""===v[0]||v[0]&&"/"===v[0].charAt(0);b&&(r.hostname=r.host=R?"":v.length?v.shift():"",(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift()));return(m=m||r.host&&v.length)&&!R&&v.unshift(""),v.length?r.pathname=v.join("/"):(r.pathname=null,r.path=null),util.isNull(r.pathname)&&util.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},Url.prototype.parseHost=function(){var t=this.host,e=portPattern.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ENV$1||(ENV$1={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(RENDERER_TYPE$1||(RENDERER_TYPE$1={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(BUFFER_BITS$1||(BUFFER_BITS$1={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(BLEND_MODES$1||(BLEND_MODES$1={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES$1||(DRAW_MODES$1={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS$1||(FORMATS$1={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS$1||(TARGETS$1={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES$1||(TYPES$1={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(SAMPLER_TYPES$1||(SAMPLER_TYPES$1={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(SCALE_MODES$1||(SCALE_MODES$1={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES$1||(WRAP_MODES$1={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES$1||(MIPMAP_MODES$1={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES$1||(ALPHA_MODES$1={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(CLEAR_MODES$1||(CLEAR_MODES$1={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(GC_MODES$1||(GC_MODES$1={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(PRECISION$1||(PRECISION$1={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(MASK_TYPES$1||(MASK_TYPES$1={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(MSAA_QUALITY$1||(MSAA_QUALITY$1={}));
/*!
   * @pixi/utils - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/utils is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var url={parse:parse,format:format$1,resolve:resolve$1};settings.RETINA_PREFIX=/@([0-9\.]+)x/,settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello=!1,VERSION="6.0.4",supported;function sayHello(t){var e;if(!saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var r=["\n %c %c %c PixiJS "+VERSION+" -  "+t+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,r)}else self.console&&self.console.log("PixiJS "+VERSION+" - "+t+" - http://www.pixijs.com/");saidHello=!0}}function isWebGLSupported(){return void 0===supported&&(supported=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),i=!(!r||!r.getContextAttributes().stencil);if(r){var n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch(t){return!1}}()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue:aliceblue,antiquewhite:antiquewhite,aqua:aqua,aquamarine:aquamarine,azure:azure,beige:beige,bisque:bisque,black:black,blanchedalmond:blanchedalmond,blue:blue,blueviolet:blueviolet,brown:brown,burlywood:burlywood,cadetblue:cadetblue,chartreuse:chartreuse,chocolate:chocolate,coral:coral,cornflowerblue:cornflowerblue,cornsilk:cornsilk,crimson:crimson,cyan:cyan,darkblue:darkblue,darkcyan:darkcyan,darkgoldenrod:darkgoldenrod,darkgray:darkgray,darkgreen:darkgreen,darkgrey:darkgrey,darkkhaki:darkkhaki,darkmagenta:darkmagenta,darkolivegreen:darkolivegreen,darkorange:darkorange,darkorchid:darkorchid,darkred:darkred,darksalmon:darksalmon,darkseagreen:darkseagreen,darkslateblue:darkslateblue,darkslategray:darkslategray,darkslategrey:darkslategrey,darkturquoise:darkturquoise,darkviolet:darkviolet,deeppink:deeppink,deepskyblue:deepskyblue,dimgray:dimgray,dimgrey:dimgrey,dodgerblue:dodgerblue,firebrick:firebrick,floralwhite:floralwhite,forestgreen:forestgreen,fuchsia:fuchsia,gainsboro:gainsboro,ghostwhite:ghostwhite,goldenrod:goldenrod,gold:gold,gray:gray,green:green,greenyellow:greenyellow,grey:grey,honeydew:honeydew,hotpink:hotpink,indianred:indianred,indigo:indigo,ivory:ivory,khaki:khaki,lavenderblush:lavenderblush,lavender:lavender,lawngreen:lawngreen,lemonchiffon:lemonchiffon,lightblue:lightblue,lightcoral:lightcoral,lightcyan:lightcyan,lightgoldenrodyellow:lightgoldenrodyellow,lightgray:lightgray,lightgreen:lightgreen,lightgrey:lightgrey,lightpink:lightpink,lightsalmon:lightsalmon,lightseagreen:lightseagreen,lightskyblue:lightskyblue,lightslategray:lightslategray,lightslategrey:lightslategrey,lightsteelblue:lightsteelblue,lightyellow:lightyellow,lime:lime,limegreen:limegreen,linen:linen,magenta:magenta,maroon:maroon,mediumaquamarine:mediumaquamarine,mediumblue:mediumblue,mediumorchid:mediumorchid,mediumpurple:mediumpurple,mediumseagreen:mediumseagreen,mediumslateblue:mediumslateblue,mediumspringgreen:mediumspringgreen,mediumturquoise:mediumturquoise,mediumvioletred:mediumvioletred,midnightblue:midnightblue,mintcream:mintcream,mistyrose:mistyrose,moccasin:moccasin,navajowhite:navajowhite,navy:navy,oldlace:oldlace,olive:olive,olivedrab:olivedrab,orange:orange,orangered:orangered,orchid:orchid,palegoldenrod:palegoldenrod,palegreen:palegreen,paleturquoise:paleturquoise,palevioletred:palevioletred,papayawhip:papayawhip,peachpuff:peachpuff,peru:peru,pink:pink,plum:plum,powderblue:powderblue,purple:purple,rebeccapurple:rebeccapurple,red:red,rosybrown:rosybrown,royalblue:royalblue,saddlebrown:saddlebrown,salmon:salmon,sandybrown:sandybrown,seagreen:seagreen,seashell:seashell,sienna:sienna,silver:silver,skyblue:skyblue,slateblue:slateblue,slategray:slategray,slategrey:slategrey,snow:snow,springgreen:springgreen,steelblue:steelblue,tan:tan,teal:teal,thistle:thistle,tomato:tomato,turquoise:turquoise,violet:violet,wheat:wheat,white:white,whitesmoke:whitesmoke,yellow:yellow,yellowgreen:yellowgreen};function hex2rgb(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function hex2string(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function string2hex(t){return"string"==typeof t&&"#"===(t=cssColorNames[t.toLowerCase()]||t)[0]&&(t=t.substr(1)),parseInt(t,16)}function mapPremultipliedBlendModes(){for(var t=[],e=[],r=0;r<32;r++)t[r]=r,e[r]=r;t[BLEND_MODES$1.NORMAL_NPM]=BLEND_MODES$1.NORMAL,t[BLEND_MODES$1.ADD_NPM]=BLEND_MODES$1.ADD,t[BLEND_MODES$1.SCREEN_NPM]=BLEND_MODES$1.SCREEN,e[BLEND_MODES$1.NORMAL]=BLEND_MODES$1.NORMAL_NPM,e[BLEND_MODES$1.ADD]=BLEND_MODES$1.ADD_NPM,e[BLEND_MODES$1.SCREEN]=BLEND_MODES$1.SCREEN_NPM;var i=[];return i.push(e),i.push(t),i}var premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(t,e){return premultiplyBlendMode[e?1:0][t]}function premultiplyRgba(t,e,r,i){return r=r||new Float32Array(4),i||void 0===i?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r}function premultiplyTint(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,i=t>>8&255,n=255&t;return(255*e<<24)+((r=r*e+.5|0)<<16)+((i=i*e+.5|0)<<8)+(n=n*e+.5|0)}function premultiplyTintToRgba(t,e,r,i){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(i||void 0===i)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r}function createIndicesForQuads(t,e){void 0===e&&(e=null);var r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+r);for(var i=0,n=0;i<r;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function nextPow2(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function isPow2(t){return!(t&t-1||!t)}function log2(t){var e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,e|=r=((t>>>=r)>15?1:0)<<2,(e|=r=((t>>>=r)>3?1:0)<<1)|(t>>>=r)>>1}function removeItems(t,e,r){var i,n=t.length;if(!(e>=n||0===r)){var s=n-(r=e+r>n?n-e:r);for(i=e;i<s;++i)t[i]=t[i+r];t.length=s}}function sign$1(t){return 0===t?0:t<0?-1:1}var nextUid=0;function uid(){return++nextUid}var warnings={};function deprecation(t,e,r){if(void 0===r&&(r=3),!warnings[e]){var i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(i))),warnings[e]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null),CanvasRenderTarget=function(){function t(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||settings.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0}),t}(),tempAnchor;function trimCanvas(t){var e,r,i,n=t.width,s=t.height,a=t.getContext("2d"),o=a.getImageData(0,0,n,s).data,h=o.length,l={top:null,left:null,right:null,bottom:null},u=null;for(e=0;e<h;e+=4)0!==o[e+3]&&(r=e/4%n,i=~~(e/4/n),null===l.top&&(l.top=i),(null===l.left||r<l.left)&&(l.left=r),(null===l.right||l.right<r)&&(l.right=r+1),(null===l.bottom||l.bottom<i)&&(l.bottom=i));return null!==l.top&&(n=l.right-l.left,s=l.bottom-l.top+1,u=a.getImageData(l.left,l.top,n,s)),{height:s,width:n,data:u}}function determineCrossOrigin(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=t;var r=url.parse(tempAnchor.href),i=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&i&&r.protocol===e.protocol?"":"anonymous"}function getResolutionOfUrl(t,e){var r=settings.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1}
/*!
   * @pixi/math - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/math is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */var PI_2=2*Math.PI,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180,SHAPES;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(SHAPES||(SHAPES={}));var Rectangle$1=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i),this.type=SHAPES.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),Circle=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.radius=r,this.type=SHAPES.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,i=this.x-t,n=this.y-e;return(i*=i)+(n*=n)<=r},t.prototype.getBounds=function(){return new Rectangle$1(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},t}(),Ellipse=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=r,this.height=i,this.type=SHAPES.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,i=(e-this.y)/this.height;return(r*=r)+(i*=i)<=1},t.prototype.getBounds=function(){return new Rectangle$1(this.x-this.width,this.y-this.height,this.width,this.height)},t.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),Polygon=function(){function t(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];var i=Array.isArray(e[0])?e[0]:e;if("number"!=typeof i[0]){for(var n=[],s=0,a=i.length;s<a;s++)n.push(i[s].x,i[s].y);i=n}this.points=i,this.type=SHAPES.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,s=i-1;n<i;s=n++){var a=this.points[2*n],o=this.points[2*n+1],h=this.points[2*s],l=this.points[2*s+1];o>e!=l>e&&t<(e-o)/(l-o)*(h-a)+a&&(r=!r)}return r},t.prototype.toString=function(){return"[@pixi/math:PolygoncloseStroke="+this.closeStroke+"points="+this.points.reduce((function(t,e){return t+", "+e}),"")+"]"},t}(),RoundedRectangle=function(){function t(t,e,r,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=20),this.x=t,this.y=e,this.width=r,this.height=i,this.radius=n,this.type=SHAPES.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),i=e-(this.y+this.radius),n=this.radius*this.radius;if(r*r+i*i<=n)return!0;if((r=t-(this.x+this.width-this.radius))*r+i*i<=n)return!0;if(r*r+(i=e-(this.y+this.height-this.radius))*i<=n)return!0;if((r=t-(this.x+this.radius))*r+i*i<=n)return!0}return!1},t.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+"width="+this.width+" height="+this.height+" radius="+this.radius+"]"},t}(),Point$2=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),ObservablePoint=function(){function t(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this._x=r,this._y=i,this.cb=t,this.scope=e}return t.prototype.clone=function(e,r){return void 0===e&&(e=this.cb),void 0===r&&(r=this.scope),new t(e,r,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Matrix=function(){function t(t,e,r,i,n,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===s&&(s=0),this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=s}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,i,n,s){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=s,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new Point$2;var r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Point$2;var r=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,s=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=s*e-this.ty*r,this.ty=s*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this},t.prototype.setTransform=function(t,e,r,i,n,s,a,o,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-o)*s,this.d=Math.cos(a-o)*s,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,i=this.c,n=this.d,s=t.pivot,a=-Math.atan2(-i,n),o=Math.atan2(r,e),h=Math.abs(a+o);return h<1e-5||Math.abs(PI_2-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(s.x*e+s.y*i),t.position.y=this.ty+(s.x*r+s.y*n),t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,s=t*i-e*r;return this.a=i/s,this.b=-e/s,this.c=-r/s,this.d=t/s,this.tx=(r*this.ty-i*n)/s,this.ty=-(t*this.ty-e*n)/s,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init$1(){for(var t=0;t<16;t++){var e=[];rotationCayley.push(e);for(var r=0;r<16;r++)for(var i=signum(ux[t]*ux[r]+vx[t]*uy[r]),n=signum(uy[t]*ux[r]+vy[t]*uy[r]),s=signum(ux[t]*vx[r]+vx[t]*vy[r]),a=signum(uy[t]*vx[r]+vy[t]*vy[r]),o=0;o<16;o++)if(ux[o]===i&&uy[o]===n&&vx[o]===s&&vy[o]===a){e.push(o);break}}for(t=0;t<16;t++){var h=new Matrix;h.set(ux[t],uy[t],vx[t],vy[t],0,0),rotationMatrices.push(h)}}init$1();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return ux[t]},uY:function(t){return uy[t]},vX:function(t){return vx[t]},vY:function(t){return vy[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return rotationCayley[t][e]},sub:function(t,e){return rotationCayley[t][groupD8.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?groupD8.S:groupD8.N:2*Math.abs(e)<=Math.abs(t)?t>0?groupD8.E:groupD8.W:e>0?t>0?groupD8.SE:groupD8.SW:t>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=rotationMatrices[groupD8.inv(e)];n.tx=r,n.ty=i,t.append(n)}},Transform=function(){function t(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,i=this.worldTransform;i.a=e.a*r.a+e.b*r.c,i.b=e.a*r.b+e.b*r.d,i.c=e.c*r.a+e.d*r.c,i.d=e.c*r.b+e.d*r.d,i.tx=e.tx*r.a+e.ty*r.c+r.tx,i.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();
/*!
   * @pixi/display - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/display is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
settings.SORTABLE_CHILDREN=!1;var Bounds=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Rectangle$1.EMPTY:((t=t||new Rectangle$1(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addPointMatrix=function(t,e){var r=t.a,i=t.b,n=t.c,s=t.d,a=t.tx,o=t.ty,h=r*e.x+n*e.y+a,l=i*e.x+s*e.y+o;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)},t.prototype.addQuad=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,s=t[0],a=t[1];e=s<e?s:e,r=a<r?a:r,i=s>i?s:i,n=a>n?a:n,e=(s=t[2])<e?s:e,r=(a=t[3])<r?a:r,i=s>i?s:i,n=a>n?a:n,e=(s=t[4])<e?s:e,r=(a=t[5])<r?a:r,i=s>i?s:i,n=a>n?a:n,e=(s=t[6])<e?s:e,r=(a=t[7])<r?a:r,i=s>i?s:i,n=a>n?a:n,this.minX=e,this.minY=r,this.maxX=i,this.maxY=n},t.prototype.addFrame=function(t,e,r,i,n){this.addFrameMatrix(t.worldTransform,e,r,i,n)},t.prototype.addFrameMatrix=function(t,e,r,i,n){var s=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,u=t.ty,c=this.minX,d=this.minY,f=this.maxX,p=this.maxY,_=s*e+o*r+l,g=a*e+h*r+u;c=_<c?_:c,d=g<d?g:d,f=_>f?_:f,p=g>p?g:p,c=(_=s*i+o*r+l)<c?_:c,d=(g=a*i+h*r+u)<d?g:d,f=_>f?_:f,p=g>p?g:p,c=(_=s*e+o*n+l)<c?_:c,d=(g=a*e+h*n+u)<d?g:d,f=_>f?_:f,p=g>p?g:p,c=(_=s*i+o*n+l)<c?_:c,d=(g=a*i+h*n+u)<d?g:d,f=_>f?_:f,p=g>p?g:p,this.minX=c,this.minY=d,this.maxX=f,this.maxY=p},t.prototype.addVertexData=function(t,e,r){for(var i=this.minX,n=this.minY,s=this.maxX,a=this.maxY,o=e;o<r;o+=2){var h=t[o],l=t[o+1];i=h<i?h:i,n=l<n?l:n,s=h>s?h:s,a=l>a?l:a}this.minX=i,this.minY=n,this.maxX=s,this.maxY=a},t.prototype.addVertices=function(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)},t.prototype.addVerticesMatrix=function(t,e,r,i,n,s){void 0===n&&(n=0),void 0===s&&(s=n);for(var a=t.a,o=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty,d=this.minX,f=this.minY,p=this.maxX,_=this.maxY,g=r;g<i;g+=2){var m=e[g],y=e[g+1],v=a*m+h*y+u,b=l*y+o*m+c;d=Math.min(d,v-n),p=Math.max(p,v+n),f=Math.min(f,b-s),_=Math.max(_,b+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=_},t.prototype.addBounds=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n},t.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&i<=s){var a=this.minX,o=this.minY,h=this.maxX,l=this.maxY;this.minX=r<a?r:a,this.minY=i<o?i:o,this.maxX=n>h?n:h,this.maxY=s>l?s:l}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&i<=s){var a=this.minX,o=this.minY,h=this.maxX,l=this.maxY;this.minX=r<a?r:a,this.minY=i<o?i:o,this.maxX=n>h?n:h,this.maxY=s>l?s:l}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,r,i,n,s){t-=n,e-=s,r+=n,i+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i},t}(),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function __extends(t,e){function r(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var DisplayObject=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new Transform,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new Bounds,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return __extends(e,t),e.mixin=function(t){for(var r=Object.keys(t),i=0;i<r.length;++i){var n=r[i];Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Rectangle$1),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle$1),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;var s=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=i,this._bounds.updateID+=this._boundsID-n,s},e.prototype.toGlobal=function(t,e,r){return void 0===r&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,r,i,n,s,a,o,h){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=s,this.skew.y=a,this.pivot.x=o,this.pivot.y=h,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*RAD_TO_DEG},set:function(t){this.transform.rotation=t*DEG_TO_RAD},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1);(this._mask=t,this._mask)&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(eventemitter3),TemporaryDisplayObject=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return __extends(e,t),e}(DisplayObject);function sortChildren(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;var Container=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=settings.SORTABLE_CHILDREN,e.sortDirty=!1,e}return __extends(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var i=0;i<e.length;i++)this.addChild(e[i]);else{var n=e[0];n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);removeItems(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var i=0;i<e.length;i++)this.removeChild(e[i]);else{var n=e[0],s=this.children.indexOf(n);if(-1===s)return null;n.parent=null,n.transform._parentID=-1,removeItems(this.children,s,1),this._boundsID++,this.onChildrenChange(s),n.emit("removed",this),this.emit("childRemoved",n,this,s)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var r,i=t,n=e-i;if(n>0&&n<=e){r=this.children.splice(i,n);for(var s=0;s<r.length;++s)r[s].parent=null,r[s].transform&&(r[s].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(s=0;s<r.length;++s)r[s].emit("removed",this),this.emit("childRemoved",r[s],this,s);return r}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,r=this.children.length;e<r;++e){var i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var r=e._mask.maskObject||e._mask;r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,r){void 0===r&&(r=!1);var i=t.prototype.getLocalBounds.call(this,e);if(!r)for(var n=0,s=this.children.length;n<s;++n){var a=this.children[n];a.visible&&a.updateTransform()}return i},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<e.length;i++)e[i].enabled&&this._enabledFilters.push(e[i]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}r&&t.mask.push(this,this._mask),this._render(t);i=0;for(var n=this.children.length;i<n;i++)this.children[i].render(t);t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var r="boolean"==typeof e?e:e&&e.children,i=this.removeChildren(0,this.children.length);if(r)for(var n=0;n<i.length;++n)i[n].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;
/*!
   * @pixi/accessibility - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/accessibility is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);var KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2,AccessibilityManager=function(){function t(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile$1.tablet||isMobile$1.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width=DIV_TOUCH_SIZE+"px",e.style.height=DIV_TOUCH_SIZE+"px",e.style.position="absolute",e.style.top=DIV_TOUCH_POS_X+"px",e.style.left=DIV_TOUCH_POS_Y+"px",e.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width=DIV_HOOK_SIZE+"px",e.style.height=DIV_HOOK_SIZE+"px",e.style.position="absolute",e.style.top=DIV_HOOK_POS_X+"px",e.style.left=DIV_HOOK_POS_Y+"px",e.style.zIndex=DIV_HOOK_ZINDEX.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var t;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(t=this.renderer.view.parentNode)||void 0===t||t.appendChild(this.div))},t.prototype.deactivate=function(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(t=this.div.parentNode)||void 0===t||t.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}},t.prototype.update=function(){var t=performance.now();if(!(isMobile$1.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),r=e.left,i=e.top,n=e.width,s=e.height,a=this.renderer,o=a.width,h=a.height,l=a.resolution,u=n/o*l,c=s/h*l,d=this.div;d.style.left=r+"px",d.style.top=i+"px",d.style.width=o+"px",d.style.height=h+"px";for(var f=0;f<this.children.length;f++){var p=this.children[f];if(p.renderId!==this.renderId)p._accessibleActive=!1,removeItems(this.children,f,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,f--;else{d=p._accessibleDiv;var _=p.hitArea,g=p.worldTransform;p.hitArea?(d.style.left=(g.tx+_.x*g.a)*u+"px",d.style.top=(g.ty+_.y*g.d)*c+"px",d.style.width=_.width*g.a*u+"px",d.style.height=_.height*g.d*c+"px"):(_=p.getBounds(),this.capHitArea(_),d.style.left=_.x*u+"px",d.style.top=_.y*c+"px",d.style.width=_.width*u+"px",d.style.height=_.height*c+"px",d.title!==p.accessibleTitle&&null!==p.accessibleTitle&&(d.title=p.accessibleTitle),d.getAttribute("aria-label")!==p.accessibleHint&&null!==p.accessibleHint&&d.setAttribute("aria-label",p.accessibleHint)),p.accessibleTitle===d.title&&p.tabIndex===d.tabIndex||(d.title=p.accessibleTitle,d.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var e=this.renderer,r=e.width,i=e.height;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>i&&(t.height=i-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=DIV_TOUCH_SIZE+"px",e.style.height=DIV_TOUCH_SIZE+"px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=DIV_TOUCH_ZINDEX.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"click",i),e.dispatchEvent(r,"pointertap",i),e.dispatchEvent(r,"tap",i)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"mouseover",i)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"mouseout",i)},t.prototype._onKeyDown=function(t){t.keyCode===KEY_CODE_TAB&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}(),UPDATE_PRIORITY;
/*!
   * @pixi/ticker - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/ticker is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
settings.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function t(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=0),void 0===i&&(i=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=i}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),Ticker=function(){function t(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,r){return void 0===r&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(t,e,r))},t.prototype.addOnce=function(t,e,r){return void 0===r&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(t,e,r,!0))},t.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var i=this._head,n=i.next;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),TickerPlugin=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ticker.shared:new Ticker,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),InteractionData=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Point$2,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),extendStatics$1=function(t,e){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$1(t,e){function r(){this.constructor=t}extendStatics$1(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var InteractionEvent=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),InteractionTrackingData=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),TreeSearch=function(){function t(){this._tempPoint=new Point$2}return t.prototype.recursiveFindHit=function(t,e,r,i,n){if(!e||!e.visible)return!1;var s=t.data.global,a=!1,o=n=e.interactive||n,h=!0;if(e.hitArea?(i&&(e.worldTransform.applyInverse(s,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(i=!1,h=!1)),o=!1):e._mask&&i&&(e._mask.containsPoint&&e._mask.containsPoint(s)||(i=!1)),h&&e.interactiveChildren&&e.children)for(var l=e.children,u=l.length-1;u>=0;u--){var c=l[u],d=this.recursiveFindHit(t,c,r,i,o);if(d){if(!c.parent)continue;o=!1,d&&(t.target&&(i=!1),a=!0)}}return n&&(i&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(s)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),r&&r(t,e,!!a))),a},t.prototype.findHit=function(t,e,r,i){this.recursiveFindHit(t,e,r,i,!1)},t}(),interactiveTarget={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(interactiveTarget);var MOUSE_POINTER_ID=1,hitTestEvent={target:null,data:{global:null}},InteractionManager=function(t){function e(e,r){var i=t.call(this)||this;return r=r||{},i.renderer=e,i.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,i.interactionFrequency=r.interactionFrequency||10,i.mouse=new InteractionData,i.mouse.identifier=MOUSE_POINTER_ID,i.mouse.global.set(-999999),i.activeInteractionData={},i.activeInteractionData[MOUSE_POINTER_ID]=i.mouse,i.interactionDataPool=[],i.eventData=new InteractionEvent,i.interactionDOMElement=null,i.moveWhenInside=!1,i.eventsAdded=!1,i.tickerAdded=!1,i.mouseOverRenderer=!("PointerEvent"in self),i.supportsTouchEvents="ontouchstart"in self,i.supportsPointerEvents=!!self.PointerEvent,i.onPointerUp=i.onPointerUp.bind(i),i.processPointerUp=i.processPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.processPointerCancel=i.processPointerCancel.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.processPointerDown=i.processPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.processPointerMove=i.processPointerMove.bind(i),i.onPointerOut=i.onPointerOut.bind(i),i.processPointerOverOut=i.processPointerOverOut.bind(i),i.onPointerOver=i.onPointerOver.bind(i),i.cursorStyles={default:"inherit",pointer:"pointer"},i.currentCursorMode=null,i.cursor=null,i.resolution=1,i.delayedEvents=[],i.search=new TreeSearch,i._tempDisplayObject=new TemporaryDisplayObject,i._useSystemTicker=void 0===r.useSystemTicker||r.useSystemTicker,i.setTargetElement(i.renderer.view,i.renderer.resolution),i}return __extends$1(e,t),Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,e){return hitTestEvent.target=null,hitTestEvent.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(hitTestEvent,e,null,!0),hitTestEvent.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),self.addEventListener("pointercancel",this.onPointerCancel,!0),self.addEventListener("pointerup",this.onPointerUp,!0)):(self.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),self.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),self.removeEventListener("pointercancel",this.onPointerCancel,!0),self.removeEventListener("pointerup",this.onPointerUp,!0)):(self.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),self.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var e=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(e=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.interactionDOMElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.interactionDOMElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,r){r.stopPropagationHint&&t!==r.stopsPropagatingAt||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},e.prototype.delayDispatchEvent=function(t,e,r){this.delayedEvents.push({displayObject:t,eventString:e,eventData:r})},e.prototype.mapPositionToPoint=function(t,e,r){var i;i=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var n=1/this.resolution;t.x=(e-i.left)*(this.interactionDOMElement.width/i.width)*n,t.y=(r-i.top)*(this.interactionDOMElement.height/i.height)*n},e.prototype.processInteractive=function(t,e,r,i){var n=this.search.findHit(t,e,r,i),s=this.delayedEvents;if(!s.length)return n;t.stopPropagationHint=!1;var a=s.length;this.delayedEvents=[];for(var o=0;o<a;o++){var h=s[o],l=h.displayObject,u=h.eventString,c=h.eventData;c.stopsPropagatingAt===l&&(c.stopPropagationHint=!0),this.dispatchEvent(l,u,c)}return n},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var r=e.length,i=0;i<r;i++){var n=e[i],s=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,s);if(a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===n.pointerType)this.emit("touchstart",a);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;this.emit(o?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,e,r){var i=t.data,n=t.data.identifier;if(r)if(e.trackedPointers[n]||(e.trackedPointers[n]=new InteractionTrackingData(n)),this.dispatchEvent(e,"pointerdown",t),"touch"===i.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===i.pointerType||"pen"===i.pointerType){var s=2===i.button;s?e.trackedPointers[n].rightDown=!0:e.trackedPointers[n].leftDown=!0,this.dispatchEvent(e,s?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,r){for(var i=this.normalizeToPointerData(t),n=i.length,s=t.target!==this.interactionDOMElement?"outside":"",a=0;a<n;a++){var o=i[a],h=this.getInteractionDataForPointerId(o),l=this.configureInteractionEventForDOMEvent(this.eventData,o,h);if(l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,r,e||!s),this.emit(e?"pointercancel":"pointerup"+s,l),"mouse"===o.pointerType||"pen"===o.pointerType){var u=2===o.button;this.emit(u?"rightup"+s:"mouseup"+s,l)}else"touch"===o.pointerType&&(this.emit(e?"touchcancel":"touchend"+s,l),this.releaseInteractionDataForPointerId(o.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var r=t.data,i=t.data.identifier;void 0!==e.trackedPointers[i]&&(delete e.trackedPointers[i],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,r){var i=t.data,n=t.data.identifier,s=e.trackedPointers[n],a="touch"===i.pointerType,o="mouse"===i.pointerType||"pen"===i.pointerType,h=!1;if(o){var l=2===i.button,u=InteractionTrackingData.FLAGS,c=l?u.RIGHT_DOWN:u.LEFT_DOWN,d=void 0!==s&&s.flags&c;r?(this.dispatchEvent(e,l?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,l?"rightclick":"click",t),h=!0)):d&&this.dispatchEvent(e,l?"rightupoutside":"mouseupoutside",t),s&&(l?s.rightDown=!1:s.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),s&&(o&&!h||this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),s.over=!1))):s&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),s&&s.none&&delete e.trackedPointers[n]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var r=e.length,i=0;i<r;i++){var n=e[i],s=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,s);a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",a),"touch"===n.pointerType&&this.emit("touchmove",a),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,r){var i=t.data,n="touch"===i.pointerType,s="mouse"===i.pointerType||"pen"===i.pointerType;s&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),n&&this.dispatchEvent(e,"touchmove",t),s&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",i),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",i):this.releaseInteractionDataForPointerId(r.identifier)}},e.prototype.processPointerOverOut=function(t,e,r){var i=t.data,n=t.data.identifier,s="mouse"===i.pointerType||"pen"===i.pointerType,a=e.trackedPointers[n];r&&!a&&(a=e.trackedPointers[n]=new InteractionTrackingData(n)),void 0!==a&&(r&&this.mouseOverRenderer?(a.over||(a.over=!0,this.delayDispatchEvent(e,"pointerover",t),s&&this.delayDispatchEvent(e,"mouseover",t)),s&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),s&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[n]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",i),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",i)},e.prototype.getInteractionDataForPointerId=function(t){var e,r=t.pointerId;return r===MOUSE_POINTER_ID||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[r]?e=this.activeInteractionData[r]:((e=this.interactionDataPool.pop()||new InteractionData).identifier=r,this.activeInteractionData[r]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,i=t.changedTouches.length;r<i;r++){var n=t.changedTouches[r];void 0===n.button&&(n.button=t.touches.length?1:0),void 0===n.buttons&&(n.buttons=t.touches.length?1:0),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,e.push(n)}else if(self.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof self.PointerEvent))e.push(t);else{var s=t;void 0===s.isPrimary&&(s.isPrimary=!0),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="mouse"),void 0===s.pointerId&&(s.pointerId=MOUSE_POINTER_ID),void 0===s.pressure&&(s.pressure=.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}return e},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e}(eventemitter3),Runner=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,r,i,n,s,a,o){if(arguments.length>8)throw new Error("max arguments reached");var h=this,l=h.name,u=h.items;this._aliasCount++;for(var c=0,d=u.length;c<d;c++)u[c][l](t,e,r,i,n,s,a,o);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}}),
/*!
   * @pixi/core - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/core is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
settings.PREFER_ENV=isMobile$1.any?ENV$1.WEBGL:ENV$1.WEBGL2,settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(t,e){if(!t)return null;var r="";if("string"==typeof t){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);i&&(r=i[1].toLowerCase())}for(var n=INSTALLED.length-1;n>=0;--n){var s=INSTALLED[n];if(s.test&&s.test(t,r))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var extendStatics$2=function(t,e){return(extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$2(t,e){function r(){this.constructor=t}extendStatics$2(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Resource=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,r){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),BufferResource=function(t){function e(e,r){var i=this,n=r||{},s=n.width,a=n.height;if(!s||!a)throw new Error("BufferResource width or height invalid");return(i=t.call(this,s,a)||this).data=e,i}return __extends$2(e,t),e.prototype.upload=function(t,e,r){var i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES$1.UNPACK);var n=e.realWidth,s=e.realHeight;return r.width===n&&r.height===s?i.texSubImage2D(e.target,0,0,0,n,s,e.format,e.type,this.data):(r.width=n,r.height=s,i.texImage2D(e.target,0,r.internalFormat,n,s,0,e.format,r.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Resource),defaultBufferOptions={scaleMode:SCALE_MODES$1.NEAREST,format:FORMATS$1.RGBA,alphaMode:ALPHA_MODES$1.NPM},BaseTexture=function(t){function e(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var i=t.call(this)||this,n=(r=r||{}).alphaMode,s=r.mipmap,a=r.anisotropicLevel,o=r.scaleMode,h=r.width,l=r.height,u=r.wrapMode,c=r.format,d=r.type,f=r.target,p=r.resolution,_=r.resourceOptions;return!e||e instanceof Resource||((e=autoDetectResource(e,_)).internal=!0),i.width=h||0,i.height=l||0,i.resolution=p||settings.RESOLUTION,i.mipmap=void 0!==s?s:settings.MIPMAP_TEXTURES,i.anisotropicLevel=void 0!==a?a:settings.ANISOTROPIC_LEVEL,i.wrapMode=u||settings.WRAP_MODE,i.scaleMode=void 0!==o?o:settings.SCALE_MODE,i.format=c||FORMATS$1.RGBA,i.type=d||TYPES$1.UNSIGNED_BYTE,i.target=f||TARGETS$1.TEXTURE_2D,i.alphaMode=void 0!==n?n:ALPHA_MODES$1.UNPACK,i.uid=uid(),i.touched=0,i.isPowerOfTwo=!1,i._refreshPOT(),i._glTextures={},i.dirtyId=0,i.dirtyStyleId=0,i.cacheId=null,i.valid=h>0&&l>0,i.textureCacheIds=[],i.destroyed=!1,i.resource=null,i._batchEnabled=0,i._batchLocation=0,i.parentTextureArray=null,i.setResource(e),i}return __extends$2(e,t),Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,e){var r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT()),this},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,r,i){void 0===i&&(i=settings.STRICT_TEXTURE_CACHE);var n="string"==typeof t,s=null;if(n)s=t;else{if(!t._pixiId){var a=r&&r.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+uid()}s=t._pixiId}var o=BaseTextureCache[s];if(n&&i&&!o)throw new Error('The cacheId "'+s+'" does not exist in BaseTextureCache.');return o||((o=new e(t,r)).cacheId=s,e.addToCache(o,s)),o},e.fromBuffer=function(t,r,i,n){t=t||new Float32Array(r*i*4);var s=new BufferResource(t,{width:r,height:i}),a=t instanceof Float32Array?TYPES$1.FLOAT:TYPES$1.UNSIGNED_BYTE;return new e(s,Object.assign(defaultBufferOptions,n||{width:r,height:i,type:a}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),BaseTextureCache[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),BaseTextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=BaseTextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete BaseTextureCache[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete BaseTextureCache[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(eventemitter3),AbstractMultiResource=function(t){function e(e,r){var i=this,n=r||{},s=n.width,a=n.height;(i=t.call(this,s,a)||this).items=[],i.itemDirtyIds=[];for(var o=0;o<e;o++){var h=new BaseTexture;i.items.push(h),i.itemDirtyIds.push(-2)}return i.length=e,i._load=null,i.baseTexture=null,i}return __extends$2(e,t),e.prototype.initFromArray=function(t,e){for(var r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Resource?this.addResourceAt(t[r],r):this.addResourceAt(autoDetectResource(t[r],e),r))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=e,this.items[r].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],r=e.realWidth,i=e.realHeight;return t.resize(r,i),Promise.resolve(t)})),this._load},e}(Resource),ArrayResource=function(t){function e(e,r){var i,n,s=this,a=r||{},o=a.width,h=a.height;return Array.isArray(e)?(i=e,n=e.length):n=e,s=t.call(this,n,{width:o,height:h})||this,i&&s.initFromArray(i,r),s}return __extends$2(e,t),e.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=TARGETS$1.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,e,r){var i=this,n=i.length,s=i.itemDirtyIds,a=i.items,o=t.gl;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,n,0,e.format,e.type,null);for(var h=0;h<n;h++){var l=a[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,e.type,l.resource.source))}return!0},e}(AbstractMultiResource),BaseImageResource=function(t){function e(e){var r=this,i=e,n=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;return(r=t.call(this,n,s)||this).source=e,r.noSubImage=!1,r}return __extends$2(e,t),e.crossOrigin=function(t,e,r){void 0===r&&0!==e.indexOf("data:")?t.crossOrigin=determineCrossOrigin(e):!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous")},e.prototype.upload=function(t,e,r,i){var n=t.gl,s=e.realWidth,a=e.realHeight;return i=i||this.source,n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES$1.UNPACK),this.noSubImage||e.target!==n.TEXTURE_2D||r.width!==s||r.height!==a?(r.width=s,r.height=a,n.texImage2D(e.target,0,e.format,e.format,e.type,i)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,e.type,i),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source,r=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(r,i),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Resource),CanvasResource=function(t){function e(e){return t.call(this,e)||this}return __extends$2(e,t),e.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(BaseImageResource),CubeResource=function(t){function e(r,i){var n=this,s=i||{},a=s.width,o=s.height,h=s.autoLoad,l=s.linkBaseTexture;if(r&&r.length!==e.SIDES)throw new Error("Invalid length. Got "+r.length+", expected 6");n=t.call(this,6,{width:a,height:o})||this;for(var u=0;u<e.SIDES;u++)n.items[u].target=TARGETS$1.TEXTURE_CUBE_MAP_POSITIVE_X+u;return n.linkBaseTexture=!1!==l,r&&n.initFromArray(r,i),!1!==h&&n.load(),n}return __extends$2(e,t),e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=TARGETS$1.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=TARGETS$1.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},e.prototype.upload=function(t,r,i){for(var n=this.itemDirtyIds,s=0;s<e.SIDES;s++){var a=this.items[s];n[s]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(t,a,i),n[s]=a.dirtyId):n[s]<-1&&(t.gl.texImage2D(a.target,0,i.internalFormat,r.realWidth,r.realHeight,0,r.format,i.type,null),n[s]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(AbstractMultiResource),ImageResource=function(t){function e(e,r){var i=this;if(r=r||{},!(e instanceof HTMLImageElement)){var n=new Image;BaseImageResource.crossOrigin(n,e,r.crossorigin),n.src=e,e=n}return i=t.call(this,e)||this,!e.complete&&i._width&&i._height&&(i._width=0,i._height=0),i.url=e.src,i._process=null,i.preserveBitmap=!1,i.createBitmap=(void 0!==r.createBitmap?r.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,i.alphaMode="number"==typeof r.alphaMode?r.alphaMode:null,i.bitmap=null,i._load=null,!1!==r.autoLoad&&i.load(),i}return __extends$2(e,t),e.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,r){var i=e.source;e.url=i.src;var n=function(){e.destroyed||(i.onload=null,i.onerror=null,e.resize(i.width,i.height),e._load=null,e.createBitmap?t(e.process()):t(e))};i.complete&&i.src?n():(i.onload=n,i.onerror=function(t){r(t),e.onError.emit(t)})}))),this._load},e.prototype.process=function(){var t=this,e=this.source;return null!==this._process?this._process:null===this.bitmap&&self.createImageBitmap?(this._process=self.createImageBitmap(e,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===ALPHA_MODES$1.UNPACK?"premultiply":"none"}).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},e.prototype.upload=function(e,r,i){if("number"==typeof this.alphaMode&&(r.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,r,i,this.bitmap),!this.preserveBitmap){var n=!0,s=r._glTextures;for(var a in s){var o=s[a];if(o!==i&&o.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},e}(BaseImageResource),SVGResource=function(t){function e(e,r){var i=this;return r=r||{},(i=t.call(this,document.createElement("canvas"))||this)._width=0,i._height=0,i.svg=e,i.scale=r.scale||1,i._overrideWidth=r.width,i._overrideHeight=r.height,i._resolve=null,i._crossorigin=r.crossorigin,i._load=null,!1!==r.autoLoad&&i.load(),i}return __extends$2(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;BaseImageResource.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(r){t._resolve&&(e.onerror=null,t.onError.emit(r))},e.onload=function(){if(t._resolve){var r=e.width,i=e.height;if(!r||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var n=r*t.scale,s=i*t.scale;(t._overrideWidth||t._overrideHeight)&&(n=t._overrideWidth||t._overrideHeight/i*r,s=t._overrideHeight||t._overrideWidth/r*i),n=Math.round(n),s=Math.round(s);var a=t.source;a.width=n,a.height=s,a._pixiId="canvas_"+uid(),a.getContext("2d").drawImage(e,0,0,r,i,0,0,n,s),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&0===t.indexOf("<svg")},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(BaseImageResource),VideoResource=function(t){function e(r,i){var n=this;if(i=i||{},!(r instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),"string"==typeof r&&(r=[r]);var a=r[0].src||r[0];BaseImageResource.crossOrigin(s,a,i.crossorigin);for(var o=0;o<r.length;++o){var h=document.createElement("source"),l=r[o],u=l.src,c=l.mime,d=(u=u||r[o]).split("?").shift().toLowerCase(),f=d.substr(d.lastIndexOf(".")+1);c=c||e.MIME_TYPES[f]||"video/"+f,h.src=u,h.type=c,s.appendChild(h)}r=s}return(n=t.call(this,r)||this).noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=i.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=!1!==i.autoPlay,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),!1!==i.autoLoad&&n.load(),n}return __extends$2(e,t),e.prototype.update=function(e){if(!this.destroyed){var r=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(r){t.valid?r(t):(t._resolve=r,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&Ticker.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(BaseImageResource),ImageBitmapResource=function(t){function e(e){return t.call(this,e)||this}return __extends$2(e,t),e.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},e}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var _resources={__proto__:null,Resource:Resource,BaseImageResource:BaseImageResource,INSTALLED:INSTALLED,autoDetectResource:autoDetectResource,AbstractMultiResource:AbstractMultiResource,ArrayResource:ArrayResource,BufferResource:BufferResource,CanvasResource:CanvasResource,CubeResource:CubeResource,ImageResource:ImageResource,SVGResource:SVGResource,VideoResource:VideoResource,ImageBitmapResource:ImageBitmapResource},System=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),DepthResource=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends$2(e,t),e.prototype.upload=function(t,e,r){var i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ALPHA_MODES$1.UNPACK);var n=e.realWidth,s=e.realHeight;return r.width===n&&r.height===s?i.texSubImage2D(e.target,0,0,0,n,s,e.format,e.type,this.data):(r.width=n,r.height=s,i.texImage2D(e.target,0,1===t.context.webGLVersion?i.DEPTH_COMPONENT:i.DEPTH_COMPONENT16,n,s,0,e.format,e.type,this.data)),!0},e}(BufferResource),Framebuffer=function(){function t(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY$1.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new BaseTexture(null,{scaleMode:SCALE_MODES$1.NEAREST,resolution:1,mipmap:MIPMAP_MODES$1.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(t){return this.depthTexture=t||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES$1.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES$1.OFF,format:FORMATS$1.DEPTH_COMPONENT,type:TYPES$1.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var i=this.colorTextures[r],n=i.resolution;i.setSize(t/n,e/n)}if(this.depthTexture){n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),BaseRenderTexture=function(t){function e(e){var r=this;if("number"==typeof e){var i=arguments[0],n=arguments[1],s=arguments[2],a=arguments[3];e={width:i,height:n,scaleMode:s,resolution:a}}r=t.call(this,null,e)||this;var o=e||{},h=o.width,l=o.height;return r.mipmap=MIPMAP_MODES$1.OFF,r.width=Math.ceil(h)||100,r.height=Math.ceil(l)||100,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new Framebuffer(r.width*r.resolution,r.height*r.resolution).addColorTexture(0,r),r.maskStack=[],r.filterStack=[{}],r}return __extends$2(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(BaseTexture),TextureUvs=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,r){var i=e.width,n=e.height;if(r){var s=t.width/2/i,a=t.height/2/n,o=t.x/i+s,h=t.y/n+a;r=groupD8.add(r,groupD8.NW),this.x0=o+s*groupD8.uX(r),this.y0=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x1=o+s*groupD8.uX(r),this.y1=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x2=o+s*groupD8.uX(r),this.y2=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x3=o+s*groupD8.uX(r),this.y3=h+a*groupD8.uY(r)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},t}(),DEFAULT_UVS=new TextureUvs,Texture=function(t){function e(r,i,n,s,a,o){var h=t.call(this)||this;if(h.noFrame=!1,i||(h.noFrame=!0,i=new Rectangle$1(0,0,1,1)),r instanceof e&&(r=r.baseTexture),h.baseTexture=r,h._frame=i,h.trim=s,h.valid=!1,h._uvs=DEFAULT_UVS,h.uvMatrix=null,h.orig=n||i,h._rotate=Number(a||0),!0===a)h._rotate=2;else if(h._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=o?new Point$2(o.x,o.y):new Point$2(0,0),h._updateID=0,h.textureCacheIds=[],r.valid?h.noFrame?r.valid&&h.onBaseTextureUpdated(r):h.frame=i:r.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&r.on("update",h.onBaseTextureUpdated,h),h}return __extends$2(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&r.url&&TextureCache[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),i=new e(this.baseTexture,!this.noFrame&&t,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i},e.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,i){void 0===r&&(r={}),void 0===i&&(i=settings.STRICT_TEXTURE_CACHE);var n="string"==typeof t,s=null;if(n)s=t;else{if(!t._pixiId){var a=r&&r.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+uid()}s=t._pixiId}var o=TextureCache[s];if(n&&i&&!o)throw new Error('The cacheId "'+s+'" does not exist in TextureCache.');return o||(r.resolution||(r.resolution=getResolutionOfUrl(t)),(o=new e(new BaseTexture(t,r))).baseTexture.cacheId=s,BaseTexture.addToCache(o.baseTexture,s),e.addToCache(o,s)),o},e.fromURL=function(t,r){var i=Object.assign({autoLoad:!1},null==r?void 0:r.resourceOptions),n=e.from(t,Object.assign({resourceOptions:i},r),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then((function(){return Promise.resolve(n)}))},e.fromBuffer=function(t,r,i,n){return new e(BaseTexture.fromBuffer(t,r,i,n))},e.fromLoader=function(t,r,i,n){var s=new BaseTexture(t,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(r)},n)),a=s.resource;a instanceof ImageResource&&(a.url=r);var o=new e(s);return i||(i=r),BaseTexture.addToCache(o.baseTexture,i),e.addToCache(o,i),i!==r&&(BaseTexture.addToCache(o.baseTexture,r),e.addToCache(o,r)),o.baseTexture.valid?Promise.resolve(o):new Promise((function(t){o.baseTexture.once("loaded",(function(){return t(o)}))}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),TextureCache[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),TextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=TextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete TextureCache[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)TextureCache[t.textureCacheIds[i]]===t&&delete TextureCache[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,i=t.width,n=t.height,s=e+i>this.baseTexture.width,a=r+n>this.baseTexture.height;if(s||a){var o=s&&a?"and":"or",h="X: "+e+" + "+i+" = "+(e+i)+" > "+this.baseTexture.width,l="Y: "+r+" + "+n+" = "+(r+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+h+" "+o+" "+l)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(eventemitter3);function createWhiteTexture(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Texture(new BaseTexture(new CanvasResource(t)))}function removeAllHandlers(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Texture.EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture.EMPTY),removeAllHandlers(Texture.EMPTY.baseTexture),Texture.WHITE=createWhiteTexture(),removeAllHandlers(Texture.WHITE),removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.valid=!0,i.filterFrame=null,i.filterPoolKey=null,i.updateUvs(),i}return __extends$2(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,r){void 0===r&&(r=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,r&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){for(var r=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=r[n];return"number"==typeof t&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:i[0],scaleMode:i[1],resolution:i[2]}),new e(new BaseRenderTexture(t))},e}(Texture),RenderTexturePool=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e){var r=new BaseRenderTexture(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new RenderTexture(r)},t.prototype.getOptimalTexture=function(e,r,i){void 0===i&&(i=1);var n=t.SCREEN_KEY;e*=i,r*=i,this.enableFullScreen&&e===this._pixelsWidth&&r===this._pixelsHeight||(n=(65535&(e=nextPow2(e)))<<16|65535&(r=nextPow2(r))),this.texturePool[n]||(this.texturePool[n]=[]);var s=this.texturePool[n].pop();return s||(s=this.createTexture(e,r)),s.filterPoolKey=n,s.setResolution(i),s},t.prototype.getFilterTexture=function(t,e){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var r=this.texturePool[e];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var r=t.SCREEN_KEY,i=this.texturePool[r];if(this.enableFullScreen=e.width>0&&e.height>0,i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[r]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY="screen",t}(),Attribute=function(){function t(t,e,r,i,n,s,a){void 0===e&&(e=0),void 0===r&&(r=!1),void 0===i&&(i=TYPES$1.FLOAT),this.buffer=t,this.size=e,this.normalized=r,this.type=i,this.stride=n,this.start=s,this.instance=a}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,r,i,n,s){return new t(e,r,i,n,s)},t}(),UID=0,Buffer=function(){function t(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=UID++,this.disposeRunner=new Runner("disposeBuffer")}return t.prototype.update=function(t){this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}();function getBufferType(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var map$1={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays(t,e){for(var r=0,i=0,n={},s=0;s<t.length;s++)i+=e[s],r+=t[s].length;var a=new ArrayBuffer(4*r),o=null,h=0;for(s=0;s<t.length;s++){var l=e[s],u=t[s],c=getBufferType(u);n[c]||(n[c]=new map$1[c](a)),o=n[c];for(var d=0;d<u.length;d++){o[(d/l|0)*i+h+d%l]=u[d]}h+=l}return new Float32Array(a)}var byteSizeMap={5126:4,5123:2,5121:1},UID$1=0,map$1$1={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Geometry=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=UID$1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,r,i,n,s,a,o){if(void 0===r&&(r=0),void 0===i&&(i=!1),void 0===o&&(o=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Buffer||(e instanceof Array&&(e=new Float32Array(e)),e=new Buffer(e));var h=t.split("|");if(h.length>1){for(var l=0;l<h.length;l++)this.addAttribute(h[l],e,r,i,n);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Attribute(u,r,i,n,s,a,o),this.instanced=this.instanced||o,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof Buffer||(t instanceof Array&&(t=new Uint16Array(t)),t=new Buffer(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],r=[],i=new Buffer;for(t in this.attributes){var n=this.attributes[t],s=this.buffers[n.buffer];e.push(s.data),r.push(n.size*byteSizeMap[n.type]/4),n.buffer=0}for(i.data=interleaveTypedArrays(e,r),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,r=0;r<this.buffers.length;r++)e.buffers[r]=new Buffer(this.buffers[r].data.slice(0));for(var r in this.attributes){var i=this.attributes[r];e.attributes[r]=new Attribute(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},t.merge=function(e){for(var r,i=new t,n=[],s=[],a=[],o=0;o<e.length;o++){r=e[o];for(var h=0;h<r.buffers.length;h++)s[h]=s[h]||0,s[h]+=r.buffers[h].data.length,a[h]=0}for(o=0;o<r.buffers.length;o++)n[o]=new(map$1$1[getBufferType(r.buffers[o].data)])(s[o]),i.buffers[o]=new Buffer(n[o]);for(o=0;o<e.length;o++){r=e[o];for(h=0;h<r.buffers.length;h++)n[h].set(r.buffers[h].data,a[h]),a[h]+=r.buffers[h].data.length}if(i.attributes=r.attributes,r.indexBuffer){i.indexBuffer=i.buffers[r.buffers.indexOf(r.indexBuffer)],i.indexBuffer.index=!0;var l=0,u=0,c=0,d=0;for(o=0;o<r.buffers.length;o++)if(r.buffers[o]!==r.indexBuffer){d=o;break}for(var o in r.attributes){var f=r.attributes[o];(0|f.buffer)===d&&(u+=f.size*byteSizeMap[f.type]/4)}for(o=0;o<e.length;o++){var p=e[o].indexBuffer.data;for(h=0;h<p.length;h++)i.indexBuffer.data[h+c]+=l;l+=r.buffers[d].data.length/u,c+=p.length}}return i},t}(),Quad$1=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return __extends$2(e,t),e}(Geometry),QuadUv=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new Buffer(e.vertices),e.uvBuffer=new Buffer(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return __extends$2(e,t),e.prototype.map=function(t,e){var r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(Geometry),UID$2=0,UniformGroup=function(){function t(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!e}return t.prototype.update=function(){this.dirtyId++},t.prototype.add=function(e,r,i){this.uniforms[e]=new t(r,i)},t.from=function(e,r){return new t(e,r)},t}(),FilterState=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Rectangle$1,this.destinationFrame=new Rectangle$1,this.bindingSourceFrame=new Rectangle$1,this.bindingDestinationFrame=new Rectangle$1,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),tempPoints=[new Point$2,new Point$2,new Point$2,new Point$2],tempMatrix=new Matrix,FilterSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.defaultFilterStack=[{}],r.texturePool=new RenderTexturePool,r.texturePool.setScreenSize(e.view),r.statePool=[],r.quad=new Quad$1,r.quadUv=new QuadUv,r.tempRect=new Rectangle$1,r.activeState={},r.globalUniforms=new UniformGroup({outputFrame:new Rectangle$1,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),r.forceClear=!1,r.useMaxPadding=!1,r}return __extends$2(e,t),e.prototype.push=function(t,e){for(var r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new FilterState,s=this.renderer.renderTexture,a=e[0].resolution,o=e[0].padding,h=e[0].autoFit,l=e[0].legacy,u=1;u<e.length;u++){var c=e[u];a=Math.min(a,c.resolution),o=this.useMaxPadding?Math.max(o,c.padding):o+c.padding,h=h&&c.autoFit,l=l||c.legacy}if(1===i.length&&(this.defaultFilterStack[0].renderTexture=s.current),i.push(n),n.resolution=a,n.legacy=l,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(o),h){var d=this.tempRect.copyFrom(s.sourceFrame);r.projection.transform&&this.transformAABB(tempMatrix.copyFrom(r.projection.transform).invert(),d),n.sourceFrame.fit(d)}this.roundFrame(n.sourceFrame,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;var f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(s.sourceFrame),n.bindingDestinationFrame.copyFrom(s.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,s.bind(n.renderTexture,n.sourceFrame,f),r.framebuffer.clear(0,0,0,0)},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;var i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;var n=i.inputSize,s=i.inputPixel,a=i.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],s[0]=n[0]*e.resolution,s[1]=n[1]*e.resolution,s[2]=1/s[0],s[3]=1/s[1],a[0]=.5*s[2],a[1]=.5*s[3],a[2]=e.sourceFrame.width*n[2]-.5*s[2],a[3]=e.sourceFrame.height*n[3]-.5*s[3],e.legacy){var o=i.filterArea;o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=e.sourceFrame.x,o[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();var h=t[t.length-1];if(e.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,h.renderTexture,CLEAR_MODES$1.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;var c=0;for(c=0;c<r.length-1;++c){r[c].apply(this,l,u,CLEAR_MODES$1.CLEAR,e);var d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,CLEAR_MODES$1.BLEND,e),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},e.prototype.bindAndClear=function(t,e){void 0===e&&(e=CLEAR_MODES$1.CLEAR);var r=this.renderer,i=r.renderTexture,n=r.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=t.filterFrame.width,s.height=t.filterFrame.height,i.bind(t,t.filterFrame,s)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=1&n.stateId||this.forceClear;(e===CLEAR_MODES$1.CLEAR||e===CLEAR_MODES$1.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},e.prototype.applyFilter=function(t,e,r,i){var n=this.renderer;n.state.set(t.state),this.bindAndClear(r,i),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(DRAW_MODES$1.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(DRAW_MODES$1.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var r=this.activeState,i=r.sourceFrame,n=r.destinationFrame,s=e._texture.orig,a=t.set(n.width,0,0,n.height,i.x,i.y),o=e.worldTransform.copyTo(Matrix.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,r){return void 0===r&&(r=1),this.texturePool.getOptimalTexture(t,e,r)},e.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return i.filterFrame=t.filterFrame,i},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e.prototype.transformAABB=function(t,e){var r=tempPoints[0],i=tempPoints[1],n=tempPoints[2],s=tempPoints[3];r.set(e.left,e.top),i.set(e.left,e.bottom),n.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(r,r),t.apply(i,i),t.apply(n,n),t.apply(s,s);var a=Math.min(r.x,i.x,n.x,s.x),o=Math.min(r.y,i.y,n.y,s.y),h=Math.max(r.x,i.x,n.x,s.x),l=Math.max(r.y,i.y,n.y,s.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o},e.prototype.roundFrame=function(t,e,r,i,n){if(n){var s=n.a,a=n.b,o=n.c,h=n.d;if(!(0===a&&0===o||0===s&&0===h))return}(n=n?tempMatrix.copyFrom(n):tempMatrix.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)},e}(System),ObjectRenderer=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),BatchSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.emptyRenderer=new ObjectRenderer(e),r.currentRenderer=r.emptyRenderer,r}return __extends$2(e,t),e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var r=this.renderer.texture.boundTextures,i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)},e.prototype.boundArray=function(t,e,r,i){for(var n=t.elements,s=t.ids,a=t.count,o=0,h=0;h<a;h++){var l=n[h],u=l._batchLocation;if(u>=0&&u<i&&e[u]===l)s[h]=u;else for(;o<i;){var c=e[o];if(!c||c._batchEnabled!==r||c._batchLocation!==o){s[h]=o,l._batchLocation=o,e[o]=l;break}o++}}},e}(System),CONTEXT_UID_COUNTER=0,ContextSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.webGLVersion=1,r.extensions={},r.supports={uint32Indices:!1},r.handleContextLost=r.handleContextLost.bind(r),r.handleContextRestored=r.handleContextRestored.bind(r),e.view.addEventListener("webglcontextlost",r.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",r.handleContextRestored,!1),r}return __extends$2(e,t),Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var r;if(settings.PREFER_ENV>=ENV$1.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,!(r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var e=t.getContextAttributes(),r="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;r&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var i=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e}(System),GLFramebuffer=function(t){this.framebuffer=t,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=MSAA_QUALITY$1.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},tempRectangle=new Rectangle$1,FramebufferSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.managedFramebuffers=[],r.unknownFramebuffer=new Framebuffer(10,10),r.msaaSamples=null,r}return __extends$2(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle$1,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV$1.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},e.prototype.bind=function(t,e){var r=this.gl;if(t){var i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var n=0;n<t.colorTextures.length;n++){var s=t.colorTextures[n];this.renderer.texture.unbind(s.parentTextureArray||s)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,r,i){var n=this.viewport;n.width===r&&n.height===i&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=r,n.height=i,this.gl.viewport(t,e,r,i))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(t,e,r,i,n){void 0===n&&(n=BUFFER_BITS$1.COLOR|BUFFER_BITS$1.DEPTH);var s=this.gl;s.clearColor(t,e,r,i),s.clear(n)},e.prototype.initFramebuffer=function(t){var e=this.gl,r=new GLFramebuffer(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r},e.prototype.resizeFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var i=t.colorTextures,n=0;n<i.length;n++)this.renderer.texture.bind(i[n],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures.length;e.drawBuffers||(i=Math.min(i,1)),r.multisample>1&&(r.msaaBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.RGBA8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,r.msaaBuffer));for(var n=[],s=0;s<i;s++)if(!(0===s&&r.multisample>1)){var a=t.colorTextures[s],o=a.parentTextureArray||a;this.renderer.texture.bind(o,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,a.target,o._glTextures[this.CONTEXT_UID].texture,0),n.push(e.COLOR_ATTACHMENT0+s)}if((n.length>1&&e.drawBuffers(n),t.depthTexture)&&this.writeDepthTexture){var h=t.depthTexture;this.renderer.texture.bind(h,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,0)}r.stencil||!t.stencil&&!t.depth||(r.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r.stencil))},e.prototype.detectSamples=function(t){var e=this.msaaSamples,r=MSAA_QUALITY$1.NONE;if(t<=1||null===e)return r;for(var i=0;i<e.length;i++)if(e[i]<=t){r=e[i];break}return 1===r&&(r=MSAA_QUALITY$1.NONE),r},e.prototype.blit=function(t,e,r){var i=this,n=i.current,s=i.renderer,a=i.gl,o=i.CONTEXT_UID;if(2===s.context.webGLVersion&&n){var h=n.glFramebuffers[o];if(h){if(!t){if(h.multisample<=1)return;h.blitFramebuffer||(h.blitFramebuffer=new Framebuffer(n.width,n.height),h.blitFramebuffer.addColorTexture(0,n.colorTextures[0])),(t=h.blitFramebuffer).width=n.width,t.height=n.height}e||((e=tempRectangle).width=n.width,e.height=n.height),r||(r=e);var l=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.x,e.y,e.width,e.height,r.x,r.y,r.width,r.height,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,e){var r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(r){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.stencil&&i.deleteRenderbuffer(r.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var r=t.width,i=t.height,n=this.gl,s=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,s),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,i),e.stencil=s,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,s)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle$1},e}(System),GLBuffer=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},byteSizeMap$1={5126:4,5123:2,5121:1},GeometrySystem=function(t){function e(e){var r=t.call(this,e)||this;return r._activeGeometry=null,r._activeVao=null,r.hasVao=!0,r.hasInstance=!0,r.canUseUInt32ElementIndex=!1,r.managedGeometries={},r.managedBuffers={},r}return __extends$2(e,t),e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var r=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV$1.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=function(){return r.createVertexArrayOES()},t.bindVertexArray=function(t){return r.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return r.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=function(t,e){return i.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,r,n,s){return i.drawElementsInstancedANGLE(t,e,r,n,s)},t.drawArraysInstanced=function(t,e,r,n){return i.drawArraysInstancedANGLE(t,e,r,n)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var r=this.gl,i=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);var s=i[e.program.id]||this.initGeometryVao(t,e.program,n);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?r.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,r=0;r<t.buffers.length;r++){var i=t.buffers[r],n=i._glBuffers[this.CONTEXT_UID];if(i._updateID!==n.updateID){n.updateID=i._updateID;var s=i.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(s,n.buffer),this._boundBuffer=n,n.byteLength>=i.data.byteLength)e.bufferSubData(s,0,i.data);else{var a=i.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=i.data.byteLength,e.bufferData(s,i.data,a)}}}},e.prototype.checkCompatibility=function(t,e){var r=t.attributes,i=e.attributeData;for(var n in i)if(!r[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},e.prototype.getSignature=function(t,e){var r=t.attributes,i=e.attributeData,n=["g",t.id];for(var s in r)i[s]&&n.push(s);return n.join("-")},e.prototype.initGeometryVao=function(t,e,r){void 0===r&&(r=!0),this.checkCompatibility(t,e);var i=this.gl,n=this.CONTEXT_UID,s=this.getSignature(t,e),a=t.glVertexArrayObjects[this.CONTEXT_UID],o=a[s];if(o)return a[e.id]=o,o;var h=t.buffers,l=t.attributes,u={},c={};for(var d in h)u[d]=0,c[d]=0;for(var d in l)!l[d].size&&e.attributeData[d]?l[d].size=e.attributeData[d].size:l[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),u[l[d].buffer]+=l[d].size*byteSizeMap$1[l[d].type];for(var d in l){var f=l[d],p=f.size;void 0===f.stride&&(u[f.buffer]===p*byteSizeMap$1[f.type]?f.stride=0:f.stride=u[f.buffer]),void 0===f.start&&(f.start=c[f.buffer],c[f.buffer]+=p*byteSizeMap$1[f.type])}o=i.createVertexArray(),i.bindVertexArray(o);for(var _=0;_<h.length;_++){var g=h[_];g._glBuffers[n]||(g._glBuffers[n]=new GLBuffer(i.createBuffer()),this.managedBuffers[g.id]=g,g.disposeRunner.add(this)),r&&g._glBuffers[n].refCount++}return this.activateVao(t,e),this._activeVao=o,a[e.id]=o,a[s]=o,o},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=t.buffers;if(t.disposeRunner.remove(this),r){for(var s=0;s<n.length;s++){var a=n[s]._glBuffers[this.CONTEXT_UID];a.refCount--,0!==a.refCount||e||this.disposeBuffer(n[s],e)}if(!e)for(var o in r)if("g"===o[0]){var h=r[o];this._activeVao===h&&this.unbind(),i.deleteVertexArray(h)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t);e=Object.keys(this.managedBuffers);for(r=0;r<e.length;r++)this.disposeBuffer(this.managedBuffers[e[r]],t)},e.prototype.activateVao=function(t,e){var r=this.gl,i=this.CONTEXT_UID,n=t.buffers,s=t.attributes;t.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[i].buffer);var a=null;for(var o in s){var h=s[o],l=n[h.buffer]._glBuffers[i];if(e.attributeData[o]){a!==l&&(r.bindBuffer(r.ARRAY_BUFFER,l.buffer),a=l);var u=e.attributeData[o].location;if(r.enableVertexAttribArray(u),r.vertexAttribPointer(u,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(u,1)}}}},e.prototype.draw=function(t,e,r,i){var n=this.gl,s=this._activeGeometry;if(s.indexBuffer){var a=s.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?s.instanced?n.drawElementsInstanced(t,e||s.indexBuffer.data.length,o,(r||0)*a,i||1):n.drawElements(t,e||s.indexBuffer.data.length,o,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else s.instanced?n.drawArraysInstanced(t,r,e||s.getSize(),i||1):n.drawArrays(t,r,e||s.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(System),MaskData=function(){function t(t){void 0===t&&(t=null),this.type=MASK_TYPES$1.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES$1.NONE,this.autoDetect=!0),this._target=null},t.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function compileShader(t,e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function compileProgram(t,e,r,i){var n=compileShader(t,t.VERTEX_SHADER,e),s=compileShader(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,s),i)for(var o in i)t.bindAttribLocation(a,i[o],o);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(n))),t.getShaderParameter(s,t.COMPILE_STATUS)||(console.warn(r),console.error(t.getShaderInfoLog(s))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(n),t.deleteShader(s),a}function booleanArray(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e}function defaultValue(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext={},context=unknownContext,maxFragmentPrecision;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var t=document.createElement("canvas"),e=void 0;settings.PREFER_ENV>=ENV$1.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),context=e}return context}function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION$1.MEDIUM;var t=getTestContext();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);maxFragmentPrecision=e.precision?PRECISION$1.HIGH:PRECISION$1.MEDIUM}}return maxFragmentPrecision}function setPrecision(t,e,r){if("precision"!==t.substring(0,9)){var i=e;return e===PRECISION$1.HIGH&&r!==PRECISION$1.HIGH&&(i=PRECISION$1.MEDIUM),"precision "+i+" float;\n"+t}return r!==PRECISION$1.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(t){return GLSL_TO_SIZE[t]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(t,e){if(!GL_TABLE){var r=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<r.length;++i){var n=r[i];GL_TABLE[t[n]]=GL_TO_GLSL_TYPES[n]}}return GL_TABLE[e]}var uniformParsers=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(t,e){var r=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var i in t.uniforms){var n=e[i];if(n){for(var s=t.uniforms[i],a=!1,o=0;o<uniformParsers.length;o++)if(uniformParsers[o].test(n,s)){r.push(uniformParsers[o].code(i,s)),a=!0;break}if(!a){var h=(1===n.size?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[n.type].replace("location",'ud["'+i+'"].location');r.push('\n            cv = ud["'+i+'"].value;\n            v = uv["'+i+'"];\n            '+h+";")}}else t.uniforms[i].group&&r.push('\n                    renderer.shader.syncUniformGroup(uv["'+i+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",r.join("\n"))}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n"),unsafeEval;function generateIfTestSrc(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}function checkMaxIfStatementsInShader(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=e.createShader(e.FRAGMENT_SHADER);;){var i=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}function unsafeEvalSupported(){if("boolean"==typeof unsafeEval)return unsafeEval;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=!0===t({a:"b"},"a","b")}catch(t){unsafeEval=!1}return unsafeEval}var defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}",defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n",UID$3=0,nameCache={},Program=function(){function t(e,r,i){void 0===i&&(i="pixi-shader"),this.id=UID$3++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),nameCache[i]?(nameCache[i]++,i+="-"+nameCache[i]):nameCache[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION$1.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return t.prototype.extractData=function(t,e){var r=getTestContext();if(r){var i=compileProgram(r,t,e);this.attributeData=this.getAttributeData(i,r),this.uniformData=this.getUniformData(i,r),r.deleteProgram(i)}else this.uniformData={},this.attributeData={}},t.prototype.getAttributeData=function(t,e){for(var r={},i=[],n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),s=0;s<n;s++){var a=e.getActiveAttrib(t,s),o=mapType(e,a.type),h={type:o,name:a.name,size:mapSize(o),location:0};r[a.name]=h,i.push(h)}i.sort((function(t,e){return t.name>e.name?1:-1}));for(s=0;s<i.length;s++)i[s].location=s;return r},t.prototype.getUniformData=function(t,e){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var s=e.getActiveUniform(t,n),a=s.name.replace(/\[.*?\]$/,""),o=s.name.match(/\[.*?\]$/),h=mapType(e,s.type);r[a]={type:h,size:s.size,isArray:o,value:defaultValue(h,s.size)}}return r},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return defaultVertex},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return defaultFragment},enumerable:!1,configurable:!0}),t.from=function(e,r,i){var n=e+r,s=ProgramCache[n];return s||(ProgramCache[n]=s=new t(e,r,i)),s},t}(),Shader=function(){function t(t,e){for(var r in this.program=t,this.uniformGroup=e?e instanceof UniformGroup?e:new UniformGroup(e):new UniformGroup({}),t.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var r in e.uniforms){var i=e.uniforms[r];if(i.group&&this.checkUniformExists(t,i))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,r,i){return new t(Program.from(e,r),i)},t}(),BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,State=function(){function t(){this.data=0,this.blendMode=BLEND_MODES$1.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND)},set:function(t){!!(this.data&1<<BLEND)!==t&&(this.data^=1<<BLEND)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET)},set:function(t){!!(this.data&1<<OFFSET)!==t&&(this.data^=1<<OFFSET)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING)},set:function(t){!!(this.data&1<<CULLING)!==t&&(this.data^=1<<CULLING)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST)},set:function(t){!!(this.data&1<<DEPTH_TEST)!==t&&(this.data^=1<<DEPTH_TEST)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK)},set:function(t){!!(this.data&1<<DEPTH_MASK)!==t&&(this.data^=1<<DEPTH_MASK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING)},set:function(t){!!(this.data&1<<WINDING)!==t&&(this.data^=1<<WINDING)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==BLEND_MODES$1.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),defaultVertex$1="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",defaultFragment$1="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n",Filter=function(t){function e(r,i,n){var s=this,a=Program.from(r||e.defaultVertexSrc,i||e.defaultFragmentSrc);return(s=t.call(this,a,n)||this).padding=0,s.resolution=settings.FILTER_RESOLUTION,s.enabled=!0,s.autoFit=!0,s.legacy=!!s.program.attributeData.aTextureCoord,s.state=new State,s}return __extends$2(e,t),e.prototype.apply=function(t,e,r,i,n){t.applyFilter(this,e,r,i)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return defaultVertex$1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return defaultFragment$1},enumerable:!1,configurable:!0}),e}(Shader),vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",fragment="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",tempMat=new Matrix,TextureMatrix=function(){function t(t,e){this._texture=t,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,i=0;i<t.length;i+=2){var n=t[i],s=t[i+1];e[i]=n*r.a+s*r.c+r.tx,e[i+1]=n*r.b+s*r.d+r.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var i=e.orig,n=e.trim;n&&(tempMat.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(tempMat));var s=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/s.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/s.width,a[1]=(e._frame.y+o+h)/s.height,a[2]=(e._frame.x+e._frame.width-o+h)/s.width,a[3]=(e._frame.y+e._frame.height-o+h)/s.height,this.uClampOffset[0]=h/s.realWidth,this.uClampOffset[1]=h/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0},t}(),SpriteMaskFilter=function(t){function e(e){var r=this,i=new Matrix;return r=t.call(this,vertex,fragment)||this,e.renderable=!1,r.maskSprite=e,r.maskMatrix=i,r}return __extends$2(e,t),e.prototype.apply=function(t,e,r,i){var n=this.maskSprite,s=n._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new TextureMatrix(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))},e}(Filter),MaskSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.enableScissor=!0,r.alphaMaskPool=[],r.maskDataPool=[],r.maskStack=[],r.alphaMaskIndex=0,r}return __extends$2(e,t),e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,e){var r=e;if(!r.isMaskData){var i=this.maskDataPool.pop()||new MaskData;i.pooled=!0,i.maskObject=e,r=i}switch(r.autoDetect&&this.detect(r),r.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),r._target=t,r.type){case MASK_TYPES$1.SCISSOR:this.maskStack.push(r),this.renderer.scissor.push(r);break;case MASK_TYPES$1.STENCIL:this.maskStack.push(r),this.renderer.stencil.push(r);break;case MASK_TYPES$1.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r),this.maskStack.push(r)}},e.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case MASK_TYPES$1.SCISSOR:this.renderer.scissor.pop();break;case MASK_TYPES$1.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case MASK_TYPES$1.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},e.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=MASK_TYPES$1.SPRITE;else if(t.type=MASK_TYPES$1.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var r=e.worldTransform,i=Math.atan2(r.b,r.a),n=Math.atan2(r.d,r.c);i=Math.round(i*(180/Math.PI)*100),n=((n=Math.round(n*(180/Math.PI)*100)-i)%18e3+18e3)%18e3,0===(i=(i%9e3+9e3)%9e3)&&9e3===n&&(t.type=MASK_TYPES$1.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e=t.maskObject,r=t._target,i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter(e)]),i[0].resolution=this.renderer.resolution,i[0].maskSprite=e;var n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e}(System),AbstractMaskSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.maskStack=[],r.glConst=0,r}return __extends$2(e,t),e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,r=this.getStackLength();this.maskStack=t;var i=this.getStackLength();i!==r&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.maskStack=null},e}(System),ScissorSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return __extends$2(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var r=t._scissorRect,i=e.getBounds(!0),n=this.renderer.gl;e.renderable=!1,r?i.fit(r):n.enable(n.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=i,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,r=this.renderer.projection,i=r.transform,n=r.sourceFrame,s=r.destinationFrame,a=e?e.resolution:this.renderer.resolution,o=s.width/n.width,h=s.height/n.height,l=((t.x-n.x)*o+s.x)*a,u=((t.y-n.y)*h+s.y)*a,c=t.width*o*a,d=t.height*h*a;i&&(l+=i.tx*a,u+=i.ty*a),e||(u=this.renderer.height-d-u),this.renderer.gl.scissor(l,u,c,d)},e}(AbstractMaskSystem),StencilSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return __extends$2(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,r=this.renderer.gl,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.enable(r.STENCIL_TEST)),t._stencilCounter++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,i,this._getBitwiseMask()),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),this.renderer.framebuffer.blit(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(AbstractMaskSystem),ProjectionSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.destinationFrame=null,r.sourceFrame=null,r.defaultFrame=null,r.projectionMatrix=new Matrix,r.transform=null,r}return __extends$2(e,t),e.prototype.update=function(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,r,i){var n=this.projectionMatrix,s=i?-1:1;n.identity(),n.a=1/e.width*2,n.d=s*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-s-e.y*n.d},e.prototype.setTransform=function(t){},e}(System),tempRect=new Rectangle$1,tempRect2=new Rectangle$1,RenderTextureSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.clearColor=e._backgroundColorRgba,r.defaultMaskStack=[],r.current=null,r.sourceFrame=new Rectangle$1,r.destinationFrame=new Rectangle$1,r.viewportFrame=new Rectangle$1,r}return __extends$2(e,t),e.prototype.bind=function(t,e,r){void 0===t&&(t=null);var i,n,s,a=this.renderer;this.current=t,t?(s=(i=t.baseTexture).resolution,e||(tempRect.width=t.frame.width,tempRect.height=t.frame.height,e=tempRect),r||(tempRect2.x=t.frame.x,tempRect2.y=t.frame.y,tempRect2.width=e.width,tempRect2.height=e.height,r=tempRect2),n=i.framebuffer):(s=a.resolution,e||(tempRect.width=a.screen.width,tempRect.height=a.screen.height,e=tempRect),r||((r=tempRect).width=e.width,r.height=e.height));var o=this.viewportFrame;o.x=r.x*s,o.y=r.y*s,o.width=r.width*s,o.height=r.height*s,t||(o.y=a.view.height-(o.y+o.height)),this.renderer.framebuffer.bind(n,o),this.renderer.projection.update(r,e,s,!n),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)},e.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var r=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer.screen,n=r.width!==i.width||r.height!==i.height;if(n){var s=this.viewportFrame,a=s.x,o=s.y,h=s.width,l=s.height;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,h,l)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),n&&this.renderer.scissor.pop()},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(System),GLProgram=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},t}(),UID$4=0,defaultSyncData={textureCount:0},ShaderSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.destroyed=!1,r.systemCheck(),r.gl=null,r.shader=null,r.program=null,r.cache={},r.id=UID$4++,r}return __extends$2(e,t),e.prototype.systemCheck=function(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(defaultSyncData.textureCount=0,this.syncUniformGroup(t.uniformGroup,defaultSyncData)),i},e.prototype.setUniforms=function(t){var e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var r=this.getglProgram();t.static&&t.dirtyId===r.uniformGroups[t.id]||(r.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))},e.prototype.syncUniforms=function(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=generateUniformsSync(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var r=t.uniforms,i=[];for(var n in r)i.push(n),e[n]&&i.push(e[n].type);return i.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,r=t.program,i={};for(var n in r.attributeData)i[n]=r.attributeData[n].location;var s=compileProgram(e,r.vertexSrc,r.fragmentSrc,i),a={};for(var n in r.uniformData){var o=r.uniformData[n];a[n]={location:e.getUniformLocation(s,n),value:defaultValue(o.type,o.size)}}var h=new GLProgram(s,a);return r.glPrograms[this.renderer.CONTEXT_UID]=h,h},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(System);function mapWebGLBlendModesToPixi(t,e){return void 0===e&&(e=[]),e[BLEND_MODES$1.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.ADD]=[t.ONE,t.ONE],e[BLEND_MODES$1.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.NONE]=[0,0],e[BLEND_MODES$1.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[BLEND_MODES$1.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[BLEND_MODES$1.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[BLEND_MODES$1.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[BLEND_MODES$1.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[BLEND_MODES$1.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[BLEND_MODES$1.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES$1.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5,StateSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.gl=null,r.stateId=0,r.polygonOffset=0,r.blendMode=BLEND_MODES$1.NONE,r._blendEq=!1,r.map=[],r.map[BLEND$1]=r.setBlend,r.map[OFFSET$1]=r.setOffset,r.map[CULLING$1]=r.setCullFace,r.map[DEPTH_TEST$1]=r.setDepthTest,r.map[WINDING$1]=r.setFrontFace,r.map[DEPTH_MASK$1]=r.setDepthMask,r.checks=[],r.defaultState=new State,r.defaultState.blend=!0,r}return __extends$2(e,t),e.prototype.contextChange=function(t){this.gl=t,this.blendModes=mapWebGLBlendModesToPixi(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,r=0;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setDepthMask=function(t){this.gl.depthMask(t)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},e}(System),TextureGCSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.count=0,r.checkCount=0,r.maxIdle=settings.GC_MAX_IDLE,r.checkCountMax=settings.GC_MAX_CHECK_COUNT,r.mode=settings.GC_MODE,r}return __extends$2(e,t),e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES$1.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,r=!1,i=0;i<e.length;i++){var n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,r=!0)}if(r){var s=0;for(i=0;i<e.length;i++)null!==e[i]&&(e[s++]=e[i]);e.length=s}},e.prototype.unload=function(t){var e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(var i=t.children.length-1;i>=0;i--)this.unload(t.children[i])},e}(System),GLTexture=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121,this.samplerType=0},TextureSystem=function(t){function e(e){var r=t.call(this,e)||this;return r.boundTextures=[],r.currentLocation=-1,r.managedTextures=[],r._unknownBoundTextures=!1,r.unknownTexture=new BaseTexture,r.hasIntegerTextures=!1,r}return __extends$2(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};var i=new GLTexture(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new GLTexture(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(r=0;r<this.boundTextures.length;r++)this.bind(null,r)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var r=this.gl;if(t){if((t=t.castToBaseTexture()).parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<r.length;i++)r[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[i]=null)},e.prototype.ensureSamplerType=function(t){var e=this,r=e.boundTextures,i=e.hasIntegerTextures,n=e.CONTEXT_UID;if(i)for(var s=t-1;s>=0;--s){var a=r[s];if(a)a._glTextures[n].samplerType!==SAMPLER_TYPES$1.FLOAT&&this.renderer.texture.unbind(a)}},e.prototype.initTexture=function(t){var e=new GLTexture(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var r=this.renderer.gl;t.type===r.FLOAT&&t.format===r.RGBA&&(e.internalFormat=r.RGBA32F),t.type===TYPES$1.HALF_FLOAT&&(e.type=r.HALF_FLOAT),e.type===r.HALF_FLOAT&&t.format===r.RGBA&&(e.internalFormat=r.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var r=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(r,t,e))e.samplerType!==SAMPLER_TYPES$1.FLOAT&&(this.hasIntegerTextures=!0);else{var i=t.realWidth,n=t.realHeight,s=r.gl;(e.width!==i||e.height!==n||e.dirtyId<0)&&(e.width=i,e.height=n,s.texImage2D(t.target,0,e.internalFormat,i,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var r=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var i=this.managedTextures.indexOf(t);-1!==i&&removeItems(this.managedTextures,i,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==MIPMAP_MODES$1.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=WRAP_MODES$1.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var r=this.gl;if(e.mipmap&&t.mipmap!==MIPMAP_MODES$1.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===SCALE_MODES$1.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var i=this.renderer.context.extensions.anisotropicFiltering;if(i&&t.anisotropicLevel>0&&t.scaleMode===SCALE_MODES$1.LINEAR){var n=Math.min(t.anisotropicLevel,r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===SCALE_MODES$1.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===SCALE_MODES$1.LINEAR?r.LINEAR:r.NEAREST)},e}(System),_systems={__proto__:null,FilterSystem:FilterSystem,BatchSystem:BatchSystem,ContextSystem:ContextSystem,FramebufferSystem:FramebufferSystem,GeometrySystem:GeometrySystem,MaskSystem:MaskSystem,ScissorSystem:ScissorSystem,StencilSystem:StencilSystem,ProjectionSystem:ProjectionSystem,RenderTextureSystem:RenderTextureSystem,ShaderSystem:ShaderSystem,StateSystem:StateSystem,TextureGCSystem:TextureGCSystem,TextureSystem:TextureSystem},tempMatrix$1=new Matrix,AbstractRenderer=function(t){function e(e,r){void 0===e&&(e=RENDERER_TYPE$1.UNKNOWN);var i=t.call(this)||this;return r=Object.assign({},settings.RENDER_OPTIONS,r),i.options=r,i.type=e,i.screen=new Rectangle$1(0,0,r.width,r.height),i.view=r.view||document.createElement("canvas"),i.resolution=r.resolution||settings.RESOLUTION,i.useContextAlpha=r.useContextAlpha,i.autoDensity=!!r.autoDensity,i.preserveDrawingBuffer=r.preserveDrawingBuffer,i.clearBeforeRender=r.clearBeforeRender,i._backgroundColor=0,i._backgroundColorRgba=[0,0,0,1],i._backgroundColorString="#000000",i.backgroundColor=r.backgroundColor||i._backgroundColor,i.backgroundAlpha=r.backgroundAlpha,void 0!==r.transparent&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),i.useContextAlpha=r.transparent,i.backgroundAlpha=r.transparent?0:1),i._lastObjectRendered=null,i.plugins={},i}return __extends$2(e,t),e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px"),this.emit("resize",t,e)},e.prototype.generateTexture=function(t,e,r,i){0===(i=i||t.getLocalBounds(null,!0)).width&&(i.width=1),0===i.height&&(i.height=1);var n=RenderTexture.create({width:0|i.width,height:0|i.height,scaleMode:e,resolution:r});return tempMatrix$1.tx=-i.x,tempMatrix$1.ty=-i.y,this.render(t,{renderTexture:n,clear:!1,transform:tempMatrix$1,skipUpdateTransform:!!t.parent}),n},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var r=this;r.plugins=null,r.type=RENDERER_TYPE$1.UNKNOWN,r.view=null,r.screen=null,r._tempDisplayObjectParent=null,r.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=hex2string(t),hex2rgb(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(eventemitter3),Renderer=function(t){function e(r){var i=t.call(this,RENDERER_TYPE$1.WEBGL,r)||this;return r=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},i.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),i.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),i.initPlugins(e.__plugins),r.context?i.context.initFromContext(r.context):i.context.initFromOptions({alpha:!!i.useContextAlpha,antialias:r.antialias,premultipliedAlpha:i.useContextAlpha&&"notMultiplied"!==i.useContextAlpha,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,sayHello(2===i.context.webGLVersion?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return __extends$2(e,t),e.create=function(t){if(isWebGLSupported())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var r=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var i in this[e]=r,this.runners)this.runners[i].add(r);return this},e.prototype.render=function(t,e){var r,i,n,s;if(e&&(e instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),r=e,i=arguments[2],n=arguments[3],s=arguments[4]):(r=e.renderTexture,i=e.clear,n=e.transform,s=e.skipUpdateTransform)),this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=n,!this.context.isLost){if(r||(this._lastObjectRendered=t),!s){var a=t.enableTempParent();t.updateTransform(),t.disableTempParent(a)}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,r){t.prototype.resize.call(this,e,r),this.runners.resize.emit(e,r)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(e){for(var r in this.runners.destroy.emit(),this.runners)this.runners[r].destroy();t.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,r){e.__plugins=e.__plugins||{},e.__plugins[t]=r},e}(AbstractRenderer);function autoDetectRenderer(t){return Renderer.create(t)}var $defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",$defaultFilterVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",defaultVertex$2=$defaultVertex,defaultFilterVertex=$defaultFilterVertex,BatchDrawCall=function(){this.texArray=null,this.blend=0,this.type=DRAW_MODES$1.TRIANGLES,this.start=0,this.size=0,this.data=null},BatchTextureArray=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),ViewableBuffer=function(){function t(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),AbstractBatchRenderer=function(t){function e(e){var r=t.call(this,e)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=State.for2d(),r.size=4*settings.SPRITE_BATCH_SIZE,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),e.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return __extends$2(e,t),e.prototype.contextChange=function(){var t=this.renderer.gl;settings.PREFER_ENV===ENV$1.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,r=e._textureArrayPool,i=this.size/4,n=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new BatchDrawCall);for(;r.length<n;)r.push(new BatchTextureArray);for(var s=0;s<this.MAX_TEXTURES;s++)this._tempBoundTextures[s]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,r=this.MAX_TEXTURES,i=e._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,a=this.renderer.textureGC.count,o=++BaseTexture._globalBatch,h=0,l=i[0],u=0;n.copyBoundTextures(s,r);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==o&&(l.count>=r&&(n.boundArray(l,s,o,r),this.buildDrawCalls(l,u,c),u=c,l=i[++h],++o),d._batchEnabled=o,d.touched=a,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,o,r),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(c=0;c<s.length;c++)s[c]=null;BaseTexture._globalBatch=o},e.prototype.buildDrawCalls=function(t,r,i){var n=this,s=n._bufferedElements,a=n._attributeBuffer,o=n._indexBuffer,h=n.vertexSize,l=e._drawCallPool,u=this._dcIndex,c=this._aIndex,d=this._iIndex,f=l[u];f.start=this._iIndex,f.texArray=t;for(var p=r;p<i;++p){var _=s[p],g=_._texture.baseTexture,m=premultiplyBlendMode[g.alphaMode?1:0][_.blendMode];s[p]=null,r<p&&f.blend!==m&&(f.size=d-f.start,r=p,(f=l[++u]).texArray=t,f.start=d),this.packInterleavedGeometry(_,a,o,c,d),c+=_.vertexData.length/2*h,d+=_.indices.length,f.blend=m}r<i&&(f.size=d-f.start,++u),this._dcIndex=u,this._aIndex=c,this._iIndex=d},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,r=t._attributeBuffer,i=t._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,r=this.renderer,i=r.gl,n=r.state,s=e._drawCallPool,a=null,o=0;o<t;o++){var h=s[o],l=h.texArray,u=h.type,c=h.size,d=h.start,f=h.blend;a!==l&&(a=l,this.bindAndClearTexArray(l)),this.state.blendMode=f,n.set(this.state),i.drawElements(u,c,i.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=nextPow2(Math.ceil(t/8)),r=log2(e),i=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new ViewableBuffer(i*this.vertexSize*4)),n},e.prototype.getIndexBuffer=function(t){var e=nextPow2(Math.ceil(t/12)),r=log2(e),i=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n},e.prototype.packInterleavedGeometry=function(t,e,r,i,n){for(var s=e.uint32View,a=e.float32View,o=i/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?premultiplyTint(t._tintRGB,d):t._tintRGB+(255*d<<24),p=0;p<u.length;p+=2)a[i++]=u[p],a[i++]=u[p+1],a[i++]=h[p],a[i++]=h[p+1],s[i++]=f,a[i++]=c;for(p=0;p<l.length;p++)r[n++]=o+l[p]},e._drawCallPool=[],e._textureArrayPool=[],e}(ObjectRenderer),BatchShaderGenerator=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=UniformGroup.from({uSamplers:e},!0);var i=this.fragTemplate;i=(i=i.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Program(this.vertexSrc,i)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[t]};return new Shader(this.programCache[t],n)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(vTextureId < "+r+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),BatchGeometry=function(t){function e(e){void 0===e&&(e=!1);var r=t.call(this)||this;return r._buffer=new Buffer(null,e,!1),r._indexBuffer=new Buffer(null,e,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,TYPES$1.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,TYPES$1.FLOAT).addAttribute("aColor",r._buffer,4,!0,TYPES$1.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,TYPES$1.FLOAT).addIndex(r._indexBuffer),r}return __extends$2(e,t),e}(Geometry),defaultVertex$3="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",defaultFragment$2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",BatchPluginFactory=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:defaultVertex$3,fragment:defaultFragment$2,geometryClass:BatchGeometry,vertexSize:6},t),r=e.vertex,i=e.fragment,n=e.vertexSize,s=e.geometryClass;return function(t){function e(e){var a=t.call(this,e)||this;return a.shaderGenerator=new BatchShaderGenerator(r,i),a.geometryClass=s,a.vertexSize=n,a}return __extends$2(e,t),e}(AbstractBatchRenderer)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),t}(),BatchRenderer=BatchPluginFactory.create(),resources={},_loop_1=function(t){Object.defineProperty(resources,t,{get:function(){return deprecation("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),_resources[t]}})};for(var name in _resources)_loop_1(name);var systems={},_loop_2=function(t){Object.defineProperty(systems,t,{get:function(){return deprecation("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),_systems[t]}})};for(var name in _systems)_loop_2(name);
/*!
   * @pixi/app - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/app is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */var Application=function(){function t(e){var r=this;this.stage=new Container,e=Object.assign({forceCanvas:!1},e),this.renderer=autoDetectRenderer(e),t._plugins.forEach((function(t){t.init.call(r,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,r){var i=this,n=t._plugins.slice(0);n.reverse(),n.forEach((function(t){t.destroy.call(i)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}(),ResizePlugin=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){self.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,r;if(e.cancelResize(),e._resizeTo===self)t=self.innerWidth,r=self.innerHeight;else{var i=e._resizeTo;t=i.clientWidth,r=i.clientHeight}e.renderer.resize(t,r)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();Application.registerPlugin(ResizePlugin);
/*!
   * @pixi/extract - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/extract is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var TEMP_RECT=new Rectangle$1,BYTES_PER_PIXEL=4,Extract=function(){function t(t){this.renderer=t}return t.prototype.image=function(t,e,r){var i=new Image;return i.src=this.base64(t,e,r),i},t.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},t.prototype.canvas=function(e){var r,i,n,s=this.renderer,a=!1,o=!1;e&&(e instanceof RenderTexture?n=e:(n=this.renderer.generateTexture(e),o=!0)),n?(r=n.baseTexture.resolution,i=n.frame,a=!1,s.renderTexture.bind(n)):(r=this.renderer.resolution,a=!0,(i=TEMP_RECT).width=this.renderer.width,i.height=this.renderer.height,s.renderTexture.bind(null));var h=Math.floor(i.width*r+1e-4),l=Math.floor(i.height*r+1e-4),u=new CanvasRenderTarget(h,l,1),c=new Uint8Array(BYTES_PER_PIXEL*h*l),d=s.gl;d.readPixels(i.x*r,i.y*r,h,l,d.RGBA,d.UNSIGNED_BYTE,c);var f=u.context.getImageData(0,0,h,l);if(t.arrayPostDivide(c,f.data),u.context.putImageData(f,0,0),a){var p=new CanvasRenderTarget(u.width,u.height,1);p.context.scale(1,-1),p.context.drawImage(u.canvas,0,-l),u.destroy(),u=p}return o&&n.destroy(!0),u.canvas},t.prototype.pixels=function(e){var r,i,n,s=this.renderer,a=!1;e&&(e instanceof RenderTexture?n=e:(n=this.renderer.generateTexture(e),a=!0)),n?(r=n.baseTexture.resolution,i=n.frame,s.renderTexture.bind(n)):(r=s.resolution,(i=TEMP_RECT).width=s.width,i.height=s.height,s.renderTexture.bind(null));var o=i.width*r,h=i.height*r,l=new Uint8Array(BYTES_PER_PIXEL*o*h),u=s.gl;return u.readPixels(i.x*r,i.y*r,o,h,u.RGBA,u.UNSIGNED_BYTE,l),a&&n.destroy(!0),t.arrayPostDivide(l,l),l},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(t,e){for(var r=0;r<t.length;r+=4){var i=e[r+3]=t[r+3];0!==i?(e[r]=Math.round(Math.min(255*t[r]/i,255)),e[r+1]=Math.round(Math.min(255*t[r+1]/i,255)),e[r+2]=Math.round(Math.min(255*t[r+2]/i,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}},t}();function parseURI(t,e){if(t){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=r.parser[e.strictMode?"strict":"loose"].exec(t),n={},s=14;s--;)n[r.key[s]]=i[s]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,(function(t,e,i){e&&(n[r.q.name][e]=i)})),n}}var parseUri=parseURI,miniSignals=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e,r,n){void 0===r&&(r=!1),i(this,t),this._fn=e,this._once=r,this._thisArg=n,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function s(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var a=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var r=[];e;)r.push(e),e=e._next;return r}},{key:"has",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return s(this,new n(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return s(this,new n(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();a.MiniSignalBinding=n,e.default=a,t.exports=e.default})),Signal=unwrapExports(miniSignals);
/*!
   * resource-loader - v3.0.1
   * https://github.com/pixijs/pixi-sound
   * Compiled Tue, 02 Jul 2019 14:06:18 UTC
   *
   * resource-loader is licensed under the MIT license.
   * http://www.opensource.org/licenses/mit-license
   */
function _noop(){}function eachSeries(t,e,r,i){var n=0,s=t.length;!function a(o){o||n===s?r&&r(o):i?setTimeout((function(){e(t[n++],a)}),1):e(t[n++],a)}()}function onlyOnce(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function queue(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=0,i={_tasks:[],concurrency:e,saturated:_noop,unsaturated:_noop,buffer:e/4,empty:_noop,drain:_noop,error:_noop,started:!1,paused:!1,push:function(t,e){n(t,!1,e)},kill:function(){r=0,i.drain=_noop,i.started=!1,i._tasks=[]},unshift:function(t,e){n(t,!0,e)},process:function(){for(;!i.paused&&r<i.concurrency&&i._tasks.length;){var e=i._tasks.shift();0===i._tasks.length&&i.empty(),(r+=1)===i.concurrency&&i.saturated(),t(e.data,onlyOnce(s(e)))}},length:function(){return i._tasks.length},running:function(){return r},idle:function(){return i._tasks.length+r===0},pause:function(){!0!==i.paused&&(i.paused=!0)},resume:function(){if(!1!==i.paused){i.paused=!1;for(var t=1;t<=i.concurrency;t++)i.process()}}};function n(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(i.started=!0,null==t&&i.idle())setTimeout((function(){return i.drain()}),1);else{var n={data:t,callback:"function"==typeof r?r:_noop};e?i._tasks.unshift(n):i._tasks.push(n),setTimeout((function(){return i.process()}),1)}}function s(t){return function(){r-=1,t.callback.apply(t,arguments),null!=arguments[0]&&i.error(arguments[0],t.data),r<=i.concurrency-i.buffer&&i.unsaturated(),i.idle()&&i.drain(),i.process()}}return i}var cache={};function caching(t,e){var r=this;cache[t.url]?(t.data=cache[t.url],t.complete()):t.onComplete.once((function(){return cache[r.url]=r.data})),e()}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var useXdr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),tempAnchor$1=null,STATUS_NONE=0,STATUS_OK=200,STATUS_EMPTY=204,STATUS_IE_BUG_EMPTY=1223,STATUS_TYPE_OK=2;function _noop$1(){}var Resource$1=function(){function t(e,r,i){if("string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Signal,this.onProgress=new Signal,this.onComplete=new Signal,this.onAfterMiddleware=new Signal}t.setExtensionLoadType=function(e,r){setExtMap(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){setExtMap(t._xhrTypeMap,e,r)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(r)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else{var i=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(i)?i[0]:i))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var i=document.createElement("source");return i.src=e,i.type=r,i},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(reqType(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(reqType(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(reqType(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,r="",i=void 0===e.status?STATUS_OK:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(r=e.responseText),i===STATUS_NONE&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?i=STATUS_OK:i===STATUS_IE_BUG_EMPTY&&(i=STATUS_EMPTY),(i/100|0)===STATUS_TYPE_OK){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var n=new DOMParser;this.data=n.parseFromString(r,"text/xml")}else{var s=document.createElement("div");s.innerHTML=r,this.data=s}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,tempAnchor$1||(tempAnchor$1=document.createElement("a")),tempAnchor$1.href=t;var r=!(t=parseUri(tempAnchor$1.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,i=t.protocol?t.protocol+":":"";return t.host===e.hostname&&r&&i===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var i=t.indexOf("?"),n=t.indexOf("#"),s=Math.min(i>-1?i:t.length,n>-1?n:t.length);e=(t=t.substring(0,s)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},_createClass(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function setExtMap(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function reqType(t){return t.toString().replace("object ","")}Resource$1.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Resource$1.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Resource$1.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Resource$1.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Resource$1._loadTypeMap={gif:Resource$1.LOAD_TYPE.IMAGE,png:Resource$1.LOAD_TYPE.IMAGE,bmp:Resource$1.LOAD_TYPE.IMAGE,jpg:Resource$1.LOAD_TYPE.IMAGE,jpeg:Resource$1.LOAD_TYPE.IMAGE,tif:Resource$1.LOAD_TYPE.IMAGE,tiff:Resource$1.LOAD_TYPE.IMAGE,webp:Resource$1.LOAD_TYPE.IMAGE,tga:Resource$1.LOAD_TYPE.IMAGE,svg:Resource$1.LOAD_TYPE.IMAGE,"svg+xml":Resource$1.LOAD_TYPE.IMAGE,mp3:Resource$1.LOAD_TYPE.AUDIO,ogg:Resource$1.LOAD_TYPE.AUDIO,wav:Resource$1.LOAD_TYPE.AUDIO,mp4:Resource$1.LOAD_TYPE.VIDEO,webm:Resource$1.LOAD_TYPE.VIDEO},Resource$1._xhrTypeMap={xhtml:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource$1.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource$1.XHR_RESPONSE_TYPE.BLOB,png:Resource$1.XHR_RESPONSE_TYPE.BLOB,bmp:Resource$1.XHR_RESPONSE_TYPE.BLOB,jpg:Resource$1.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource$1.XHR_RESPONSE_TYPE.BLOB,tif:Resource$1.XHR_RESPONSE_TYPE.BLOB,tiff:Resource$1.XHR_RESPONSE_TYPE.BLOB,webp:Resource$1.XHR_RESPONSE_TYPE.BLOB,tga:Resource$1.XHR_RESPONSE_TYPE.BLOB,json:Resource$1.XHR_RESPONSE_TYPE.JSON,text:Resource$1.XHR_RESPONSE_TYPE.TEXT,txt:Resource$1.XHR_RESPONSE_TYPE.TEXT,ttf:Resource$1.XHR_RESPONSE_TYPE.BUFFER,otf:Resource$1.XHR_RESPONSE_TYPE.BUFFER},Resource$1.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(t){for(var e="",r=0;r<t.length;){for(var i=[0,0,0],n=[0,0,0,0],s=0;s<i.length;++s)r<t.length?i[s]=255&t.charCodeAt(r++):i[s]=0;switch(n[0]=i[0]>>2,n[1]=(3&i[0])<<4|i[1]>>4,n[2]=(15&i[1])<<2|i[2]>>6,n[3]=63&i[2],r-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(var a=0;a<n.length;++a)e+=_keyStr.charAt(n[a])}return e}var Url$1=window.URL||window.webkitURL;function parsing(t,e){if(t.data){if(t.xhr&&t.xhrType===Resource$1.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=Url$1.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=r,t.type=Resource$1.TYPE.IMAGE,void(t.data.onload=function(){Url$1.revokeObjectURL(r),t.data.onload=null,e()})}}else{var i=t.xhr.getResponseHeader("content-type");if(i&&0===i.indexOf("image"))return t.data=new Image,t.data.src="data:"+i+";base64,"+encodeBinary(t.xhr.responseText),t.type=Resource$1.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}var index$3={caching:caching,parsing:parsing},MAX_PROGRESS=100,rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function t(e,r){var i=this;void 0===e&&(e=""),void 0===r&&(r=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this._queue=queue(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Signal,this.onError=new Signal,this.onLoad=new Signal,this.onStart=new Signal,this.onComplete=new Signal;for(var n=0;n<t._defaultBeforeMiddleware.length;++n)this.pre(t._defaultBeforeMiddleware[n]);for(var s=0;s<t._defaultAfterMiddleware.length;++s)this.use(t._defaultAfterMiddleware[s])}var e=t.prototype;return e.add=function(t,e,r,i){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(i=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new Resource$1(t,e,r),"function"==typeof i&&this.resources[t].onAfterMiddleware.once(i),this.loading){for(var s=r.parentResource,a=[],o=0;o<s.children.length;++o)s.children[o].isComplete||a.push(s.children[o]);var h=s.progressChunk*(a.length+1)/(a.length+2);s.children.push(this.resources[t]),s.progressChunk=h;for(var l=0;l<a.length;++l)a[l].progressChunk=h;this.resources[t].progressChunk=h}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=this._queue._tasks.length,r=MAX_PROGRESS/e,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,r=parseUri(t,{strictMode:!0});if(e=r.protocol||!r.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var i=rgxExtractUrlHash.exec(e)[0];-1!==(e=e.substr(0,e.length-i.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=i}return e},e._loadResource=function(t,e){var r=this;t._dequeue=e,eachSeries(this._beforeMiddleware,(function(e,i){e.call(r,t,(function(){i(t.isComplete?{}:null)}))}),(function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=MAX_PROGRESS,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),eachSeries(this._afterMiddleware,(function(r,i){r.call(e,t,i)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(MAX_PROGRESS,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},_createClass(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();Loader._defaultBeforeMiddleware=[],Loader._defaultAfterMiddleware=[],Loader.pre=function(t){return Loader._defaultBeforeMiddleware.push(t),Loader},Loader.use=function(t){return Loader._defaultAfterMiddleware.push(t),Loader};
/*!
   * @pixi/loaders - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/loaders is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var extendStatics$3=function(t,e){return(extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$3(t,e){function r(){this.constructor=t}extendStatics$3(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var TextureLoader=function(){function t(){}return t.add=function(){Resource$1.setExtensionLoadType("svg",Resource$1.LOAD_TYPE.XHR),Resource$1.setExtensionXhrType("svg",Resource$1.XHR_RESPONSE_TYPE.TEXT)},t.use=function(t,e){if(!t.data||t.type!==Resource$1.TYPE.IMAGE&&"svg"!==t.extension)e();else{var r=t.data,i=t.url,n=t.name,s=t.metadata;Texture.fromLoader(r,i,n,s).then((function(r){t.texture=r,e()})).catch(e)}},t}(),Loader$1=function(t){function e(r,i){for(var n=t.call(this,r,i)||this,s=0;s<e._plugins.length;++s){var a=e._plugins[s],o=a.pre,h=a.use;o&&n.pre(o),h&&n.use(h)}return n._protected=!1,n}return __extends$3(e,t),e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e}(Loader);Loader$1.registerPlugin({use:index$3.parsing}),Loader$1.registerPlugin(TextureLoader);var AppLoaderPlugin=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Loader$1.shared:new Loader$1},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),LoaderResource=Resource$1,_a,INTERNAL_FORMATS;!function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(INTERNAL_FORMATS||(INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=(_a={},_a[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a),extendStatics$4=function(t,e){return(extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function __extends$4(t,e){function r(){this.constructor=t}extendStatics$4(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function __awaiter(t,e,r,i){return new(r||(r=Promise))((function(n,s){function a(t){try{h(i.next(t))}catch(t){s(t)}}function o(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){t.done?n(t.value):new r((function(e){e(t.value)})).then(a,o)}h((i=i.apply(t,e||[])).next())}))}function __generator(t,e){var r,i,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}var BlobResource=function(t){function e(e,r){void 0===r&&(r={width:1,height:1,autoLoad:!0});var i,n,s=this;return"string"==typeof e?(i=e,n=new Uint8Array):(i=null,n=e),(s=t.call(this,n,r)||this).origin=i,s.buffer=n?new ViewableBuffer(n):null,s.origin&&!1!==r.autoLoad&&s.load(),n&&n.length&&(s.loaded=!0,s.onBlobLoaded(s.buffer.rawBinaryData)),s}return __extends$4(e,t),e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return[4,fetch(this.origin)];case 1:return[4,e.sent().blob()];case 2:return[4,e.sent().arrayBuffer()];case 3:return t=e.sent(),this.data=new Uint32Array(t),this.buffer=new ViewableBuffer(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),[2,this]}}))}))},e}(BufferResource),CompressedTextureResource=function(t){function e(r,i){var n=t.call(this,r,i)||this;return n.format=i.format,n.levels=i.levels||1,n._width=i.width,n._height=i.height,n._extension=e._formatToExtension(n.format),(i.levelBuffers||n.buffer)&&(n._levelBuffers=i.levelBuffers||e._createLevelBuffers(r instanceof Uint8Array?r:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return __extends$4(e,t),e.prototype.upload=function(t,e,r){var i=t.gl;if(!t.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var n=0,s=this.levels;n<s;n++){var a=this._levelBuffers[n],o=a.levelID,h=a.levelWidth,l=a.levelHeight,u=a.levelBuffer;i.compressedTexImage2D(i.TEXTURE_2D,o,this.format,h,l,0,u)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,e,r,i,n,s,a){for(var o=new Array(r),h=t.byteOffset,l=s,u=a,c=l+i-1&~(i-1),d=u+n-1&~(n-1),f=c*d*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[e],p=0;p<r;p++)o[p]={levelID:p,levelWidth:r>1?l:c,levelHeight:r>1?u:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,f=(c=(l=l>>1||1)+i-1&~(i-1))*(d=(u=u>>1||1)+n-1&~(n-1))*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[e];return o},e}(BlobResource),CompressedTextureLoader=function(){function t(){}return t.use=function(e,r){var i=e.data;if(e.type===LoaderResource.TYPE.JSON&&i&&i.cacheID&&i.textures){for(var n=i.textures,s=void 0,a=void 0,o=0,h=n.length;o<h;o++){var l=n[o],u=l.src,c=l.format;if(c||(a=u),t.textureFormats[c]){s=u;break}}if(!(s=s||a))return void r(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));if(s===e.url)return void r(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},f=url.resolve(e.url.replace(this.baseUrl,""),s),p=i.cacheID;this.add(p,f,d,(function(t){if(t.error)r(t.error);else{var i=t.texture,n=void 0===i?null:i,s=t.textures,a=void 0===s?{}:s;Object.assign(e,{texture:n,textures:a}),r()}}))}else r()},t.add=function(){var e=document.createElement("canvas").getContext("webgl");if(e){var r={s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};for(var i in t.textureExtensions=r,t.textureFormats={},r){var n=r[i];n&&Object.assign(t.textureFormats,Object.getPrototypeOf(n))}}else console.error("WebGL not available for compressed textures. Silently failing.")},t}(),_a$1,_b;function registerCompressedTextures(t,e,r){var i={textures:{},texture:null};return e?(e.map((function(t){return new Texture(new BaseTexture(t,Object.assign({mipmap:MIPMAP_MODES$1.OFF,alphaMode:ALPHA_MODES$1.NO_PREMULTIPLIED_ALPHA},r)))})).forEach((function(e,r){var n=e.baseTexture,s=t+"-"+(r+1);BaseTexture.addToCache(n,s),Texture.addToCache(e,s),0===r&&(BaseTexture.addToCache(n,t),Texture.addToCache(e,t),i.texture=e),i.textures[s]=e})),i):i}LoaderResource.setExtensionXhrType("dds",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},DXGI_FORMAT,D3D10_RESOURCE_DIMENSION;!function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(DXGI_FORMAT||(DXGI_FORMAT={})),function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=(_a$1={},_a$1[FOURCC_DXT1]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=(_b={},_b[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b),DDSLoader=function(){function t(){}return t.use=function(e,r){if("dds"===e.extension&&e.data)try{Object.assign(e,registerCompressedTextures(e.name||e.url,t.parse(e.data),e.metadata))}catch(t){return void r(t)}r()},t.parse=function(t){var e=new Uint32Array(t);if(e[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var r=new Uint32Array(t,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),i=r[DDS_FIELDS.HEIGHT],n=r[DDS_FIELDS.WIDTH],s=r[DDS_FIELDS.MIPMAP_COUNT],a=new Uint32Array(t,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),o=a[PF_FLAGS];if(o&DDPF_FOURCC){var h=a[DDS_PF_FIELDS.FOURCC];if(h!==FOURCC_DX10){var l=FOURCC_TO_FORMAT[h],u=new Uint8Array(t,DDS_MAGIC_SIZE+DDS_HEADER_SIZE);return[new CompressedTextureResource(u,{format:l,width:n,height:i,levels:s})]}var c=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,d=new Uint32Array(e.buffer,c,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),f=d[DDS_DX10_FIELDS.DXGI_FORMAT],p=d[DDS_DX10_FIELDS.RESOURCE_DIMENSION],_=d[DDS_DX10_FIELDS.MISC_FLAG],g=d[DDS_DX10_FIELDS.ARRAY_SIZE],m=DXGI_TO_FORMAT[f];if(void 0===m)throw new Error("DDSLoader cannot parse texture data with DXGI format "+f);if(_===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSLoader does not support cubemap textures");if(p===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var y=new Array,v=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(1===g)y.push(new Uint8Array(t,v));else{for(var b=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[m],x=0,T=n,E=i,S=0;S<s;S++){x+=Math.max(1,T+3&-4)*Math.max(1,E+3&-4)*b,T>>>=1,E>>>=1}var A=v;for(S=0;S<g;S++)y.push(new Uint8Array(t,A,x)),A+=x}return y.map((function(t){return new CompressedTextureResource(t,{format:m,width:n,height:i,levels:s})}))}if(o&DDPF_RGB)throw new Error("DDSLoader does not support uncompressed texture data.");if(o&DDPF_YUV)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(o&DDPF_LUMINANCE)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(o&DDPF_ALPHA)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},t}(),_a$2,_b$1,_c;LoaderResource.setExtensionXhrType("ktx",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=(_a$2={},_a$2[TYPES$1.UNSIGNED_BYTE]=1,_a$2[TYPES$1.UNSIGNED_SHORT]=2,_a$2[TYPES$1.FLOAT]=4,_a$2[TYPES$1.HALF_FLOAT]=8,_a$2),FORMATS_TO_COMPONENTS=(_b$1={},_b$1[FORMATS$1.RGBA]=4,_b$1[FORMATS$1.RGB]=3,_b$1[FORMATS$1.LUMINANCE]=1,_b$1[FORMATS$1.LUMINANCE_ALPHA]=2,_b$1[FORMATS$1.ALPHA]=1,_b$1),TYPES_TO_BYTES_PER_PIXEL=(_c={},_c[TYPES$1.UNSIGNED_SHORT_4_4_4_4]=2,_c[TYPES$1.UNSIGNED_SHORT_5_5_5_1]=2,_c[TYPES$1.UNSIGNED_SHORT_5_6_5]=2,_c),KTXLoader=function(){function t(){}return t.use=function(e,r){if("ktx"===e.extension&&e.data)try{var i=e.name||e.url;Object.assign(e,registerCompressedTextures(i,t.parse(i,e.data),e.metadata))}catch(t){return void r(t)}r()},t.parse=function(e,r){var i=new DataView(r);if(!t.validate(e,i))return null;var n=i.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,s=i.getUint32(KTX_FIELDS.GL_TYPE,n),a=i.getUint32(KTX_FIELDS.GL_FORMAT,n),o=i.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,n),h=i.getUint32(KTX_FIELDS.PIXEL_WIDTH,n),l=i.getUint32(KTX_FIELDS.PIXEL_HEIGHT,n)||1,u=i.getUint32(KTX_FIELDS.PIXEL_DEPTH,n)||1,c=i.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(KTX_FIELDS.NUMBER_OF_FACES,n),f=i.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,n),p=i.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,n);if(0===l||1!==u)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");var _,g=h+3&-4,m=l+3&-4,y=new Array(c),v=h*l;if(0===s&&(v=g*m),void 0===(_=0!==s?TYPES_TO_BYTES_PER_COMPONENT[s]?TYPES_TO_BYTES_PER_COMPONENT[s]*FORMATS_TO_COMPONENTS[a]:TYPES_TO_BYTES_PER_PIXEL[s]:INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[o]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var b=v*_,x=h,T=l,E=g,S=m,A=FILE_HEADER_SIZE+p,R=0;R<f;R++){for(var w=i.getUint32(A,n),O=A+4,P=0;P<c;P++){var I=y[P];I||(I=y[P]=new Array(f)),I[R]={levelID:R,levelWidth:f>1?x:E,levelHeight:f>1?T:S,levelBuffer:new Uint8Array(r,O,b)},O+=b}A=(A+=w+4)%4!=0?A+4-A%4:A,b=(E=(x=x>>1||1)+4-1&-4)*(S=(T=T>>1||1)+4-1&-4)*_}if(0!==s)throw new Error("TODO: Uncompressed");return y.map((function(t){return new CompressedTextureResource(null,{format:o,width:h,height:l,levels:f,levelBuffers:t})}))},t.validate=function(t,e){for(var r=0;r<FILE_IDENTIFIER.length;r++)if(e.getUint8(r)!==FILE_IDENTIFIER[r])return console.error(t+" is not a valid *.ktx file!"),!1;return!0},t}(),extendStatics$5=function(t,e){return(extendStatics$5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$5(t,e){function r(){this.constructor=t}extendStatics$5(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ParticleContainer=function(t){function e(e,r,i,n){void 0===e&&(e=1500),void 0===i&&(i=16384),void 0===n&&(n=!1);var s=t.call(this)||this;return i>16384&&(i=16384),s._properties=[!1,!0,!1,!1,!1],s._maxSize=e,s._batchSize=i,s._buffers=null,s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=BLEND_MODES$1.NORMAL,s.autoResize=n,s.roundPixels=!0,s.baseTexture=null,s.setProperties(r),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return __extends$5(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,hex2rgb(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e}(Container),ParticleBuffer=function(){function t(t,e,r){this.geometry=new Geometry,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<t.length;++i){var n=t[i];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||TYPES$1.FLOAT,offset:n.offset},e[i]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){(a=this.dynamicProperties[r]).offset=e,e+=a.size,this.dynamicStride+=a.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);var n=0;this.staticStride=0;for(r=0;r<this.staticProperties.length;++r){(a=this.staticProperties[r]).offset=n,n+=a.size,this.staticStride+=a.size}var s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(r=0;r<this.dynamicProperties.length;++r){var a=this.dynamicProperties[r];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===TYPES$1.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(r=0;r<this.staticProperties.length;++r){a=this.staticProperties[r];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===TYPES$1.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}},t.prototype.uploadDynamic=function(t,e,r){for(var i=0;i<this.dynamicProperties.length;i++){var n=this.dynamicProperties[i];n.uploadFunction(t,e,r,n.type===TYPES$1.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(t,e,r){for(var i=0;i<this.staticProperties.length;i++){var n=this.staticProperties[i];n.uploadFunction(t,e,r,n.type===TYPES$1.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),fragment$1="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",vertex$1="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n",ParticleRenderer=function(t){function e(e){var r=t.call(this,e)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Matrix,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES$1.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=Shader.from(vertex$1,fragment$1,{}),r.state=State.for2d(),r}return __extends$5(e,t),e.prototype.render=function(t){var e=t.children,r=t._maxSize,i=t._batchSize,n=this.renderer,s=e.length;if(0!==s){s>r&&!t.autoResize&&(s=r);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var o=e[0]._texture.baseTexture;this.state.blendMode=correctBlendMode(t.blendMode,o.alphaMode),n.state.set(this.state);var h=n.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,o.alphaMode),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);for(var u=!1,c=0,d=0;c<s;c+=i,d+=1){var f=s-c;f>i&&(f=i),d>=a.length&&a.push(this._generateOneMoreBuffer(t));var p=a[d];p.uploadDynamic(e,c,f);var _=t._bufferUpdateIDs[d]||0;(u=u||p._updateID<_)&&(p._updateID=t._updateID,p.uploadStatic(e,c,f)),n.geometry.bind(p.geometry),h.drawElements(h.TRIANGLES,6*f,h.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],r=t._maxSize,i=t._batchSize,n=t._properties,s=0;s<r;s+=i)e.push(new ParticleBuffer(this.properties,n,i));return e},e.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,r=t._properties;return new ParticleBuffer(this.properties,r,e)},e.prototype.uploadVertices=function(t,e,r,i,n,s){for(var a=0,o=0,h=0,l=0,u=0;u<r;++u){var c=t[e+u],d=c._texture,f=c.scale.x,p=c.scale.y,_=d.trim,g=d.orig;_?(a=(o=_.x-c.anchor.x*g.width)+_.width,h=(l=_.y-c.anchor.y*g.height)+_.height):(a=g.width*(1-c.anchor.x),o=g.width*-c.anchor.x,h=g.height*(1-c.anchor.y),l=g.height*-c.anchor.y),i[s]=o*f,i[s+1]=l*p,i[s+n]=a*f,i[s+n+1]=l*p,i[s+2*n]=a*f,i[s+2*n+1]=h*p,i[s+3*n]=o*f,i[s+3*n+1]=h*p,s+=4*n}},e.prototype.uploadPosition=function(t,e,r,i,n,s){for(var a=0;a<r;a++){var o=t[e+a].position;i[s]=o.x,i[s+1]=o.y,i[s+n]=o.x,i[s+n+1]=o.y,i[s+2*n]=o.x,i[s+2*n+1]=o.y,i[s+3*n]=o.x,i[s+3*n+1]=o.y,s+=4*n}},e.prototype.uploadRotation=function(t,e,r,i,n,s){for(var a=0;a<r;a++){var o=t[e+a].rotation;i[s]=o,i[s+n]=o,i[s+2*n]=o,i[s+3*n]=o,s+=4*n}},e.prototype.uploadUvs=function(t,e,r,i,n,s){for(var a=0;a<r;++a){var o=t[e+a]._texture._uvs;o?(i[s]=o.x0,i[s+1]=o.y0,i[s+n]=o.x1,i[s+n+1]=o.y1,i[s+2*n]=o.x2,i[s+2*n+1]=o.y2,i[s+3*n]=o.x3,i[s+3*n+1]=o.y3,s+=4*n):(i[s]=0,i[s+1]=0,i[s+n]=0,i[s+n+1]=0,i[s+2*n]=0,i[s+2*n+1]=0,i[s+3*n]=0,i[s+3*n+1]=0,s+=4*n)}},e.prototype.uploadTint=function(t,e,r,i,n,s){for(var a=0;a<r;++a){var o=t[e+a],h=o._texture.baseTexture.alphaMode>0,l=o.alpha,u=l<1&&h?premultiplyTint(o._tintRGB,l):o._tintRGB+(255*l<<24);i[s]=u,i[s+n]=u,i[s+2*n]=u,i[s+3*n]=u,s+=4*n}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(ObjectRenderer),LINE_JOIN,LINE_CAP;!function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"}(LINE_JOIN||(LINE_JOIN={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(LINE_CAP||(LINE_CAP={}));var GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},FillStyle=function(){function t(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),extendStatics$6=function(t,e){return(extendStatics$6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$6(t,e){function r(){this.constructor=t}extendStatics$6(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var buildPoly={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var r=t.points,i=t.holes,n=e.points,s=e.indices;if(r.length>=6){for(var a=[],o=0;o<i.length;o++){var h=i[o];a.push(r.length/2),r=r.concat(h.points)}var l=earcut_1(r,a,2);if(!l)return;var u=n.length/2;for(o=0;o<l.length;o+=3)s.push(l[o]+u),s.push(l[o+1]+u),s.push(l[o+2]+u);for(o=0;o<r.length;o++)n.push(r[o])}}},buildCircle={build:function(t){var e,r,i=t.shape,n=t.points,s=i.x,a=i.y;if(n.length=0,t.type===SHAPES.CIRC)e=i.radius,r=i.radius;else{var o=t.shape;e=o.width,r=o.height}if(0!==e&&0!==r){var h=Math.floor(30*Math.sqrt(i.radius))||Math.floor(15*Math.sqrt(e+r));h/=2.3;for(var l=2*Math.PI/h,u=0;u<h-.5;u++)n.push(s+Math.sin(-l*u)*e,a+Math.cos(-l*u)*r);n.push(n[0],n[1])}},triangulate:function(t,e){var r=t.points,i=e.points,n=e.indices,s=i.length/2,a=s,o=t.shape,h=t.matrix,l=o.x,u=o.y;i.push(t.matrix?h.a*l+h.c*u+h.tx:l,t.matrix?h.b*l+h.d*u+h.ty:u);for(var c=0;c<r.length;c+=2)i.push(r[c],r[c+1]),n.push(s++,a,s)}},buildRectangle={build:function(t){var e=t.shape,r=e.x,i=e.y,n=e.width,s=e.height,a=t.points;a.length=0,a.push(r,i,r+n,i,r+n,i+s,r,i+s)},triangulate:function(t,e){var r=t.points,i=e.points,n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function getPt(t,e,r){return t+(e-t)*r}function quadraticBezierCurve(t,e,r,i,n,s,a){void 0===a&&(a=[]);for(var o=a,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0;p<=20;++p)h=getPt(t,r,_=p/20),l=getPt(e,i,_),u=getPt(r,n,_),c=getPt(i,s,_),d=getPt(h,u,_),f=getPt(l,c,_),o.push(d,f);return o}var buildRoundedRectangle={build:function(t){var e=t.shape,r=t.points,i=e.x,n=e.y,s=e.width,a=e.height,o=Math.max(0,Math.min(e.radius,Math.min(s,a)/2));r.length=0,o?(quadraticBezierCurve(i,n+o,i,n,i+o,n,r),quadraticBezierCurve(i+s-o,n,i+s,n,i+s,n+o,r),quadraticBezierCurve(i+s,n+a-o,i+s,n+a,i+s-o,n+a,r),quadraticBezierCurve(i+o,n+a,i,n+a,i,n+a-o,r)):r.push(i,n,i+s,n,i+s,n+a,i,n+a)},triangulate:function(t,e){for(var r=t.points,i=e.points,n=e.indices,s=i.length/2,a=earcut_1(r,null,2),o=0,h=a.length;o<h;o+=3)n.push(a[o]+s),n.push(a[o+1]+s),n.push(a[o+2]+s);for(o=0,h=r.length;o<h;o++)i.push(r[o],r[++o])}};function square(t,e,r,i,n,s,a,o){var h,l;a?(h=i,l=-r):(h=-i,l=r);var u=t-r*n+h,c=e-i*n+l,d=t+r*s+h,f=e+i*s+l;return o.push(u,c),o.push(d,f),2}function round(t,e,r,i,n,s,a,o){var h=r-t,l=i-e,u=Math.atan2(h,l),c=Math.atan2(n-t,s-e);o&&u<c?u+=2*Math.PI:!o&&u>c&&(c+=2*Math.PI);var d=u,f=c-u,p=Math.abs(f),_=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(_)/Math.PI>>0),m=f/g;if(d+=m,o){a.push(t,e),a.push(r,i);for(var y=1,v=d;y<g;y++,v+=m)a.push(t,e),a.push(t+Math.sin(v)*_,e+Math.cos(v)*_);a.push(t,e),a.push(n,s)}else{a.push(r,i),a.push(t,e);for(y=1,v=d;y<g;y++,v+=m)a.push(t+Math.sin(v)*_,e+Math.cos(v)*_),a.push(t,e);a.push(n,s),a.push(t,e)}return 2*g}function buildNonNativeLine(t,e){var r=t.shape,i=t.points||r.points.slice(),n=e.closePointEps;if(0!==i.length){var s=t.lineStyle,a=new Point$2(i[0],i[1]),o=new Point$2(i[i.length-2],i[i.length-1]),h=r.type!==SHAPES.POLY||r.closeStroke,l=Math.abs(a.x-o.x)<n&&Math.abs(a.y-o.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));var u=.5*(a.x+o.x),c=.5*(o.y+a.y);i.unshift(u,c),i.push(u,c)}var d=e.points,f=i.length/2,p=i.length,_=d.length/2,g=s.width/2,m=g*g,y=s.miterLimit*s.miterLimit,v=i[0],b=i[1],x=i[2],T=i[3],E=0,S=0,A=-(b-T),R=v-x,w=0,O=0,P=Math.sqrt(A*A+R*R);A/=P,R/=P,A*=g,R*=g;var I=s.alignment,M=2*(1-I),C=2*I;h||(s.cap===LINE_CAP.ROUND?p+=round(v-A*(M-C)*.5,b-R*(M-C)*.5,v-A*M,b-R*M,v+A*C,b+R*C,d,!0)+2:s.cap===LINE_CAP.SQUARE&&(p+=square(v,b,A,R,M,C,!0,d))),d.push(v-A*M,b-R*M),d.push(v+A*C,b+R*C);for(var D=1;D<f-1;++D){v=i[2*(D-1)],b=i[2*(D-1)+1],x=i[2*D],T=i[2*D+1],E=i[2*(D+1)],S=i[2*(D+1)+1],A=-(b-T),R=v-x,A/=P=Math.sqrt(A*A+R*R),R/=P,A*=g,R*=g,w=-(T-S),O=x-E,w/=P=Math.sqrt(w*w+O*O),O/=P,w*=g,O*=g;var N=x-v,L=b-T,F=x-E,k=S-T,B=L*F-k*N,U=B<0;if(Math.abs(B)<.1)d.push(x-A*M,T-R*M),d.push(x+A*C,T+R*C);else{var G=(-A+v)*(-R+T)-(-A+x)*(-R+b),$=(-w+E)*(-O+T)-(-w+x)*(-O+S),X=(N*$-F*G)/B,H=(k*G-L*$)/B,V=(X-x)*(X-x)+(H-T)*(H-T),Y=x+(X-x)*M,j=T+(H-T)*M,z=x-(X-x)*C,W=T-(H-T)*C,q=U?M:C;V<=Math.min(N*N+L*L,F*F+k*k)+q*q*m?s.join===LINE_JOIN.BEVEL||V/m>y?(U?(d.push(Y,j),d.push(x+A*C,T+R*C),d.push(Y,j),d.push(x+w*C,T+O*C)):(d.push(x-A*M,T-R*M),d.push(z,W),d.push(x-w*M,T-O*M),d.push(z,W)),p+=2):s.join===LINE_JOIN.ROUND?U?(d.push(Y,j),d.push(x+A*C,T+R*C),p+=round(x,T,x+A*C,T+R*C,x+w*C,T+O*C,d,!0)+4,d.push(Y,j),d.push(x+w*C,T+O*C)):(d.push(x-A*M,T-R*M),d.push(z,W),p+=round(x,T,x-A*M,T-R*M,x-w*M,T-O*M,d,!1)+4,d.push(x-w*M,T-O*M),d.push(z,W)):(d.push(Y,j),d.push(z,W)):(d.push(x-A*M,T-R*M),d.push(x+A*C,T+R*C),s.join===LINE_JOIN.BEVEL||V/m>y||(s.join===LINE_JOIN.ROUND?p+=U?round(x,T,x+A*C,T+R*C,x+w*C,T+O*C,d,!0)+2:round(x,T,x-A*M,T-R*M,x-w*M,T-O*M,d,!1)+2:(U?(d.push(z,W),d.push(z,W)):(d.push(Y,j),d.push(Y,j)),p+=2)),d.push(x-w*M,T-O*M),d.push(x+w*C,T+O*C),p+=2)}}v=i[2*(f-2)],b=i[2*(f-2)+1],x=i[2*(f-1)],A=-(b-(T=i[2*(f-1)+1])),R=v-x,A/=P=Math.sqrt(A*A+R*R),R/=P,A*=g,R*=g,d.push(x-A*M,T-R*M),d.push(x+A*C,T+R*C),h||(s.cap===LINE_CAP.ROUND?p+=round(x-A*(M-C)*.5,T-R*(M-C)*.5,x-A*M,T-R*M,x+A*C,T+R*C,d,!1)+2:s.cap===LINE_CAP.SQUARE&&(p+=square(x,T,A,R,M,C,!1,d)));var Z=e.indices,K=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon;for(D=_;D<p+_-2;++D)v=d[2*D],b=d[2*D+1],x=d[2*(D+1)],T=d[2*(D+1)+1],E=d[2*(D+2)],S=d[2*(D+2)+1],Math.abs(v*(T-S)+x*(S-b)+E*(b-T))<K||Z.push(D,D+1,D+2)}}function buildNativeLine(t,e){var r=0,i=t.shape,n=t.points||i.points,s=i.type!==SHAPES.POLY||i.closeStroke;if(0!==n.length){var a=e.points,o=e.indices,h=n.length/2,l=a.length/2,u=l;for(a.push(n[0],n[1]),r=1;r<h;r++)a.push(n[2*r],n[2*r+1]),o.push(u,u+1),u++;s&&o.push(u,l)}}function buildLine(t,e){t.lineStyle.native?buildNativeLine(t,e):buildNonNativeLine(t,e)}var ArcUtils=function(){function t(){}return t.curveTo=function(t,e,r,i,n,s){var a=s[s.length-2],o=s[s.length-1]-e,h=a-t,l=i-e,u=r-t,c=Math.abs(o*u-h*l);if(c<1e-8||0===n)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;var d=o*o+h*h,f=l*l+u*u,p=o*l+h*u,_=n*Math.sqrt(d)/c,g=n*Math.sqrt(f)/c,m=_*p/d,y=g*p/f,v=_*u+g*h,b=_*l+g*o,x=h*(g+m),T=o*(g+m),E=u*(_+y),S=l*(_+y);return{cx:v+t,cy:b+e,radius:n,startAngle:Math.atan2(T-b,x-v),endAngle:Math.atan2(S-b,E-v),anticlockwise:h*l>u*o}},t.arc=function(t,e,r,i,n,s,a,o,h){for(var l=a-s,u=GRAPHICS_CURVES._segmentsCount(Math.abs(l)*n,40*Math.ceil(Math.abs(l)/PI_2)),c=l/(2*u),d=2*c,f=Math.cos(c),p=Math.sin(c),_=u-1,g=_%1/_,m=0;m<=_;++m){var y=c+s+d*(m+g*m),v=Math.cos(y),b=-Math.sin(y);h.push((f*v+p*b)*n+r,(f*-b+p*v)*n+i)}},t}(),BezierUtils=function(){function t(){}return t.curveLength=function(t,e,r,i,n,s,a,o){for(var h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,g=0,m=0,y=0,v=t,b=e,x=1;x<=10;++x)m=v-(_=(p=(f=(d=1-(l=x/10))*d)*d)*t+3*f*l*r+3*d*(u=l*l)*n+(c=u*l)*a),y=b-(g=p*e+3*f*l*i+3*d*u*s+c*o),v=_,b=g,h+=Math.sqrt(m*m+y*y);return h},t.curveTo=function(e,r,i,n,s,a,o){var h=o[o.length-2],l=o[o.length-1];o.length-=2;var u=GRAPHICS_CURVES._segmentsCount(t.curveLength(h,l,e,r,i,n,s,a)),c=0,d=0,f=0,p=0,_=0;o.push(h,l);for(var g=1,m=0;g<=u;++g)f=(d=(c=1-(m=g/u))*c)*c,_=(p=m*m)*m,o.push(f*h+3*d*m*e+3*c*p*i+_*s,f*l+3*d*m*r+3*c*p*n+_*a)},t}(),QuadraticUtils=function(){function t(){}return t.curveLength=function(t,e,r,i,n,s){var a=t-2*r+n,o=e-2*i+s,h=2*r-2*t,l=2*i-2*e,u=4*(a*a+o*o),c=4*(a*h+o*l),d=h*h+l*l,f=2*Math.sqrt(u+c+d),p=Math.sqrt(u),_=2*u*p,g=2*Math.sqrt(d),m=c/p;return(_*f+p*c*(f-g)+(4*d*u-c*c)*Math.log((2*p+m+f)/(m+g)))/(4*_)},t.curveTo=function(e,r,i,n,s){for(var a=s[s.length-2],o=s[s.length-1],h=GRAPHICS_CURVES._segmentsCount(t.curveLength(a,o,e,r,i,n)),l=0,u=0,c=1;c<=h;++c){var d=c/h;l=a+(e-a)*d,u=o+(r-o)*d,s.push(l+(e+(i-e)*d-l)*d,u+(r+(n-r)*d-u)*d)}},t}(),BatchPart=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),_a$3,FILL_COMMANDS=(_a$3={},_a$3[SHAPES.POLY]=buildPoly,_a$3[SHAPES.CIRC]=buildCircle,_a$3[SHAPES.ELIP]=buildCircle,_a$3[SHAPES.RECT]=buildRectangle,_a$3[SHAPES.RREC]=buildRoundedRectangle,_a$3),BATCH_POOL=[],DRAW_CALL_POOL=[],GraphicsData=function(){function t(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null),this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=i,this.type=t.type,this.points=[],this.holes=[]}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),tmpPoint=new Point$2,tmpBounds=new Bounds,GraphicsGeometry=function(t){function e(){var e=t.call(this)||this;return e.uvsFloat32=null,e.indicesUint16=null,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.dirty=0,e.batchDirty=-1,e.cacheDirty=-1,e.clearDirty=0,e.drawCalls=[],e.batches=[],e.shapeIndex=0,e._bounds=new Bounds,e.boundsDirty=-1,e.boundsPadding=0,e.batchable=!1,e.indicesUint16=null,e.uvsFloat32=null,e.closePointEps=1e-4,e}return __extends$6(e,t),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),BATCH_POOL.push(e)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null);var n=new GraphicsData(t,e,r,i);return this.graphicsData.push(n),this.dirty++,this},e.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var r=new GraphicsData(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,r=0;r<e.length;++r){var i=e[r];if(i.fillStyle.visible&&(i.shape&&(i.matrix?i.matrix.applyInverse(t,tmpPoint):tmpPoint.copyFrom(t),i.shape.contains(tmpPoint.x,tmpPoint.y)))){var n=!1;if(i.holes)for(var s=0;s<i.holes.length;s++){if(i.holes[s].shape.contains(tmpPoint.x,tmpPoint.y)){n=!0;break}}if(!n)return!0}}return!1},e.prototype.updateBatches=function(t){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,r=this.graphicsData,i=null,n=null;this.batches.length>0&&(n=(i=this.batches[this.batches.length-1]).style);for(var s=this.shapeIndex;s<r.length;s++){this.shapeIndex++;var a=r[s],o=a.fillStyle,h=a.lineStyle;FILL_COMMANDS[a.type].build(a),a.matrix&&this.transformPoints(a.points,a.matrix);for(var l=0;l<2;l++){var u=0===l?o:h;if(u.visible){var c=u.texture.baseTexture,d=this.indices.length,f=this.points.length/2;c.wrapMode=WRAP_MODES$1.REPEAT,0===l?this.processFill(a):this.processLine(a);var p=this.points.length/2-f;0!==p&&(i&&!this._compareStyles(n,u)&&(i.end(d,f),i=null),i||((i=BATCH_POOL.pop()||new BatchPart).begin(u,d,f),this.batches.push(i),n=u),this.addUvs(this.points,e,u.texture,f,p,u.matrix))}}}var _=this.indices.length,g=this.points.length/2;if(i&&i.end(_,g),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var m=g>65535&&t;this.indicesUint16=m?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var r=this.graphicsData[t],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,r=t.length;e<r;e++)for(var i=t[e],n=0;n<i.size;n++){var s=i.start+n;this.indicesUint16[s]=this.indicesUint16[s]-i.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++BaseTexture._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[e]);this.drawCalls.length=0;var r=this.colors,i=this.textureIds,n=DRAW_CALL_POOL.pop();n||((n=new BatchDrawCall).texArray=new BatchTextureArray),n.texArray.count=0,n.start=0,n.size=0,n.type=DRAW_MODES$1.TRIANGLES;var s=0,a=null,o=0,h=!1,l=DRAW_MODES$1.TRIANGLES,u=0;this.drawCalls.push(n);for(e=0;e<this.batches.length;e++){var c=this.batches[e],d=c.style,f=d.texture.baseTexture;h!==!!d.native&&(l=(h=!!d.native)?DRAW_MODES$1.LINES:DRAW_MODES$1.TRIANGLES,a=null,s=8,t++),a!==f&&(a=f,f._batchEnabled!==t&&(8===s&&(t++,s=0,n.size>0&&((n=DRAW_CALL_POOL.pop())||((n=new BatchDrawCall).texArray=new BatchTextureArray),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),f.touched=1,f._batchEnabled=t,f._batchLocation=s,f.wrapMode=WRAP_MODES$1.REPEAT,n.texArray.elements[n.texArray.count++]=f,s++)),n.size+=c.size,u+=c.size,o=f._batchLocation,this.addColors(r,d.color,d.alpha,c.attribSize),this.addTextureIds(i,o,c.attribSize)}BaseTexture._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(3*t.length*4),s=new Float32Array(n),a=new Uint32Array(n),o=0,h=0;h<t.length/2;h++)s[o++]=t[2*h],s[o++]=t[2*h+1],s[o++]=e[2*h],s[o++]=e[2*h+1],a[o++]=r[h],s[o++]=i[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),buildPoly.triangulate(t,this)):FILL_COMMANDS[t.type].triangulate(t,this)},e.prototype.processLine=function(t){buildLine(t,this);for(var e=0;e<t.holes.length;e++)buildLine(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var r=t[e];FILL_COMMANDS[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=tmpBounds,r=Matrix.IDENTITY;this._bounds.clear(),e.clear();for(var i=0;i<this.graphicsData.length;i++){var n=this.graphicsData[i],s=n.shape,a=n.type,o=n.lineStyle,h=n.matrix||Matrix.IDENTITY,l=0;if(o&&o.visible){var u=o.alignment;l=o.width,a===SHAPES.POLY?l*=.5+Math.abs(.5-u):l*=Math.max(0,u)}if(r!==h&&(e.isEmpty()||(t.addBoundsMatrix(e,r),e.clear()),r=h),a===SHAPES.RECT||a===SHAPES.RREC){var c=s;e.addFramePad(c.x,c.y,c.x+c.width,c.y+c.height,l,l)}else if(a===SHAPES.CIRC){var d=s;e.addFramePad(d.x,d.y,d.x,d.y,d.radius+l,d.radius+l)}else if(a===SHAPES.ELIP){var f=s;e.addFramePad(f.x,f.y,f.x,f.y,f.width+l,f.height+l)}else{var p=s;t.addVerticesMatrix(r,p.points,0,p.points.length,l,l)}}e.isEmpty()||t.addBoundsMatrix(e,r),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var r=0;r<t.length/2;r++){var i=t[2*r],n=t[2*r+1];t[2*r]=e.a*i+e.c*n+e.tx,t[2*r+1]=e.b*i+e.d*n+e.ty}},e.prototype.addColors=function(t,e,r,i){for(var n=premultiplyTint((e>>16)+(65280&e)+((255&e)<<16),r);i-- >0;)t.push(n)},e.prototype.addTextureIds=function(t,e,r){for(;r-- >0;)t.push(e)},e.prototype.addUvs=function(t,e,r,i,n,s){void 0===s&&(s=null);for(var a=0,o=e.length,h=r.frame;a<n;){var l=t[2*(i+a)],u=t[2*(i+a)+1];if(s){var c=s.a*l+s.c*u+s.tx;u=s.b*l+s.d*u+s.ty,l=c}a++,e.push(l/h.width,u/h.height)}var d=r.baseTexture;(h.width<d.width||h.height<d.height)&&this.adjustUvs(e,r,o,n)},e.prototype.adjustUvs=function(t,e,r,i){for(var n=e.baseTexture,s=1e-6,a=r+2*i,o=e.frame,h=o.width/n.width,l=o.height/n.height,u=o.x/o.width,c=o.y/o.height,d=Math.floor(t[r]+s),f=Math.floor(t[r+1]+s),p=r+2;p<a;p+=2)d=Math.min(d,Math.floor(t[p]+s)),f=Math.min(f,Math.floor(t[p+1]+s));u-=d,c-=f;for(p=r;p<a;p+=2)t[p]=(t[p]+u)*h,t[p+1]=(t[p+1]+c)*l},e.BATCHABLE_SIZE=100,e}(BatchGeometry),LineStyle=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=LINE_CAP.BUTT,e.join=LINE_JOIN.MITER,e.miterLimit=10,e}return __extends$6(e,t),e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(FillStyle),temp=new Float32Array(3),DEFAULT_SHADERS={},Graphics=function(t){function e(e){void 0===e&&(e=null);var r=t.call(this)||this;return r._geometry=e||new GraphicsGeometry,r._geometry.refCount++,r.shader=null,r.state=State.for2d(),r._fillStyle=new FillStyle,r._lineStyle=new LineStyle,r._matrix=null,r._holeMode=!1,r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r.pluginName="batch",r._transformID=-1,r.tint=16777215,r.blendMode=BLEND_MODES$1.NORMAL,r}return __extends$6(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t,e,r,i,n){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=.5),void 0===n&&(n=!1),"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:i,native:n}),this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:Texture.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,r,i){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),QuadraticUtils.curveTo(t,e,r,i,n),this},e.prototype.bezierCurveTo=function(t,e,r,i,n,s){return this._initCurve(),BezierUtils.curveTo(t,e,r,i,n,s,this.currentPath.points),this},e.prototype.arcTo=function(t,e,r,i,n){this._initCurve(t,e);var s=this.currentPath.points,a=ArcUtils.curveTo(t,e,r,i,n,s);if(a){var o=a.cx,h=a.cy,l=a.radius,u=a.startAngle,c=a.endAngle,d=a.anticlockwise;this.arc(o,h,l,u,c,d)}return this},e.prototype.arc=function(t,e,r,i,n,s){if(void 0===s&&(s=!1),i===n)return this;if(!s&&n<=i?n+=PI_2:s&&i<=n&&(i+=PI_2),0===n-i)return this;var a=t+Math.cos(i)*r,o=e+Math.sin(i)*r,h=this._geometry.closePointEps,l=this.currentPath?this.currentPath.points:null;if(l){var u=Math.abs(l[l.length-2]-a),c=Math.abs(l[l.length-1]-o);u<h&&c<h||l.push(a,o)}else this.moveTo(a,o),l=this.currentPath.points;return ArcUtils.arc(a,o,t,e,r,i,n,s,l),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Texture.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){t=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,r,i){return this.drawShape(new Rectangle$1(t,e,r,i))},e.prototype.drawRoundedRect=function(t,e,r,i,n){return this.drawShape(new RoundedRectangle(t,e,r,i,n))},e.prototype.drawCircle=function(t,e,r){return this.drawShape(new Circle(t,e,r))},e.prototype.drawEllipse=function(t,e,r,i){return this.drawShape(new Ellipse(t,e,r,i))},e.prototype.drawPolygon=function(){for(var t,e=arguments,r=[],i=0;i<arguments.length;i++)r[i]=e[i];var n=!0,s=r[0];s.points?(n=s.closeStroke,t=s.points):t=Array.isArray(r[0])?r[0]:r;var a=new Polygon(t);return a.closeStroke=n,this.drawShape(a),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==SHAPES.RECT||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var e=this._geometry,r=t.context.supports.uint32Indices;e.updateBatches(r),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(var i=0;i<r;i++){var n=t.batches[i],s=n.style.color,a=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),h={vertexData:a,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:o,_batchRGB:hex2rgb(s),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=h}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,r=this.batches.length;e<r;e++){var i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),r=this._geometry,i=this.tint,n=this.worldAlpha,s=e.uniforms,a=r.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(i>>16&255)/255*n,s.tint[1]=(i>>8&255)/255*n,s.tint[2]=(255&i)/255*n,s.tint[3]=n,t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(var o=0,h=a.length;o<h;o++)this._renderDrawCallDirect(t,r.drawCalls[o])},e.prototype._renderDrawCallDirect=function(t,e){for(var r=e.texArray,i=e.type,n=e.size,s=e.start,a=r.count,o=0;o<a;o++)t.texture.bind(r.elements[o],o);t.geometry.draw(i,n,s)},e.prototype._resolveDirectShader=function(t){var e=this.shader,r=this.pluginName;if(!e){if(!DEFAULT_SHADERS[r]){for(var i=t.plugins.batch.MAX_TEXTURES,n=new Int32Array(i),s=0;s<i;s++)n[s]=s;var a={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:n},!0)},o=t.plugins[r]._shader.program;DEFAULT_SHADERS[r]=new Shader(o,a)}e=DEFAULT_SHADERS[r]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,r=e.minX,i=e.minY,n=e.maxX,s=e.maxY;this._bounds.addFrame(this.transform,r,i,n,s)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=hex2rgb(this.tint,temp),e=0;e<this.batches.length;e++){var r=this.batches[e],i=r._batchRGB,n=(t[0]*i[0]*255<<16)+(t[1]*i[1]*255<<8)+(0|t[2]*i[2]*255);r._tintRGB=(n>>16)+(65280&n)+((255&n)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,s=e.d,a=e.tx,o=e.ty,h=this._geometry.points,l=this.vertexData,u=0,c=0;c<h.length;c+=2){var d=h[c],f=h[c+1];l[u++]=r*d+n*f+a,l[u++]=s*f+i*d+o}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},e._TEMP_POINT=new Point$2,e}(Container),extendStatics$7=function(t,e){return(extendStatics$7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$7(t,e){function r(){this.constructor=t}extendStatics$7(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var tempPoint=new Point$2,indices=new Uint16Array([0,1,2,0,2,3]),Sprite=function(t){function e(e){var r=t.call(this)||this;return r._anchor=new ObservablePoint(r._onAnchorUpdate,r,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=BLEND_MODES$1.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=e||Texture.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=indices,r.pluginName="batch",r.isSprite=!0,r._roundPixels=settings.ROUND_PIXELS,r}return __extends$7(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign$1(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign$1(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,s=e.d,a=e.tx,o=e.ty,h=this.vertexData,l=t.trim,u=t.orig,c=this._anchor,d=0,f=0,p=0,_=0;if(l?(d=(f=l.x-c._x*u.width)+l.width,p=(_=l.y-c._y*u.height)+l.height):(d=(f=-c._x*u.width)+u.width,p=(_=-c._y*u.height)+u.height),h[0]=r*f+n*_+a,h[1]=s*_+i*f+o,h[2]=r*d+n*_+a,h[3]=s*_+i*d+o,h[4]=r*d+n*p+a,h[5]=s*p+i*d+o,h[6]=r*f+n*p+a,h[7]=s*p+i*f+o,this._roundPixels)for(var g=settings.RESOLUTION,m=0;m<h.length;++m)h[m]=Math.round((h[m]*g|0)/g)}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,n=this.transform.worldTransform,s=n.a,a=n.b,o=n.c,h=n.d,l=n.tx,u=n.ty,c=-i._x*r.width,d=c+r.width,f=-i._y*r.height,p=f+r.height;e[0]=s*c+o*f+l,e[1]=h*f+a*c+u,e[2]=s*d+o*f+l,e[3]=h*f+a*d+u,e[4]=s*d+o*p+l,e[5]=h*p+a*d+u,e[6]=s*c+o*p+l,e[7]=h*p+a*c+u},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Rectangle$1),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);var e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x,n=0;return tempPoint.x>=i&&tempPoint.x<i+e&&(n=-r*this.anchor.y,tempPoint.y>=n&&tempPoint.y<n+r)},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e&&e.texture){var r="boolean"==typeof e?e:e&&e.baseTexture;this._texture.destroy(!!r)}this._texture=null},e.from=function(t,r){return new e(t instanceof Texture?t:Texture.from(t,r))},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=sign$1(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=sign$1(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(Container),extendStatics$8=function(t,e){return(extendStatics$8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},TEXT_GRADIENT;function __extends$8(t,e){function r(){this.constructor=t}extendStatics$8(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}!function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(TEXT_GRADIENT||(TEXT_GRADIENT={}));var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],TextStyle=function(){function t(t){this.styleID=0,this.reset(),deepCopyProperties(this,t,t)}return t.prototype.clone=function(){var e={};return deepCopyProperties(e,this,defaultStyle),new t(e)},t.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=getColor(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=getColor(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){areArraysEqual(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=getColor(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var i=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&genericFontFamilies.indexOf(i)<0&&(i='"'+i+'"'),e[r]=i}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function getSingleColor(t){return"number"==typeof t?hex2string(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function getColor(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=getSingleColor(t[e]);return t}return getSingleColor(t)}function areArraysEqual(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}function deepCopyProperties(t,e,r){for(var i in r)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}var TextMetrics=function(){function t(t,e,r,i,n,s,a,o,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}return t.measureText=function(e,r,i,n){void 0===n&&(n=t._canvas),i=null==i?r.wordWrap:i;var s=r.toFontString(),a=t.measureFont(s);0===a.fontSize&&(a.fontSize=r.fontSize,a.ascent=r.fontSize);var o=n.getContext("2d");o.font=s;for(var h=(i?t.wordWrap(e,r,n):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length),u=0,c=0;c<h.length;c++){var d=o.measureText(h[c]).width+(h[c].length-1)*r.letterSpacing;l[c]=d,u=Math.max(u,d)}var f=u+r.strokeThickness;r.dropShadow&&(f+=r.dropShadowDistance);var p=r.lineHeight||a.fontSize+r.strokeThickness,_=Math.max(p,a.fontSize+r.strokeThickness)+(h.length-1)*(p+r.leading);return r.dropShadow&&(_+=r.dropShadowDistance),new t(e,r,f,_,h,l,p+r.leading,u,a)},t.wordWrap=function(e,r,i){void 0===i&&(i=t._canvas);for(var n=i.getContext("2d"),s=0,a="",o="",h=Object.create(null),l=r.letterSpacing,u=r.whiteSpace,c=t.collapseSpaces(u),d=t.collapseNewlines(u),f=!c,p=r.wordWrapWidth+l,_=t.tokenize(e),g=0;g<_.length;g++){var m=_[g];if(t.isNewline(m)){if(!d){o+=t.addLine(a),f=!c,a="",s=0;continue}m=" "}if(c){var y=t.isBreakingSpace(m),v=t.isBreakingSpace(a[a.length-1]);if(y&&v)continue}var b=t.getFromCache(m,l,h,n);if(b>p)if(""!==a&&(o+=t.addLine(a),a="",s=0),t.canBreakWords(m,r.breakWords))for(var x=t.wordWrapSplit(m),T=0;T<x.length;T++){for(var E=x[T],S=1;x[T+S];){var A=x[T+S],R=E[E.length-1];if(t.canBreakChars(R,A,m,T,r.breakWords))break;E+=A,S++}T+=E.length-1;var w=t.getFromCache(E,l,h,n);w+s>p&&(o+=t.addLine(a),f=!1,a="",s=0),a+=E,s+=w}else{a.length>0&&(o+=t.addLine(a),a="",s=0);var O=g===_.length-1;o+=t.addLine(m,!O),f=!1,a="",s=0}else b+s>p&&(f=!1,o+=t.addLine(a),a="",s=0),(a.length>0||!t.isBreakingSpace(m)||f)&&(a+=m,s+=b)}return o+=t.addLine(a,!1)},t.addLine=function(e,r){return void 0===r&&(r=!0),e=t.trimRight(e),e=r?e+"\n":e},t.getFromCache=function(t,e,r,i){var n=r[t];if("number"!=typeof n){var s=t.length*e;n=i.measureText(t).width+s,r[t]=n}return n},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var r=e.length-1;r>=0;r--){var i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,r){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var r=[],i="";if("string"!=typeof e)return r;for(var n=0;n<e.length;n++){var s=e[n],a=e[n+1];t.isBreakingSpace(s,a)||t.isNewline(s)?(""!==i&&(r.push(i),i=""),r.push(s)):i+=s}return""!==i&&r.push(i),r},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,r,i,n){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var r={ascent:0,descent:0,fontSize:0},i=t._canvas,n=t._context;n.font=e;var s=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(n.measureText(s).width),o=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),h=Math.ceil(t.HEIGHT_MULTIPLIER*o);o=o*t.BASELINE_MULTIPLIER|0,i.width=a,i.height=h,n.fillStyle="#f00",n.fillRect(0,0,a,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,o);var l=n.getImageData(0,0,a,h).data,u=l.length,c=4*a,d=0,f=0,p=!1;for(d=0;d<o;++d){for(var _=0;_<c;_+=4)if(255!==l[f+_]){p=!0;break}if(p)break;f+=c}for(r.ascent=o-d,f=u-c,p=!1,d=h;d>o;--d){for(_=0;_<c;_+=4)if(255!==l[f+_]){p=!0;break}if(p)break;f-=c}return r.descent=d-o,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),canvas=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();canvas.width=canvas.height=10,TextMetrics._canvas=canvas,TextMetrics._context=canvas.getContext("2d"),TextMetrics._fonts={},TextMetrics.METRICS_STRING="|q",TextMetrics.BASELINE_SYMBOL="M",TextMetrics.BASELINE_MULTIPLIER=1.4,TextMetrics.HEIGHT_MULTIPLIER=2,TextMetrics._newlines=[10,13],TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=function(t){function e(e,r,i){var n=this,s=!1;i||(i=document.createElement("canvas"),s=!0),i.width=3,i.height=3;var a=Texture.from(i);return a.orig=new Rectangle$1,a.trim=new Rectangle$1,(n=t.call(this,a)||this)._ownCanvas=s,n.canvas=i,n.context=n.canvas.getContext("2d"),n._resolution=settings.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=e,n.style=r,n.localStyleID=-1,n}return __extends$8(e,t),e.prototype.updateText=function(t){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,n,s=this.context,a=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=a.width,h=a.height,l=a.lines,u=a.lineHeight,c=a.lineWidths,d=a.maxLineWidth,f=a.fontProperties;this.canvas.width=Math.ceil((Math.max(1,o)+2*r.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,h)+2*r.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=r.strokeThickness,s.textBaseline=r.textBaseline,s.lineJoin=r.lineJoin,s.miterLimit=r.miterLimit;for(var p=r.dropShadow?2:1,_=0;_<p;++_){var g=r.dropShadow&&0===_,m=g?Math.ceil(Math.max(1,h)+2*r.padding):0,y=m*this._resolution;if(g){s.fillStyle="black",s.strokeStyle="black";var v=r.dropShadowColor,b=hex2rgb("number"==typeof v?v:string2hex(v));s.shadowColor="rgba("+255*b[0]+","+255*b[1]+","+255*b[2]+","+r.dropShadowAlpha+")",s.shadowBlur=r.dropShadowBlur,s.shadowOffsetX=Math.cos(r.dropShadowAngle)*r.dropShadowDistance,s.shadowOffsetY=Math.sin(r.dropShadowAngle)*r.dropShadowDistance+y}else s.fillStyle=this._generateFillStyle(r,l,a),s.strokeStyle=r.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;var x=(u-f.fontSize)/2;(!e.nextLineHeightBehavior||u-f.fontSize<0)&&(x=0);for(var T=0;T<l.length;T++)i=r.strokeThickness/2,n=r.strokeThickness/2+T*u+f.ascent+x,"right"===r.align?i+=d-c[T]:"center"===r.align&&(i+=(d-c[T])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(l[T],i+r.padding,n+r.padding-m,!0),r.fill&&this.drawLetterSpacing(l[T],i+r.padding,n+r.padding-m)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,r,i){void 0===i&&(i=!1);var n=this._style.letterSpacing;if(0!==n)for(var s=e,a=Array.from?Array.from(t):t.split(""),o=this.context.measureText(t).width,h=0,l=0;l<a.length;++l){var u=a[l];i?this.context.strokeText(u,s,r):this.context.fillText(u,s,r),s+=o-(h=this.context.measureText(t.substring(l+1)).width)+n,o=h}else i?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=trimCanvas(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var r=this._texture,i=this._style,n=i.trim?0:i.padding,s=r.baseTexture;r.trim.width=r._frame.width=Math.ceil(t.width/this._resolution),r.trim.height=r._frame.height=Math.ceil(t.height/this._resolution),r.trim.x=-n,r.trim.y=-n,r.orig.width=r._frame.width-2*n,r.orig.height=r._frame.height-2*n,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,e,r){var i,n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];var s=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=Math.ceil(this.canvas.width/this._resolution)-s-2*a,h=Math.ceil(this.canvas.height/this._resolution)-s-2*a,l=n.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var c=l.length+1,d=1;d<c;++d)u.push(d/c);if(l.unshift(n[0]),u.unshift(0),l.push(n[n.length-1]),u.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){i=this.context.createLinearGradient(o/2,a,o/2,h+a);var f=(r.fontProperties.fontSize+t.strokeThickness)/h;for(d=0;d<e.length;d++)for(var p=r.lineHeight*d,_=0;_<l.length;_++){var g=0;g="number"==typeof u[_]?u[_]:_/l.length;var m=Math.min(1,Math.max(0,p/h+g*f));m=Number(m.toFixed(5)),i.addColorStop(m,l[_])}}else{i=this.context.createLinearGradient(a,h/2,o+a,h/2);var y=l.length+1,v=1;for(d=0;d<l.length;d++){var b=void 0;b="number"==typeof u[d]?u[d]:v/y,i.addColorStop(b,l[d]),v++}}return i},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},defaultDestroyOptions,e),t.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=sign$1(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=sign$1(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof TextStyle?t:new TextStyle(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e}(Sprite);
/*!
   * @pixi/prepare - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/prepare is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
settings.UPLOADS_PER_FRAME=4;
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var extendStatics$9=function(t,e){return(extendStatics$9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$9(t,e){function r(){this.constructor=t}extendStatics$9(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var CountLimiter=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function findMultipleBaseTextures(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var i=0;i<t._textures.length;i++)if(t._textures[i]instanceof Texture){var n=t._textures[i].baseTexture;-1===e.indexOf(n)&&(e.push(n),r=!0)}return r}function findBaseTexture(t,e){if(t.baseTexture instanceof BaseTexture){var r=t.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function findTexture(t,e){if(t._texture&&t._texture instanceof Texture){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function drawText(t,e){return e instanceof Text&&(e.updateText(!0),!0)}function calculateTextStyle(t,e){if(e instanceof TextStyle){var r=e.toFontString();return TextMetrics.measureFont(r),!0}return!1}function findText(t,e){if(t instanceof Text){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function findTextStyle(t,e){return t instanceof TextStyle&&(-1===e.indexOf(t)&&e.push(t),!0)}var BasePrepare=function(){function t(t){var e=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var n=this.completes.slice(0);this.completes.length=0;for(r=0,i=n.length;r<i;r++)n[r]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Container)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},t.prototype.destroy=function(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function uploadBaseTextures(t,e){return e instanceof BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function uploadGraphics(t,e){if(!(e instanceof Graphics))return!1;var r=e.geometry;e.finishPoly(),r.updateBatches();for(var i=r.batches,n=0;n<i.length;n++){var s=i[n].style.texture;s&&uploadBaseTextures(t,s.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function findGraphics(t,e){return t instanceof Graphics&&(e.push(t),!0)}var Prepare=function(t){function e(e){var r=t.call(this,e)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(findGraphics),r.registerUploadHook(uploadBaseTextures),r.registerUploadHook(uploadGraphics),r}return __extends$9(e,t),e}(BasePrepare),Spritesheet=function(){function t(t,e,r){void 0===r&&(r=null),this._texture=t instanceof Texture?t:null,this.baseTexture=t instanceof BaseTexture?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,r=getResolutionOfUrl(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var r=e,i=t.BATCH_SIZE;r-e<i&&r<this._frameKeys.length;){var n=this._frameKeys[r],s=this._frames[n],a=s.frame;if(a){var o=null,h=null,l=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,u=new Rectangle$1(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=s.rotated?new Rectangle$1(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new Rectangle$1(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(h=new Rectangle$1(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new Texture(this.baseTexture,o,u,h,s.rotated?2:0,s.anchor),Texture.addToCache(this.textures[n],n)}r++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var i=t[e][r];this.animations[e].push(this.textures[i])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var r in void 0===t&&(t=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),SpritesheetLoader=function(){function t(){}return t.use=function(e,r){var i,n,s=this,a=e.name+"_image";if(e.data&&e.type===LoaderResource.TYPE.JSON&&e.data.frames&&!s.resources[a]){var o=null===(n=null===(i=e.data)||void 0===i?void 0:i.meta)||void 0===n?void 0:n.related_multi_packs;if(Array.isArray(o))for(var h=function(t){if("string"!=typeof t)return"continue";var r=t.replace(".json",""),i=url.resolve(e.url.replace(s.baseUrl,""),t);if(s.resources[r]||Object.values(s.resources).some((function(t){return url.format(url.parse(t.url))===i})))return"continue";var n={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.XHR,xhrType:LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:e};s.add(r,i,n)},l=0,u=o;l<u.length;l++){h(u[l])}var c={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},d=t.getResourcePath(e,s.baseUrl);s.add(a,d,c,(function(t){if(t.error)r(t.error);else{var i=new Spritesheet(t.texture,e.data,e.url);i.parse((function(){e.spritesheet=i,e.textures=i.textures,r()}))}}))}else r()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:url.resolve(t.url.replace(e,""),t.data.meta.image)},t}(),extendStatics$a=function(t,e){return(extendStatics$a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*!
   * @pixi/spritesheet - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/spritesheet is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */function __extends$a(t,e){function r(){this.constructor=t}extendStatics$a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var tempPoint$1=new Point$2,TilingSprite=function(t){function e(e,r,i){void 0===r&&(r=100),void 0===i&&(i=100);var n=t.call(this,e)||this;return n.tileTransform=new Transform,n._width=r,n._height=i,n.uvMatrix=n.texture.uvMatrix||new TextureMatrix(e),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}return __extends$a(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,i)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Rectangle$1),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint$1);var e=this._width,r=this._height,i=-e*this.anchor._x;if(tempPoint$1.x>=i&&tempPoint$1.x<i+e){var n=-r*this.anchor._y;if(tempPoint$1.y>=n&&tempPoint$1.y<n+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){return new e(t instanceof Texture?t:Texture.from(t,r),r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(Sprite),vertex$2="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",fragment$2="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",fragmentSimple="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",tempMat$1=new Matrix,TilingSpriteRenderer=function(t){function e(e){var r=t.call(this,e)||this,i={globals:r.renderer.globalUniforms};return r.shader=Shader.from(vertex$2,fragment$2,i),r.simpleShader=Shader.from(vertex$2,fragmentSimple,i),r.quad=new QuadUv,r.state=State.for2d(),r}return __extends$a(e,t),e.prototype.render=function(t){var e=this.renderer,r=this.quad,i=r.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);var n=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;(i=r.uvs)[0]=i[6]=-n,i[1]=i[3]=-s,i[2]=i[4]=1-n,i[5]=i[7]=1-s,r.invalidate();var a=t._texture,o=a.baseTexture,h=t.tileTransform.localTransform,l=t.uvMatrix,u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==WRAP_MODES$1.CLAMP:o.wrapMode===WRAP_MODES$1.CLAMP&&(o.wrapMode=WRAP_MODES$1.REPEAT));var c=u?this.simpleShader:this.shader,d=a.width,f=a.height,p=t._width,_=t._height;tempMat$1.set(h.a*d/p,h.b*d/_,h.c*f/p,h.d*f/_,h.tx/p,h.ty/_),tempMat$1.invert(),u?tempMat$1.prepend(l.mapCoord):(c.uniforms.uMapCoord=l.mapCoord.toArray(!0),c.uniforms.uClampFrame=l.uClampFrame,c.uniforms.uClampOffset=l.uClampOffset),c.uniforms.uTransform=tempMat$1.toArray(!0),c.uniforms.uColor=premultiplyTintToRgba(t.tint,t.worldAlpha,c.uniforms.uColor,o.alphaMode),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=a,e.shader.bind(c),e.geometry.bind(r),this.state.blendMode=correctBlendMode(t.blendMode,o.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(ObjectRenderer),extendStatics$b=function(t,e){return(extendStatics$b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$b(t,e){function r(){this.constructor=t}extendStatics$b(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var MeshBatchUvs=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),tempPoint$2=new Point$2,tempPolygon=new Polygon,Mesh=function(t){function e(e,r,i,n){void 0===n&&(n=DRAW_MODES$1.TRIANGLES);var s=t.call(this)||this;return s.geometry=e,e.refCount++,s.shader=r,s.state=i||State.for2d(),s.drawMode=n,s.start=0,s.size=0,s.uvs=null,s.indices=null,s.vertexData=new Float32Array(1),s.vertexDirty=-1,s._transformID=-1,s._roundPixels=settings.ROUND_PIXELS,s.batchUvs=null,s}return __extends$b(e,t),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===DRAW_MODES$1.TRIANGLES&&r.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var i=this.transform.worldTransform,n=i.a,s=i.b,a=i.c,o=i.d,h=i.tx,l=i.ty,u=this.vertexData,c=0;c<u.length/2;c++){var d=e[2*c],f=e[2*c+1];u[2*c]=n*d+a*f+h,u[2*c+1]=s*d+o*f+l}if(this._roundPixels){var p=settings.RESOLUTION;for(c=0;c<u.length;++c)u[c]=Math.round((u[c]*p|0)/p)}this.vertexDirty=r}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,tempPoint$2);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=tempPolygon.points,i=this.geometry.getIndex().data,n=i.length,s=4===this.drawMode?3:1,a=0;a+2<n;a+=s){var o=2*i[a],h=2*i[a+1],l=2*i[a+2];if(r[0]=e[o],r[1]=e[o+1],r[2]=e[h],r[3]=e[h+1],r[4]=e[l],r[5]=e[l+1],tempPolygon.contains(tempPoint$2.x,tempPoint$2.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(Container),fragment$3="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n",vertex$3="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n",MeshMaterial=function(t){function e(e,r){var i=this,n={uSampler:e,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(n,r.uniforms),(i=t.call(this,r.program||Program.from(vertex$3,fragment$3),n)||this)._colorDirty=!1,i.uvMatrix=new TextureMatrix(e),i.batchable=void 0===r.program,i.pluginName=r.pluginName,i.tint=r.tint,i.alpha=r.alpha,i}return __extends$b(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(Shader),MeshGeometry=function(t){function e(e,r,i){var n=t.call(this)||this,s=new Buffer(e),a=new Buffer(r,!0),o=new Buffer(i,!0,!0);return n.addAttribute("aVertexPosition",s,2,!1,TYPES$1.FLOAT).addAttribute("aTextureCoord",a,2,!1,TYPES$1.FLOAT).addIndex(o),n._updateId=-1,n}return __extends$b(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(Geometry),extendStatics$c=function(t,e){return(extendStatics$c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$c(t,e){function r(){this.constructor=t}extendStatics$c(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var BitmapFontData=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},TextFormat=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in e){var n=e[i].match(/^[a-z]+/gm)[0],s=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(var o in s){var h=s[o].split("="),l=h[0],u=h[1].replace(/"/gm,""),c=parseFloat(u),d=isNaN(c)?u:c;a[l]=d}r[n].push(a)}var f=new BitmapFontData;return r.info.forEach((function(t){return f.info.push({face:t.face,size:parseInt(t.size,10)})})),r.common.forEach((function(t){return f.common.push({lineHeight:parseInt(t.lineHeight,10)})})),r.page.forEach((function(t){return f.page.push({id:parseInt(t.id,10),file:t.file})})),r.char.forEach((function(t){return f.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),r.kerning.forEach((function(t){return f.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),f},t}(),XMLFormat=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new BitmapFontData,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=0;o<r.length;o++)e.info.push({face:r[o].getAttribute("face"),size:parseInt(r[o].getAttribute("size"),10)});for(o=0;o<i.length;o++)e.common.push({lineHeight:parseInt(i[o].getAttribute("lineHeight"),10)});for(o=0;o<n.length;o++)e.page.push({id:parseInt(n[o].getAttribute("id"),10)||0,file:n[o].getAttribute("file")});for(o=0;o<s.length;o++){var h=s[o];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(o=0;o<a.length;o++)e.kerning.push({first:parseInt(a[o].getAttribute("first"),10),second:parseInt(a[o].getAttribute("second"),10),amount:parseInt(a[o].getAttribute("amount"),10)});return e},t}(),XMLStringFormat=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return XMLFormat.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return XMLFormat.parse(e)},t}(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(t){for(var e=0;e<formats.length;e++)if(formats[e].test(t))return formats[e];return null}function generateFillStyle(t,e,r,i,n,s){var a,o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,u=Math.ceil(t.width/i)-h-2*l,c=Math.ceil(t.height/i)-h-2*l,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length)for(var p=d.length+1,_=1;_<p;++_)f.push(_/p);if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,l,u/2,c+l);var g=0,m=(s.fontProperties.fontSize+r.strokeThickness)/c;for(_=0;_<n.length;_++)for(var y=s.lineHeight*_,v=0;v<d.length;v++){var b=y/c+("number"==typeof f[v]?f[v]:v/d.length)*m,x=Math.max(g,b);x=Math.min(x,1),a.addColorStop(x,d[v]),g=x}}else{a=e.createLinearGradient(l,c/2,u+l,c/2);var T=d.length+1,E=1;for(_=0;_<d.length;_++){var S=void 0;S="number"==typeof f[_]?f[_]:E/T,a.addColorStop(S,d[_]),E++}}return a}function drawGlyph(t,e,r,i,n,s,a){var o=r.text,h=r.fontProperties;e.translate(i,n),e.scale(s,s);var l=a.strokeThickness/2,u=-a.strokeThickness/2;e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=generateFillStyle(t,e,a,s,[o],r),e.strokeStyle=a.stroke,e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=generateFillStyle(t,e,a,s,[o],r),e.strokeStyle=a.stroke;var c=a.dropShadowColor,d=hex2rgb("number"==typeof c?c:string2hex(c));a.dropShadow?(e.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+a.dropShadowAlpha+")",e.shadowBlur=a.dropShadowBlur,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*a.dropShadowDistance,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*a.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),a.stroke&&a.strokeThickness&&e.strokeText(o,l,u+r.lineHeight-h.descent),a.fill&&e.fillText(o,l,u+r.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function resolveCharacters(t){"string"==typeof t&&(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(var o=s,h=a;o<=h;o++)e.push(String.fromCharCode(o))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var BitmapFont=function(){function t(t,e,r){var i=t.info[0],n=t.common[0],s=getResolutionOfUrl(t.page[0].file),a={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/s,this.chars={},this.pageTextures=a;for(var o=0;o<t.page.length;o++){var h=t.page[o],l=h.id,u=h.file;a[l]=e instanceof Array?e[o]:e[u]}for(o=0;o<t.char.length;o++){var c=t.char[o],d=(l=c.id,c.page),f=t.char[o],p=f.x,_=f.y,g=f.width,m=f.height,y=f.xoffset,v=f.yoffset,b=f.xadvance;_/=s,g/=s,m/=s,y/=s,v/=s,b/=s;var x=new Rectangle$1((p/=s)+a[d].frame.x/s,_+a[d].frame.y/s,g,m);this.chars[l]={xOffset:y,yOffset:v,xAdvance:b,kerning:{},texture:new Texture(a[d].baseTexture,x),page:d}}for(o=0;o<t.kerning.length;o++){var T=t.kerning[o],E=T.first,S=T.second,A=T.amount;E/=s,S/=s,A/=s,this.chars[S]&&(this.chars[S].kerning[E]=A)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,r,i){var n;if(e instanceof BitmapFontData)n=e;else{var s=autoDetectFormat(e);if(!s)throw new Error("Unrecognized data format for font.");n=s.parse(e)}r instanceof Texture&&(r=[r]);var a=new t(n,r,i);return t.available[a.font]=a,a},t.uninstall=function(e){var r=t.available[e];if(!r)throw new Error("No font found named '"+e+"'");r.destroy(),delete t.available[e]},t.from=function(e,r,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,i),s=n.chars,a=n.padding,o=n.resolution,h=n.textureWidth,l=n.textureHeight,u=resolveCharacters(s),c=r instanceof TextStyle?r:new TextStyle(r),d=h,f=new BitmapFontData;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};for(var p,_,g,m=0,y=0,v=0,b=[],x=0;x<u.length;x++){p||((p=document.createElement("canvas")).width=h,p.height=l,_=p.getContext("2d"),g=new BaseTexture(p,{resolution:o}),b.push(new Texture(g)),f.page.push({id:b.length-1,file:""}));var T=TextMetrics.measureText(u[x],c,!1,p),E=T.width,S=Math.ceil(T.height),A=Math.ceil(("italic"===c.fontStyle?2:1)*E);if(y>=l-S*o){if(0===y)throw new Error("[BitmapFont] textureHeight "+l+"px is too small for "+c.fontSize+"px fonts");--x,p=null,_=null,g=null,y=0,m=0,v=0}else if(v=Math.max(S+T.fontProperties.descent,v),A*o+m>=d)--x,y+=v*o,y=Math.ceil(y),m=0,v=0;else{drawGlyph(p,_,T,m,y,o,c);var R=T.text.charCodeAt(0);f.char.push({id:R,page:b.length-1,x:m/o,y:y/o,width:A,height:S,xoffset:0,yoffset:0,xadvance:Math.ceil(E-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),m+=(A+2*a)*o,m=Math.ceil(m)}}x=0;for(var w=u.length;x<w;x++)for(var O=u[x],P=0;P<w;P++){var I=u[P],M=_.measureText(O).width,C=_.measureText(I).width,D=_.measureText(O+I).width-(M+C);D&&f.kerning.push({first:O.charCodeAt(0),second:I.charCodeAt(0),amount:D})}var N=new t(f,b,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=N,N},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),pageMeshDataPool=[],charRenderDataPool=[],BitmapText=function(t){function e(r,i){void 0===i&&(i={});var n=t.call(this)||this;n._tint=16777215;var s=Object.assign({},e.styleDefaults,i),a=s.align,o=s.tint,h=s.maxWidth,l=s.letterSpacing,u=s.fontName,c=s.fontSize;if(!BitmapFont.available[u])throw new Error('Missing BitmapFont "'+u+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=a,n._tint=o,n._fontName=u,n._fontSize=c||BitmapFont.available[u].size,n._text=r,n._maxWidth=h,n._maxLineHeight=0,n._letterSpacing=l,n._anchor=new ObservablePoint((function(){n.dirty=!0}),n,0,0),n._roundPixels=settings.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return __extends$c(e,t),e.prototype.updateText=function(){for(var t,e=BitmapFont.available[this._fontName],r=this._fontSize/e.size,i=new Point$2,n=[],s=[],a=[],o=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",h=o.length,l=this._maxWidth*e.size/this._fontSize,u=null,c=0,d=0,f=0,p=-1,_=0,g=0,m=0,y=0,v=0;v<h;v++){var b=o.charCodeAt(v),x=o.charAt(v);if(/(?:\s)/.test(x)&&(p=v,_=c,y++),"\r"!==x&&"\n"!==x){var T=e.chars[b];if(T){u&&T.kerning[u]&&(i.x+=T.kerning[u]);var E=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point$2};E.texture=T.texture,E.line=f,E.charCode=b,E.position.x=i.x+T.xOffset+this._letterSpacing/2,E.position.y=i.y+T.yOffset,E.prevSpaces=y,n.push(E),i.x+=T.xAdvance+this._letterSpacing,c=i.x,m=Math.max(m,T.yOffset+T.texture.height),u=b,-1!==p&&l>0&&i.x>l&&(removeItems(n,1+p-++g,1+v-p),v=p,p=-1,s.push(_),a.push(n.length>0?n[n.length-1].prevSpaces:0),d=Math.max(d,_),f++,i.x=0,i.y+=e.lineHeight,u=null,y=0)}}else s.push(c),a.push(-1),d=Math.max(d,c),++f,++g,i.x=0,i.y+=e.lineHeight,u=null,y=0}var S=o.charAt(o.length-1);"\r"!==S&&"\n"!==S&&(/(?:\s)/.test(S)&&(c=_),s.push(c),d=Math.max(d,c),a.push(-1));var A=[];for(v=0;v<=f;v++){var R=0;"right"===this._align?R=d-s[v]:"center"===this._align?R=(d-s[v])/2:"justify"===this._align&&(R=a[v]<0?0:(d-s[v])/a[v]),A.push(R)}var w=n.length,O={},P=[],I=this._activePagesMeshData;for(v=0;v<I.length;v++)pageMeshDataPool.push(I[v]);for(v=0;v<w;v++){var M=(G=n[v].texture).baseTexture.uid;if(!O[M]){if(!(z=pageMeshDataPool.pop())){var C=new MeshGeometry,D=new MeshMaterial(Texture.EMPTY);z={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Mesh(C,D),vertices:null,uvs:null,indices:null}}z.index=0,z.indexCount=0,z.vertexCount=0,z.uvsCount=0,z.total=0;var N=this._textureCache;N[M]=N[M]||new Texture(G.baseTexture),z.mesh.texture=N[M],z.mesh.tint=this._tint,P.push(z),O[M]=z}O[M].total++}for(v=0;v<I.length;v++)-1===P.indexOf(I[v])&&this.removeChild(I[v].mesh);for(v=0;v<P.length;v++)P[v].mesh.parent!==this&&this.addChild(P[v].mesh);for(var v in this._activePagesMeshData=P,O){var L=(z=O[v]).total;if(!((null===(t=z.indices)||void 0===t?void 0:t.length)>6*L)||z.vertices.length<2*Mesh.BATCHABLE_SIZE)z.vertices=new Float32Array(8*L),z.uvs=new Float32Array(8*L),z.indices=new Uint16Array(6*L);else for(var F=z.total,k=z.vertices,B=4*F*2;B<k.length;B++)k[B]=0;z.mesh.size=6*L}for(v=0;v<w;v++){var U=(x=n[v]).position.x+A[x.line]*("justify"===this._align?x.prevSpaces:1);this._roundPixels&&(U=Math.round(U));var G,$=U*r,X=x.position.y*r,H=O[(G=x.texture).baseTexture.uid],V=G.frame,Y=G._uvs,j=H.index++;H.indices[6*j+0]=0+4*j,H.indices[6*j+1]=1+4*j,H.indices[6*j+2]=2+4*j,H.indices[6*j+3]=0+4*j,H.indices[6*j+4]=2+4*j,H.indices[6*j+5]=3+4*j,H.vertices[8*j+0]=$,H.vertices[8*j+1]=X,H.vertices[8*j+2]=$+V.width*r,H.vertices[8*j+3]=X,H.vertices[8*j+4]=$+V.width*r,H.vertices[8*j+5]=X+V.height*r,H.vertices[8*j+6]=$,H.vertices[8*j+7]=X+V.height*r,H.uvs[8*j+0]=Y.x0,H.uvs[8*j+1]=Y.y0,H.uvs[8*j+2]=Y.x1,H.uvs[8*j+3]=Y.y1,H.uvs[8*j+4]=Y.x2,H.uvs[8*j+5]=Y.y2,H.uvs[8*j+6]=Y.x3,H.uvs[8*j+7]=Y.y3}for(var v in this._textWidth=d*r,this._textHeight=(i.y+e.lineHeight)*r,O){var z=O[v];if(0!==this.anchor.x||0!==this.anchor.y)for(var W=0,q=this._textWidth*this.anchor.x,Z=this._textHeight*this.anchor.y,K=0;K<z.total;K++)z.vertices[W++]-=q,z.vertices[W++]-=Z,z.vertices[W++]-=q,z.vertices[W++]-=Z,z.vertices[W++]-=q,z.vertices[W++]-=Z,z.vertices[W++]-=q,z.vertices[W++]-=Z;this._maxLineHeight=m*r;var J=z.mesh.geometry.getBuffer("aVertexPosition"),Q=z.mesh.geometry.getBuffer("aTextureCoord"),tt=z.mesh.geometry.getIndex();J.data=z.vertices,Q.data=z.uvs,tt.data=z.indices,J.update(),Q.update(),tt.update()}for(v=0;v<n.length;v++)charRenderDataPool.push(n[v])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!BitmapFont.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){var r=this._textureCache;for(var i in r){r[i].destroy(),delete r[i]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(Container),BitmapFontLoader=function(){function t(){}return t.add=function(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,r){var i=autoDetectFormat(e.data);if(i)for(var n=t.getBaseUrl(this,e),s=i.parse(e.data),a={},o=function(t){a[t.metadata.pageFile]=t.texture,Object.keys(a).length===s.page.length&&(e.bitmapFont=BitmapFont.install(s,a,!0),r())},h=0;h<s.page.length;++h){var l=s.page[h].file,u=n+l,c=!1;for(var d in this.resources){var f=this.resources[d];if(f.url===u){f.metadata.pageFile=l,f.texture?o(f):f.onAfterMiddleware.add(o),c=!0;break}}if(!c){var p={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(u,p,o)}}else r()},t.getBaseUrl=function(e,r){var i=r.isDataUrl?"":t.dirname(r.url);return r.isDataUrl&&("."===i&&(i=""),e.baseUrl&&i&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(i+="/")),(i=i.replace(e.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}(),extendStatics$d=function(t,e){return(extendStatics$d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$d(t,e){function r(){this.constructor=t}extendStatics$d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var fragment$4="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",AlphaFilter=function(t){function e(e){void 0===e&&(e=1);var r=t.call(this,defaultVertex$2,fragment$4,{uAlpha:1})||this;return r.alpha=e,r}return __extends$d(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Filter),extendStatics$e=function(t,e){return(extendStatics$e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$e(t,e){function r(){this.constructor=t}extendStatics$e(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var vertTemplate="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";function generateBlurVertSource(t,e){var r,i=Math.ceil(t/2),n=vertTemplate,s="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var o=r.replace("%index%",a.toString());s+=o=o.replace("%sampleIndex%",a-(i-1)+".0"),s+="\n"}return n=(n=n.replace("%blur%",s)).replace("%size%",t.toString())}var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate$1=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n"),ENV$2,RENDERER_TYPE$2,BUFFER_BITS$2,BLEND_MODES$2,DRAW_MODES$2,FORMATS$2,TARGETS$2,TYPES$2,SAMPLER_TYPES$2,SCALE_MODES$2,WRAP_MODES$2,MIPMAP_MODES$2,ALPHA_MODES$2,CLEAR_MODES$2,GC_MODES$2,PRECISION$2,MASK_TYPES$2,MSAA_QUALITY$2;function generateBlurFragSource(t){for(var e,r=GAUSSIAN_VALUES[t],i=r.length,n=fragTemplate$1,s="",a=0;a<t;a++){var o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());e=a,a>=i&&(e=t-a-1),s+=o=o.replace("%value%",r[e].toString()),s+="\n"}return n=(n=n.replace("%blur%",s)).replace("%size%",t.toString())}!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ENV$2||(ENV$2={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(RENDERER_TYPE$2||(RENDERER_TYPE$2={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(BUFFER_BITS$2||(BUFFER_BITS$2={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(BLEND_MODES$2||(BLEND_MODES$2={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES$2||(DRAW_MODES$2={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS$2||(FORMATS$2={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS$2||(TARGETS$2={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES$2||(TYPES$2={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(SAMPLER_TYPES$2||(SAMPLER_TYPES$2={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(SCALE_MODES$2||(SCALE_MODES$2={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES$2||(WRAP_MODES$2={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES$2||(MIPMAP_MODES$2={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES$2||(ALPHA_MODES$2={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(CLEAR_MODES$2||(CLEAR_MODES$2={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(GC_MODES$2||(GC_MODES$2={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(PRECISION$2||(PRECISION$2={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(MASK_TYPES$2||(MASK_TYPES$2={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(MSAA_QUALITY$2||(MSAA_QUALITY$2={}));var BlurFilterPass=function(t){function e(e,r,i,n,s){void 0===r&&(r=8),void 0===i&&(i=4),void 0===n&&(n=settings.FILTER_RESOLUTION),void 0===s&&(s=5);var a=this,o=generateBlurVertSource(s,e),h=generateBlurFragSource(s);return(a=t.call(this,o,h)||this).horizontal=e,a.resolution=n,a._quality=0,a.quality=i,a.blur=r,a}return __extends$e(e,t),e.prototype.apply=function(t,e,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{var n=t.getFilterTexture(),s=t.renderer,a=e,o=n;this.state.blend=!1,t.applyFilter(this,a,o,CLEAR_MODES$2.CLEAR);for(var h=1;h<this.passes-1;h++){t.bindAndClear(a,CLEAR_MODES$2.BLIT),this.uniforms.uSampler=o;var l=o;o=a,a=l,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,r,i),t.returnFilterTexture(n)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(Filter),BlurFilter=function(t){function e(e,r,i,n){void 0===e&&(e=8),void 0===r&&(r=4),void 0===i&&(i=settings.FILTER_RESOLUTION),void 0===n&&(n=5);var s=t.call(this)||this;return s.blurXFilter=new BlurFilterPass(!0,e,r,i,n),s.blurYFilter=new BlurFilterPass(!1,e,r,i,n),s.resolution=i,s.quality=r,s.blur=e,s.repeatEdgePixels=!1,s}return __extends$e(e,t),e.prototype.apply=function(t,e,r,i){var n=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(n&&s){var a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,CLEAR_MODES$2.CLEAR),this.blurYFilter.apply(t,a,r,i),t.returnFilterTexture(a)}else s?this.blurYFilter.apply(t,e,r,i):this.blurXFilter.apply(t,e,r,i)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(Filter),extendStatics$f=function(t,e){return(extendStatics$f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$f(t,e){function r(){this.constructor=t}extendStatics$f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var fragment$5="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",ColorMatrixFilter=function(t){function e(){var e=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,defaultFilterVertex,fragment$5,r)||this).alpha=1,e}return __extends$f(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.greyscale=function(t,e){var r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),i=Math.sin(t),n=1/3,s=(0,Math.sqrt)(n),a=[r+(1-r)*n,n*(1-r)-s*i,n*(1-r)+s*i,0,0,n*(1-r)+s*i,r+n*(1-r),n*(1-r)-s*i,0,0,n*(1-r)-s*i,n*(1-r)+s*i,r+n*(1-r),0,0,0,0,0,1,0];this._loadMatrix(a,e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var r=2*t/3+1,i=-.5*(r-1),n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,i,n){var s=((r=r||16770432)>>16&255)/255,a=(r>>8&255)/255,o=(255&r)/255,h=((i=i||3375104)>>16&255)/255,l=(i>>8&255)/255,u=(255&i)/255,c=[.3,.59,.11,0,0,s,a,o,t=t||.2,0,h,l,u,e=e||.15,0,s-h,a-l,o-u,0,0];this._loadMatrix(c,n)},e.prototype.night=function(t,e){var r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.predator=function(t,e){var r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Filter);ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;
/*!
   * @pixi/filter-displacement - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/filter-displacement is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var extendStatics$g=function(t,e){return(extendStatics$g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$g(t,e){function r(){this.constructor=t}extendStatics$g(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var fragment$6="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",vertex$4="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n",DisplacementFilter=function(t){function e(e,r){var i=this,n=new Matrix;return e.renderable=!1,(i=t.call(this,vertex$4,fragment$6,{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,i.maskMatrix=n,null==r&&(r=20),i.scale=new Point$2(r,r),i}return __extends$g(e,t),e.prototype.apply=function(t,e,r,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,s=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);0!==s&&0!==a&&(this.uniforms.rotation[0]=n.a/s,this.uniforms.rotation[1]=n.b/s,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,r,i)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(Filter),extendStatics$h=function(t,e){return(extendStatics$h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$h(t,e){function r(){this.constructor=t}extendStatics$h(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var vertex$5="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",fragment$7='varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n',FXAAFilter=function(t){function e(){return t.call(this,vertex$5,fragment$7)||this}return __extends$h(e,t),e}(Filter),extendStatics$i=function(t,e){return(extendStatics$i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$i(t,e){function r(){this.constructor=t}extendStatics$i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var fragment$8="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",NoiseFilter=function(t){function e(e,r){void 0===e&&(e=.5),void 0===r&&(r=Math.random());var i=t.call(this,defaultFilterVertex,fragment$8,{uNoise:0,uSeed:0})||this;return i.noise=e,i.seed=r,i}return __extends$i(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(Filter),_tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1,DisplayObject.prototype._cacheData=null,DisplayObject.prototype._cacheAsBitmapResolution=null;var CacheData=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new CacheData),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),DisplayObject.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},DisplayObject.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var i=this.filters[0].padding;r.pad(i)}r.ceil(settings.RESOLUTION);var n=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,h=RenderTexture.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution}),l="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=l,BaseTexture.addToCache(h.baseTexture,l),Texture.addToCache(h,l);var u=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),t.projection.transform=o,t.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;var c=new Sprite(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-r.x/r.width,c.anchor.y=-r.y/r.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)}},DisplayObject.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},DisplayObject.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var i=t.context,n=t._projTransform;e.ceil(settings.RESOLUTION);var s=RenderTexture.create({width:e.width,height:e.height}),a="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=a,BaseTexture.addToCache(s.baseTexture,a),Texture.addToCache(s,a);var o=_tempMatrix;this.transform.localTransform.copyTo(o),o.invert(),o.tx-=e.x,o.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:o,skipUpdateTransform:!1}),t.context=i,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var h=new Sprite(s);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)}},DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},DisplayObject.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},
/*!
   * @pixi/mixin-get-child-by-name - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/mixin-get-child-by-name is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
DisplayObject.prototype.name=null,Container.prototype.getChildByName=function(t,e){for(var r=0,i=this.children.length;r<i;r++)if(this.children[r].name===t)return this.children[r];if(e)for(r=0,i=this.children.length;r<i;r++){if(this.children[r].getChildByName){var n=this.children[r].getChildByName(t,!0);if(n)return n}}return null},
/*!
   * @pixi/mixin-get-global-position - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/mixin-get-global-position is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
DisplayObject.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Point$2),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};
/*!
   * @pixi/mesh-extras - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * @pixi/mesh-extras is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var extendStatics$j=function(t,e){return(extendStatics$j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$j(t,e){function r(){this.constructor=t}extendStatics$j(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var PlaneGeometry=function(t){function e(e,r,i,n){void 0===e&&(e=100),void 0===r&&(r=100),void 0===i&&(i=10),void 0===n&&(n=10);var s=t.call(this)||this;return s.segWidth=i,s.segHeight=n,s.width=e,s.height=r,s.build(),s}return __extends$j(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],r=[],i=[],n=this.segWidth-1,s=this.segHeight-1,a=this.width/n,o=this.height/s,h=0;h<t;h++){var l=h%this.segWidth,u=h/this.segWidth|0;e.push(l*a,u*o),r.push(l/n,u/s)}var c=n*s;for(h=0;h<c;h++){var d=h%n,f=h/n|0,p=f*this.segWidth+d,_=f*this.segWidth+d+1,g=(f+1)*this.segWidth+d,m=(f+1)*this.segWidth+d+1;i.push(p,_,g,_,m,g)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(i),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(MeshGeometry),RopeGeometry=function(t){function e(e,r,i){void 0===e&&(e=200),void 0===i&&(i=0);var n=t.call(this,new Float32Array(4*r.length),new Float32Array(4*r.length),new Uint16Array(6*(r.length-1)))||this;return n.points=r,n._width=e,n.textureScale=i,n.build(),n}return __extends$j(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),i=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));var n=r.data,s=i.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var a=0,o=t[0],h=this._width*this.textureScale,l=t.length,u=0;u<l;u++){var c=4*u;if(this.textureScale>0){var d=o.x-t[u].x,f=o.y-t[u].y,p=Math.sqrt(d*d+f*f);o=t[u],a+=p/h}else a=u/(l-1);n[c]=a,n[c+1]=0,n[c+2]=a,n[c+3]=1}var _=0;for(u=0;u<l-1;u++){c=2*u;s[_++]=c,s[_++]=c+1,s[_++]=c+2,s[_++]=c+2,s[_++]=c+1,s[_++]=c+3}r.update(),i.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,r=t[0],i=0,n=0,s=this.buffers[0].data,a=t.length,o=0;o<a;o++){var h=t[o],l=4*o;n=-((e=o<t.length-1?t[o+1]:h).x-r.x),i=e.y-r.y;var u=Math.sqrt(i*i+n*n),c=this.textureScale>0?this.textureScale*this._width/2:this._width/2;i/=u,n/=u,i*=c,n*=c,s[l]=h.x+i,s[l+1]=h.y+n,s[l+2]=h.x-i,s[l+3]=h.y-n,r=h}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(MeshGeometry),SimpleRope=function(t){function e(e,r,i){void 0===i&&(i=0);var n=this,s=new RopeGeometry(e.height,r,i),a=new MeshMaterial(e);return i>0&&(e.baseTexture.wrapMode=WRAP_MODES$1.REPEAT),(n=t.call(this,s,a)||this).autoUpdate=!0,n}return __extends$j(e,t),e.prototype._render=function(e){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),t.prototype._render.call(this,e)},e}(Mesh),SimplePlane=function(t){function e(e,r,i){var n=this,s=new PlaneGeometry(e.width,e.height,r,i),a=new MeshMaterial(Texture.WHITE);return(n=t.call(this,s,a)||this).texture=e,n}return __extends$j(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry;t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Mesh),SimpleMesh=function(t){function e(e,r,i,n,s){void 0===e&&(e=Texture.EMPTY);var a=this,o=new MeshGeometry(r,i,n);o.getBuffer("aVertexPosition").static=!1;var h=new MeshMaterial(e);return(a=t.call(this,o,h,null,s)||this).autoUpdate=!0,a}return __extends$j(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(Mesh),DEFAULT_BORDER_SIZE=10,NineSlicePlane=function(t){function e(e,r,i,n,s){void 0===r&&(r=DEFAULT_BORDER_SIZE),void 0===i&&(i=DEFAULT_BORDER_SIZE),void 0===n&&(n=DEFAULT_BORDER_SIZE),void 0===s&&(s=DEFAULT_BORDER_SIZE);var a=t.call(this,Texture.WHITE,4,4)||this;return a._origWidth=e.orig.width,a._origHeight=e.orig.height,a._width=a._origWidth,a._height=a._origHeight,a._leftWidth=r,a._rightWidth=n,a._topHeight=i,a._bottomHeight=s,a.texture=e,a}return __extends$j(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,i=this._height>r?1:this._height/r;return Math.min(e,i)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var r=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(SimplePlane),extendStatics$k=function(t,e){return(extendStatics$k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends$k(t,e){function r(){this.constructor=t}extendStatics$k(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var AnimatedSprite=function(t){function e(e,r){void 0===r&&(r=!0);var i=t.call(this,e[0]instanceof Texture?e[0]:e[0].texture)||this;return i._textures=null,i._durations=null,i._autoUpdate=r,i._isConnectedToTicker=!1,i.animationSpeed=1,i.loop=!0,i.updateAnchor=!1,i.onComplete=null,i.onFrameChange=null,i.onLoop=null,i._currentTime=0,i._playing=!1,i._previousFrame=null,i.textures=e,i}return __extends$k(e,t),e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var r=[],i=0;i<t.length;++i)r.push(Texture.from(t[i]));return new e(r)},e.fromImages=function(t){for(var r=[],i=0;i<t.length;++i)r.push(Texture.from(t[i]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(Sprite);
/*!
   * pixi.js - v6.0.4
   * Compiled Tue, 11 May 2021 18:00:23 UTC
   *
   * pixi.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */Renderer.registerPlugin("accessibility",AccessibilityManager),Renderer.registerPlugin("extract",Extract),Renderer.registerPlugin("interaction",InteractionManager),Renderer.registerPlugin("particle",ParticleRenderer),Renderer.registerPlugin("prepare",Prepare),Renderer.registerPlugin("batch",BatchRenderer),Renderer.registerPlugin("tilingSprite",TilingSpriteRenderer),Loader$1.registerPlugin(BitmapFontLoader),Loader$1.registerPlugin(CompressedTextureLoader),Loader$1.registerPlugin(DDSLoader),Loader$1.registerPlugin(KTXLoader),Loader$1.registerPlugin(SpritesheetLoader),Application.registerPlugin(TickerPlugin),Application.registerPlugin(AppLoaderPlugin);let DEG2RAD=Math.PI/180;class WebGLRenderer{constructor(t){this._canvasId=t,this._doesCollectionHaveBounds=!1,this._app=new Application({antialias:!0,width:1600,height:1e3,view:document.getElementById(this._canvasId)}),this._app.renderer.autoResize=!0}render(t,e){let r=e||{};this._app.renderer.backgroundColor=toHexColor(t.fillColor??"#fff"),this._doesCollectionHaveBounds=!!r.collectionBounds,this._app.stage.removeChildren(),this._app.renderer.clear();let i=this._renderItem(t);this._app.stage.addChild(i)}_renderItem(t){switch(t.type){case ItemType.Ellipse:case ItemType.LinearGradient:throwError("mark",t,Errors$1.FEATURE_NOT_IMPLEMENTED);break;case ItemType.Circle:return this._renderCircle(t);case ItemType.Pie:return this._renderPiePath(t);case ItemType.Area:return this._renderArea(t);case ItemType.Polygon:return this._renderPolygon(t);case ItemType.Axis:return this._renderAxis(t);case ItemType.Collection:return this._renderCollection(t);case ItemType.Glyph:case ItemType.Group:case ItemType.Gridlines:case ItemType.Legend:case ItemType.Scene:return this._renderGroup(t);case ItemType.Path:return this._renderPath(t);case ItemType.Line:return this._renderLinearPath(t);case ItemType.Rect:return this._renderRectangle(t);case ItemType.PointText:return this._renderText(t);case ItemType.Arc:return this._renderArc(t);case ItemType.Image:return this._renderImage(t);case ItemType.Link:return this._renderLink(t);default:throw new Error(`Expect: itemType, Actual: ${t}\nWait that's illegal`)}}_renderRectangle(t){let e=new Graphics;return decorate(e,t.styles),e.lineStyle(t.styles.strokeWidth,toHexColor(t.styles.strokeColor)),beginGradientOrColorFill(t.styles,e,t.height),e.drawRect(0,0,t.width,t.height),e.x=t.left,e.y=t.top,e.endFill(),e}_renderText(t){let e=new TextStyle({fontSize:t.styles.fontSize,fontFamily:t.styles.fontFamily,fontWeight:styleFontWeight2PixiFontWeight(t.styles.fontWeight),fill:toHexColor(t.styles.fillColor)}),r=new Text(t.text,e),i=new Container;decorate(r,t.styles),r.x=t.x,r.y=t.y,r.anchor.set(...styleAnchor2PixiAnchor(t.anchor)),i.addChild(r);let n=rotation2PixiPivot(t._rotate);return i.pivot.set(n[0],n[1]),i.angle=rotation2PixiAngle(t._rotate),i.position.set(n[0],n[1]),i}_renderGroup(t){let e=new Container;for(const r of t.children){let t=this._renderItem(r);if(null==t)throw new Error;e.addChild(t)}return e}_renderAxis(t){let e=this._renderGroup(t),r=rotation2PixiPivot(t._rotate);return e.pivot.set(r[0],r[1]),e.angle=rotation2PixiAngle(t._rotate),e.position.set(r[0],r[1]),e}_renderCollection(t){let e=new Container,r=this._renderGroup(t);if(e.addChild(r),!this._doesCollectionHaveBounds)return e;let i=new Graphics,n=0,s=t.bounds,a=s.left,o=s.right,h=s.top,l=s.bottom,u={strokeWidth:1,color:2018112,dashLength:5,dashSpacing:5};return n=c(a,o,h,n,u,i),n=c(h,l,-o,n,u,i),n=c(o,a,l,n,u,i),c(l,h,-a,n,u,i),e.addChild(i),e;function c(t,e,r,i,n,s){let a=t<=e?1:-1,o=i>=0?{point:t+i*a}:{point:t},h=r>0?[o,{point:r}]:[{point:-r},o];s.lineStyle({width:n.strokeWidth,color:n.color}),s.moveTo(h[0].point,h[1].point),o.point=i*a+t+n.dashLength*a,s.lineTo(h[0].point,h[1].point);let l=!1;for(o.point+=n.dashLength*a;o.point*a<=e*a;)l?(s.lineTo(h[0].point,h[1].point),l=!1,o.point+=n.dashSpacing*a):(s.moveTo(h[0].point,h[1].point),l=!0,o.point+=n.dashLength*a);return l?(r>0?s.lineTo(e,r):s.lineTo(-r,e),(e-o.point)*a):(o.point-e)*a}}_renderArea(t){switch(t.curveMode){case"linear":return this._renderPolygon(t);case"basis":return this._renderBezierArea(t);default:return throwError("areaPath",t,Errors$1.FEATURE_NOT_IMPLEMENTED)}}_renderBezierArea(t){let e=new Graphics;decorate(e,t.styles),e.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)});let r=parseDPath(t.getSVGPathData());return beginGradientOrColorFill(t.styles,e,t.bounds.height),drawOnGraphicsFromJSONData(e,r),e.endFill(),e}_renderPolygon(t){let e=new Container,r=this._renderLinearPath(t);r.getChildAt(0).lineTo(t.vertices[0].x,t.vertices[0].y);let i=new Graphics;decorate(i,t.styles);let n=[];for(const e of t.vertices)n.push(e.x-t.bounds.left),n.push(e.y-t.bounds.top);return beginGradientOrColorFill(t.styles,i,t.bounds.height),i.drawPolygon(n),i.x+=t.bounds.left,i.y+=t.bounds.top,i.endFill(),e.addChild(i),e.addChild(r),e}_renderPath(t){switch(t.curveMode){case"linear":return this._renderLinearPath(t);case"bumpX":case"natural":return this._renderBezierPath(t);default:throwError("path",t,Errors$1.FEATURE_NOT_IMPLEMENTED)}}_renderLinearPath(t){let e=new Container,r=new Graphics,i="none"==t.styles.strokeDash;decorate(r,t.styles);let n=t.vertices[0];if(r.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)}),r.moveTo(n.x,n.y),i)for(let e=1;e<t.vertices.length;e++){const i=t.vertices[e];r.lineTo(i.x,i.y)}else drawDashLine(t.vertices,t.styles.strokeDash,r);e.addChild(r);for(let r=0;r<t.vertices.length;r++){let i=t.vertices[r],n=this._renderVertex(i);null!=n&&e.addChild(n)}return e}_renderBezierPath(t){let e=new Container,r=new Graphics;decorate(r,t.styles),r.lineStyle({width:t.styles.strokeWidth,color:toHexColor(t.styles.strokeColor)}),drawOnGraphicsFromJSONData(r,parseDPath(t.getSVGPathData())),e.addChild(r);for(let r=0;r<t.vertices.length;r++){let i=t.vertices[r],n=this._renderVertex(i);null!=n&&e.addChild(n)}return e}_renderVertex(t){switch(t.shape){case"rect":return function(t){let e=new Graphics;return e.lineStyle({width:t.strokeWidth,color:toHexColor(t.strokeColor)}),e.beginFill(toHexColor(t.fillColor)),e.drawRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),e.endFill(),e}(t);case"circle":return function(t){let e=new Graphics;return e.lineStyle({width:t.strokeWidth,color:toHexColor(t.strokeColor)}),e.beginFill(toHexColor(t.fillColor)),e.drawCircle(t.x,t.y,t.radius),e.endFill(),e}(t);case void 0:return null;default:throwError("vertex shape",t.shape,Errors$1.FEATURE_NOT_IMPLEMENTED)}}_renderCircle(t){let e=new Graphics;return decorate(e,t.styles),e.lineStyle(t.styles.strokeWidth,toHexColor(t.styles.strokeColor)),beginGradientOrColorFill(t.styles,e,t.height),e.drawCircle(t.x,t.y,t.radius),e.endFill(),e}_renderPiePath(t){let e=new Graphics;return e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),e.beginFill(toHexColor(t.styles.fillColor)),e.moveTo(t.x,t.y),e.arc(t.x,t.y,t.radius,-t.endAngleRad,-t.startAngleRad),e.lineTo(t.x,t.y),e.endFill(),e}_renderArc(t){let e=new Graphics;return e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),e.beginFill(toHexColor(t.styles.fillColor)),e.arc(t.x,t.y,t.outerRadius,-t.endAngle*DEG2RAD,-t.startAngle*DEG2RAD),e.arc(t.x,t.y,t.innerRadius,-t.startAngle*DEG2RAD,-t.endAngle*DEG2RAD,!0),e.endFill(),e}_renderImage(t){let e=Sprite.from(t.src);return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}_renderLink(t){switch(t.curveMode){case"linear":return function(t){let e=new Graphics;return decorate(e,t.styles),e.lineStyle({color:toHexColor(t.styles.strokeColor),width:t.styles.strokeWidth}),drawOnGraphicsFromJSONData(e,parseDPath(t.getSVGPathData())),e}(t);default:throwError("link",t.curveMode,"unexpected curvemode")}}}function decorate(t,e){t.visible=styleVisiblity2PixiVisible(e.visibility),t.alpha=styleOpacity2PixiAlpha(e.opacity)}function styleFontWeight2PixiFontWeight(t){switch(t){case"regular":return"normal";case"bold":return"bold";default:throwError("font weight",t,Errors$1.FEATURE_NOT_IMPLEMENTED)}}function styleAnchor2PixiAnchor(t){let e,r;switch(t[0]){case"left":e=0;break;case"center":e=.5;break;case"right":e=1;break;default:throwError("x anchor",t[0],Errors$1.UNKNOWN_ANCHOR)}switch(t[1]){case"hanging":case"top":r=0;break;case"middle":case"central":r=.5;break;case"bottom":r=1;break;default:throwError("y anchor",t[1],Errors$1.UNKNOWN_ANCHOR)}return[e,r]}function toHexColor(t){let e=color$1(t);if(null==e)return null;return string2hex(e.formatHex())}function styleVisiblity2PixiVisible(t){switch(t){case"hidden":return!1;case null:case void 0:case"visible":default:return!0}}function rotation2PixiAngle(t){return void 0===t||"number"!=typeof t[0]?0:t[0]}function rotation2PixiPivot(t){return void 0===t||"number"!=typeof t[0]?[0,0]:t.slice(1)}function styleOpacity2PixiAlpha(t){switch(t){case void 0:case null:return 1;default:return t}}function throwError(t,e,r){throw console.log(e),new Error(`${r}. Source: ${t}, Actual: `)}function beginGradientOrColorFill(t,e,r){let i=t.fillColor;if("none"==i)return;let n=toHexColor(i);null!=n?e.beginFill(n):e.beginTextureFill({color:16777215,texture:createLinearGradientTexture(r,i.stops,i.y1>i.y2)})}function createLinearGradientTexture(t,e,r){const i=document.createElement("canvas");i.height=t,i.width=1;const n=i.getContext("2d"),s=n.createLinearGradient(0,0,0,t);for(let t=0;t<e.length;t++)r?s.addColorStop(1-e[t].offset/100,e[t].color):s.addColorStop(e[t].offset/100,e[t].color);return n.fillStyle=s,n.fillRect(0,0,1,t),Texture.from(i)}function drawOnGraphicsFromJSONData(t,e){let r=e.pop(),i=()=>{};"Z"==r.code.toUpperCase()?i=()=>t.lineTo(e[0].end.x,e[0].end.y):e.push(r);for(const r of e)draw(r,t);i()}function draw(t,e){switch(t.code.toUpperCase()){case"M":e.moveTo(t.end.x,t.end.y);break;case"L":e.lineTo(t.end.x,t.end.y);break;case"Q":e.bezierCurveTo(t.cp1.x,t.cp1.y,t.cp1.x,t.cp1.y,t.end.x,t.end.y);break;case"C":e.bezierCurveTo(t.cp1.x,t.cp1.y,t.cp2.x,t.cp2.y,t.end.x,t.end.y);break;case"Z":throw new Error('Unexpected "z" marker. There\'s something wrong, I can feel it');default:return throwError("data",t,Errors$1.FEATURE_NOT_IMPLEMENTED)}}function drawDashLine(t,e,r){let i,n,s,a=0,o=0,h=e.split(" "),l=Number(h[0]),u=Number(h[1]);for(i=0;i<t.length&&(n=t[i],i!=t.length-1);i++){s=t[i+1];let e=s.x-n.x,h=s.y-n.y,c=Math.sqrt(e*e+h*h),d={x:e/c,y:h/c},f=0;for(r.moveTo(n.x+o*d.x,n.y+o*d.y);f<=c;)f+=o,f+=a>0?a:l,f>c?(a=f-c,f=c):a=0,r.lineTo(n.x+f*d.x,n.y+f*d.y),f+=u,f>c&&0==a?o=f-c:(o=0,r.moveTo(n.x+f*d.x,n.y+f*d.y))}}function parseDPath(t){let e={command:/\s*([achlmqstvz])/gi,number:/\s*([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/gi,comma:/\s*(?:(,)|\s)/g,flag:/\s*([01])/g},r={number:function(t){return+a("number",t)},"coordinate pair":function(t){let e=a("number",t);return null!==e||t?(a("comma"),{x:+e,y:+a("number",!0)}):null},"arc definition":function(t){let e=r["coordinate pair"](t);if(!e&&!t)return null;a("comma");let i=+a("number",!0);a("comma",!0);let n=!!+a("flag",!0);a("comma");let s=!!+a("flag",!0);return a("comma"),{radii:e,rotation:i,large:n,clockwise:s,end:r["coordinate pair"](!0)}}},i=0,n=[];for(;i<t.length;){let t,e=a("command"),r=e.toUpperCase(),h=e!==r;switch(r){case"M":t=o("coordinate pair").map((function(t,r){return 1===r&&(e=h?"l":"L"),s({end:t},e,h)}));break;case"L":case"T":t=o("coordinate pair").map((function(t){return s({end:t},e,h)}));break;case"C":if(t=o("coordinate pair"),t.length%3)throw Error("Expected coordinate pair triplet at position "+i);t=t.reduce((function(t,r,i){let n=i%3;if(n){t[t.length-1][1===n?"cp2":"end"]=r}else t.push(s({cp1:r},e,h));return t}),[]);break;case"Q":case"S":if(t=o("coordinate pair"),1&t.length)throw Error("Expected coordinate pair couple at position "+i);t=t.reduce((function(t,r,i){if(1&i){t[t.length-1].end=r}else t.push(s({cp:r},e,h));return t}),[]);break;case"H":case"V":t=o("number").map((function(t){return s({value:t},e,h)}));break;case"A":t=o("arc definition").map(s,e,h);break;case"Z":t=[{code:"Z"}]}n.push.apply(n,t)}return n;function s(t,e,r){return t.code=e,t.relative=r,t}function a(r,n){e[r].lastIndex=i;let s=e[r].exec(t);if(!s||s.index!==i){if(!n)return null;throw Error("Expected "+r+" at position "+i)}return i=e[r].lastIndex,s[1]}function o(t){let e,i=[],n=!0;for(;e=r[t](n);)i.push(e),n=!!a("comma");return i}}const depth="_depth";class Tree{constructor(t,e){let r=[],i=[];this._nodeHash={},this._traverse(t,r,i),this._nodeTable=new DataTable(r,"nodes"),this._linkTable=new DataTable(i,"links"),this._nodeTable.tree=this,this._linkTable.tree=this,this._data=t,this.aggregateFromLeaves("value","average")}_traverse(t,e,r,i=0){let n={};t.hasOwnProperty(nodeId)||(t[nodeId]="n"+e.length),e.push(n),t[depth]=i;for(let s in t)if("children"==s&&t[s]&&t[s].length>0)for(let n of t[s]){let s=this._traverse(n,e,r,i+1);r.push({parent:t[nodeId],child:s})}else n[s]=t[s];return this._nodeHash[n[nodeId]]=n,n[nodeId]}getParent(t){let e,r=t[nodeId],i=this._linkTable.data,n=this._nodeTable.data;for(let t in i)if(i[t].child==r){e=i[t].parent;let r=n.findIndex((t=>t[nodeId]==e));return n[r]}}getChildren(t){let e=t[nodeId],r=[],i=this._linkTable.data,n=this._nodeTable.data;for(let t in i)if(i[t].parent==e){let e=i[t].child,s=n.findIndex((t=>t[nodeId]==e));r.push(n[s])}return r}getMaxDepth(){return this._nodeTable._fieldSummaries[depth].max}getRoot(){return this._nodeTable.data[0]}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}getNode(t){return this._nodeTable.data.filter((e=>e[nodeId]==t))[0]}sumLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];if(i=this.getChildren(t),i&&i.length>0){let t=0;for(let r of i)t+=this.sumLeaves(r,e);this.getNode(r)["sum"+e]=t}else this.getNode(r)["sum"+e]=t[e];return t["sum"+e]}countLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];i=this.getChildren(t);let n=0;if(i&&i.length>0)for(let t of i)n+=this.countLeaves(t,e);else n=1;return this.getNode(r)["count"+e]=n,t["count"+e]}averageLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];i=this.getChildren(t);let n=0;if(i&&i.length>0){for(let t of i)n+=this.averageLeaves(t,e);n/=i.length,this.getNode(r)["median"+e],this.getNode(r)["average"+e]=n}else this.getNode(r)["average"+e]=t[e];return t["average"+e]}medianLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];i=this.getChildren(t);let n=[];if(i&&i.length>0){for(let t of i)n.push(this.medianLeaves(t,e));n.sort((function(t,e){return t-e}));let t=Math.floor(n.length/2);n.length%2?this.getNode(r)["median"+e]=n[t]:this.getNode(r)["median"+e]=(n[t-1]+n[t])/2}else this.getNode(r)["median"+e]=t[e];return t["median"+e]}maxLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];i=this.getChildren(t);let n=[];if(i&&i.length>0){for(let t of i)n.push(this.maxLeaves(t,e));this.getNode(r)["max"+e]=Math.max(...n)}else this.getNode(r)["max"+e]=t[e];return t["max"+e]}minLeaves(t,e){if(!t)return 0;let r=t[nodeId],i=[];i=this.getChildren(t);let n=[];if(i&&i.length>0){for(let t of i)n.push(this.minLeaves(t,e));this.getNode(r)["min"+e]=Math.min(...n)}else this.getNode(r)["min"+e]=t[e];return t["min"+e]}aggregateFromLeaves(t,e){let r=this.getRoot();switch(e){case"sum":this.sumLeaves(r,t);break;case"count":this.countLeaves(r,t);break;case"average":this.averageLeaves(r,t);break;case"median":this.medianLeaves(r,t);break;case"max":this.maxLeaves(r,t);break;case"min":this.minLeaves(r,t)}}}class Network{constructor(t,e){this._nodeTable=new DataTable(t.nodes,"nodes"),this._linkTable=new DataTable(t.links,"links"),this._nodeTable.graph=this,this._linkTable.graph=this,this._nodes=t.nodes,this._links=t.links,this._nodeHash={};for(let e of t.nodes)this._nodeHash[e[nodeId]]=e}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}get nodes(){return this._nodes}get links(){return this._links}getNode(t){return this._nodeHash[t]}getSources(t){let e,r=t[nodeId],i=this._links.data,n=this._nodes.data,s=[];for(let t in i)if(i[t].target==r){e=i[t].source;let r=n.findIndex((t=>t[nodeId]===e));s.push(n[r])}return s}getTargets(t){let e,r=t[nodeId],i=this._links.data,n=this._nodes.data,s=[];for(let t in i)if(i[t].source==r){e=i[t].target;let r=n.findIndex((t=>t[nodeId]===e));s.push(n[r])}return s}}class TidyTreeLayout extends Layout{constructor(t){super(t),this.type=LayoutType.TidyTree,this._width=t.hasOwnProperty("width")?t.width:500,this._height=t.hasOwnProperty("height")?t.height:500,this._left=t.hasOwnProperty("left")?t.left:100,this._top=t.hasOwnProperty("top")?t.top:100,this._orientation=t.hasOwnProperty("orientation")?t.orientation:Orientation.Horizontal}toJSON(){let t={args:{}};return t.args.type=this.type,t.args.orientation=this._orientation,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt;if(t.tree){let e=hierarchy(t.tree._data),r=Math.max(...this.group.children.map((t=>t.bounds.width))),i=Math.max(...this.group.children.map((t=>t.bounds.height))),n=this._orientation==Orientation.Horizontal?[this._height,this._width]:[this._width,this._height],s=tree().nodeSize([r,i]).size(n)(e);this._apply(s,this.group)}}_apply(t,e){let r,i,n=e.children.filter((e=>e.dataScope.getFieldValue(nodeId)==t.data[nodeId]))[0];switch(this._orientation){case Orientation.Horizontal:r=t.y+this._left,i=t.x+this._top;break;case Orientation.Vertical:r=t.x+this._left,i=this._top+t.y}if(n.x=r,n.y=i,t.children&&t.children.length>0)for(let r of t.children)this._apply(r,e)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.run()}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get size(){return[this._width,this._height]}set size(t){this._width=t[0],this._height=t[1],this.run()}}class ForceLayout extends Layout{constructor(t){super(t),this.type=LayoutType.Force,this._x=t.hasOwnProperty("x")?t.x:0,this._y=t.hasOwnProperty("y")?t.y:0,this._iterations=t.hasOwnProperty("iterations")?t.iterations:1,this._repulsion=t.hasOwnProperty("repulsion")?t.repulsion:30,this._attraction=t.hasOwnProperty("attraction")?t.attraction:1,this._linkDistance=t.hasOwnProperty("linkDistance")?t.linkDistance:30}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this._x,t.args.y=this._y,t.args.iterations=this._iterations,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt.graph;if(t){let e=t.links.map((e=>({source:t.getNode(e.source),target:t.getNode(e.target)}))),r=simulation(t.nodes).force("charge",manyBody().strength(-this._repulsion)).force("link",link(e).id((t=>t.id)).distance(this._linkDistance)).force("x",x$1()).force("y",y$1()).force("center",center(this._x,this._y).strength(this._attraction));r.stop(),r.tick(this._iterations);for(let e=0;e<this.group.children.length;e++)this.group.children[e].x=t.nodes[e].x,this.group.children[e].y=t.nodes[e].y}}}class SpecGenerator{constructor(){this.axes={},this.guideCmds=[],this.collectionCmds=[],this.glyphCmds=[],this.spec=[]}run(t){for(let e of t.children)switch(e.type){case ItemType.Axis:let r=e.classId?e.classId:e.id;this.axes[r]=e;break;case ItemType.Gridlines:case ItemType.Legend:{let t=e.toJSON();this.guideCmds.push({cmd:e.type,channel:t.channel,field:t.field,args:t.args});break}case ItemType.Collection:case ItemType.Group:case ItemType.Glyph:let i=[];this._analyze(e,i);for(let t=i.length-1;t>0;t--)for(let e of i[t].fields)i[t-1].fields.delete(e);for(let[t,e]of i.entries()){if(e.item instanceof Mark)this.collectionCmds.push({cmd:"mark",type:e.item.type,output:e.item,args:e.item.toJSON().args});else if(e.item instanceof Glyph)this.collectionCmds.push({cmd:"glyph",output:e.item,input:i.slice(0,t).map((t=>t.item)),args:{}});else if(e.item instanceof Collection){let r=[...i[t-1].fields][0],n={cmd:"join",input:i[t-1].item,output:e.item,data:i[t-1].item.dataScope.dataTable.id,args:{field:r}};r==atlas_rowId&&delete n.field,this.collectionCmds.push(n)}e.item.dataScope&&0==e.item.dataScope.fields.length&&!e.item.parent.dataScope&&this.collectionCmds.push({cmd:"attach",input:e.item,data:e.item.dataScope.dataTable.id})}break;default:if(e instanceof Mark){let r={cmd:"mark",type:e.type,output:e,args:e.toJSON().args};this._inferMarkArgs(r,t),this.glyphCmds.push(r)}}this._inferJoin(),this._inferArgs(t);for(let t in this.axes){let e=this.axes[t].toJSON();this.guideCmds.push({cmd:e.type,channel:e.channel,field:e.field,args:e.args})}return this._generateFullSpec(t),this.spec}_inferJoin(){for(let t of this.collectionCmds){if("join"!=t.cmd)continue;let e=t.input,r=e.parent;switch(e.type){case ItemType.Rect:r.layout&&r.layout.type==LayoutType.Stack?t.cmd="divide":t.cmd="repeat";break;default:t.cmd="repeat"}}}_inferArgs(t){for(let e of this.collectionCmds)switch(e.cmd){case"mark":this._inferMarkArgs(e,t);break;case"divide":this._inferDivideArgs(e,t)}}_inferDivideArgs(t,e){t.args.orientation=t.output.layout.orientation}_inferMarkArgs(t,e){let r=t.output,i=r.parent,n=getPeers(r,e),s=getPeers(i,e);switch(r.type){case ItemType.Rect:i.layout&&i.layout.type==LayoutType.Grid?(t.args.width=i.layout.cellBounds[0].width,t.args.height=i.layout.cellBounds[0].height):i.layout&&i.layout.type==LayoutType.Stack?(t.args.width=Math.max(...s.map((t=>t.bounds.width))),t.args.height=Math.max(...s.map((t=>t.bounds.height)))):(t.args.width=Math.max(...n.map((t=>t.bounds.width))),t.args.height=Math.max(...n.map((t=>t.bounds.height)))),t.args.left=Math.min(...n.map((t=>t.bounds.left))),t.args.top=Math.min(...n.map((t=>t.bounds.top)));break;case ItemType.Line:t.args.x1=Math.min(...n.map((t=>t.vertices[0].x))),t.args.y1=Math.min(...n.map((t=>t.vertices[0].y))),t.args.x2=Math.min(...n.map((t=>t.vertices[1].x))),t.args.y2=Math.min(...n.map((t=>t.vertices[1].y)))}for(let e in r.styles)t.args[e]=r.styles[e]}_analyze(t,e){if(t instanceof Glyph)for(let r of t.children)this._analyze(r,e);else t instanceof Group&&this._analyze(t.firstChild,e);let r={type:t.type,item:t};t.dataScope?r.fields=new Set(t.dataScope.fields):r.fields=new Set,e.push(r)}_generateFullSpec(t){this.spec=[],this.spec.push({cmd:"scene",args:{fillColor:t.fillColor}});let e=t.getDataTables(),r={},i=[];for(let t in e){let n=e[t];if(n.sourceDataTable)for(;n.sourceDataTable;)i.push({cmd:"transform",type:n.transform.type,args:n.transform.args,input:n.sourceDataTable.id,output:n.id}),n=n.sourceDataTable;r.hasOwnProperty(n.id)||(r[n.id]={cmd:"data",url:n.url,output:n.id})}this.spec=this.spec.concat(Object.values(r)),this.spec=this.spec.concat(i);let n=[];for(let t of this.collectionCmds){let e;t.output&&t.output.layout&&(e={cmd:"layout",type:t.output.layout.type,input:t.output.id,args:t.output.layout.toJSON().args}),this.spec.push(t),t.output&&t.output.childrenOrder&&n.push({cmd:"sortChildren",args:t.output.childrenOrder,input:t.output.id}),e&&this.spec.push(e),t.input&&Array.isArray(t.input)?t.input=t.input.map((t=>t.classId?t.classId:t.id)):t.input&&(t.input=t.input.classId?t.input.classId:t.input.id),t.output&&(t.output=t.output.classId?t.output.classId:t.output.id)}let s={},a=[];for(let e in t.encodings)for(let r in t.encodings[e]){let i=t.encodings[e][r];i.scale&&!s.hasOwnProperty(i.scale.id)&&(s[i.scale.id]=i.scale.toJSON());let n=i.toJSON().args;n.field=i.field,n.channel=i.channel,delete n.datatable,a.push({cmd:"encode",input:getEncodingKey(i.anyItem),scale:i.scale.id,args:n})}for(let t in s){let e=s[t];e.cmd="scale",this.spec.push(e)}this.spec=this.spec.concat(a),this.spec=this.spec.concat(n);for(let e in t.constraints){let r=t.constraints[e],i={cmd:"constraint",type:r.type,args:{}};switch(r.type){case ConstraintType.Affix:i.item=r.item.classId?r.item.classId:r.item.id,i.baseItem=r.baseItem.classId?r.baseItem.classId:r.baseItem.id,i.channel=r.channel,i.args.itemAnchor=r.itemAnchor,i.args.baseAnchor=r.baseAnchor,i.args.offset=r.offset;break;case ConstraintType.Align:i.items=r.items.map((t=>t.classId?t.classId:t.id)),i.anchor=r.anchor}this.spec.push(i)}for(let t of this.guideCmds)this.spec.push(t);for(let t of this.glyphCmds)t.output&&(t.output=t.output.classId?t.output.classId:t.output.id),this.spec.push(t)}}class SceneLoader{constructor(){this.axes={},this.legends=[],this.gridlines=[],this.scales={},this.tables={}}load(t){console.log("saved",t);let e={};t.fillColor&&(e.fillColor=t.fillColor);let r=scene(e);if(r.id=t.id,r.type=t.type,t.bounds&&(r._bounds=new Rectangle(t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height)),t.tables)for(let e in t.tables)this.tables[e]=new DataTable(t.tables[e].data,e,t.tables[e].fieldTypes);for(let e of t.children)this._processItem(r,e,r);if(t.scales)for(let e in t.scales)this._loadScale(t.scales[e],r);if(t.encodings)for(let e of t.encodings)this._loadEncoding(e,r);if(t.constraints)for(let e in t.constraints)this._loadConstraint(t.constraints[e],r);for(let t in this.axes)this._createGuide(r,this.axes[t]);for(let t of this.legends)this._createGuide(r,t);for(let t of this.gridlines)this._createGuide(r,t);return console.log("loaded",r),r}_loadScale(t){let e=createScale(t.type);e.id=t.id,e.domain="time"==t.type?t.domain.map((t=>new Date(t))):t.domain,e.range=t.range,t.hasOwnProperty("offset")&&(e.offset=t.offset),this.scales[e.id]=e}_loadEncoding(t,e){let r=t.items.map((t=>e.find([{id:t}])[0]));t.args.datatable&&(t.args.datatable=this.tables[t.args.datatable]);let i=new Encoding(r,e,t.channel,t.field,t.args);t.scale&&(i.scale=this.scales[t.scale],i.scale._addEncoding(i)),t.data&&(i.data=t.data),t._rectNegativeValues&&(i._rectNegativeValues=t._rectNegativeValues),e._registerBinding(i)}_createGuide(t,e){switch(e.type){case ItemType.Axis:t.axis(e.channel,e.field,e.args);break;case ItemType.Legend:t.legend(e.channel,e.field,e.args);break;case ItemType.Gridlines:t.gridlines(e.channel,e.field,e.args)}}_processItem(t,e,r){switch(e.type){case ItemType.Axis:let i=e.classId?e.classId:e.id;this.axes[i]=e;break;case ItemType.Gridlines:this.gridlines.push(e);break;case ItemType.Legend:this.legends.push(e);break;case ItemType.Collection:let n=new Collection;t.addChild(n),this._loadGroup(n,e,r);break;case ItemType.Group:let s=new Group;t.addChild(s),this._loadGroup(s,e,r);break;case ItemType.Glyph:let a=new Glyph;t.addChild(a),this._loadGroup(a,e,r);break;default:this._loadMark(t,e,r)}}_loadConstraint(t,e){switch(t.type){case"affixation":{let r=e.find([{id:t.item}])[0],i=e.find([{id:t.baseItem}])[0],n=new AffixConstraint(r,i,e,t.channel,t.itemAnchor,t.baseAnchor,t.offset);return n.id=t.id,e.constraints[t.id]=n,n}case"alignment":{let r=t.items.map((t=>e.find([{id:t}])[0])),i=new AlignConstraint(r,t.direction);return i.id=t.id,e.constraints[t.id]=i,i}}}_loadDataScope(t){let e=new DataScope(this.tables[t.dt]);for(let r in t.f2v)e._field2value[r]=t.f2v[r],e._updateTuples(r,t.f2v[r]);return e}_loadGroup(t,e,r){t.id=e.id,e.classId&&(t.classId=e.classId),e.dataScope&&(t.dataScope=this._loadDataScope(e.dataScope));for(let i of e.children)this._processItem(t,i,r);if(e.layout){let r=this._loadLayout(e.layout);r.group=t,t._layout=r}e.bounds&&(t._bounds=new Rectangle(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height))}_loadMark(t,e,r){let i=r.mark(e.type,e.args);if(i.id=e.id,e.classId&&(i.classId=e.classId),e.dataScope&&(i.dataScope=this._loadDataScope(e.dataScope)),e.vertices){i.vertices=e.vertices.map((t=>Vertex.fromJSON(t,i)));for(let t=1;t<i.vertices.length;t++)i.segments.push(new Segment(i.vertices[t-1],i.vertices[t],i,i.segmentCounter++))}e.bounds&&(i._bounds=new Rectangle(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height)),t.addChild(i)}_loadLayout(t){let e=layout(t.type,t.args);switch(t.type){case LayoutType.Grid:e._left=t.left,e._top=t.top}return e}}class SpecExecutor{constructor(){}async run(t){let e,r,i={},n={},s={};console.log("spec");for(let a of t)switch(console.log(a),a.cmd){case"scene":e=scene(a.args);break;case"data":let t=a.url;r=await csv$1(t),n[a.output]=r;break;case"transform":n[a.output]=n[a.input].transform(a.type,a.args);break;case"mark":let o=e.mark(a.type,a.args);i[a.output]=o;break;case"glyph":let h=e.glyph(...a.input.map((t=>i[t])));i[a.output]=h;break;case"attach":e.attach(i[a.input],n[a.data]);break;case"repeat":{let t=e.repeat(i[a.input],n[a.data],a.args);i[a.output]=t;break}case"divide":{let t=e.divide(i[a.input],n[a.data],a.args);i[a.output]=t;break}case"layout":let l=layout(a.type,a.args);i[a.input].layout=l;break;case"sortChildren":a.args.hasOwnProperty("field")?i[a.input].sortChildrenByData(a.args.field,a.args.reverse,a.args.order):a.args.hasOwnProperty("channel")&&i[a.input].sortChildren(a.args.channel,a.args.reverse);break;case"scale":let u=createScale(a.type);u.id=a.id,u.domain="time"==a.type?a.domain.map((t=>new Date(t))):a.domain,u.range=a.range,u.clamp=a.clamp,a.hasOwnProperty("offset")&&(u.offset=a.offset),s[u.id]=u;break;case"encode":let c,d=a.input;if(d.indexOf("_v_")>0){let t=parseInt(d.split("_v_")[1]);c=i[d.split("_v_")[0]].vertices[t]}else if(d.indexOf("_v")>0);else if(d.indexOf("_s_")>0){let t=parseInt(d.split("_s_")[1]);c=i[d.split("_s_")[0]].segments[t]}else d.indexOf("_s")>0||(c=i[a.input]);a.scale&&s[a.scale]&&(a.args.scale=s[a.scale]),e.encode(c,a.args);break;case"constraint":switch(a.type){case ConstraintType.Affix:e.affix(i[a.item],i[a.baseItem],a.channel,a.args)}break;case"axis":e.axis(a.channel,a.field,a.args);break;case"legend":e.legend(a.channel,a.field,a.args);break;case"gridlines":e.gridlines(a.channel,a.field,a.args)}return e}}var pixiRenderers={};function scene(t){return new Scene(t)}function renderer(t,e){switch(t){case"svg":return new SVGRenderer(e);case"canvas":case"webgl":return pixiRenderers.hasOwnProperty(e)||(pixiRenderers[e]=new WebGLRenderer(e)),pixiRenderers[e]}}function createScale(t,e){if(ScaleType.indexOf(t)<0)throw new Error(Errors.UNKOWNN_SCALE_TYPE+": "+t);return new Scale(t,e)}function layout(t,e){let r=e||{};switch(t.toLowerCase()){case"grid":return new GridLayout(r);case"circular":return new CircularLayout(r);case"packing":return new PackingLayout(r);case"treemap":return new TreemapLayout(r);case"stack":return new StackLayout(r);case"tidytree":return new TidyTreeLayout(r);case"force":return new ForceLayout(r)}}function linearGradient(t){return new LinearGradient(t||{})}function sceneLoader(){return new SceneLoader}function specGenerator(){return new SpecGenerator}function specExecutor(){return new SpecExecutor}function makeRequest(t,e){return new Promise((function(r,i){let n=new XMLHttpRequest;n.open(t,e),n.onload=function(){this.status>=200&&this.status<300?r(n.response):i({status:this.status,statusText:n.statusText})},n.onerror=function(){i({status:this.status,statusText:n.statusText})},n.send()}))}async function csv$1(t){let e=await makeRequest("GET",t),r=csvParse(e.trim(),autoType);return new DataTable(r,t)}async function treejson(t){let e=await makeRequest("GET",t);return new Tree(JSON.parse(e),t)}async function graphjson(t){let e=await makeRequest("GET",t);return new Network(JSON.parse(e),t)}function csvSync(t,e){let r=!!e;var i=new XMLHttpRequest;if(i.open("GET",t,r),i.send(),!r&&validResponse(i)){let e=csvParse(i.responseText.trim(),autoType);return new DataTable(e,t)}}function validResponse(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function cartesianToPolar(t,e,r,i){return cartesian2Polar(t,e,r,i)}function polarToCartesian(t,e,r,i){return polar2Cartesian(t,e,r,i)}exports.cartesianToPolar=cartesianToPolar,exports.createScale=createScale,exports.csv=csv$1,exports.csvSync=csvSync,exports.graphjson=graphjson,exports.layout=layout,exports.linearGradient=linearGradient,exports.polarToCartesian=polarToCartesian,exports.renderer=renderer,exports.scene=scene,exports.sceneLoader=sceneLoader,exports.specExecutor=specExecutor,exports.specGenerator=specGenerator,exports.treejson=treejson,Object.defineProperty(exports,"__esModule",{value:!0})}));
